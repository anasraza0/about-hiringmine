;/*FB_PKG_DELIM*/

__d("BladeRunnerConfig",["RTISubscriptionManagerConfig","WebDriverConfig","cr:3024","gkx","isEmpty"],(function(a,b,c,d,e,f,g){var h,i="javascript-sandbox",j="OverrideServer",k="www_sandbox",l="www_tier";a=function(){function a(){}var d=a.prototype;d.patchRequestHeaders=function(a){var d={},e=c("RTISubscriptionManagerConfig").bladerunner_www_sandbox,f=c("RTISubscriptionManagerConfig").is_intern;if(!(h||(h=c("isEmpty")))(c("WebDriverConfig").auxiliaryServiceInfo)){var g;g=(g=c("WebDriverConfig").auxiliaryServiceInfo.BladeRunner)!=null?g:c("WebDriverConfig").auxiliaryServiceInfo["BladeRunner-sandcastle"];g!=null?(typeof g.ip_address==="string"?d[j]=g.ip_address+":18295":typeof g.hostname==="string"&&(d[j]=g.hostname+":18295"),typeof c("WebDriverConfig").originHost==="string"&&(d[k]="www."+c("WebDriverConfig").originHost)):e!=null&&(d[i]=e)}else e!=null&&(d[i]=e);f===!0&&(d[l]="intern");if(c("WebDriverConfig").isTestRunning&&c("gkx")("20919")){g=b("cr:3024")==null?void 0:b("cr:3024").get();g!=null&&(d.is_test="true",d.original_request_id=g)}c("gkx")("20929")&&(d["Accept-Ack"]="RSAck");for(e in a)d[e]=a[e];d.http_referer=window.location.href;return d};return a}();d=new a();e=d;g["default"]=e}),98);
__d("BladeRunnerLogger",["FBLogger","ODS"],(function(a,b,c,d,e,f,g){var h,i="bladerunner_js_client",j={info:"info",warning:"warning",exception:"exception"};a=function(){function a(){this.setFBLoggerLevel(1)}var b=a.prototype;b.info=function(a){this.$2>=2&&c("FBLogger")(i).info("BladeRunner info: %s",a),this.$3(j.info,a)};b.warn=function(a){this.$2>=1&&c("FBLogger")(i).warn("BladeRunner warn: %s",a),this.$3(j.warning,a)};b.exception=function(a,b){b===void 0&&(b="");var d=b+" "+a.toString();this.$2>=0&&c("FBLogger")(i).warn("BladeRunner exception: %s, %s",b,a.toString());this.$3(j.exception,d)};b.trimForLogging=function(a){var b=1024;return typeof a==="string"&&a.length>b?"[trimmed]:"+a.substring(0,b)+"...":a};b.bumpCounter=function(a,b){b===void 0&&(b=1),(h||(h=d("ODS"))).bumpEntityKey(2966,"BladeRunnerClient",a,b)};b.setClientSessionId=function(a){this.$1=a};b.setFBLoggerLevel=function(a){this.$2=a};b.$3=function(a,b){};return a}();b=new a();e=b;g["default"]=e}),98);
__d("BladeRunnerTypes",[],(function(a,b,c,d,e,f,g){a={REQUEST:1,DATA:2,DATA_ACK:3,STATUS_UPDATE:4,REWRITE_REQUEST:5,LOG:6};b={BLADE_RUNNER:1,GATEWAY:2};g.StreamFrameType=a;g.StreamRequestType=b}),98);
__d("BladeRunnerTypesInternal",["Base64","BladeRunnerLogger","BladeRunnerTypes"],(function(a,b,c,d,e,f,g){var h=function(){function a(){}var b=a.prototype;b.getHeaders=function(){if(this.headers!=null)return this.headers;throw new Error("Expected headers")};b.getInstrumentationData=function(){if(this.instrumentationData!=null&&this.instrumentationData.length>0)try{return JSON.parse(this.instrumentationData)}catch(a){return null}else return null};b.updateRetryRequestPayload=function(a){a!=null?this.payload=c("Base64").encode(a):this.payload=null};a.readObject=function(b){var c=new a();c.streamId=o(b.streamId);c.requestType=o(b.requestType);c.payload=r(b.payload);c.headers=u(b.headers);c.extraHeader=r(b.extraHeader);c.requestTarget=r(b.requestTarget);c.instrumentationData=r(b.instrumentationData);return c};return a}(),i=function(){function a(){}a.readObject=function(b){var c=new a();c.streamId=o(b.streamId);c.dataId=p(b.dataId);c.data=r(b.data);c.shouldAck=w(b.shouldAck);return c};var b=a.prototype;b.rawData=function(){if(this.data==null)throw new Error("Expected data");return this.data};b.rawDataSize=function(){return this.data==null?0:this.data.length};b.decodeData=function(){if(this.data==null)throw new Error("Expected data");return c("Base64").decode(this.data)};b.setData=function(a){this.data=c("Base64").encode(a)};b.getInstrumentationData=function(){if(this.instrumentationData!=null)return JSON.parse(this.instrumentationData);else return null};return a}(),j=function(){function a(){}a.readObject=function(b){var c=new a();c.streamId=o(b.streamId);c.dataId=o(b.dataId);c.success=v(b.success);c.message=r(b.message);c.code=p(b.code);return c};return a}();j.ACK_CODE_LANDED_AND_ACCEPTED=20;j.ACK_CODE_LANDED_BUT_NOT_ACCEPTED=21;j.ACK_CODE_FAILED_TO_LAND=50;var k=function(){function a(){}a.readObject=function(b){var c=new a();c.streamId=p(b.streamId);c.message=r(b.message);return c};return a}(),l=function(){function a(){}a.readObject=function(b){var c=new a();c.streamId=o(b.streamId);c.status=o(b.status);c.message=r(b.message);c.code=p(b.code);c.shouldRetry=w(b.shouldRetry);c.retryDelayMs=p(b.retryDelayMs);return c};return a}(),m=function(){function a(){}a.readObject=function(b){var c=new a();c.streamId=o(b.streamId);c.newBody=r(b.newBody);c.newExtraHeader=r(b.newExtraHeader);c.patchExtraHeader=r(b.patchExtraHeader);c.killBody=w(b.killBody);c.temporary=w(b.temporary);return c};return a}(),n=function(){function a(){}var b=a.prototype;b.getRequest=function(){if(this.type==d("BladeRunnerTypes").StreamFrameType.REQUEST&&this.request!=null)return this.request;throw new Error("Expected request")};b.getData=function(){if(this.type==d("BladeRunnerTypes").StreamFrameType.DATA&&this.data!=null)return this.data;throw new Error("Expected data")};b.getDataAck=function(){if(this.type==d("BladeRunnerTypes").StreamFrameType.DATA_ACK&&this.dataAck!=null)return this.dataAck;throw new Error("Expected dataAck")};b.getStatusUpdate=function(){if(this.type==d("BladeRunnerTypes").StreamFrameType.STATUS_UPDATE&&this.statusUpdate!=null)return this.statusUpdate;throw new Error("Expected status update")};b.getLog=function(){if(this.type==d("BladeRunnerTypes").StreamFrameType.LOG&&this.log!=null)return this.log;throw new Error("Expected log")};b.getRewriteRequest=function(){if(this.type==d("BladeRunnerTypes").StreamFrameType.REWRITE_REQUEST&&this.rewriteRequest!=null)return this.rewriteRequest;throw new Error("Expected rewrite request")};b.getStreamId=function(){if(this.type==d("BladeRunnerTypes").StreamFrameType.REQUEST&&this.request!=null)return this.request.streamId;if(this.type==d("BladeRunnerTypes").StreamFrameType.DATA&&this.data!=null)return this.data.streamId;if(this.type==d("BladeRunnerTypes").StreamFrameType.STATUS_UPDATE&&this.statusUpdate!=null)return this.statusUpdate.streamId;if(this.type==d("BladeRunnerTypes").StreamFrameType.LOG&&this.log!=null)return this.log.streamId;if(this.type==d("BladeRunnerTypes").StreamFrameType.REWRITE_REQUEST&&this.rewriteRequest!=null)return this.rewriteRequest.streamId;if(this.type==d("BladeRunnerTypes").StreamFrameType.DATA_ACK&&this.dataAck!=null)return this.dataAck.streamId;throw new Error("Frame with unexpected type")};b.isInstrumented=function(){if(this.type===d("BladeRunnerTypes").StreamFrameType.REQUEST)return this.getRequest().instrumentationData!=null;else if(this.type===d("BladeRunnerTypes").StreamFrameType.DATA)return this.getData().instrumentationData!=null;else return!1};a.readObject=function(b){var e=new a();e.type=o(b.type);switch(e.type){case d("BladeRunnerTypes").StreamFrameType.REQUEST:e.request=h.readObject(s(b.request));break;case d("BladeRunnerTypes").StreamFrameType.DATA:e.data=i.readObject(s(b.data));break;case d("BladeRunnerTypes").StreamFrameType.DATA_ACK:e.dataAck=j.readObject(s(b.dataAck));break;case d("BladeRunnerTypes").StreamFrameType.STATUS_UPDATE:e.statusUpdate=l.readObject(s(b.statusUpdate));break;case d("BladeRunnerTypes").StreamFrameType.LOG:e.log=k.readObject(s(b.log));break;case d("BladeRunnerTypes").StreamFrameType.REWRITE_REQUEST:e.rewriteRequest=m.readObject(s(b.rewriteRequest));break;default:c("BladeRunnerLogger").warn("Frame with unexpected type: "+e.type);return null}return e};a.newRequestFrame=function(b){var c=new a();c.type=d("BladeRunnerTypes").StreamFrameType.REQUEST;c.request=b;return c};a.newDataFrame=function(b){var c=new a();c.type=d("BladeRunnerTypes").StreamFrameType.DATA;c.data=b;return c};a.newDataAckFrame=function(b){var c=new a();c.type=d("BladeRunnerTypes").StreamFrameType.DATA_ACK;c.dataAck=b;return c};a.newStatusUpdateFrame=function(b){var c=new a();c.type=d("BladeRunnerTypes").StreamFrameType.STATUS_UPDATE;c.statusUpdate=b;return c};a.newLogFrame=function(b){var c=new a();c.type=d("BladeRunnerTypes").StreamFrameType.LOG;c.log=b;return c};a.newRewriteRequestFrame=function(b){var c=new a();c.type=d("BladeRunnerTypes").StreamFrameType.REWRITE_REQUEST;c.rewriteRequest=b;return c};return a}();a=function(){function a(a,b,c){this.batchId=a,this.frames=b,this.instrumentationData=c}var b=a.prototype;b.getFrames=function(){if(this.frames!=null)return this.frames;throw new Error("Expected frames")};b.getInstrumentationData=function(){if(this.instrumentationData!=null)try{return JSON.parse(this.instrumentationData)}catch(a){return null}else return null};b.getInstrumentationDataDfTraceId=function(){if(this.instrumentationData!=null)try{var a=JSON.parse(this.instrumentationData);return(a=a.dataFlowTracingData)==null?void 0:a.traceId}catch(a){return null}else return null};b.write=function(){return JSON.stringify(this)};b.isInstrumented=function(){return this.getFrames().some(function(a){return a.isInstrumented()})};a.read=function(b){b=JSON.parse(b);var c=b.batchId||0,d=[];for(var e of b.frames){var f=n.readObject(e);f!=null&&d.push(f)}f=b.instrumentationData||null;return new a(c,d,f)};return a}();function o(a){if(typeof a==="number")return a;throw new Error("Expected number")}function p(a){return a==null?null:o(a)}function q(a){if(typeof a==="string")return a;throw new Error("Expected string")}function r(a){return a==null?null:q(a)}function s(a){if(typeof a==="object"&&a!=null)return a;throw new Error("Expected object")}function t(a){if(typeof a==="object"&&a!=null){var b=a,c={};Object.keys(b).forEach(function(a){var d=b[a];typeof d==="string"&&d!=null&&(c[a]=d)});return c}throw new Error("Expected string map")}function u(a){return a==null?null:t(a)}function v(a){if(typeof a==="boolean"&&a!=null)return a;throw new Error("Expected boolean")}function w(a){return a==null?null:v(a)}g.GatewayStreamRequest=h;g.GatewayStreamData=i;g.GatewayStreamDataAck=j;g.GatewayStreamLog=k;g.GatewayStreamStatusUpdate=l;g.GatewayStreamRewriteRequest=m;g.GatewayStreamFrame=n;g.GatewayStreamBatch=a}),98);
__d("RequestStreamE2EClientLoggerEvent",[],(function(a,b,c,d,e,f){a=Object.freeze({RECEIVED:"received",SENT:"sent",FAILURE:"failure",PUBACK:"puback"});f["default"]=a}),66);
__d("RequestStreamE2EClientLoggerMessageType",[],(function(a,b,c,d,e,f){a=Object.freeze({REQUEST_STREAM:"request_stream",AMENDMENT:"amendment",AMENDMENT_ACK:"amendment_ack",CANCEL:"cancel",RESPONSE:"response",RESPONSE_ACK:"response_ack",TIMED_REQUEST:"timed_request",INTERRUPT:"interrupt"});f["default"]=a}),66);
__d("BladeRunnerEventHandler",["BladeRunnerLogger","BladeRunnerStreamStatus","BladeRunnerTypes","BladeRunnerTypesInternal","RequestStreamE2EClientLoggerEvent","RequestStreamE2EClientLoggerMessageType","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f,g){var h=1e3;a=function(){function a(a,b,c){this.$2=a,this.$1=b,this.$3=c}var b=a.prototype;b.onProxyResponse=function(a){this.$4(a);var b=[];for(var e of a.getFrames())this.$2.witnessFrame(e)&&b.push(e);e=this.$2.getRequest();(e=e.e2eLogger)==null||e.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").RESPONSE,c("RequestStreamE2EClientLoggerEvent").SENT,{},(e=a.getInstrumentationData())==null?void 0:e.auxId,null,a.getInstrumentationDataDfTraceId());b.length>0&&this.$5(new(d("BladeRunnerTypesInternal").GatewayStreamBatch)(a.batchId,b,a.instrumentationData))};b.onDisconnect=function(){this.$2.resetErrors();var a=new(d("BladeRunnerTypesInternal").GatewayStreamStatusUpdate)();a.streamId=this.$2.getRequest().streamId;a.status=d("BladeRunnerStreamStatus").StreamStatus.CLOSED;a.shouldRetry=!0;a.retryDelayMs=0;a=new(d("BladeRunnerTypesInternal").GatewayStreamBatch)(null,[d("BladeRunnerTypesInternal").GatewayStreamFrame.newStatusUpdateFrame(a)]);this.onProxyResponse(a)};b.$4=function(a){var b=this;a=a.getFrames().filter(function(a){return a.type==d("BladeRunnerTypes").StreamFrameType.STATUS_UPDATE});for(a of a){var e=a.getStatusUpdate();if(e.status==d("BladeRunnerStreamStatus").StreamStatus.CLOSED||e.status==d("BladeRunnerStreamStatus").StreamStatus.REJECTED){this.$2.onError();var f=e.shouldRetry!=null&&e.shouldRetry,g=e.message!=null?e.message:"null";if(f&&this.$2.getErrorCount()<=this.$2.getRetriesAllowed()){e.status=d("BladeRunnerStreamStatus").StreamStatus.STOPPED;var i=h;e.retryDelayMs!=null&&(i=e.retryDelayMs);c("BladeRunnerLogger").info("Can retry: stream "+e.streamId+" closed with status "+e.status+", message "+g+". Error count: "+this.$2.getErrorCount()+", retryDelay "+i+"ms. Already retrying: "+this.$2.getRetryRequestScheduled().toString());this.$2.getRetryRequestScheduled()?c("BladeRunnerLogger").bumpCounter("stream_closed_already_retrying"):(c("BladeRunnerLogger").bumpCounter("stream_closed_will_retry"),this.$2.setRetryRequestScheduled(!0),i>0?c("setTimeoutAcrossTransitions")(function(){return b.$6()},i):this.$6())}else c("BladeRunnerLogger").info("Will not retry: stream "+e.streamId+" closed with status "+e.status+", message "+g+". Error count: "+this.$2.getErrorCount()+", shouldRetry "+f.toString()+". Already retrying: "+this.$2.getRetryRequestScheduled().toString()),f?c("BladeRunnerLogger").bumpCounter("stream_closed_retry_exceeded"):c("BladeRunnerLogger").bumpCounter("stream_closed_no_retry"),this.$3.removeStream(e.streamId)}}};b.$6=function(){this.$2.setRetryRequestScheduled(!1);if(this.$2.isAlive()){var a=this.$1.getUpdatedRequestBody();a!=null&&this.$2.updateRetryRequestPayload(a);this.$3.sendRetryStreamRequest(this.$2)}};b.$5=function(a){c("BladeRunnerLogger").bumpCounter("send_to_handler");var b=[];this.$1.onBatch(a);for(a of a.getFrames())try{switch(a.type){case d("BladeRunnerTypes").StreamFrameType.DATA:this.$1.onData(a.getData());b.push(a.getData());break;case d("BladeRunnerTypes").StreamFrameType.STATUS_UPDATE:this.$1.onStatusUpdate(a.getStatusUpdate().status);break;case d("BladeRunnerTypes").StreamFrameType.LOG:var e=a.getLog().message;e!=null&&this.$1.onLog(e);break;case d("BladeRunnerTypes").StreamFrameType.DATA_ACK:break;default:throw new Error("Frame with unexpected type")}}catch(a){c("BladeRunnerLogger").bumpCounter("send_to_handler_error"),c("BladeRunnerLogger").exception(a,"Failed sending frame to stream handler")}this.$7(b)};b.$7=function(a){var b=[];for(a of a)if(a.shouldAck===!0&&a.dataId!=null){var c=new(d("BladeRunnerTypesInternal").GatewayStreamDataAck)();c.streamId=a.streamId;c.dataId=a.dataId;c.success=!0;b.push(c)}this.$3.sendDataAcks(b)};return a}();g["default"]=a}),98);
__d("RtiRequestStreamE2eClientBatchFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("819");b=d("FalcoLoggerInternal").create("rti_request_stream_e2e_client_batch",a);e=b;g["default"]=e}),98);
__d("RtiRequestStreamE2eClientFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1857112");b=d("FalcoLoggerInternal").create("rti_request_stream_e2e_client",a);e=b;g["default"]=e}),98);
__d("RequestStreamE2ELogger",["ConstUriUtils","FBLogger","RequestStreamE2EClientLoggerEvent","RequestStreamE2EClientLoggerMessageType","RtiRequestStreamE2eClientBatchFalcoEvent","RtiRequestStreamE2eClientFalcoEvent","WebStorage"],(function(a,b,c,d,e,f,g){"use strict";var h;e="rs_debug_logging";var i=["FBGQLS:COMMENT_CREATE_SUBSCRIBE","FBGQLS:COMMENT_LIKE_SUBSCRIBE","FBGQLS:FEEDBACK_COMMENT_PERMISSION_TOGGLE_SUBSCRIBE","FBGQLS:FEEDBACK_TYPING_SUBSCRIBE","FBLQ:comet_notifications_live_query_experimental"],j=0;function k(){var a=Date.now();j>=a?j+=1:j=a;return j.toString()}var l=function(){function a(a,b,c,e,f,g,h,i,j,k){this.$10=[];this.$11=!1;this.$1=a;this.$2=b;this.$3=c;this.$4=e;this.$5=f;this.$6=g;this.$7=h;this.$8=i;this.$9=j;this.$12=k!=null?k:!1;a=d("ConstUriUtils").getUri(window.location.href);a&&(this.$13=a.getDomain())}var b=a.prototype;b.logE2EEvent=function(a,b,c,d,e,f,g){c===void 0&&(c=null);d===void 0&&(d=null);e===void 0&&(e=null);f===void 0&&(f=null);g===void 0&&(g=null);if(this.$3==="Falco")return;e={request_id:this.$1,resume_id:"0",retry_id:e,transport:this.$2,method:this.$3,use_case:this.$4,request_log_context:this.$5,force_log_context:this.$6,e2e_sample_rate:this.$7,message_type:a,event:b,timestamp_ms:k(),aux_id:d,additional_data:c,dgw_stream_group_logging_id:this.$8,dgw_count_prior_streams_in_group:this.$9,domain:this.$13,df_trace_id:f};this.$14(e,g)};b.$14=function(a,b){if(!this.$12){c("RtiRequestStreamE2eClientFalcoEvent").log(function(){return a});return}this.$10.push(a);if(this.$11||a.event==c("RequestStreamE2EClientLoggerEvent").FAILURE||a.message_type==c("RequestStreamE2EClientLoggerMessageType").RESPONSE){var d={events:this.$10};c("RtiRequestStreamE2eClientBatchFalcoEvent").log(function(){return d});this.$10=[];this.$11=!0}};b.getRequestId=function(){return this.$1};return a}();function a(a,b,c){if(a==null||a.method==null)return null;var d=!1;i.includes(a.method)&&(d=!0);if(b==null||b.length==0)return null;b=JSON.parse(b);return b.requestId==null?null:new l(b.requestId,c,a.method,m(a.method,a),b.requestLogContext,b.forceLogContext,b.sampleRate,b.dgwStreamGroupLoggingId,b.dgwCountPriorStreamsInGroup,d)}function m(a,b){if(a==="FBLQ"&&b.config_id)return b.config_id;if(a==="SKY"){if(b.topic){var c=b.topic.lastIndexOf("/");return c>0?b.topic.substr(0,c):b.topic}return}return a}function b(a,b,d,e,f,g){f===void 0&&(f=null);g===void 0&&(g=null);if(a==null||a.requestId==null||a.clientLoggingDisabled!=null)return;var h={request_id:a.requestId,resume_id:"0",transport:b,e2e_sample_rate:a.sampleRate,message_type:d,event:e,timestamp_ms:k(),aux_id:a.auxId,additional_data:f,df_trace_id:g};c("RtiRequestStreamE2eClientFalcoEvent").log(function(){return h})}g.RequestStreamE2ELogger=l;g.createStreamLogger=a;g.logRequestStreamE2EEventStatic=b}),98);
__d("RequestStreamTransport",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["WEB_BR_MQTT","WEB_RS_MQTT","WEB_RS_STARGATE"]);f.RequestStreamTransport=a}),66);
__d("BladeRunnerSocket",["BladeRunnerEventHandler","BladeRunnerLogger","BladeRunnerStreamStatus","BladeRunnerTypes","BladeRunnerTypesInternal","CurrentUser","FBMqttChannel","MqttPublishListener","Promise","RequestStreamE2EClientLoggerEvent","RequestStreamE2EClientLoggerMessageType","RequestStreamE2ELogger","RequestStreamTransport","justknobx","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h,i="Connected",j="Disconnected",k="/br_sr",l="/sr_res",m=null;function n(a){var b;switch(a.type){case d("BladeRunnerTypes").StreamFrameType.REQUEST:return(b=a.request)==null?void 0:b.getInstrumentationData();case d("BladeRunnerTypes").StreamFrameType.DATA:return(b=a.data)==null?void 0:b.getInstrumentationData()}return null}function o(a){switch(a.type){case d("BladeRunnerTypes").StreamFrameType.REQUEST:return c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM;case d("BladeRunnerTypes").StreamFrameType.DATA:return c("RequestStreamE2EClientLoggerMessageType").AMENDMENT}return null}function p(a){if(a===null)return null;switch(a){case d("BladeRunnerStreamStatus").StreamStatus.ACCEPTED:return"Accepted";case d("BladeRunnerStreamStatus").StreamStatus.REJECTED:return"Rejected";case d("BladeRunnerStreamStatus").StreamStatus.STARTED:return"Started";case d("BladeRunnerStreamStatus").StreamStatus.STOPPED:return"Stopped";case d("BladeRunnerStreamStatus").StreamStatus.CLOSED:return"Closed"}return null}function q(a){var b,c={};a==null||(b=a.frames)==null||b.forEach(function(a){if(a.type===d("BladeRunnerTypes").StreamFrameType.STATUS_UPDATE){a=(a=a.statusUpdate)==null?void 0:a.status;a=p(a);a!==null&&(c.flow_status=a)}});return c}function r(a,b){var c;switch(a.type){case d("BladeRunnerTypes").StreamFrameType.REQUEST:b.data_base64_size=(c=a.request)==null||(c=c.payload)==null||(c=c.length)==null?void 0:c.toString();break;case d("BladeRunnerTypes").StreamFrameType.DATA:b.data_base64_size=(c=a.data)==null||(c=c.rawDataSize())==null?void 0:c.toString();break}return null}function s(a,b,e){var f=n(a);if(f==null)return;var g=o(a);if(g==null)return;var h=null;switch(b){case d("MqttPublishListener").MqttPublishEvent.SENT:h=c("RequestStreamE2EClientLoggerEvent").SENT;break;case d("MqttPublishListener").MqttPublishEvent.ACKED:h=c("RequestStreamE2EClientLoggerEvent").PUBACK;break;case d("MqttPublishListener").MqttPublishEvent.NOT_ACKED:case d("MqttPublishListener").MqttPublishEvent.NOT_CONNECTED:case d("MqttPublishListener").MqttPublishEvent.PUBLISH_ERROR:h=c("RequestStreamE2EClientLoggerEvent").FAILURE;e.reason==null&&(e.reason=b);break}if(h==null)return;r(a,e);if(((b=a.request)==null?void 0:b.e2eLogger)!=null&&f.clientLoggingDisabled==null){(b=a.request)==null||b.e2eLogger.logE2EEvent(g,h,e,f.auxId)}else d("RequestStreamE2ELogger").logRequestStreamE2EEventStatic(f,d("RequestStreamTransport").RequestStreamTransport.WEB_BR_MQTT,g,h,e)}a=function(){function a(a){this.$1=[],this.$2=0,this.$3=0,this.$4=null,this.$5=0,this.$6=new Map(),this.$7=a!=null?a:c("FBMqttChannel"),this.$8=new Map(),c("BladeRunnerLogger").setClientSessionId(c("uuidv4")()),this.$9()}a.get=function(){m==null&&(m=new a(c("FBMqttChannel")));return m};var e=a.prototype;e.sendNewStreamRequest=function(b,d){d=new(c("BladeRunnerEventHandler"))(b,d,this);var e=b.getRequest();this.$6.set(e.streamId,d);if(!this.$10()){this.$11(d,e.streamId);return}this.getStreamCount()<=a.maxStreamCount?this.$12(e):(c("BladeRunnerLogger").bumpCounter("socket_request_throttled_max_streams"),c("BladeRunnerLogger").warn("Maximum stream count reached, will not send request: "+JSON.stringify(b.getRequest().getHeaders())),this.$11(d,e.streamId))};e.sendRetryStreamRequest=function(a){this.$12(a.getRequest())};e.sendCancel=function(a){c("BladeRunnerLogger").bumpCounter("socket_send_cancel");var b=new(d("BladeRunnerTypesInternal").GatewayStreamStatusUpdate)();b.streamId=a.streamId;b.status=d("BladeRunnerStreamStatus").StreamStatus.CLOSED;this.$13(b,a);this.removeStream(a.streamId)};e.sendAmendment=function(a,b,e){c("BladeRunnerLogger").bumpCounter("socket_send_amendment");var f=new(d("BladeRunnerTypesInternal").GatewayStreamData)();f.streamId=a;f.setData(b);e!=null&&(f.instrumentationData=e);this.$14(f)};e.sendAmendmentWithAck=function(a,e,f){var g=this;c("BladeRunnerLogger").bumpCounter("socket_send_amendment");var i=this.$15(),j=new(d("BladeRunnerTypesInternal").GatewayStreamData)();j.streamId=a;j.setData(e);j.shouldAck=!0;j.dataId=i;f!=null&&(j.instrumentationData=f);a=new(h||(h=b("Promise")))(function(a,b){g.$8.set(i,{resolve:a,reject:b})});this.$14(j);return a};e.$14=function(a){this.$1.push(d("BladeRunnerTypesInternal").GatewayStreamFrame.newDataFrame(a)),this.$16()};e.sendDataAcks=function(a){c("BladeRunnerLogger").bumpCounter("socket_send_data_ack",a.length),this.$17(a)};e.removeStream=function(a){this.$6["delete"](a)};e.getStreamCount=function(){return this.$6.size};e.getNextStreamId=function(){this.$5++;return this.$5};e.onMQTTStateChanged=function(a){this.$16();if(a!=j&&a!=i||this.$4==a)return;this.$4=a;c("BladeRunnerLogger").info("MQTTStateChanged: "+a);a==j?(c("BladeRunnerLogger").bumpCounter("mqtt_state_disconnected"),this.$18()):a==i&&c("BladeRunnerLogger").bumpCounter("mqtt_state_connected")};e.$12=function(a){c("BladeRunnerLogger").bumpCounter("socket_send_request");this.$1.push(d("BladeRunnerTypesInternal").GatewayStreamFrame.newRequestFrame(a));if(!this.$16()){(a=a.e2eLogger)==null||a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:"MQTT Not Connected"})}};e.$13=function(a,b){this.$1.push(d("BladeRunnerTypesInternal").GatewayStreamFrame.newStatusUpdateFrame(a));if(this.$16()){(a=b.e2eLogger)==null||a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").CANCEL,c("RequestStreamE2EClientLoggerEvent").SENT)}};e.$17=function(a){for(a of a)this.$1.push(d("BladeRunnerTypesInternal").GatewayStreamFrame.newDataAckFrame(a));this.$16()};e.$19=function(){this.$2++;return this.$2};e.$15=function(){this.$3++;return this.$3};e.$16=function(){var a=!1;if(this.$7.getConnectionState()===i&&this.$1.length>0)try{this.$20(this.$1),a=!0}catch(a){}finally{this.$1=[]}return a};e.$20=function(a){var b=this,e=new(d("BladeRunnerTypesInternal").GatewayStreamBatch)(this.$19(),a),f=e.write();if(f.length>this.$21()){var g=Math.floor(a.length/2);if(g===0){a.forEach(function(a){return s(a,d("MqttPublishListener").MqttPublishEvent.PUBLISH_ERROR,{reason:"too long"})});var h=new Error("Publish is too long: "+f.length);h.stack;this.$22(e,h,"Publish is too long");throw h}this.$20(a.slice(0,g));this.$20(a.slice(g,a.length))}else try{c("BladeRunnerLogger").info("send message to "+k+" ("+f.length+" bytes)");h={qos:1,skipBuffer:!1};if(e.isInstrumented()){var i=Date.now();h.listener={onEvent:function(b){var c=(Date.now()-i).toString();a.forEach(function(a){s(a,b,{latency:c})})}}}this.$7.publish(k,f,h)["catch"](function(a){b.$22(e,a,"Failed publishing to MQTT")});c("BladeRunnerLogger").bumpCounter("mqtt_publish_success")}catch(a){this.$22(e,a,"Failed publishing to MQTT");throw a}};e.$9=function(){var a=this;c("BladeRunnerLogger").info("Starting socket with endpoint "+this.$7.getEndpoint()+" useragent "+navigator.userAgent);this.onMQTTStateChanged(this.$7.getConnectionState());this.$7.subscribeChannelEvents({onMQTTStateChanged:function(b){a.onMQTTStateChanged(b)},onJSError:function(a){var b=a!=null&&typeof a.isRecoverable==="boolean"?a.isRecoverable:!1;b?c("BladeRunnerLogger").bumpCounter("mqtt_channel_recoverable_error"):(c("BladeRunnerLogger").warn("JS error in MQTTChannel: "+(typeof a=="object"&&a!=null?a.toString():"unknown error")+", "+JSON.stringify(a)),c("BladeRunnerLogger").bumpCounter("mqtt_channel_error"))}});this.$7.subscribe(k,function(a){throw new Error("Unexpected response: "+k+" "+a.toString())});this.$7.subscribe(l,function(b){a.$23(b)})};e.$23=function(a){a=d("BladeRunnerTypesInternal").GatewayStreamBatch.read(a);this.processBatch(a)};e.$22=function(a,b,e){for(a of a.getFrames())if(a.type===d("BladeRunnerTypes").StreamFrameType.REQUEST){var f=a.getRequest(),g=this.$6.get(f.streamId);g!=null&&this.$24(g,f.streamId,d("BladeRunnerStreamStatus").StreamStatus.CLOSED,!0,null)}else if(a.type===d("BladeRunnerTypes").StreamFrameType.DATA){g=a.getData();f=g.dataId;if(g.shouldAck!=null&&g.shouldAck&&f!=null){var h=new(d("BladeRunnerTypesInternal").GatewayStreamDataAck)();h.streamId=g.streamId;h.dataId=f;h.success=!1;h.code=d("BladeRunnerTypesInternal").GatewayStreamDataAck.ACK_CODE_FAILED_TO_LAND;h.message=e;this.$25(h)}}c("BladeRunnerLogger").info("Failed publishing to MQTT: "+b.message);c("BladeRunnerLogger").bumpCounter("mqtt_publish_error")};e.$25=function(a){var b=this.$8.get(a.dataId);b!=null&&(this.$8["delete"](a.dataId),a.success?b.resolve(!0):a.code===d("BladeRunnerTypesInternal").GatewayStreamDataAck.ACK_CODE_LANDED_BUT_NOT_ACCEPTED?b.resolve(!1):b.reject(a.message))};e.processBatch=function(a){try{d("RequestStreamE2ELogger").logRequestStreamE2EEventStatic(a.getInstrumentationData(),d("RequestStreamTransport").RequestStreamTransport.WEB_BR_MQTT,c("RequestStreamE2EClientLoggerMessageType").RESPONSE,c("RequestStreamE2EClientLoggerEvent").RECEIVED,q(a),a.getInstrumentationDataDfTraceId());c("BladeRunnerLogger").bumpCounter("socket_process_batch");var b=JSON.stringify(a);c("BladeRunnerLogger").info("Received batch ("+b.length+" bytes)");b=null;for(var e of a.getFrames()){var f=e.getStreamId();b==null&&(b=f);if(f!=null&&b!=f)throw new Error("Received batch with frames for multiple streams");e.type==d("BladeRunnerTypes").StreamFrameType.DATA_ACK&&this.$25(e.getDataAck())}if(b!=null){f=this.$6.get(b);f!=null?f.onProxyResponse(a):c("BladeRunnerLogger").info("Received batch with frames for unknown stream id: "+b)}else c("BladeRunnerLogger").info("Received batch with no frames")}catch(a){c("BladeRunnerLogger").exception(a,"Failed processing batch from MQTT");c("BladeRunnerLogger").bumpCounter("socket_process_batch_error");throw a}};e.$18=function(){this.$6.forEach(function(a,b,c){a.onDisconnect()})};e.$11=function(a,b){this.$24(a,b,d("BladeRunnerStreamStatus").StreamStatus.REJECTED,!1,0)};e.$24=function(a,b,c,e,f){var g=new(d("BladeRunnerTypesInternal").GatewayStreamStatusUpdate)();g.streamId=b;g.status=c;g.shouldRetry=e;g.retryDelayMs=f;b=new(d("BladeRunnerTypesInternal").GatewayStreamBatch)(null,[d("BladeRunnerTypesInternal").GatewayStreamFrame.newStatusUpdateFrame(g)]);a.onProxyResponse(b)};e.$10=function(){if(!c("CurrentUser").isLoggedIn()){c("BladeRunnerLogger").bumpCounter("request_stream_user_logged_out");return!1}return!0};e.$21=function(){var a=1024*1024,b=512*1024;try{var d=c("justknobx")._("317");b=d*a}catch(a){}return Math.max(b-1024,0)};return a}();a.maxStreamCount=2e3;g["default"]=a}),98);
__d("BladeRunnerStream",[],(function(a,b,c,d,e,f){a=function(){function a(a){this.$1=a}var b=a.prototype;b.getStreamHandler=function(){return this.$1};b.cancel=function(){};b.amendWithAck=async function(a){return!1};b.amendFireAndForget=function(a){};b.amendWithoutAck=function(a){};b.start=function(){return Promise.resolve()};b.isAlive=function(){return!1};b.canAmend=function(){return!1};b.getStatus=function(){return null};b.getStreamId=function(){return 0};return a}();f.default=a}),66);
__d("BladeRunnerStreamState",["BladeRunnerLogger","BladeRunnerStreamStatus","BladeRunnerTypes"],(function(a,b,c,d,e,f,g){a=function(){function a(a){this.$1=a,this.$2=null,this.$3=0,this.$4=!1,this.$5=0,this.$6=!1}var b=a.prototype;b.getRequest=function(){return this.$1};b.updateRetryRequestPayload=function(a){this.$1.updateRetryRequestPayload(a)};b.isAlive=function(){return!(this.$2==d("BladeRunnerStreamStatus").StreamStatus.CLOSED||this.$2==d("BladeRunnerStreamStatus").StreamStatus.REJECTED)};b.canAmend=function(){return this.$2==d("BladeRunnerStreamStatus").StreamStatus.ACCEPTED||this.$2==d("BladeRunnerStreamStatus").StreamStatus.STARTED||this.$2==d("BladeRunnerStreamStatus").StreamStatus.STOPPED};b.getLastStatus=function(){return this.$2};b.setLastStatus=function(a){this.$2=a};b.onError=function(){this.$3+=1};b.getErrorCount=function(){return this.$3};b.resetErrors=function(){this.$3=0};b.getRetryRequestScheduled=function(){return this.$6};b.setRetryRequestScheduled=function(a){this.$6=a};b.witnessFrame=function(a){switch(a.type){case d("BladeRunnerTypes").StreamFrameType.STATUS_UPDATE:var b=a.getStatusUpdate(),c=!0;switch(b.status){case d("BladeRunnerStreamStatus").StreamStatus.ACCEPTED:c=!this.$4;this.$4||(this.$4=!0);break;case d("BladeRunnerStreamStatus").StreamStatus.STARTED:c=this.getLastStatus()!=d("BladeRunnerStreamStatus").StreamStatus.STARTED;break;case d("BladeRunnerStreamStatus").StreamStatus.STOPPED:c=this.getLastStatus()==d("BladeRunnerStreamStatus").StreamStatus.STARTED;break;case d("BladeRunnerStreamStatus").StreamStatus.CLOSED:case d("BladeRunnerStreamStatus").StreamStatus.REJECTED:default:c=!0}this.setLastStatus(b.status);return c;case d("BladeRunnerTypes").StreamFrameType.REWRITE_REQUEST:this.$7(a.getRewriteRequest());return!1;default:return!0}};b.setRetriesAllowed=function(a){this.$5=a};b.getRetriesAllowed=function(){return this.$5};b.$7=function(a){if(!(a.temporary!=null||a.temporary==!0)){a.newBody!=null&&(this.$1.payload=a.newBody);a.newExtraHeader!=null&&(this.$1.extraHeader=a.newExtraHeader,this.$1.headers=JSON.parse(a.newExtraHeader));if(a.patchExtraHeader!=null)try{var b=JSON.parse(a.patchExtraHeader),d=this.$1.extraHeader!=null?JSON.parse(this.$1.extraHeader):{};this.$1.headers==null&&(this.$1.headers={});for(var e of Object.keys(b))this.$1.headers[e]=b[e],d[e]=b[e];this.$1.extraHeader=JSON.stringify(d)}catch(b){c("BladeRunnerLogger").warn("Failed to patch header: "+a.patchExtraHeader)}a.killBody!=null&&a.killBody==!0&&(this.$1.payload=null)}};return a}();g["default"]=a}),98);
__d("BladeRunnerSocketStream",["BladeRunnerStream","BladeRunnerStreamState","BladeRunnerStreamStatus","RequestStreamE2EClientLoggerEvent","RequestStreamE2EClientLoggerMessageType","uuidv4"],(function(a,b,c,d,e,f,g){var h=4,i={reason:"stream_dead"};a=function(a){function b(b,d,e){b=a.call(this,b)||this;b.$BladeRunnerSocketStream$p_1=e;b.$BladeRunnerSocketStream$p_2=new(c("BladeRunnerStreamState"))(d);b.$BladeRunnerSocketStream$p_2.setRetriesAllowed(h);return b}babelHelpers.inheritsLoose(b,a);var e=b.prototype;e.start=function(){var a=this;return new Promise(function(b){a.send(),b()})};e.send=function(){var a,b=this.$BladeRunnerSocketStream$p_2.getRequest();(a=b.e2eLogger)==null||a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").RECEIVED,{data_base64_size:(a=b.payload)==null||(a=a.length)==null?void 0:a.toString()});this.$BladeRunnerSocketStream$p_1.sendNewStreamRequest(this.$BladeRunnerSocketStream$p_2,this.getStreamHandler())};e.amendWithAck=async function(a){var b=this.$BladeRunnerSocketStream$p_2.getRequest(),d=b.getInstrumentationData();if(d){var e,f;d.auxId=c("uuidv4")();(e=b.e2eLogger)==null||e.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").RECEIVED,{data_size:a==null||(f=a.length)==null?void 0:f.toString()},d.auxId)}if(this.canAmend()){if(d){var g;(e=b.e2eLogger)==null||e.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").SENT,{data_size:a==null||(g=a.length)==null?void 0:g.toString()},d.auxId)}return this.$BladeRunnerSocketStream$p_1.sendAmendmentWithAck(b.streamId,this.$BladeRunnerSocketStream$p_3(a),d==null?null:JSON.stringify(d))}(e=b.e2eLogger)==null||e.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").FAILURE,i,d==null?void 0:d.auxId);return Promise.reject("Stream is closed or not accepted")};e.amendFireAndForget=function(a){var b=this.$BladeRunnerSocketStream$p_2.getRequest(),d=b.getInstrumentationData();if(d){var e,f;d.auxId=c("uuidv4")();(e=b.e2eLogger)==null||e.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").RECEIVED,{data_size:a==null||(f=a.length)==null?void 0:f.toString()},d.auxId)}if(this.canAmend()){this.$BladeRunnerSocketStream$p_1.sendAmendment(this.$BladeRunnerSocketStream$p_2.getRequest().streamId,this.$BladeRunnerSocketStream$p_3(a),d==null?null:JSON.stringify(d));if(d){var g;(e=b.e2eLogger)==null||e.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").SENT,{data_size:a==null||(g=a.length)==null?void 0:g.toString()},d.auxId)}}else{(e=b.e2eLogger)==null||e.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").FAILURE,i,d==null?void 0:d.auxId);throw new Error("Stream is closed or not accepted")}};e.amendWithoutAck=function(a){this.amendFireAndForget(a)};e.$BladeRunnerSocketStream$p_3=function(a){return typeof a=="object"?btoa(new TextDecoder("utf8").decode(a)):a};e.cancel=function(){var a=this.$BladeRunnerSocketStream$p_2.getRequest();(a=a.e2eLogger)==null||a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").CANCEL,c("RequestStreamE2EClientLoggerEvent").RECEIVED);this.isAlive()&&(this.$BladeRunnerSocketStream$p_1.sendCancel(this.$BladeRunnerSocketStream$p_2.getRequest()),this.$BladeRunnerSocketStream$p_2.setLastStatus(d("BladeRunnerStreamStatus").StreamStatus.CLOSED),this.getStreamHandler().onClientCancel())};e.isAlive=function(){return this.$BladeRunnerSocketStream$p_2.isAlive()};e.canAmend=function(){return this.$BladeRunnerSocketStream$p_2.canAmend()};e.getStatus=function(){return this.$BladeRunnerSocketStream$p_2.getLastStatus()};e.getStreamId=function(){return this.$BladeRunnerSocketStream$p_2.getRequest().streamId};return b}(c("BladeRunnerStream"));g.default=a}),98);
__d("RequestStreamE2ESampling",["invariant","Random","RequestStreamE2EClientSamplingConfig","uuidv4"],(function(a,b,c,d,e,f,g,h){"use strict";function i(a){return a==null?!1:a.requestId!=null&&typeof a.requestId=="string"&&a.forceLogContext!=null&&typeof a.forceLogContext=="string"}function j(a,b){var d=c("RequestStreamE2EClientSamplingConfig").sampleRate;if(d>1&&a!=null){a=c("RequestStreamE2EClientSamplingConfig").methodToSamplingMultiplier[a];a==0?d=0:a!=null&&(d/=a)}return d==1?1:d/b}function k(a,b,d,e){var f=c("uuidv4")();(b.requestId==null||b.requestId===""||typeof b.requestId!="string")&&(a.requestId!=null&&typeof a.requestId=="string"?b.requestId=a.requestId:b.requestId=f);b.requestId+="/_"+f.substring(0,4);b.resumeId="0";d!=null?b.sampleRate=d:b.sampleRate=void 0;f="";e!=null&&e.length>0&&(f=e);f.length>0&&(b.requestLogContext!=null&&b.requestLogContext.length>0?b.requestLogContext+=":":b.requestLogContext="",b.requestLogContext+=f);(a==null?void 0:a.method)==="Falco"&&(b.clientLoggingDisabled="Falco");d={};for(e of Object.keys(b).sort())d[e]=b[e];return JSON.stringify(d)}function a(a,b,d,e){b&&(!b.requestId.includes("/")&&!b.requestId.includes("#")||h(0,41721));e=j(a.method,e!=null?e:1);if(c("Random").coinflip(e))return k(a,b||{requestId:""},e,d);return i(b)?k(a,b||{requestId:""},null,d):""}g.isForceLogged=i;g.getSampleRateForLogging=j;g.normalizeInstrumentationData=k;g.validateInstrumentationData=a}),98);
__d("BladeRunnerClient",["Base64","BladeRunnerConfig","BladeRunnerLogger","BladeRunnerSocket","BladeRunnerSocketStream","BladeRunnerTypes","BladeRunnerTypesInternal","RequestStreamE2ELogger","RequestStreamE2ESampling","RequestStreamTransport","cr:2046346"],(function(a,b,c,d,e,f,g){a=function(){function a(a,b){this.$2=d("RequestStreamTransport").RequestStreamTransport.WEB_BR_MQTT,this.$1=a!=null?a:c("BladeRunnerSocket").get(),b&&(this.$2=b)}var e=a.prototype;e.createStream=function(a,b,c,d){return this.$3(a,b,c,d)};e.requestStream=function(a,c,d,e){a=this.$3(a,c,d,e);a.send();b("cr:2046346")!=null&&b("cr:2046346").startPulsarTest();return a};e.logInfo=function(a){c("BladeRunnerLogger").info(a)};e.bumpCounter=function(a){c("BladeRunnerLogger").bumpCounter(a)};e.$3=function(a,b,e,f){var g=new(d("BladeRunnerTypesInternal").GatewayStreamRequest)();g.streamId=this.$1.getNextStreamId();g.requestType=d("BladeRunnerTypes").StreamRequestType.BLADE_RUNNER;g.headers=c("BladeRunnerConfig").patchRequestHeaders(a);g.extraHeader=JSON.stringify(g.headers);g.payload=b!=null?c("Base64").encode(b):null;f!=null&&(f.transport="WEB_RS_MQTT");g.instrumentationData=d("RequestStreamE2ESampling").validateInstrumentationData(g.headers||{},f);g.e2eLogger=d("RequestStreamE2ELogger").createStreamLogger(g.headers,g.instrumentationData,this.$2);return new(c("BladeRunnerSocketStream"))(e,g,this.$1)};return a}();g["default"]=a}),98);
__d("jsbi",[],(function(a,b,c,d,e,f){(function(a,b){"object"==typeof f&&"undefined"!=typeof e?e.exports=b():"function"==typeof define&&define.amd?define(b):a.JSBI=b()})(this,function(){"use strict";function a(b){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},a(b)}function b(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function c(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function d(a,b,d){return b&&c(a.prototype,b),d&&c(a,d),a}function e(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&g(a,b)}function f(a){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},f(a)}function g(a,b){return g=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},g(a,b)}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function i(){return i=h()?Reflect.construct:function(a,b,c){var d=[null];d.push.apply(d,b);b=Function.bind.apply(a,d);a=new b;return c&&g(a,c.prototype),a},i.apply(null,arguments)}function j(a){return-1!==Function.toString.call(a).indexOf("[native code]")}function k(a){var b="function"==typeof Map?new Map:void 0;return k=function(a){function c(){return i(a,arguments,f(this).constructor)}if(null===a||!j(a))return a;if("function"!=typeof a)throw new TypeError("Super expression must either be null or a function");if("undefined"!=typeof b){if(b.has(a))return b.get(a);b.set(a,c)}return c.prototype=Object.create(a.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),g(c,a)},k(a)}function l(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function m(a,b){return b&&("object"==typeof b||"function"==typeof b)?b:l(a)}var n=function(c){var h=Math.abs,i=Math.max,j=Math.imul,k=Math.clz32;function g(a,c){if(b(this,g),a>g.__kMaxLength)throw new RangeError("Maximum BigInt size exceeded");return a=m(this,f(g).call(this,a)),a.sign=c,a}return e(g,c),d(g,[{key:"toDebugString",value:function(){var a=["BigInt["],b=!0,c=!1,d=void 0;try{for(var e,e,f=this[Symbol.iterator]();!(b=(e=f.next()).done);b=!0)e=e.value,a.push((e?(e>>>0).toString(16):e)+", ")}catch(a){c=!0,d=a}finally{try{b||null==f["return"]||f["return"]()}finally{if(c)throw d}}return a.push("]"),a.join("")}},{key:"toString",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:10;if(2>a||36<a)throw new RangeError("toString() radix argument must be between 2 and 36");return 0===this.length?"0":0==(a&a-1)?g.__toStringBasePowerOfTwo(this,a):g.__toStringGeneric(this,a,!1)}},{key:"__copy",value:function(){for(var a=new g(this.length,this.sign),b=0;b<this.length;b++)a[b]=this[b];return a}},{key:"__trim",value:function(){for(var a=this.length,b=this[a-1];0===b;)a--,b=this[a-1],this.pop();return 0===a&&(this.sign=!1),this}},{key:"__initializeDigits",value:function(){for(var a=0;a<this.length;a++)this[a]=0}},{key:"__clzmsd",value:function(){return k(this[this.length-1])}},{key:"__inplaceMultiplyAdd",value:function(a,b,c){c>this.length&&(c=this.length);for(var d=65535&a,a=a>>>16,e=0,f=65535&b,b=b>>>16,i=0;i<c;i++){var n=this.__digit(i),m=65535&n;n=n>>>16;var o=j(m,d);m=j(m,a);var p=j(n,d);n=j(n,a);var q=f+(65535&o);o=b+e+(q>>>16)+(o>>>16)+(65535&m)+(65535&p);f=(m>>>16)+(p>>>16)+(65535&n)+(o>>>16),e=f>>>16,f&=65535,b=n>>>16;this.__setDigit(i,65535&q|o<<16)}if(0!==e||0!==f||0!==b)throw new Error("implementation bug")}},{key:"__inplaceAdd",value:function(a,b,c){for(var d,e=0,f=0;f<c;f++)d=this.__halfDigit(b+f)+a.__halfDigit(f)+e,e=d>>>16,this.__setHalfDigit(b+f,d);return e}},{key:"__inplaceSub",value:function(a,b,c){var d=0;if(1&b){b>>=1;for(var e=this.__digit(b),f=65535&e,k=0;k<c-1>>>1;k++){var l=a.__digit(k),m=(e>>>16)-(65535&l)-d;d=1&m>>>16,this.__setDigit(b+k,m<<16|65535&f),e=this.__digit(b+k+1),f=(65535&e)-(l>>>16)-d,d=1&f>>>16}m=a.__digit(k);l=(e>>>16)-(65535&m)-d;d=1&l>>>16,this.__setDigit(b+k,l<<16|65535&f);if(b+k+1>=this.length)throw new RangeError("out of bounds");0==(1&c)&&(e=this.__digit(b+k+1),f=(65535&e)-(m>>>16)-d,d=1&f>>>16,this.__setDigit(b+a.length,4294901760&e|65535&f))}else{b>>=1;for(l=0;l<a.length-1;l++){k=this.__digit(b+l);m=a.__digit(l);e=(65535&k)-(65535&m)-d;d=1&e>>>16;f=(k>>>16)-(m>>>16)-d;d=1&f>>>16,this.__setDigit(b+l,f<<16|65535&e)}k=this.__digit(b+l);m=a.__digit(l);f=(65535&k)-(65535&m)-d;d=1&f>>>16;e=0;0==(1&c)&&(e=(k>>>16)-(m>>>16)-d,d=1&e>>>16),this.__setDigit(b+l,e<<16|65535&f)}return d}},{key:"__inplaceRightShift",value:function(a){if(0!==a){for(var b,c=this.__digit(0)>>>a,d=this.length-1,e=0;e<d;e++)b=this.__digit(e+1),this.__setDigit(e,b<<32-a|c),c=b>>>a;this.__setDigit(d,c)}}},{key:"__digit",value:function(a){return this[a]}},{key:"__unsignedDigit",value:function(a){return this[a]>>>0}},{key:"__setDigit",value:function(a,b){this[a]=0|b}},{key:"__setDigitGrow",value:function(a,b){this[a]=0|b}},{key:"__halfDigitLength",value:function(){var a=this.length;return 65535>=this.__unsignedDigit(a-1)?2*a-1:2*a}},{key:"__halfDigit",value:function(a){return 65535&this[a>>>1]>>>((1&a)<<4)}},{key:"__setHalfDigit",value:function(a,b){var c=a>>>1,d=this.__digit(c);a=1&a?65535&d|b<<16:4294901760&d|65535&b;this.__setDigit(c,a)}}],[{key:"BigInt",value:function(b){var c=Math.floor,d=Number.isFinite;if("number"==typeof b){if(0===b)return g.__zero();if((0|b)===b)return 0>b?g.__oneDigit(-b,!0):g.__oneDigit(b,!1);if(!d(b)||c(b)!==b)throw new RangeError("The number "+b+" cannot be converted to BigInt because it is not an integer");return g.__fromDouble(b)}if("string"==typeof b){d=g.__fromString(b);if(null===d)throw new SyntaxError("Cannot convert "+b+" to a BigInt");return d}if("boolean"==typeof b)return!0===b?g.__oneDigit(1,!1):g.__zero();if("object"===a(b)){if(b.constructor===g)return b;c=g.__toPrimitive(b);return g.BigInt(c)}throw new TypeError("Cannot convert "+b+" to a BigInt")}},{key:"toNumber",value:function(a){var b=a.length;if(0===b)return 0;if(1===b){var c=a.__unsignedDigit(0);return a.sign?-c:c}c=a.__digit(b-1);var d=k(c),e=32*b-d;if(1024<e)return a.sign?-Infinity:1/0;e=e-1;c=c;b=b-1;d=d+1;var f=32===d?0:c<<d;f>>>=12;var h=d-12,i=12<=d?0:c<<20+d;d=20+d;0<h&&0<b&&(b--,c=a.__digit(b),f|=c>>>32-h,i=c<<h,d=h),0<d&&0<b&&(b--,c=a.__digit(b),i|=c>>>32-d,d-=32);h=g.__decideRounding(a,d,b,c);if((1===h||0===h&&1==(1&i))&&(i=i+1>>>0,0===i&&(f++,0!=f>>>20&&(f=0,e++,1023<e))))return a.sign?-Infinity:1/0;d=a.sign?-2147483648:0;return e=e+1023<<20,g.__kBitConversionInts[1]=d|e|f,g.__kBitConversionInts[0]=i,g.__kBitConversionDouble[0]}},{key:"unaryMinus",value:function(a){if(0===a.length)return a;var b=a.__copy();return b.sign=!a.sign,b}},{key:"bitwiseNot",value:function(a){return a.sign?g.__absoluteSubOne(a).__trim():g.__absoluteAddOne(a,!0)}},{key:"exponentiate",value:function(a,b){if(b.sign)throw new RangeError("Exponent must be positive");if(0===b.length)return g.__oneDigit(1,!1);if(0===a.length)return a;if(1===a.length&&1===a.__digit(0))return a.sign&&0==(1&b.__digit(0))?g.unaryMinus(a):a;if(1<b.length)throw new RangeError("BigInt too big");b=b.__unsignedDigit(0);if(1===b)return a;if(b>=g.__kMaxLengthBits)throw new RangeError("BigInt too big");if(1===a.length&&2===a.__digit(0)){var c=1+(b>>>5),d=a.sign&&0!=(1&b);d=new g(c,d);d.__initializeDigits();var e=1<<(31&b);return d.__setDigit(c-1,e),d}c=null;e=a;for(0!=(1&b)&&(c=a),b>>=1;0!==b;b>>=1)e=g.multiply(e,e),0!=(1&b)&&(null===c?c=e:c=g.multiply(c,e));return c}},{key:"multiply",value:function(a,b){if(0===a.length)return a;if(0===b.length)return b;var c=a.length+b.length;32<=a.__clzmsd()+b.__clzmsd()&&c--;c=new g(c,a.sign!==b.sign);c.__initializeDigits();for(var d=0;d<a.length;d++)g.__multiplyAccumulate(b,a.__digit(d),c,d);return c.__trim()}},{key:"divide",value:function(a,b){if(0===b.length)throw new RangeError("Division by zero");if(0>g.__absoluteCompare(a,b))return g.__zero();var c=a.sign!==b.sign,d=b.__unsignedDigit(0);if(1===b.length&&65535>=d){if(1===d)return c===a.sign?a:g.unaryMinus(a);d=g.__absoluteDivSmall(a,d,null)}else d=g.__absoluteDivLarge(a,b,!0,!1);return d.sign=c,d.__trim()}},{key:"remainder",value:function(a,b){if(0===b.length)throw new RangeError("Division by zero");if(0>g.__absoluteCompare(a,b))return a;var c=b.__unsignedDigit(0);if(1===b.length&&65535>=c){if(1===c)return g.__zero();c=g.__absoluteModSmall(a,c);return 0===c?g.__zero():g.__oneDigit(c,a.sign)}c=g.__absoluteDivLarge(a,b,!1,!0);return c.sign=a.sign,c.__trim()}},{key:"add",value:function(a,b){var c=a.sign;return c===b.sign?g.__absoluteAdd(a,b,c):0<=g.__absoluteCompare(a,b)?g.__absoluteSub(a,b,c):g.__absoluteSub(b,a,!c)}},{key:"subtract",value:function(a,b){var c=a.sign;return c===b.sign?0<=g.__absoluteCompare(a,b)?g.__absoluteSub(a,b,c):g.__absoluteSub(b,a,!c):g.__absoluteAdd(a,b,c)}},{key:"leftShift",value:function(a,b){return 0===b.length||0===a.length?a:b.sign?g.__rightShiftByAbsolute(a,b):g.__leftShiftByAbsolute(a,b)}},{key:"signedRightShift",value:function(a,b){return 0===b.length||0===a.length?a:b.sign?g.__leftShiftByAbsolute(a,b):g.__rightShiftByAbsolute(a,b)}},{key:"unsignedRightShift",value:function(){throw new TypeError("BigInts have no unsigned right shift; use >> instead")}},{key:"lessThan",value:function(a,b){return 0>g.__compareToBigInt(a,b)}},{key:"lessThanOrEqual",value:function(a,b){return 0>=g.__compareToBigInt(a,b)}},{key:"greaterThan",value:function(a,b){return 0<g.__compareToBigInt(a,b)}},{key:"greaterThanOrEqual",value:function(a,b){return 0<=g.__compareToBigInt(a,b)}},{key:"equal",value:function(a,b){if(a.sign!==b.sign)return!1;if(a.length!==b.length)return!1;for(var c=0;c<a.length;c++)if(a.__digit(c)!==b.__digit(c))return!1;return!0}},{key:"notEqual",value:function(a,b){return!g.equal(a,b)}},{key:"bitwiseAnd",value:function(a,b){if(!a.sign&&!b.sign)return g.__absoluteAnd(a,b).__trim();if(a.sign&&b.sign){var c=i(a.length,b.length)+1;c=g.__absoluteSubOne(a,c);var d=g.__absoluteSubOne(b);return c=g.__absoluteOr(c,d,c),g.__absoluteAddOne(c,!0,c).__trim()}if(a.sign){d=[b,a];a=d[0],b=d[1]}return g.__absoluteAndNot(a,g.__absoluteSubOne(b)).__trim()}},{key:"bitwiseXor",value:function(a,b){if(!a.sign&&!b.sign)return g.__absoluteXor(a,b).__trim();if(a.sign&&b.sign){var c=i(a.length,b.length);c=g.__absoluteSubOne(a,c);var d=g.__absoluteSubOne(b);return g.__absoluteXor(c,d,c).__trim()}d=i(a.length,b.length)+1;if(a.sign){c=[b,a];a=c[0],b=c[1]}c=g.__absoluteSubOne(b,d);return c=g.__absoluteXor(c,a,c),g.__absoluteAddOne(c,!0,c).__trim()}},{key:"bitwiseOr",value:function(a,b){var c=i(a.length,b.length);if(!a.sign&&!b.sign)return g.__absoluteOr(a,b).__trim();if(a.sign&&b.sign){var d=g.__absoluteSubOne(a,c),e=g.__absoluteSubOne(b);return d=g.__absoluteAnd(d,e,d),g.__absoluteAddOne(d,!0,d).__trim()}if(a.sign){e=[b,a];a=e[0],b=e[1]}d=g.__absoluteSubOne(b,c);return d=g.__absoluteAndNot(d,a,d),g.__absoluteAddOne(d,!0,d).__trim()}},{key:"asIntN",value:function(a,b){if(0===b.length)return b;if(0===a)return g.__zero();if(a>=g.__kMaxLengthBits)return b;var c=a+31>>>5;if(b.length<c)return b;var d=b.__unsignedDigit(c-1),e=1<<(31&a-1);if(b.length===c&&d<e)return b;if(!((d&e)===e))return g.__truncateToNBits(a,b);if(!b.sign)return g.__truncateAndSubFromPowerOfTwo(a,b,!0);if(0==(d&e-1)){for(var f=c-2;0<=f;f--)if(0!==b.__digit(f))return g.__truncateAndSubFromPowerOfTwo(a,b,!1);return b.length===c&&d===e?b:g.__truncateToNBits(a,b)}return g.__truncateAndSubFromPowerOfTwo(a,b,!1)}},{key:"asUintN",value:function(a,b){if(0===b.length)return b;if(0===a)return g.__zero();if(b.sign){if(a>g.__kMaxLengthBits)throw new RangeError("BigInt too big");return g.__truncateAndSubFromPowerOfTwo(a,b,!1)}if(a>=g.__kMaxLengthBits)return b;var c=a+31>>>5;if(b.length<c)return b;var d=31&a;if(b.length==c){if(0==d)return b;c=b.__digit(c-1);if(0==c>>>d)return b}return g.__truncateToNBits(a,b)}},{key:"ADD",value:function(a,b){if(a=g.__toPrimitive(a),b=g.__toPrimitive(b),"string"==typeof a)return"string"!=typeof b&&(b=b.toString()),a+b;if("string"==typeof b)return a.toString()+b;if(a=g.__toNumeric(a),b=g.__toNumeric(b),g.__isBigInt(a)&&g.__isBigInt(b))return g.add(a,b);if("number"==typeof a&&"number"==typeof b)return a+b;throw new TypeError("Cannot mix BigInt and other types, use explicit conversions")}},{key:"LT",value:function(a,b){return g.__compare(a,b,0)}},{key:"LE",value:function(a,b){return g.__compare(a,b,1)}},{key:"GT",value:function(a,b){return g.__compare(a,b,2)}},{key:"GE",value:function(a,b){return g.__compare(a,b,3)}},{key:"EQ",value:function(b,c){for(;;){if(g.__isBigInt(b))return g.__isBigInt(c)?g.equal(b,c):g.EQ(c,b);if("number"==typeof b){if(g.__isBigInt(c))return g.__equalToNumber(c,b);if("object"!==a(c))return b==c;c=g.__toPrimitive(c)}else if("string"==typeof b){if(g.__isBigInt(c))return b=g.__fromString(b),null!==b&&g.equal(b,c);if("object"!==a(c))return b==c;c=g.__toPrimitive(c)}else if("boolean"==typeof b){if(g.__isBigInt(c))return g.__equalToNumber(c,+b);if("object"!==a(c))return b==c;c=g.__toPrimitive(c)}else if("symbol"===a(b)){if(g.__isBigInt(c))return!1;if("object"!==a(c))return b==c;c=g.__toPrimitive(c)}else if("object"===a(b)){if("object"===a(c)&&c.constructor!==g)return b==c;b=g.__toPrimitive(b)}else return b==c}}},{key:"NE",value:function(a,b){return!g.EQ(a,b)}},{key:"__zero",value:function(){return new g(0,!1)}},{key:"__oneDigit",value:function(a,b){b=new g(1,b);return b.__setDigit(0,a),b}},{key:"__decideRounding",value:function(a,b,c,d){if(0<b)return-1;if(0>b)b=-b-1;else{if(0===c)return-1;c--,d=a.__digit(c),b=31}b=1<<b;if(0==(d&b))return-1;if(b-=1,0!=(d&b))return 1;for(;0<c;)if(c--,0!==a.__digit(c))return 1;return 0}},{key:"__fromDouble",value:function(a){g.__kBitConversionDouble[0]=a;var b,c=2047&g.__kBitConversionInts[1]>>>20;c=c-1023;var d=(c>>>5)+1;a=new g(d,0>a);var e=1048575&g.__kBitConversionInts[1]|1048576,f=g.__kBitConversionInts[0],k=20;c=31&c;var n=0;if(c<k){var m=k-c;n=m+32,b=e>>>m,e=e<<32-m|f>>>m,f<<=32-m}else if(c===k)n=32,b=e,e=f;else{m=c-k;n=32-m,b=e<<m|f>>>32-m,e=f<<m}a.__setDigit(d-1,b);for(c=d-2;0<=c;c--)0<n?(n-=32,b=e,e=f):b=0,a.__setDigit(c,b);return a.__trim()}},{key:"__isWhitespace",value:function(a){return!!(13>=a&&9<=a)||(159>=a?32==a:131071>=a?160==a||5760==a:196607>=a?(a&=131071,10>=a||40==a||41==a||47==a||95==a||4096==a):65279==a)}},{key:"__fromString",value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,c=0,d=a.length,e=0;if(e===d)return g.__zero();for(var f=a.charCodeAt(e);g.__isWhitespace(f);){if(++e===d)return g.__zero();f=a.charCodeAt(e)}if(43===f){if(++e===d)return null;f=a.charCodeAt(e),c=1}else if(45===f){if(++e===d)return null;f=a.charCodeAt(e),c=-1}if(0===b){if(b=10,48===f){if(++e===d)return g.__zero();if(f=a.charCodeAt(e),88===f||120===f){if(b=16,++e===d)return null;f=a.charCodeAt(e)}else if(79===f||111===f){if(b=8,++e===d)return null;f=a.charCodeAt(e)}else if(66===f||98===f){if(b=2,++e===d)return null;f=a.charCodeAt(e)}}}else if(16===b&&48===f){if(++e===d)return g.__zero();if(f=a.charCodeAt(e),88===f||120===f){if(++e===d)return null;f=a.charCodeAt(e)}}for(;48===f;){if(++e===d)return g.__zero();f=a.charCodeAt(e)}var m=d-e,i=g.__kMaxBitsPerChar[b],j=g.__kBitsPerCharTableMultiplier-1;if(m>1073741824/i)return null;var k=i*m+j>>>g.__kBitsPerCharTableShift,l=new g(k+31>>>5,!1),n=10>b?b:10,o=10<b?b-10:0;if(0==(b&b-1)){i>>=g.__kBitsPerCharTableShift;var p=[],q=[],r=!1;do{for(var s,t=0,u=0;;){if(void 0,f-48>>>0<n)s=f-48;else if((32|f)-97>>>0<o)s=(32|f)-87;else{r=!0;break}if(u+=i,t=t<<i|s,++e===d){r=!0;break}if(f=a.charCodeAt(e),32<u+i)break}p.push(t),q.push(u)}while(!r);g.__fillFromParts(l,p,q)}else{l.__initializeDigits();var v=!1,w=0;do{for(var x,y=0,z=1;;){if(void 0,f-48>>>0<n)x=f-48;else if((32|f)-97>>>0<o)x=(32|f)-87;else{v=!0;break}var A=z*b;if(4294967295<A)break;if(z=A,y=y*b+x,w++,++e===d){v=!0;break}f=a.charCodeAt(e)}j=32*g.__kBitsPerCharTableMultiplier-1;var B=i*w+j>>>g.__kBitsPerCharTableShift+5;l.__inplaceMultiplyAdd(z,y,B)}while(!v)}if(e!==d){if(!g.__isWhitespace(f))return null;for(e++;e<d;e++)if(f=a.charCodeAt(e),!g.__isWhitespace(f))return null}return 0!==c&&10!==b?null:(l.sign=-1===c,l.__trim())}},{key:"__fillFromParts",value:function(a,b,c){for(var d=0,e=0,f=0,k=b.length-1;0<=k;k--){var l=b[k],m=c[k];e|=l<<f,f+=m,32===f?(a.__setDigit(d++,e),f=0,e=0):32<f&&(a.__setDigit(d++,e),f-=32,e=l>>>m-f)}if(0!==e){if(d>=a.length)throw new Error("implementation bug");a.__setDigit(d++,e)}for(;d<a.length;d++)a.__setDigit(d,0)}},{key:"__toStringBasePowerOfTwo",value:function(a,b){var c=a.length,d=b-1;d=(85&d>>>1)+(85&d),d=(51&d>>>2)+(51&d),d=(15&d>>>4)+(15&d);d=d;b=b-1;var e=a.__digit(c-1),f=k(e);f=0|(32*c-f+d-1)/d;if(a.sign&&f++,268435456<f)throw new Error("string too long");for(var h=Array(f),f=f-1,l=0,n=0,o=0;o<c-1;o++){var p=a.__digit(o),q=(l|p<<n)&b;h[f--]=g.__kConversionChars[q];q=d-n;for(l=p>>>q,n=32-q;n>=d;)h[f--]=g.__kConversionChars[l&b],l>>>=d,n-=d}p=(l|e<<n)&b;for(h[f--]=g.__kConversionChars[p],l=e>>>d-n;0!==l;)h[f--]=g.__kConversionChars[l&b],l>>>=d;if(a.sign&&(h[f--]="-"),-1!==f)throw new Error("implementation bug");return h.join("")}},{key:"__toStringGeneric",value:function(a,b,c){var d=a.length;if(0===d)return"";if(1===d){var e=a.__unsignedDigit(0).toString(b);return!1===c&&a.sign&&(e="-"+e),e}e=32*d-k(a.__digit(d-1));d=g.__kMaxBitsPerChar[b];d=d-1;e=e*g.__kBitsPerCharTableMultiplier;e+=d-1,e=0|e/d;var f;d=e+1>>1;e=g.exponentiate(g.__oneDigit(b,!1),g.__oneDigit(d,!1));var h=e.__unsignedDigit(0);if(1===e.length&&65535>=h){f=new g(a.length,!1),f.__initializeDigits();for(var i,j=0,l=2*a.length-1;0<=l;l--)i=j<<16|a.__halfDigit(l),f.__setHalfDigit(l,0|i/h),j=0|i%h;i=j.toString(b)}else{h=g.__absoluteDivLarge(a,e,!0,!0);f=h.quotient;l=h.remainder.__trim();i=g.__toStringGeneric(l,b,!0)}f.__trim();for(j=g.__toStringGeneric(f,b,!0);i.length<d;)i="0"+i;return!1===c&&a.sign&&(j="-"+j),j+i}},{key:"__unequalSign",value:function(a){return a?-1:1}},{key:"__absoluteGreater",value:function(a){return a?-1:1}},{key:"__absoluteLess",value:function(a){return a?1:-1}},{key:"__compareToBigInt",value:function(a,b){var c=a.sign;if(c!==b.sign)return g.__unequalSign(c);a=g.__absoluteCompare(a,b);return 0<a?g.__absoluteGreater(c):0>a?g.__absoluteLess(c):0}},{key:"__compareToNumber",value:function(a,b){if(!0|b){var c=a.sign,d=0>b;if(c!==d)return g.__unequalSign(c);if(0===a.length){if(d)throw new Error("implementation bug");return 0===b?0:-1}if(1<a.length)return g.__absoluteGreater(c);d=h(b);var e=a.__unsignedDigit(0);return e>d?g.__absoluteGreater(c):e<d?g.__absoluteLess(c):0}return g.__compareToDouble(a,b)}},{key:"__compareToDouble",value:function(a,b){if(b!==b)return b;if(b===1/0)return-1;if(b===-Infinity)return 1;var c=a.sign;if(c!==0>b)return g.__unequalSign(c);if(0===b)throw new Error("implementation bug: should be handled elsewhere");if(0===a.length)return-1;g.__kBitConversionDouble[0]=b;b=2047&g.__kBitConversionInts[1]>>>20;if(2047==b)throw new Error("implementation bug: handled elsewhere");b=b-1023;if(0>b)return g.__absoluteGreater(c);var d=a.length,e=a.__digit(d-1),f=k(e),l=32*d-f;b=b+1;if(l<b)return g.__absoluteLess(c);if(l>b)return g.__absoluteGreater(c);b=1048576|1048575&g.__kBitConversionInts[1];var m=g.__kBitConversionInts[0],o=20;f=31-f;if(f!==(l-1)%31)throw new Error("implementation bug");var p;l=0;if(f<o){var q=o-f;l=q+32,p=b>>>q,b=b<<32-q|m>>>q,m<<=32-q}else if(f===o)l=32,p=b,b=m;else{q=f-o;l=32-q,p=b<<q|m>>>32-q,b=m<<q}if(e>>>=0,p>>>=0,e>p)return g.__absoluteGreater(c);if(e<p)return g.__absoluteLess(c);for(f=d-2;0<=f;f--){0<l?(l-=32,p=b>>>0,b=m,m=0):p=0;o=a.__unsignedDigit(f);if(o>p)return g.__absoluteGreater(c);if(o<p)return g.__absoluteLess(c)}if(0!==b||0!==m){if(0===l)throw new Error("implementation bug");return g.__absoluteLess(c)}return 0}},{key:"__equalToNumber",value:function(a,b){return b|0===b?0===b?0===a.length:1===a.length&&a.sign===0>b&&a.__unsignedDigit(0)===h(b):0===g.__compareToDouble(a,b)}},{key:"__comparisonResultToBool",value:function(a,b){switch(b){case 0:return 0>a;case 1:return 0>=a;case 2:return 0<a;case 3:return 0<=a}throw new Error("unreachable")}},{key:"__compare",value:function(a,b,c){if(a=g.__toPrimitive(a),b=g.__toPrimitive(b),"string"==typeof a&&"string"==typeof b)switch(c){case 0:return a<b;case 1:return a<=b;case 2:return a>b;case 3:return a>=b}if(g.__isBigInt(a)&&"string"==typeof b)return b=g.__fromString(b),null!==b&&g.__comparisonResultToBool(g.__compareToBigInt(a,b),c);if("string"==typeof a&&g.__isBigInt(b))return a=g.__fromString(a),null!==a&&g.__comparisonResultToBool(g.__compareToBigInt(a,b),c);if(a=g.__toNumeric(a),b=g.__toNumeric(b),g.__isBigInt(a)){if(g.__isBigInt(b))return g.__comparisonResultToBool(g.__compareToBigInt(a,b),c);if("number"!=typeof b)throw new Error("implementation bug");return g.__comparisonResultToBool(g.__compareToNumber(a,b),c)}if("number"!=typeof a)throw new Error("implementation bug");if(g.__isBigInt(b))return g.__comparisonResultToBool(g.__compareToNumber(b,a),2^c);if("number"!=typeof b)throw new Error("implementation bug");return 0===c?a<b:1===c?a<=b:2===c?a>b:3===c?a>=b:void 0}},{key:"__absoluteAdd",value:function(a,b,c){if(a.length<b.length)return g.__absoluteAdd(b,a,c);if(0===a.length)return a;if(0===b.length)return a.sign===c?a:g.unaryMinus(a);var d=a.length;(0===a.__clzmsd()||b.length===a.length&&0===b.__clzmsd())&&d++;for(var d=new g(d,c),c=0,e=0;e<b.length;e++){var f=b.__digit(e),h=a.__digit(e),m=(65535&h)+(65535&f)+c;h=(h>>>16)+(f>>>16)+(m>>>16);c=h>>>16,d.__setDigit(e,65535&m|h<<16)}for(;e<a.length;e++){f=a.__digit(e);m=(65535&f)+c;h=(f>>>16)+(m>>>16);c=h>>>16,d.__setDigit(e,65535&m|h<<16)}return e<d.length&&d.__setDigit(e,c),d.__trim()}},{key:"__absoluteSub",value:function(a,b,c){if(0===a.length)return a;if(0===b.length)return a.sign===c?a:g.unaryMinus(a);for(var c=new g(a.length,c),d=0,e=0;e<b.length;e++){var f=a.__digit(e),l=b.__digit(e),m=(65535&f)-(65535&l)-d;d=1&m>>>16;f=(f>>>16)-(l>>>16)-d;d=1&f>>>16,c.__setDigit(e,65535&m|f<<16)}for(;e<a.length;e++){l=a.__digit(e);m=(65535&l)-d;d=1&m>>>16;f=(l>>>16)-d;d=1&f>>>16,c.__setDigit(e,65535&m|f<<16)}return c.__trim()}},{key:"__absoluteAddOne",value:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,d=a.length;null===c?c=new g(d,b):c.sign=b;for(var e=!0,f=0;f<d;f++){var k=a.__digit(f),l=-1===k;e&&(k=0|k+1),e=l,c.__setDigit(f,k)}return e&&c.__setDigitGrow(d,1),c}},{key:"__absoluteSubOne",value:function(a,b){var c=a.length;b=b||c;for(var d=new g(b,!1),e=!0,f=0;f<c;f++){var k=a.__digit(f),l=0===k;e&&(k=0|k-1),e=l,d.__setDigit(f,k)}for(l=c;l<b;l++)d.__setDigit(l,0);return d}},{key:"__absoluteAnd",value:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,d=a.length,e=b.length,f=e;if(d<e){f=d;var m=a,n=d;a=b,e,b=m,n}var k=f;null===c?c=new g(k,!1):k=c.length;for(var l=0;l<f;l++)c.__setDigit(l,a.__digit(l)&b.__digit(l));for(;l<k;l++)c.__setDigit(l,0);return c}},{key:"__absoluteAndNot",value:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,d=a.length,e=b.length,f=e;d<e&&(f=d);var k=d;null===c?c=new g(k,!1):k=c.length;for(var l=0;l<f;l++)c.__setDigit(l,a.__digit(l)&~b.__digit(l));for(;l<d;l++)c.__setDigit(l,a.__digit(l));for(;l<k;l++)c.__setDigit(l,0);return c}},{key:"__absoluteOr",value:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,d=a.length,e=b.length,f=e;if(d<e){f=d;var m=a,n=d;a=b,d=e,b=m,n}var k=d;null===c?c=new g(k,!1):k=c.length;for(var l=0;l<f;l++)c.__setDigit(l,a.__digit(l)|b.__digit(l));for(;l<d;l++)c.__setDigit(l,a.__digit(l));for(;l<k;l++)c.__setDigit(l,0);return c}},{key:"__absoluteXor",value:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,d=a.length,e=b.length,f=e;if(d<e){f=d;var m=a,n=d;a=b,d=e,b=m,n}var k=d;null===c?c=new g(k,!1):k=c.length;for(var l=0;l<f;l++)c.__setDigit(l,a.__digit(l)^b.__digit(l));for(;l<d;l++)c.__setDigit(l,a.__digit(l));for(;l<k;l++)c.__setDigit(l,0);return c}},{key:"__absoluteCompare",value:function(a,b){var c=a.length-b.length;if(0!=c)return c;for(c=a.length-1;0<=c&&a.__digit(c)===b.__digit(c);)c--;return 0>c?0:a.__unsignedDigit(c)>b.__unsignedDigit(c)?1:-1}},{key:"__multiplyAccumulate",value:function(a,b,c,d){if(0!==b){for(var e=65535&b,b=b>>>16,f=0,g=0,k=0,l=0;l<a.length;l++,d++){var m=c.__digit(d),n=65535&m,o=m>>>16,p=a.__digit(l),q=65535&p;p=p>>>16;var r=j(q,e);q=j(q,b);var s=j(p,e);p=j(p,b);n+=g+(65535&r),o+=k+f+(n>>>16)+(r>>>16)+(65535&q)+(65535&s),f=o>>>16,g=(q>>>16)+(s>>>16)+(65535&p)+f,f=g>>>16,g&=65535,k=p>>>16,m=65535&n|o<<16,c.__setDigit(d,m)}for(;0!==f||0!==g||0!==k;d++){r=c.__digit(d);q=(65535&r)+g;s=(r>>>16)+(q>>>16)+k+f;g=0,k=0,f=s>>>16,r=65535&q|s<<16,c.__setDigit(d,r)}}}},{key:"__internalMultiplyAdd",value:function(a,b,c,d,e){for(var c=c,f=0,h=0;h<d;h++){var l=a.__digit(h),m=j(65535&l,b),n=(65535&m)+f+c;c=n>>>16;l=j(l>>>16,b);m=(65535&l)+(m>>>16)+c;c=m>>>16,f=l>>>16,e.__setDigit(h,m<<16|65535&n)}if(e.length>d)for(e.__setDigit(d++,c+f);d<e.length;)e.__setDigit(d++,0);else if(0!==c+f)throw new Error("implementation bug")}},{key:"__absoluteDivSmall",value:function(a,b,c){null===c&&(c=new g(a.length,!1));for(var d=0,e=2*a.length-1;0<=e;e-=2){var f=(d<<16|a.__halfDigit(e))>>>0,k=0|f/b;d=0|f%b,f=(d<<16|a.__halfDigit(e-1))>>>0;var l=0|f/b;d=0|f%b,c.__setDigit(e>>>1,k<<16|l)}return c}},{key:"__absoluteModSmall",value:function(a,b){for(var c,d=0,e=2*a.length-1;0<=e;e--)c=(d<<16|a.__halfDigit(e))>>>0,d=0|c%b;return d}},{key:"__absoluteDivLarge",value:function(a,b,c,d){var f=b.__halfDigitLength(),e=b.length,n=a.__halfDigitLength()-f,i=null;c&&(i=new g(n+2>>>1,!1),i.__initializeDigits());var l=new g(f+2>>>1,!1);l.__initializeDigits();var m=g.__clz16(b.__halfDigit(f-1));0<m&&(b=g.__specialLeftShift(b,m,0));for(var a=g.__specialLeftShift(a,m,1),k=b.__halfDigit(f-1),o=0,n=n;0<=n;n--){var p=65535,q=a.__halfDigit(n+f);if(q!==k){q=(q<<16|a.__halfDigit(n+f-1))>>>0;p=0|q/k;for(var q=0|q%k,r=b.__halfDigit(f-2),s=a.__halfDigit(n+f-2);j(p,r)>>>0>(q<<16|s)>>>0&&(p--,q+=k,!(65535<q)););}g.__internalMultiplyAdd(b,p,0,e,l);r=a.__inplaceSub(l,n,f+1);0!==r&&(r=a.__inplaceAdd(b,n,f),a.__setHalfDigit(n+f,a.__halfDigit(n+f)+r),p--),c&&(1&n?o=p<<16:i.__setDigit(n>>>1,o|p))}return d?(a.__inplaceRightShift(m),c?{quotient:i,remainder:a}:a):c?i:void 0}},{key:"__clz16",value:function(a){return k(a)-16}},{key:"__specialLeftShift",value:function(a,b,c){var e=a.length,d=new g(e+c,!1);if(0===b){for(var f=0;f<e;f++)d.__setDigit(f,a.__digit(f));return 0<c&&d.__setDigit(e,0),d}for(var j,f=0,l=0;l<e;l++)j=a.__digit(l),d.__setDigit(l,j<<b|f),f=j>>>32-b;return 0<c&&d.__setDigit(e,f),d}},{key:"__leftShiftByAbsolute",value:function(a,b){b=g.__toShiftAmount(b);if(0>b)throw new RangeError("BigInt too big");var c=b>>>5;b=31&b;var d=a.length,e=0!==b&&0!=a.__digit(d-1)>>>32-b,f=d+c+(e?1:0),m=new g(f,a.sign);if(0===b){for(var n=0;n<c;n++)m.__setDigit(n,0);for(;n<f;n++)m.__setDigit(n,a.__digit(n-c))}else{for(n=0,f=0;f<c;f++)m.__setDigit(f,0);for(var o,f=0;f<d;f++)o=a.__digit(f),m.__setDigit(f+c,o<<b|n),n=o>>>32-b;if(e)m.__setDigit(d+c,n);else if(0!==n)throw new Error("implementation bug")}return m.__trim()}},{key:"__rightShiftByAbsolute",value:function(a,b){var c=a.length,d=a.sign;b=g.__toShiftAmount(b);if(0>b)return g.__rightShiftByMaximum(d);var e=b>>>5;b=31&b;var f=c-e;if(0>=f)return g.__rightShiftByMaximum(d);var i=!1;if(d)if(0!=(a.__digit(e)&(1<<b)-1))i=!0;else for(var m=0;m<e;m++)if(0!==a.__digit(m)){i=!0;break}if(i&&0===b){m=a.__digit(c-1);0==~m&&f++}m=new g(f,d);if(0===b)for(f=e;f<c;f++)m.__setDigit(f-e,a.__digit(f));else{for(var n,d=a.__digit(e)>>>b,f=c-e-1,c=0;c<f;c++)n=a.__digit(c+e+1),m.__setDigit(c,n<<32-b|d),d=n>>>b;m.__setDigit(f,d)}return i&&(m=g.__absoluteAddOne(m,!0,m)),m.__trim()}},{key:"__rightShiftByMaximum",value:function(a){return a?g.__oneDigit(1,!0):g.__zero()}},{key:"__toShiftAmount",value:function(a){if(1<a.length)return-1;a=a.__unsignedDigit(0);return a>g.__kMaxLengthBits?-1:a}},{key:"__toPrimitive",value:function(b){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"default";if("object"!==a(b))return b;if(b.constructor===g)return b;var d=b[Symbol.toPrimitive];if(d){var e=d(c);if("object"!==a(e))return e;throw new TypeError("Cannot convert object to primitive value")}var f=b.valueOf;if(f){var k=f.call(b);if("object"!==a(k))return k}var l=b.toString;if(l){var m=l.call(b);if("object"!==a(m))return m}throw new TypeError("Cannot convert object to primitive value")}},{key:"__toNumeric",value:function(a){return g.__isBigInt(a)?a:+a}},{key:"__isBigInt",value:function(b){return"object"===a(b)&&b.constructor===g}},{key:"__truncateToNBits",value:function(a,b){for(var c=a+31>>>5,d=new g(c,b.sign),c=c-1,e=0;e<c;e++)d.__setDigit(e,b.__digit(e));e=b.__digit(c);if(0!=(31&a)){b=32-(31&a);e=e<<b>>>b}return d.__setDigit(c,e),d.__trim()}},{key:"__truncateAndSubFromPowerOfTwo",value:function(a,b,c){for(var d=Math.min,e=a+31>>>5,c=new g(e,c),f=0,e=e-1,h=0,d=d(e,b.length);f<d;f++){var j=b.__digit(f),l=0-(65535&j)-h;h=1&l>>>16;j=0-(j>>>16)-h;h=1&j>>>16,c.__setDigit(f,65535&l|j<<16)}for(;f<e;f++)c.__setDigit(f,0|-h);l=e<b.length?b.__digit(e):0;j=31&a;if(0===j){d=0-(65535&l)-h;h=1&d>>>16;f=0-(l>>>16)-h;b=65535&d|f<<16}else{a=32-j;l=l<<a>>>a;d=1<<32-a;f=(65535&d)-(65535&l)-h;h=1&f>>>16;j=(d>>>16)-(l>>>16)-h;b=65535&f|j<<16,b&=d-1}return c.__setDigit(e,b),c.__trim()}},{key:"__digitPow",value:function(a,b){for(var c=1;0<b;)1&b&&(c*=a),b>>>=1,a*=a;return c}}]),g}(k(Array));return n.__kMaxLength=33554432,n.__kMaxLengthBits=n.__kMaxLength<<5,n.__kMaxBitsPerChar=[0,0,32,51,64,75,83,90,96,102,107,111,115,119,122,126,128,131,134,136,139,141,143,145,147,149,151,153,154,156,158,159,160,162,163,165,166],n.__kBitsPerCharTableShift=5,n.__kBitsPerCharTableMultiplier=1<<n.__kBitsPerCharTableShift,n.__kConversionChars=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],n.__kBitConversionBuffer=new ArrayBuffer(8),n.__kBitConversionDouble=new Float64Array(n.__kBitConversionBuffer),n.__kBitConversionInts=new Int32Array(n.__kBitConversionBuffer),n})}),null);
__d("TCompactProtocolPolyfill",["StringToUtf8","ThriftTypes","Utf8ToString","jsbi"],(function(a,b,c,d,e,f,g){var h,i=Object.freeze({CT_STOP:0,CT_BOOLEAN_TRUE:1,CT_BOOLEAN_FALSE:2,CT_BYTE:3,CT_I16:4,CT_I32:5,CT_I64:6,CT_DOUBLE:7,CT_BINARY:8,CT_LIST:9,CT_SET:10,CT_MAP:11,CT_STRUCT:12,CT_FLOAT:13}),j=Object.freeze({NONE:-1,CT_BOOLEAN_TRUE:i.CT_BOOLEAN_TRUE,CT_BOOLEAN_FALSE:i.CT_BOOLEAN_FALSE}),k=[i.CT_STOP,0,i.CT_BOOLEAN_TRUE,i.CT_BYTE,i.CT_DOUBLE,0,i.CT_I16,0,i.CT_I32,0,i.CT_I64,i.CT_BINARY,i.CT_STRUCT,i.CT_MAP,i.CT_SET,i.CT_LIST,0,0,0,i.CT_FLOAT],l=Math.pow(2,7)-1,m=-1*Math.pow(2,7),n=Math.pow(2,15)-1,o=-1*Math.pow(2,15),p=Math.pow(2,31)-1,q=-1*Math.pow(2,31),r=Math.pow(2,32)-1,s=(a=c("jsbi")).BigInt("9223372036854775807"),t=a.BigInt("-9223372036854775808"),u=a.BigInt("18446744073709551615"),v=a.BigInt(63),w=a.BigInt(1),x=a.BigInt(0),y=a.BigInt(7),z=a.BigInt(70),A=a.BigInt(127),B=a.BigInt(128),C=Math.pow(2,4);b=function(){function a(a){this.$4=null,this.$5=null,this.$1=a,this.$2=[],this.$3=0,this.$6=new DataView(new ArrayBuffer(1))}var b=a.prototype;b.readStructBegin=function(){this.$2.push(this.$3),this.$3=0};b.readStructEnd=function(){this.$3=this.$2.pop();return 0};b.writeStructBegin=function(a){this.$2.push(this.$3);this.$3=0;return 0};b.writeStructEnd=function(){this.$3=this.$2.pop();return 0};b.writeFieldBegin=function(a){if(a.ftype===(h||(h=c("ThriftTypes"))).BOOL){this.$4={fid:a.fid,fname:a.fname,ftype:a.ftype};return 0}else return this.$7(a,j.NONE)};b.writeListBegin=function(a){return this.$8(a)};b.writeListEnd=function(){return 0};b.writeSetBegin=function(a){return this.$8(a)};b.writeSetEnd=function(){return 0};b.writeMapBegin=function(a){var b=0;if(a.size===0)b+=this.$1.writeByte(0);else{b+=this.writeVarint32(a.size);if(a.ktype!=null&&a.vtype!=null)b+=this.$1.writeByte(this.$9(a.ktype)<<4|this.$9(a.vtype));else throw new Error("received invalid map info: "+JSON.stringify(a))}return b};b.writeMapEnd=function(){return 0};b.$7=function(a,b){var c=0;b=b===j.NONE?this.$9(a.ftype):b;a.fid>this.$3&&a.fid-this.$3<=C-1?c+=this.$1.writeByte(a.fid-this.$3<<4|b):(c+=this.$1.writeByte(b),c+=this.writeI16(a.fid));this.$3=a.fid;return c};b.$8=function(a){var b=0,c=this.$9(a.etype);a.size<=C-2?b+=this.$1.writeByte(a.size<<4|c):(b+=this.$1.writeByte(240|c),b+=this.writeVarint32(a.size));return b};b.readFieldBegin=function(){var a=this.$1.readByte(),b=a&15;if(b===(h||(h=c("ThriftTypes"))).STOP)return{ftype:(h||(h=c("ThriftTypes"))).STOP,fid:0};a=(a&240)>>>4;var d;a===0?d=this.readI16():d=this.$3+a;a=this.$10(b);(b===i.CT_BOOLEAN_TRUE||b===i.CT_BOOLEAN_FALSE)&&(this.$5=b===i.CT_BOOLEAN_TRUE);this.$3=d;return{ftype:a,fid:d}};b.readListBegin=function(){return this.$11()};b.readListEnd=function(){return 0};b.readSetBegin=function(){return this.$11()};b.readSetEnd=function(){return 0};b.readMapBegin=function(){var a=this.readVarint32();if(a>0){var b=this.$1.readByte(),c=this.$12(b>>4,"readMapBegin:key");b=this.$12(b&15,"readMapBegin:value");return{ktype:this.$10(c),vtype:this.$10(b),size:a}}return{size:a}};b.readMapEnd=function(){return 0};b.$12=function(a,b){if(a<0||a>13)throw new Error(b+" read invalid compact type: "+a);return a};b.$11=function(){var a=this.$1.readByte(),b=this.$12(a&15,"_readListOrSetBegin");b=this.$10(b);a=a>>4&15;a===15&&(a=this.readVarint32());return{etype:b,size:a}};b.readFieldEnd=function(){return 0};b.readByte=function(){this.$6.setUint8(0,this.$1.readByte());return this.$6.getInt8(0)};b.writeByte=function(a){if(a<m||a>l)throw new Error("byte to write is out of range: "+a);this.$6.setInt8(0,a);return this.$1.writeByte(this.$6.getUint8(0))};b.readFloat=function(){return this.$1.readFloatBE()};b.writeFloat=function(a){return this.$1.writeFloatBE(a)};b.readDouble=function(){return this.$1.readDoubleBE()};b.writeDouble=function(a){return this.$1.writeDoubleBE(a)};b.writeString=function(a){return this.writeBinary(d("StringToUtf8").StringToUtf8(a))};b.skip=function(a){switch(a){case(h||(h=c("ThriftTypes"))).STOP:return;case(h||(h=c("ThriftTypes"))).BOOL:this.readBool();break;case(h||(h=c("ThriftTypes"))).BYTE:this.readByte();break;case(h||(h=c("ThriftTypes"))).DOUBLE:this.readDouble();break;case(h||(h=c("ThriftTypes"))).I16:this.readI16();break;case(h||(h=c("ThriftTypes"))).I32:this.readI32();break;case(h||(h=c("ThriftTypes"))).I64:this.readI64();break;case(h||(h=c("ThriftTypes"))).STRING:this.readString();break;case(h||(h=c("ThriftTypes"))).STRUCT:this.readStructBegin();var b;while(!0){b=this.readFieldBegin();if(b.ftype===(h||(h=c("ThriftTypes"))).STOP)break;this.skip(b.ftype)}this.readStructEnd();break;case(h||(h=c("ThriftTypes"))).MAP:b=this.readMapBegin();if(b.size>0&&b.ktype!=null&&b.vtype!=null){var d=b.ktype,e=b.vtype;for(var f=0;f<b.size;f++)this.skip(d),this.skip(e)}break;case(h||(h=c("ThriftTypes"))).SET:case(h||(h=c("ThriftTypes"))).LIST:f=this.$11();for(d=0;d<f.size;d++)this.skip(f.etype);break;case(h||(h=c("ThriftTypes"))).FLOAT:this.readFloat();break;default:throw new Error("encoutered unknow thrift type: "+a+" in skip")}};b.toByteArray=function(){return this.$1.toByteArray()};b.writeFieldEnd=function(){return 0};b.writeFieldStop=function(){return this.$1.writeByte((h||(h=c("ThriftTypes"))).STOP)};b.writeI16=function(a){if(a<o||a>n)throw new Error("trying to write i16 out of range: "+a);return this.writeVarint32(this.i32ToZigzag(a))};b.readI16=function(){var a=this.zigzagToI32(this.readVarint32());if(a<o||a>n)throw new Error("read invalid i16: "+a);return a};b.writeI32=function(a){if(a<q||a>p)throw new Error("i32 out of range: "+a);return this.writeVarint32(this.i32ToZigzag(a))};b.readI32=function(){return this.zigzagToI32(this.readVarint32())};b.writeI64=function(a){return this.writeVarint64(this.i64ToZigzag(a))};b.readI64=function(){return this.zigzagToI64(this.readVarint64())};b.readBool=function(){var a;this.$5!=null?(a=this.$5,this.$5=null):a=this.$1.readByte()===i.CT_BOOLEAN_TRUE;return a};b.writeBool=function(a){var b=0;this.$4!=null?(b+=this.$7(this.$4,a?j.CT_BOOLEAN_TRUE:j.CT_BOOLEAN_FALSE),this.$4=null):b+=this.$1.writeByte(a?i.CT_BOOLEAN_TRUE:i.CT_BOOLEAN_FALSE);return b};b.readBinary=function(){var a=this.readVarint32();return a===0?new Uint8Array(0):this.$1.readBytes(a)};b.writeBinary=function(a){var b=0;b+=this.writeVarint32(a.length);b+=this.$1.write(a);return b};b.i32ToZigzag=function(a){if(a<q||a>p)throw new Error("number: "+a+" is out of range of i32");return(a<<1^(a<0?4294967295:0))>>>0};b.zigzagToI32=function(a){if(a<0||a>r)throw new Error("number: "+a+" is out of range of uint32");return a>>>1^-1*(a&1)};b.i64ToZigzag=function(a){if(c("jsbi").greaterThan(a,s)||c("jsbi").lessThan(a,t))throw new Error("i64 out of range: "+a.toString());return c("jsbi").bitwiseXor(c("jsbi").signedRightShift(a,v),c("jsbi").leftShift(a,w))};b.zigzagToI64=function(a){if(c("jsbi").lessThan(a,0)||c("jsbi").greaterThan(a,u))throw new Error("invalid uint64: "+a.toString());return c("jsbi").equal(c("jsbi").bitwiseAnd(a,w),w)?c("jsbi").bitwiseNot(c("jsbi").signedRightShift(a,w)):c("jsbi").signedRightShift(a,w)};b.writeVarint32=function(a){if(a<0||a>r)throw new Error("writeVarint32 received out of range uint32: "+a);a=a;var b=0;while(!0)if(a>>>7===0){this.$1.writeByte(a);b++;break}else this.$1.writeByte(a&127|128),b++,a>>>=7;return b};b.readVarint32=function(){var a=0,b=0,c;while(!0){c=this.$1.readByte();a=(a|(c&127)<<b)>>>0;b+=7;if((c&128)==0){if(b===35&&(c&240)!=0)throw new Error("result exceeded 32 bit limit");break}if(b>28)throw new Error("result exceeded 32 bit limit")}return a};b.writeVarint64=function(a){if(c("jsbi").lessThan(a,x)||c("jsbi").greaterThan(a,u))throw new Error("invalid uint64: "+a.toString());a=a;var b=0;while(!0)if(c("jsbi").equal(c("jsbi").signedRightShift(a,y),x)){this.$1.writeByte(c("jsbi").toNumber(a));b++;break}else{var d,e=(d=c("jsbi")).toNumber(d.bitwiseOr(d.bitwiseAnd(a,A),B));this.$1.writeByte(e);b++;a=d.signedRightShift(a,y)}return b};b.readVarint64=function(){var a=x,b=x,d;while(!0){var e;d=(e=c("jsbi")).BigInt(this.$1.readByte());a=e.bitwiseOr(a,e.leftShift(e.bitwiseAnd(d,A),b));b=e.add(b,y);if(c("jsbi").equal(c("jsbi").bitwiseAnd(d,B),x)){if(c("jsbi").equal(b,z)&&c("jsbi").notEqual(d,w))throw new Error("result exceeded 64 bit limit");break}if(c("jsbi").greaterThan(b,v))throw new Error("result exceeded 64 bit limit")}return a};b.readString=function(){return d("Utf8ToString").Utf8ToString(this.readBinary())};b.getLastFieldId=function(){return this.$3};b.getLastField=function(){return this.$2};b.getBooleanFieldInfo=function(){return this.$4};b.getBooleanValue=function(){return this.$5};b.$9=function(a){return k[a]};b.$10=function(a){switch(a){case i.CT_STOP:return(h||(h=c("ThriftTypes"))).STOP;case i.CT_BOOLEAN_FALSE:case i.CT_BOOLEAN_TRUE:return(h||(h=c("ThriftTypes"))).BOOL;case i.CT_BYTE:return(h||(h=c("ThriftTypes"))).BYTE;case i.CT_I16:return(h||(h=c("ThriftTypes"))).I16;case i.CT_I32:return(h||(h=c("ThriftTypes"))).I32;case i.CT_I64:return(h||(h=c("ThriftTypes"))).I64;case i.CT_DOUBLE:return(h||(h=c("ThriftTypes"))).DOUBLE;case i.CT_FLOAT:return(h||(h=c("ThriftTypes"))).FLOAT;case i.CT_BINARY:return(h||(h=c("ThriftTypes"))).STRING;case i.CT_LIST:return(h||(h=c("ThriftTypes"))).LIST;case i.CT_SET:return(h||(h=c("ThriftTypes"))).SET;case i.CT_MAP:return(h||(h=c("ThriftTypes"))).MAP;case i.CT_STRUCT:return(h||(h=c("ThriftTypes"))).STRUCT;default:throw new Error("don't know what type")}};return a}();g["default"]=b}),98);
__d("CompactSerializerPolyfill",["TCompactProtocolPolyfill","TNoOpWriteBuffer","TReadBuffer","TWriteBuffer"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){a=new(c("TReadBuffer"))(a);a=new(c("TCompactProtocolPolyfill"))(a);return b(a)}function a(a,b,c){try{return h(a,b)}catch(a){c!=null&&c(a)}return null}function i(a,b,d){d===void 0&&(d=!1);if(d){d=new(c("TNoOpWriteBuffer"))();var e=new(c("TCompactProtocolPolyfill"))(d);b(a,e);e=new(c("TWriteBuffer"))(d.currentSize())}else e=new(c("TWriteBuffer"))();d=new(c("TCompactProtocolPolyfill"))(e);b(a,d);return d.toByteArray()}function b(a,b,c,d){c===void 0&&(c=!1);try{return i(a,b,c)}catch(a){d!=null&&d(a)}return null}g.deserialize=h;g.deserializeNoThrow=a;g.serialize=i;g.serializeNoThrow=b}),98);
__d("ContentAccessAndControlEventType",[],(function(a,b,c,d,e,f){a=Object.freeze({CLICK_BEGIN:"content_access_and_control_click_begin",CLICK_CANCEL:"content_access_and_control_click_cancel",CLICK_CONFIRM:"content_access_and_control_click_confirm",IMPRESSION:"content_access_and_control_impression",ENT_STORY_ACTION:"content_access_and_control_ent_story_action",SERVER_MUTATION_BEGIN:"content_access_and_control_mutation_begin",SERVER_MUTATION_FAILURE:"content_access_and_control_mutation_failure",SERVER_MUTATION_SUCCESS:"content_access_and_control_mutation_success",TRASH_METADATA_NOT_FOUND:"content_access_and_control_trash_metadata_not_found"});f["default"]=a}),66);
__d("ContextualConfigConstants",[],(function(a,b,c,d,e,f){"use strict";a=1e3;b=", ";c={SAME:"same",NULL:"null",NNULL:"nnull",CATCH_ALL:"catch_all",EQ:"eq",NEQ:"neq",LT:"lt",LTE:"lte",GT:"gt",GTE:"gte",COR:"cor",CONTAINS:"contains",REGEX:"regex",IN:"in",NIN:"nin"};d={DENSE:"dense",MULTI_OUTPUT_RESOLVED:"multi-output-resolved",TABLE:"table"};e=[];var g=[],h=[],i={BAD_BOOLEAN_FORMAT:"Bad boolean format",BAD_CONFIG:"Bad config",BAD_CONTEXT_IDENTIFIER:"Bad context identifier",BAD_CONTEXT_VALUE:"Bad context value",BAD_MONITORED_CONTEXTS:"Bad monitored contexts",BAD_NUMBER_FORMAT:"Bad number format",BAD_OUTPUT_NAME:"Bad output name",BAD_OUTPUT_TYPE:"Bad output type",BAD_VALUE_ORDER:"Bad values order",DUPLICATE_OUTPUT_NAME:"Duplicate output name",ILLEGAL_BOOLEAN_STRATEGY:"Illegal boolean strategy",ILLEGAL_BUCKET_VALUES:"Illegal bucket values",ILLEGAL_NUMERIC_STRATEGY:"Illegal numeric strategy",ILLEGAL_STRING_STRATEGY:"Illegal string strategy",INVALID_BOOLEAN:"Invalid boolean",INVALID_FLOAT:"Invalid float",INVALID_INTEGER:"Invalid integer",INVALID_STRING:"Invalid string",INVALID_VALUE_TYPE:"Invalid value type",MISMATCH_NUMBER_OF_VALUES:"Mismatching number of values",MISSING_BUCKETS:"Missing buckets",MISSING_BUCKET_MATCH:"Missing bucket match",MISSING_BUCKET_NAME:"Missing bucket name",MISSING_BUCKET_STRATEGY:"Missing bucket strategy",MISSING_CONTEXT_IN_CONFIG:"Missing context in config",MISSING_DEFAULT_VALUE:"Missing default value",MISSING_OUTPUTS_DEFINITION:"Missing outputs field definition",MISSING_RESULTS:"Missing results",MISSING_TABLE:"Missing table",MISSING_TABLE_ITEM_BUCKET:"Missing table item bucket",MISSING_TABLE_ITEM_VALUES:"Missing table item values",MISSING_VECTOR:"Missing vector",REGEX_SYNTAX_ERROR:"Regex syntax error",REQUESTED_PARAM_NOT_FOUND:"Requested param not found",RESULTS_VECTOR_SIZE_MISMATCH:"Results vector size mismatch",UNDECLARED_OUTPUT_PARAM:"Undeclared output param",UNKNOWN_BUCKET_DEFINITION:"Unknown bucket definition",UNKNOWN_CONFIG_TYPE:"Unknown config type",UNSUPPORTED_CONFIG_VERSION:"Unsupported config version"},j=10,k=", ",l={BOOL:"BOOL",FLOAT:"FLOAT",INT:"INT",STRING:"STRING"};f.ANALYTICS_SAMPLE_RATE=a;f.BUCKET_DELIMITER=b;f.CONTEXT_BUCKET_STRATEGY=c;f.CONFIG_TYPE=d;f.EMPTY_RESOLVED_CONTEXTS=e;f.EMPTY_RESOLVED_MONITORS=g;f.EMPTY_RESULT_PARAMS=h;f.ERROR=i;f.JSON_SUB_SAMPLE_RATE=j;f.LIST_DELIMITER=k;f.TYPE=l}),66);
__d("ContextualConfigResolvedContextsUtils",[],(function(a,b,c,d,e,f){"use strict";a=function(a){var b=[];for(a of a){var c=a.bucketIndex;if(c==void 0)break;b.push(c)}return b};b=function(a){var b=[];for(a of a){var c=a.bucketName;if(c===void 0)break;b.push(c)}return b};var g=function(a){return a.name};c=function(a){return a.map(g)};d=function(a){var b=[];for(a of a){var c=a.value;if(c===void 0)break;b.push(c)}return b};f.getBucketIndices=a;f.getBucketNames=b;f.getContextNames=c;f.getContextValues=d}),66);
__d("ContextualConfigCollateExposureData",["ContextualConfigConstants","ContextualConfigResolvedContextsUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=["cfg_ver_timestamp","policy_id","version","sample_rate"],i=function(a){return a.join(d("ContextualConfigConstants").LIST_DELIMITER)},j=function(a,b){for(var c of h)b[c]!=null&&(a[c]=b[c]);b.name&&(a.config_name=b.name)},k=function(a,b){var c=b[0],e=b[1],f=b[2];b=b[3];c!=null&&(a.exception=c.message);a.result=i(e.map(function(a){return a.value}))||"INVALID";a.context=i(d("ContextualConfigResolvedContextsUtils").getContextNames(f));a.context_value=i(d("ContextualConfigResolvedContextsUtils").getContextValues(f));a.bucket_name=i(d("ContextualConfigResolvedContextsUtils").getBucketNames(f));a.monitor=i(d("ContextualConfigResolvedContextsUtils").getContextNames(b));a.monitor_value=i(d("ContextualConfigResolvedContextsUtils").getContextValues(b))};function a(a,b,c){var e={sample_rate:d("ContextualConfigConstants").ANALYTICS_SAMPLE_RATE};j(e,a);k(e,b);c&&(e.config_contents=JSON.stringify(a));return e}g["default"]=a}),98);
__d("ContextualConfigExposureEvent",["Random"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b,c){this.$2=a,this.$4=d("Random").random()<1/a.sample_rate,this.$3=b,this.$1=c}var b=a.prototype;b.getData=function(){return this.$2};b.log=function(a){var b=this.$2,c=this.$3,d=this.$4;a&&c(b);d&&this.$1(b);return this};b.isSampled=function(){return this.$4};return a}();g["default"]=a}),98);
__d("ContextualConfigExposureLoggerFactory",["ContextualConfigExposureEvent"],(function(a,b,c,d,e,f,g){"use strict";var h=function(){function a(a,b){this.$2=a,this.$1=b}var b=a.prototype;b.createEvent=function(a){a=new(c("ContextualConfigExposureEvent"))(a,this.$2,this.$1);return a};return a}();function a(a,b){return new h(a,b)}g["default"]=a}),98);
__d("ContextualConfigExposureLogger",["ContextualConfigExposureLoggerFactory","MarauderLogger"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){};b=function(a){d("MarauderLogger").log("contextual_config_exposure","",a)};e=c("ContextualConfigExposureLoggerFactory")(a,b);g["default"]=e}),98);
__d("ContextualConfigAssert",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){if(a===!1)throw new Error(b)}f["default"]=a}),66);
__d("ContextualConfigValidators",["ContextualConfigConstants"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return Array.isArray(a)};b=function(a){return typeof a==="boolean"};c=function(a){return a!=null};e=function(a){return function(b){return Object.prototype.hasOwnProperty.call(a,b)}};f=function(a){return i(a)&&a%1===0};var h=function(a){return j(a)&&a.length>0},i=function(a){return typeof a==="number"&&!isNaN(a)&&a!==Infinity&&a!==-Infinity},j=function(a){return typeof a==="string"},k=function(a){switch(a){case d("ContextualConfigConstants").TYPE.BOOL:case d("ContextualConfigConstants").TYPE.FLOAT:case d("ContextualConfigConstants").TYPE.INT:case d("ContextualConfigConstants").TYPE.STRING:return!0;default:return!1}};g.isArray=a;g.isBoolean=b;g.isDefined=c;g.isKey=e;g.isInteger=f;g.isNonEmptyString=h;g.isNumber=i;g.isString=j;g.isType=k}),98);
__d("ContextualConfigParseBoolean",["ContextualConfigConstants"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a.toUpperCase()){case"TRUE":return!0;case"FALSE":return!1;default:throw new Error(d("ContextualConfigConstants").ERROR.BAD_BOOLEAN_FORMAT)}}g["default"]=a}),98);
__d("ContextualConfigParsePredBoolean",["ContextualConfigConstants","ContextualConfigParseBoolean"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e;switch(b){case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.SAME:var f=c("ContextualConfigParseBoolean")(a);e=function(a){return a===f};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.NULL:e=function(a){return a==null};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.NNULL:e=function(a){return a!=null};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.CATCH_ALL:e=function(a){return!0};break;default:throw new Error(d("ContextualConfigConstants").ERROR.ILLEGAL_BOOLEAN_STRATEGY)}return function(a){return e(a)}}g["default"]=a}),98);
__d("ContextualConfigParseFloat",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i=/^[-\+]?([1-9]\d*|0)(\.\d+)?$/,j=function(a){return i.test(a)};function a(a){(h||(h=c("ContextualConfigAssert")))(j(a),d("ContextualConfigConstants").ERROR.BAD_NUMBER_FORMAT);a=parseFloat(a);h(d("ContextualConfigValidators").isNumber(a),d("ContextualConfigConstants").ERROR.BAD_NUMBER_FORMAT);return a}g["default"]=a}),98);
__d("ContextualConfigParseInteger",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i=/^[-\+]?([1-9]\d*|0)$/,j=function(a){return i.test(a)};function a(a){(h||(h=c("ContextualConfigAssert")))(j(a),d("ContextualConfigConstants").ERROR.BAD_NUMBER_FORMAT);a=parseInt(a,10);h(d("ContextualConfigValidators").isNumber(a),d("ContextualConfigConstants").ERROR.BAD_NUMBER_FORMAT);return a}g["default"]=a}),98);
__d("ContextualConfigPredAssertions",["ContextualConfigAssert","ContextualConfigConstants"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a){return(h||(h=c("ContextualConfigAssert")))(a>0,d("ContextualConfigConstants").ERROR.MISMATCH_NUMBER_OF_VALUES)};b=function(a,b){return(h||(h=c("ContextualConfigAssert")))(a===b,d("ContextualConfigConstants").ERROR.MISMATCH_NUMBER_OF_VALUES)};e=function(a,b){return(h||(h=c("ContextualConfigAssert")))(a<b,d("ContextualConfigConstants").ERROR.BAD_VALUE_ORDER)};g.assertHasValues=a;g.assertNumberOfValues=b;g.assertValueOrder=e}),98);
__d("ContextualConfigParsePredNumeric",["ContextualConfigConstants","ContextualConfigParseFloat","ContextualConfigParseInteger","ContextualConfigPredAssertions","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e,f){var g=e.map(f?c("ContextualConfigParseInteger"):h||(h=c("ContextualConfigParseFloat"))),i;switch(b){case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.SAME:var j=f?c("ContextualConfigParseInteger")(a):(h||(h=c("ContextualConfigParseFloat")))(a);i=function(a){return f&&!d("ContextualConfigValidators").isInteger(a)?!1:a===j};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.NULL:i=function(a){return a==null};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.NNULL:i=function(a){return a!=null};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.CATCH_ALL:i=function(a){return!0};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.COR:d("ContextualConfigPredAssertions").assertNumberOfValues(g.length,2);d("ContextualConfigPredAssertions").assertValueOrder(g[0],g[1]);i=function(a){if(typeof a!=="number")return!1;return f&&!d("ContextualConfigValidators").isInteger(a)?!1:a>=g[0]&&a<g[1]};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.LT:d("ContextualConfigPredAssertions").assertNumberOfValues(g.length,1);i=function(a){if(typeof a!=="number")return!1;return f&&!d("ContextualConfigValidators").isInteger(a)?!1:a<g[0]};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.LTE:d("ContextualConfigPredAssertions").assertNumberOfValues(g.length,1);i=function(a){if(typeof a!=="number")return!1;return f&&!d("ContextualConfigValidators").isInteger(a)?!1:a<=g[0]};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.EQ:d("ContextualConfigPredAssertions").assertNumberOfValues(g.length,1);i=function(a){if(typeof a!=="number")return!1;return f&&!d("ContextualConfigValidators").isInteger(a)?!1:a===g[0]};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.NEQ:d("ContextualConfigPredAssertions").assertNumberOfValues(g.length,1);i=function(a){if(typeof a!=="number")return!1;return f&&!d("ContextualConfigValidators").isInteger(a)?!1:a!==g[0]};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.GT:d("ContextualConfigPredAssertions").assertNumberOfValues(g.length,1);i=function(a){if(typeof a!=="number")return!1;return f&&!d("ContextualConfigValidators").isInteger(a)?!1:a>g[0]};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.GTE:d("ContextualConfigPredAssertions").assertNumberOfValues(g.length,1);i=function(a){if(typeof a!=="number")return!1;return f&&!d("ContextualConfigValidators").isInteger(a)?!1:a>=g[0]};break;default:throw new Error(d("ContextualConfigConstants").ERROR.ILLEGAL_NUMERIC_STRATEGY)}return function(a){return i(a)}}g["default"]=a}),98);
__d("ContextualConfigParseRegExp",["ContextualConfigConstants"],(function(a,b,c,d,e,f,g){"use strict";var h=/^\/(.+)\/(.*)$/;function a(a){try{var b=a.match(h);if(b!=null)return new RegExp(b[1],b[2]);else return new RegExp(a)}catch(a){throw new Error(d("ContextualConfigConstants").ERROR.REGEX_SYNTAX_ERROR)}}g["default"]=a}),98);
__d("ContextualConfigParsePredString",["ContextualConfigConstants","ContextualConfigParseRegExp","ContextualConfigPredAssertions"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a){if(typeof a!=="string")throw new Error(d("ContextualConfigConstants").ERROR.INVALID_VALUE_TYPE);return a},i=function(a){var b=[];for(a of a)b.push(h(a));return b};function a(a,b,e){var f=i(e),g;switch(b){case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.SAME:g=function(b){return typeof b!=="string"?!1:b===a};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.NULL:g=function(a){return a==null};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.NNULL:g=function(a){return a!=null};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.CATCH_ALL:g=function(a){return!0};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.IN:d("ContextualConfigPredAssertions").assertHasValues(f.length);g=function(a){return typeof a!=="string"?!1:f.indexOf(a)!==-1};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.NIN:d("ContextualConfigPredAssertions").assertHasValues(f.length);g=function(a){return typeof a!=="string"?!1:f.indexOf(a)===-1};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.CONTAINS:d("ContextualConfigPredAssertions").assertNumberOfValues(f.length,1);g=function(a){return typeof a!=="string"?!1:a.indexOf(f[0])!==-1};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.REGEX:d("ContextualConfigPredAssertions").assertNumberOfValues(f.length,1);var h=c("ContextualConfigParseRegExp")(f[0]);g=function(a){return typeof a!=="string"?!1:h.test(a)};break;default:throw new Error(d("ContextualConfigConstants").ERROR.ILLEGAL_STRING_STRATEGY)}return function(a){return g(a)}}g["default"]=a}),98);
__d("ContextualConfigParseContextBuckets",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigParsePredBoolean","ContextualConfigParsePredNumeric","ContextualConfigParsePredString","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isDefined(a),d("ContextualConfigConstants").ERROR.MISSING_BUCKETS)},j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isArray(a),d("ContextualConfigConstants").ERROR.MISSING_BUCKETS)},k=d("ContextualConfigValidators").isKey(d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY),l=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isString(a)&&k(a.toUpperCase()),d("ContextualConfigConstants").ERROR.MISSING_BUCKET_STRATEGY)},m=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isArray(a),d("ContextualConfigConstants").ERROR.ILLEGAL_BUCKET_VALUES)},n=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isNonEmptyString(a),d("ContextualConfigConstants").ERROR.MISSING_BUCKET_NAME)},o=function(a,b){var e=b.name;n(e);var f=b.strategy;l(f);b=b.values||[];m(b);switch(a){case d("ContextualConfigConstants").TYPE.BOOL:return c("ContextualConfigParsePredBoolean")(e,f);case d("ContextualConfigConstants").TYPE.FLOAT:return c("ContextualConfigParsePredNumeric")(e,f,b,!1);case d("ContextualConfigConstants").TYPE.INT:return c("ContextualConfigParsePredNumeric")(e,f,b,!0);case d("ContextualConfigConstants").TYPE.STRING:return c("ContextualConfigParsePredString")(e,f,b);default:throw new Error(d("ContextualConfigConstants").ERROR.UNKNOWN_BUCKET_DEFINITION)}},p=function(a,b){i(b);var c=b.name;n(c);return{name:c,pred:o(a,b)}};function a(a,b){j(b);return b.map(function(b){return p(a,b)})}g["default"]=a}),98);
__d("ContextualConfigParseContexts",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigParseContextBuckets","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isDefined(a),d("ContextualConfigConstants").ERROR.BAD_CONTEXT_IDENTIFIER)},j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isArray(a)&&a.length>0,d("ContextualConfigConstants").ERROR.MISSING_CONTEXT_IN_CONFIG)},k=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isNonEmptyString(a),d("ContextualConfigConstants").ERROR.BAD_CONTEXT_IDENTIFIER)},l=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isType(a),d("ContextualConfigConstants").ERROR.BAD_CONTEXT_IDENTIFIER)},m=function(a){i(a);var b=a.name,d=a.type;a=a.buckets;k(b);l(d);return{name:b,type:d,buckets:c("ContextualConfigParseContextBuckets")(d,a)}};function a(a){j(a);return a.map(m)}g["default"]=a}),98);
__d("ContextualConfigIsEqualParams",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){if(a.length!=b.length)return!1;for(var c=0;c<a.length;c+=1){var d=a[c],e=b[c];if(d.name!==e.name||d.type!==e.type)return!1}return!0}f["default"]=a}),66);
__d("ContextualConfigParseResultParamValue",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigParseBoolean","ContextualConfigParseFloat","ContextualConfigParseInteger","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isString(a),d("ContextualConfigConstants").ERROR.INVALID_STRING)};function a(a,b){j(b);switch(a){case d("ContextualConfigConstants").TYPE.BOOL:return c("ContextualConfigParseBoolean")(b);case d("ContextualConfigConstants").TYPE.FLOAT:return(i||(i=c("ContextualConfigParseFloat")))(b);case d("ContextualConfigConstants").TYPE.INT:return c("ContextualConfigParseInteger")(b);case d("ContextualConfigConstants").TYPE.STRING:return b;default:throw new Error(d("ContextualConfigConstants").ERROR.INVALID_VALUE_TYPE)}}g["default"]=a}),98);
__d("ContextualConfigParseResultParams",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigParseResultParamValue","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isArray(a),d("ContextualConfigConstants").ERROR.MISSING_RESULTS)},k=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isDefined(a),d("ContextualConfigConstants").ERROR.BAD_CONTEXT_VALUE)},l=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isNonEmptyString(a),d("ContextualConfigConstants").ERROR.BAD_CONTEXT_VALUE)},m=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isType(a),d("ContextualConfigConstants").ERROR.BAD_CONTEXT_VALUE)},n=function(a,b){for(a of a)if(a.name===b)return a.type;throw new Error(d("ContextualConfigConstants").ERROR.UNDECLARED_OUTPUT_PARAM)},o=function(a){return function(b){k(b);var d=b.name;l(d);var e=n(a,d);m(e);b=(i||(i=c("ContextualConfigParseResultParamValue")))(e,b.value);return{name:d,type:e,value:b}}};function a(a,b){j(b);return b.map(o(a))}g["default"]=a}),98);
__d("ContextualConfigParseDenseResultParams",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigIsEqualParams","ContextualConfigParseResultParams"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a,b){return(h||(h=c("ContextualConfigAssert")))(c("ContextualConfigIsEqualParams")(a,b),d("ContextualConfigConstants").ERROR.RESULTS_VECTOR_SIZE_MISMATCH)};function a(a,b){b=c("ContextualConfigParseResultParams")(a,b.map(function(b,c){return{name:a[c].name,value:b}}));i(a,b);return b}g["default"]=a}),98);
__d("ContextualConfigParseDenseDefaults",["ContextualConfigConstants","ContextualConfigParseDenseResultParams"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){try{return c("ContextualConfigParseDenseResultParams")(a,b)}catch(a){throw new Error(d("ContextualConfigConstants").ERROR.MISSING_DEFAULT_VALUE)}}g["default"]=a}),98);
__d("ContextualConfigParseMonitors",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isDefined(a),d("ContextualConfigConstants").ERROR.BAD_CONTEXT_IDENTIFIER)},j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isArray(a),d("ContextualConfigConstants").ERROR.BAD_MONITORED_CONTEXTS)},k=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isNonEmptyString(a),d("ContextualConfigConstants").ERROR.BAD_CONTEXT_IDENTIFIER)},l=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isType(a),d("ContextualConfigConstants").ERROR.BAD_CONTEXT_IDENTIFIER)},m=function(a){i(a);var b=a.name;a=a.type;k(b);l(a);return{name:b,type:a}};function a(a){j(a);return a.map(m)}g["default"]=a}),98);
__d("ContextualConfigParseOutputParams",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){var h,i=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isArray(a),d("ContextualConfigConstants").ERROR.MISSING_OUTPUTS_DEFINITION)},j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isType(a),d("ContextualConfigConstants").ERROR.BAD_OUTPUT_TYPE)},k=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isNonEmptyString(a),d("ContextualConfigConstants").ERROR.BAD_OUTPUT_NAME)},l=function(a){return(h||(h=c("ContextualConfigAssert")))(m(a),d("ContextualConfigConstants").ERROR.DUPLICATE_OUTPUT_NAME)},m=function(a){var b={};for(a of a){if(b[a.name])return!1;b[a.name]=!0}return!0},n=function(a){k(a.name);j(a.type);return a};function a(a){i(a);a=a.map(n);l(a);return a}g["default"]=a}),98);
__d("ContextualConfigParseVector",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigParseResultParamValue","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isArray(a),d("ContextualConfigConstants").ERROR.MISSING_VECTOR)},k=function(a,b){return(h||(h=c("ContextualConfigAssert")))(a===b,d("ContextualConfigConstants").ERROR.RESULTS_VECTOR_SIZE_MISMATCH)},l=function(a,b){k(a.length,b.length);for(var d=0;d<a.length;d+=1){var e=a[d].type,f=b[d];(i||(i=c("ContextualConfigParseResultParamValue")))(e,f)}},m=function(a){return a.reduce(function(a,b){b=b.buckets;return a*b.length},1)};function a(a,b,c){j(c);b=m(b);var d=a.length;k(b*d,c.length);for(var e=0;e<b;e+=1){var f=e*d;l(a,c.slice(f,f+d))}return c}g["default"]=a}),98);
__d("ContextualConfigResolveContexts",["ContextualConfigConstants"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a,b){for(var c=0;c<a.length;c+=1){var d=a[c];try{if(d.pred(b))return[d.name,c]}catch(a){return null}}return null};function a(a,b,c){var e=null;a=a.map(function(a){var f=a.name,g={name:f};if(e!=null)return g;var i;c[f]!=null?i=c[f]:b[f]!=null?i=b[f]():i=null;g.value=i;if(a.buckets!=null){f=h(a.buckets,i);if(f==null){e=new Error(d("ContextualConfigConstants").ERROR.MISSING_BUCKET_MATCH);return g}a=f[0];i=f[1];g.bucketName=a;g.bucketIndex=i}return g});return[e,a]}g["default"]=a}),98);
__d("DenseContextualConfig",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigParseContexts","ContextualConfigParseDenseDefaults","ContextualConfigParseDenseResultParams","ContextualConfigParseMonitors","ContextualConfigParseOutputParams","ContextualConfigParseVector","ContextualConfigResolveContexts","ContextualConfigResolvedContextsUtils","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isDefined(a),d("ContextualConfigConstants").ERROR.BAD_CONFIG)},j=function(a){var b=[],c=1;for(var d=a.length-1;d>=0;d-=1)b.push(c),c*=a[d].buckets.length;return b.reverse()},k=function(a,b,d,e){try{b=b.slice(d,d+a.length);return[null,c("ContextualConfigParseDenseResultParams")(a,b)]}catch(a){return[a,e]}},l=function(a,b,d){try{d=d.reduce(function(b,d,e){(h||(h=c("ContextualConfigAssert")))(e<a.length,"Auxillery index out of range.");return b+a[e]*d},0);return[null,d*b]}catch(a){return[a,-1]}};a=function(){function a(a,b){i(a);this.globalContextProviders=babelHelpers["extends"]({},b);b=c("ContextualConfigParseOutputParams")(a.outputs);var d=c("ContextualConfigParseContexts")(a.contexts);this.aux=j(d);this.contexts=d;this.defaults=c("ContextualConfigParseDenseDefaults")(b,a.vectorDefaults);this.monitors=a.monitors!=null?c("ContextualConfigParseMonitors")(a.monitors):[];this.outputs=b;this.vector=c("ContextualConfigParseVector")(b,d,a.vector)}var b=a.prototype;b.resolve=function(a){try{return this.unsafeResolve(a)}catch(a){return[a,this.defaults,d("ContextualConfigConstants").EMPTY_RESOLVED_CONTEXTS,d("ContextualConfigConstants").EMPTY_RESOLVED_MONITORS]}};b.unsafeResolve=function(a){var b=this.aux,e=this.globalContextProviders,f=this.contexts,g=this.defaults,h=this.monitors,i=this.outputs,j=this.vector;f=c("ContextualConfigResolveContexts")(f,e,a);var m=f[0];f=f[1];if(m!=null)return[m,g,f,d("ContextualConfigConstants").EMPTY_RESOLVED_MONITORS];m=l(b,i.length,d("ContextualConfigResolvedContextsUtils").getBucketIndices(f));b=m[0];m=m[1];if(b!=null)return[b,g,f,d("ContextualConfigConstants").EMPTY_RESOLVED_MONITORS];b=k(i,j,m,g);i=b[0];j=b[1];if(i!=null)return[i,j,f,d("ContextualConfigConstants").EMPTY_RESOLVED_MONITORS];m=c("ContextualConfigResolveContexts")(h,e,a);g=m[0];b=m[1];return g!=null?[g,j,f,d("ContextualConfigConstants").EMPTY_RESOLVED_MONITORS]:[null,j,f,b]};return a}();g["default"]=a}),98);
__d("MultiOutputResolvedContextualConfig",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigParseMonitors","ContextualConfigParseOutputParams","ContextualConfigParseResultParams","ContextualConfigResolveContexts","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isDefined(a),d("ContextualConfigConstants").ERROR.BAD_CONFIG)};a=function(){function a(a,b){i(a);this.globalContextProviders=babelHelpers["extends"]({},b);b=c("ContextualConfigParseOutputParams")(a.outputs);this.monitors=a.monitors!=null?c("ContextualConfigParseMonitors")(a.monitors):[];this.values=c("ContextualConfigParseResultParams")(b,a.values)}var b=a.prototype;b.resolve=function(a){try{return this.unsafeResolve(a)}catch(a){return[a,this.values,d("ContextualConfigConstants").EMPTY_RESOLVED_CONTEXTS,d("ContextualConfigConstants").EMPTY_RESOLVED_MONITORS]}};b.unsafeResolve=function(a){var b=this.globalContextProviders,e=this.monitors,f=this.values;e=c("ContextualConfigResolveContexts")(e,b,a);b=e[0];a=e[1];return b!=null?[b,f,d("ContextualConfigConstants").EMPTY_RESOLVED_CONTEXTS,d("ContextualConfigConstants").EMPTY_RESOLVED_MONITORS]:[null,f,d("ContextualConfigConstants").EMPTY_RESOLVED_CONTEXTS,a]};return a}();g["default"]=a}),98);
__d("ContextualConfigMergePartialResultParams",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c={};for(b of b)c[b.name]=b;b=[];for(a of a){var d=c[a.name];b.push(d!=null&&d.name===a.name&&d.type===a.type?d:a)}return b}f["default"]=a}),66);
__d("ContextualConfigParseDefaults",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigIsEqualParams","ContextualConfigParseResultParams"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a,b){return(h||(h=c("ContextualConfigAssert")))(c("ContextualConfigIsEqualParams")(a,b),d("ContextualConfigConstants").ERROR.MISSING_DEFAULT_VALUE)};function a(a,b){b=c("ContextualConfigParseResultParams")(a,b);i(a,b);return b}g["default"]=a}),98);
__d("ContextualConfigParseTable",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigParseResultParams","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isArray(a),d("ContextualConfigConstants").ERROR.MISSING_TABLE)},j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isDefined(a),d("ContextualConfigConstants").ERROR.MISSING_TABLE)},k=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isNonEmptyString(a),d("ContextualConfigConstants").ERROR.MISSING_TABLE_ITEM_BUCKET)},l=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isArray(a),d("ContextualConfigConstants").ERROR.MISSING_TABLE_ITEM_VALUES)},m=function(a,b){j(b);var d=b.bucket;b=b.values;k(d);l(b);return{bucket:d,values:c("ContextualConfigParseResultParams")(a,b)}};function a(a,b){i(b);return b.reduce(function(b,c){c=m(a,c);b[c.bucket]=c.values;return b},{})}g["default"]=a}),98);
__d("TableContextualConfig",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigMergePartialResultParams","ContextualConfigParseContexts","ContextualConfigParseDefaults","ContextualConfigParseMonitors","ContextualConfigParseOutputParams","ContextualConfigParseTable","ContextualConfigResolveContexts","ContextualConfigResolvedContextsUtils","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i=[],j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isDefined(a),d("ContextualConfigConstants").ERROR.BAD_CONFIG)};a=function(){function a(a,b){j(a);this.globalContextProviders=babelHelpers["extends"]({},b);b=c("ContextualConfigParseOutputParams")(a.outputs);this.contexts=c("ContextualConfigParseContexts")(a.contexts);this.defaults=c("ContextualConfigParseDefaults")(b,a.defaults);this.monitors=a.monitors!=null?c("ContextualConfigParseMonitors")(a.monitors):[];this.table=c("ContextualConfigParseTable")(b,a.table)}var b=a.prototype;b.resolve=function(a){try{return this.unsafeResolve(a)}catch(a){return[a,this.defaults,d("ContextualConfigConstants").EMPTY_RESOLVED_CONTEXTS,d("ContextualConfigConstants").EMPTY_RESOLVED_MONITORS]}};b.unsafeResolve=function(a){var b=this.globalContextProviders,e=this.contexts,f=this.defaults,g=this.monitors,h=this.table;e=c("ContextualConfigResolveContexts")(e,b,a);var j=e[0];e=e[1];if(j!=null)return[j,f,e,[]];j=d("ContextualConfigResolvedContextsUtils").getBucketNames(e).join(d("ContextualConfigConstants").BUCKET_DELIMITER);h=h[j]||i;j=c("ContextualConfigMergePartialResultParams")(f,h);f=c("ContextualConfigResolveContexts")(g,b,a);h=f[0];g=f[1];return h!=null?[h,j,e,[]]:[null,j,e,g]};return a}();g["default"]=a}),98);
__d("ContextualConfigParseConfig",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigValidators","DenseContextualConfig","MultiOutputResolvedContextualConfig","TableContextualConfig"],(function(a,b,c,d,e,f,g){"use strict";var h,i=[1],j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isDefined(a)&&d("ContextualConfigValidators").isDefined(a.version),d("ContextualConfigConstants").ERROR.BAD_CONFIG)},k=function(a){return(h||(h=c("ContextualConfigAssert")))(i.indexOf(a)!==-1,d("ContextualConfigConstants").ERROR.UNSUPPORTED_CONFIG_VERSION)};function a(a,b){j(a);k(a.version);switch(a.cctype){case d("ContextualConfigConstants").CONFIG_TYPE.DENSE:return new(c("DenseContextualConfig"))(a,b);case d("ContextualConfigConstants").CONFIG_TYPE.MULTI_OUTPUT_RESOLVED:return new(c("MultiOutputResolvedContextualConfig"))(a,b);case d("ContextualConfigConstants").CONFIG_TYPE.TABLE:return new(c("TableContextualConfig"))(a,b);default:throw new Error(d("ContextualConfigConstants").ERROR.UNKNOWN_CONFIG_TYPE)}}g["default"]=a}),98);
__d("ContextualConfigWarn",[],(function(a,b,c,d,e,f){"use strict";function a(a){}f["default"]=a}),66);
__d("ContextualConfigResult",["ContextualConfigConstants","ContextualConfigWarn"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){this.$1=a.reduce(function(a,b){var c=b.name;b=b.value;a[c]=b;return a},{}),this.$2=a}var b=a.prototype;b.get=function(a,b){try{a=this.$1[a];if(typeof a!==typeof b){c("ContextualConfigWarn")(d("ContextualConfigConstants").ERROR.REQUESTED_PARAM_NOT_FOUND);return b}return a}catch(a){c("ContextualConfigWarn")(a.message);return b}};b.getParams=function(){return this.$2};return a}();g["default"]=a}),98);
__d("ErrorContextualConfig",["ContextualConfigConstants"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){this.error=a}var b=a.prototype;b.resolve=function(a){return[this.error,d("ContextualConfigConstants").EMPTY_RESULT_PARAMS,d("ContextualConfigConstants").EMPTY_RESOLVED_CONTEXTS,d("ContextualConfigConstants").EMPTY_RESOLVED_MONITORS]};return a}();g["default"]=a}),98);
__d("ContextualConfig",["ContextualConfigCollateExposureData","ContextualConfigConstants","ContextualConfigExposureLogger","ContextualConfigParseConfig","ContextualConfigResult","ErrorContextualConfig","Random"],(function(a,b,c,d,e,f,g){"use strict";var h=1/d("ContextualConfigConstants").JSON_SUB_SAMPLE_RATE,i=1;a=function(){function a(a,b){b===void 0&&(b={}),this.isDebugLoggingEnabled=!1,this.$3=!1,this.$4=a,this.$2=b}var b=a.prototype;b.$5=function(){if(this.$1)return this.$1;var a=this.$2,b=this.$4;try{b=c("ContextualConfigParseConfig")(b,a)}catch(a){b=new(c("ErrorContextualConfig"))(a)}this.$1=b;return b};b.$6=function(a){var b=this.isDebugLoggingEnabled,e=this.$3;e=!e&&d("Random").random()<h;e&&(this.$3=!0);a=c("ContextualConfigCollateExposureData")(this.$4,a,e);e=c("ContextualConfigExposureLogger").createEvent(a);e.log(b)};b.resolve=function(a){a===void 0&&(a={});var b=this.$1||this.$5();b=b.resolve(a);this.$6(b);return new(c("ContextualConfigResult"))(b[i])};return a}();g["default"]=a}),98);
__d("DgwClientFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1755537");b=d("FalcoLoggerInternal").create("dgw_client",a);e=b;g["default"]=e}),98);
__d("DGWLoggingContext",["$InternalEnum","DgwClientFalcoEvent","ODS","Random"],(function(a,b,c,d,e,f,g){"use strict";var h;a="dgw_client";var i=b("$InternalEnum")({STREAM_GROUP_COMPONENT:"WebStreamGroup",GROUPED_STREAM_COMPONENT:"GroupedWebStream",WEBSOCKET_TRANSPORT_COMPONENT:"WebSocketTransport",ACK_MANAGER_COMPONENT:"WebStreamAckManager",CODEC_COMPONENT:"WebCodec",RAW_CLIENT:"RAWDGWClient",PINGER:"DGWPinger"}),j={VERBOSE:-1,INFO:0,WARNING:1,ERROR:2,FATAL:3};function k(a){switch(a){case i.GROUPED_STREAM_COMPONENT:case i.ACK_MANAGER_COMPONENT:return!0;default:return!1}}e=function(){function a(a,b,c,d,e,f,g){f===void 0&&(f=!1),g===void 0&&(g=!1),this.$5=""+a,this.$1=b,this.$4=c,this.$3=d,this.sgTransportId=e,this.$2=f,this.$6=g}a.bumpODSKey=function(a,b,c){c===void 0&&(c=1);if(!d("Random").coinflip(c))return;a=a+"."+b;(h||(h=d("ODS"))).bumpEntityKey(3589,"dgw_web_client",a,c)};var b=a.prototype;b.bumpODSKey=function(a,b,c){c===void 0&&(c=1);if(!d("Random").coinflip(c))return;a=this.$4+"."+a+"."+b;(h||(h=d("ODS"))).bumpEntityKey(3589,"dgw_web_client",a,c)};b.logEvent=function(a,b,c,d,e){d===void 0&&(d=!1),this.$2||this.$7(a,b,null,j.INFO,c,d,e)};b.$7=function(a,b,d,e,f,g,h){var i=this;g===void 0&&(g=!1);if(g&&!this.$6)return;(k(a)&&this.$1!=null||!k(a)&&this.sgTransportId!=null)&&c("DgwClientFalcoEvent").log(function(){return{event:b,logging_id:h!=null?h:i.$1,dgw_version:i.$5,message:d,severity:e,uuid:i.$3,dgw_component:a,extra_info:f,destination_tier:i.$4,sg_transport_id:i.sgTransportId,source:2}})};b.logError=function(a,b,c,d,e,f){e===void 0&&(e=!1),this.$2||this.$7(a,b,c,j.ERROR,d,e,f)};b.logWarn=function(a,b,c,d,e){e===void 0&&(e=!1),this.$2||this.$7(a,b,c,j.WARNING,d,e)};return a}();g.DGW_MODULE=a;g.DGWLoggingComponent=i;g.DGWLoggingContext=e}),98);
__d("DGWAckManager",["DGWLoggingContext"],(function(a,b,c,d,e,f,g){"use strict";var h=function(){function a(a,b,c){var d=this;this.$3=c;this.sendId=a;this.$2=b;this.handleAckReceived=function(){d.stopTracking(!0)};this.$1=window.setTimeout(function(){d.stopTracking(!1)},b)}var b=a.prototype;b.stopTracking=function(a){window.clearTimeout(this.$1),this.$3(a)};return a}();a=function(){function a(a){this.$1=new Map(),this.$2=a}var b=a.prototype;b.waitForAck=async function(a,b){this.$2.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"ack_expected");var c=this.$1;try{var e=await new Promise(function(d,e){c.set(a,new h(a,b,d))});e===!0?this.$2.logEvent(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"Received ACK","sendId:"+a,!0):(this.$2.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"ack_timeout"),this.$2.logWarn(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"ACK timeout","Request "+a+" timed out after "+b+"ms"));c.delete(a);return e}catch(b){this.$2.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"ack_error");c.delete(a);throw b}};b.handleAckReceived=function(a){this.$2.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"ack_received");var b=this.$1.get(a);if(b===void 0){this.$2.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"ack_received.not_tracked");this.$2.logWarn(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"untracked ACK","Received ACK for ackId "+a+" which was not being tracked");return}b.handleAckReceived()};b.clearPendingAcks=function(){var a=this;this.$2.logEvent(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"Clearing pending acks","ACKs cleared size: "+this.$1.size);this.$1.forEach(function(b,c,e){a.$2.logEvent(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"Clearing pending ACK with ackId "+b.sendId,null,!0),b.stopTracking(!1),e.delete(c)})};return a}();g.DGWAckManager=a}),98);
__d("DGWStream",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";var g=b("$InternalEnum").Mirrored(["ABNORMAL_CLOSURE","GOING_AWAY","SERVER_INTERNAL_ERROR","PREMATURE_CLOSE","UNKNOWN_ERROR","KEEPALIVE_TIMEOUT","TRANSPORT_CLOSED_BEFORE_STREAM_INIT","TRANSPORT_ESTABLISHMENT_ERROR","TRANSPORT_ESTABLISHMENT_TIMEOUT","ESTABLISHMENT_TIMEOUT","UNAUTHENTICATED","UNAUTHORIZED","REJECTED","BAD_REQUEST","DGW_SERVER_ERROR","ESTABLISHMENT_ERROR","ACK_TIMEOUT"]);function a(a){switch(a){case g.UNAUTHENTICATED:case g.UNAUTHORIZED:case g.REJECTED:case g.BAD_REQUEST:case g.UNKNOWN_ERROR:case g.SERVER_INTERNAL_ERROR:return!1;default:return!0}}f.StreamError=g;f.isRetryableError=a}),66);
__d("DGWCppBridge",[],(function(l,m,n,o,p,q){var r=function(){var l=typeof document!=="undefined"&&document.currentScript?document.currentScript.src:void 0;return function(m){m=m||{};var m=typeof m!=="undefined"?m:{},n=function(){function m(){}function n(l,m){return function(){l.apply(m,arguments)}}function l(m){if(!(this instanceof l))throw new TypeError("Promises must be constructed via new");if(typeof m!=="function")throw new TypeError("not a function");this._state=0;this._handled=!1;this._value=void 0;this._deferreds=[];t(m,this)}function o(m,n){while(m._state===3)m=m._value;if(m._state===0){m._deferreds.push(n);return}m._handled=!0;l._immediateFn(function(){var l=m._state===1?n.onFulfilled:n.onRejected;if(l===null){(m._state===1?p:q)(n.promise,m._value);return}var o;try{o=l(m._value)}catch(l){q(n.promise,l);return}p(n.promise,o)})}function p(m,o){try{if(o===m)throw new TypeError("A promise cannot be resolved with itself.");if(o&&(typeof o==="object"||typeof o==="function")){var p=o.then;if(o instanceof l){m._state=3;m._value=o;r(m);return}else if(typeof p==="function"){t(n(p,o),m);return}}m._state=1;m._value=o;r(m)}catch(l){q(m,l)}}function q(l,m){l._state=2,l._value=m,r(l)}function r(m){m._state===2&&m._deferreds.length===0&&l._immediateFn(function(){m._handled||l._unhandledRejectionFn(m._value)});for(var n=0,p=m._deferreds.length;n<p;n++)o(m,m._deferreds[n]);m._deferreds=null}function s(l,m,n){this.onFulfilled=typeof l==="function"?l:null,this.onRejected=typeof m==="function"?m:null,this.promise=n}function t(l,m){var n=!1;try{l(function(l){if(n)return;n=!0;p(m,l)},function(l){if(n)return;n=!0;q(m,l)})}catch(l){if(n)return;n=!0;q(m,l)}}l.prototype["catch"]=function(l){return this.then(null,l)};l.prototype.then=function(l,n){var p=new this.constructor(m);o(this,new s(l,n,p));return p};l.all=function(m){return new l(function(l,n){if(!Array.isArray(m))return n(new TypeError("Promise.all accepts an array"));var o=Array.prototype.slice.call(m);if(o.length===0)return l([]);var p=o.length;function q(m,r){try{if(r&&(typeof r==="object"||typeof r==="function")){var s=r.then;if(typeof s==="function"){s.call(r,function(l){q(m,l)},n);return}}o[m]=r;--p===0&&l(o)}catch(l){n(l)}}for(var r=0;r<o.length;r++)q(r,o[r])})};l.resolve=function(m){return m&&typeof m==="object"&&m.constructor===l?m:new l(function(l){l(m)})};l.reject=function(m){return new l(function(l,n){n(m)})};l.race=function(m){return new l(function(n,o){if(!Array.isArray(m))return o(new TypeError("Promise.race accepts an array"));for(var p=0,q=m.length;p<q;p++)l.resolve(m[p]).then(n,o)})};l._immediateFn=typeof setImmediate==="function"&&function(l){setImmediate(l)}||function(l){setTimeout(l,0)};l._unhandledRejectionFn=function(l){typeof console!=="undefined"&&console};return l}(),o,s;m.ready=new n(function(l,m){o=l,s=m});var t={},u;for(u in m)Object.prototype.hasOwnProperty.call(m,u)&&(t[u]=m[u]);var v=[];(function(l,m){throw m});var w=!0,x=!1,y="";function z(l){return m.locateFile?m.locateFile(l,y):y+l}var A;(w||x)&&(x?y=self.location.href:typeof document!=="undefined"&&document.currentScript&&(y=document.currentScript.src),l&&(y=l),y.indexOf("blob:")!==0?y=y.substr(0,y.lastIndexOf("/")+1):y="",(function(l){try{var m=new XMLHttpRequest();m.open("GET",l,!1);m.send(null);return m.responseText}catch(n){m=ga(l);if(m)return fa(m);throw n}},x&&(A=function(l){try{var m=new XMLHttpRequest();m.open("GET",l,!1);m.responseType="arraybuffer";m.send(null);return new Uint8Array(m.response)}catch(n){m=ga(l);if(m)return m;throw n}}),function(l,m,n){var o=new XMLHttpRequest();o.open("GET",l,!0);o.responseType="arraybuffer";o.onload=function(){if(o.status==200||o.status==0&&o.response){m(o.response);return}var p=ga(l);if(p){m(p.buffer);return}n()};o.onerror=n;o.send(null)}),function(l){document.title=l});m.print||emptyFunction.bind(console);var B=m.printErr||emptyFunction.bind(console);for(u in t)Object.prototype.hasOwnProperty.call(t,u)&&(m[u]=t[u]);t=null;m.arguments&&(v=m.arguments);m.thisProgram&&m.thisProgram;m.quit&&m.quit;var C;m.wasmBinary&&(C=m.wasmBinary);m.noExitRuntime||!0;var D={Memory:function(l){this.buffer=new ArrayBuffer(l.initial*65536)},Module:function(l){},Instance:function(l,m){this.exports=function(l){function m(l){l.set=function(l,m){this[l]=m};l.get=function(l){return this[l]};return l}var n,o=new Uint8Array(123);for(var p=25;p>=0;--p)o[48+p]=52+p,o[65+p]=p,o[97+p]=26+p;o[43]=62;o[47]=63;function q(m,n,p){var q,r,l=0,s=n,t=p.length;n=n+(t*3>>2)-(p[t-2]=="=")-(p[t-1]=="=");for(;l<t;l+=4)q=o[p.charCodeAt(l+1)],r=o[p.charCodeAt(l+2)],m[s++]=o[p.charCodeAt(l)]<<2|q>>4,s<n&&(m[s++]=q<<4|r>>2),s<n&&(m[s++]=r<<6|o[p.charCodeAt(l+3)])}function r(l){q(n,1024,"U3Q5dHlwZV9pbmZvAAAAAOAEAAAABAAATjEwX19jeHhhYml2MTE2X19zaGltX3R5cGVfaW5mb0UAAAAACAUAABgEAAAQBAAATjEwX19jeHhhYml2MTE3X19jbGFzc190eXBlX2luZm9FAAAACAUAAEgEAAA8BAAATjEwX19jeHhhYml2MTE3X19wYmFzZV90eXBlX2luZm9FAAAACAUAAHgEAAA8BAAATjEwX19jeHhhYml2MTE5X19wb2ludGVyX3R5cGVfaW5mb0UACAUAAKgEAACcBAAAAAAAAGwEAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAAAAABQBQAAAQAAAAkAAAADAAAABAAAAAUAAAAKAAAACwAAAAwAAABOMTBfX2N4eGFiaXYxMjBfX3NpX2NsYXNzX3R5cGVfaW5mb0UAAAAACAUAACgFAABsBA=="),q(n,1372,"gAkQ")}function s(l){var o=l.a,p=o.buffer;o.grow=xa;var q=new Int8Array(p),s=new Int16Array(p),t=new Int32Array(p),u=new Uint8Array(p),v=new Uint16Array(p),w=new Uint32Array(p);new Float32Array(p);new Float64Array(p);var x=Math.imul;Math.fround;Math.abs;var y=Math.clz32;Math.min;Math.max;Math.floor;Math.ceil;Math.trunc;Math.sqrt;l.abort;NaN;Infinity;var z=l.b,A=1051008,B;function C(o,p,l,r,m,n){o=o|0;p=p|0;l=l|0;r=r|0;m=m|0;n=n|0;var y=0,z=0,B;y=A-80|0;A=y;t[y+72>>2]=o;t[y+68>>2]=p;t[y+64>>2]=l;t[y+60>>2]=r;t[y+56>>2]=m;t[y+52>>2]=n;a:{if(t[y+52>>2]?!t[y+56>>2]|(!t[y+72>>2]|!t[y+68>>2]|(!t[y+64>>2]|!t[y+60>>2])):1){t[y+76>>2]=5;break a}t[t[y+64>>2]>>2]=0;t[t[y+60>>2]>>2]=0;p=t[y+68>>2];l=t[y+56>>2];r=t[y+52>>2];o=A+-64|0;A=o;t[o+56>>2]=t[y+72>>2];t[o+52>>2]=p;t[o+48>>2]=l;t[o+44>>2]=r;t[o+40>>2]=0;t[o+36>>2]=t[o+56>>2];b:{c:{d:{while(1){if(!t[o+52>>2])break c;t[o+32>>2]=t[o+36>>2];q[o+31|0]=u[t[o+36>>2]];t[o+52>>2]=t[o+52>>2]-1;t[o+36>>2]=t[o+36>>2]+1;if(u[o+31|0]!=10?u[o+31|0]==2|u[o+31|0]==4|u[o+31|0]==9:1){t[o+40>>2]=t[o+40>>2]+1;continue}t[o+24>>2]=1;if(V(u[o+31|0])&1){z=o,B=X(u[o+31|0])&1,q[z+23|0]=B;t[o+16>>2]=q[o+23|0]&1?1:2;if(w[o+52>>2]<w[o+16>>2]){t[t[o+48>>2]>>2]=t[o+32>>2];t[t[o+44>>2]>>2]=t[o+52>>2]+t[o+24>>2];break b}t[o+52>>2]=t[o+52>>2]-t[o+16>>2];t[o+24>>2]=t[o+16>>2]+t[o+24>>2];t[o+36>>2]=t[o+16>>2]+t[o+36>>2];if(!(u[o+31|0]!=14?u[o+31|0]!=8:0)){t[o+40>>2]=t[o+40>>2]+1;continue}}if(w[o+52>>2]<3)break d;t[o+12>>2]=0;p=t[o+36>>2];l=u[p|0]|u[p+1|0]<<8;q[o+12|0]=l;q[o+13|0]=l>>>8;q[o+14|0]=u[p+2|0];t[o+52>>2]=t[o+52>>2]-3;t[o+24>>2]=t[o+24>>2]+3;t[o+36>>2]=t[o+36>>2]+3;if(w[o+12>>2]<=w[o+52>>2]){t[o+40>>2]=t[o+40>>2]+1;t[o+36>>2]=t[o+12>>2]+t[o+36>>2];t[o+52>>2]=t[o+52>>2]-t[o+12>>2];continue}break}t[t[o+48>>2]>>2]=t[o+32>>2];t[t[o+44>>2]>>2]=t[o+52>>2]+t[o+24>>2];break b}t[t[o+48>>2]>>2]=t[o+32>>2];t[t[o+44>>2]>>2]=t[o+52>>2]+t[o+24>>2];break b}t[t[o+44>>2]>>2]=t[o+52>>2]}t[o+60>>2]=t[o+40>>2];A=o- -64|0;t[y+48>>2]=t[o+60>>2];if(!t[y+48>>2]){t[y+76>>2]=0;break a}z=y,B=D(x(t[y+48>>2],20)),t[z+44>>2]=B;if(!t[y+44>>2]){t[y+76>>2]=3;break a}t[y+40>>2]=t[y+44>>2];t[y+36>>2]=t[y+72>>2];t[y+32>>2]=t[y+68>>2]-t[t[y+52>>2]>>2];t[y+28>>2]=0;while(1){if(w[y+28>>2]<w[y+48>>2]){if(w[y+32>>2]<1){O(t[y+44>>2],t[y+28>>2]);t[y+76>>2]=1;break a}q[y+27|0]=u[t[y+36>>2]];t[y+36>>2]=t[y+36>>2]+1;t[y+32>>2]=t[y+32>>2]-1;e:{if(!u[y+27|0]|u[y+27|0]==1|(u[y+27|0]==2|u[y+27|0]==3)|(u[y+27|0]==4|u[y+27|0]==9|u[y+27|0]==10))break e;if(V(u[y+27|0])&1)break e;O(t[y+44>>2],t[y+28>>2]);t[y+76>>2]=6;break a}o=t[y+40>>2];t[o>>2]=u[y+27|0]&15|t[o>>2]&-16;f:{if(u[y+27|0]!=10?u[y+27|0]==2|u[y+27|0]==4|u[y+27|0]==9:1){o=t[y+40>>2];t[o>>2]=t[o>>2]&-268435441;t[y+40>>2]=t[y+40>>2]+20;break f}if(V(u[y+27|0])&1){o=A-48|0;A=o;t[o+40>>2]=t[y+40>>2];t[o+36>>2]=y+36;t[o+32>>2]=y+32;g:{if(!(V(t[t[o+40>>2]>>2]&15)&1)){t[o+44>>2]=1;break g}z=o,B=X(t[t[o+40>>2]>>2]&15)&1,q[z+31|0]=B;t[o+24>>2]=q[o+31|0]&1?1:2;if(w[t[o+32>>2]>>2]<w[o+24>>2]){t[o+44>>2]=1;break g}ba(t[o+40>>2]+4|0,t[t[o+36>>2]>>2],t[o+24>>2]);p=t[o+36>>2];t[p>>2]=t[o+24>>2]+t[p>>2];p=t[o+32>>2];t[p>>2]=t[p>>2]-t[o+24>>2];if((t[t[o+40>>2]>>2]&15)==8){p=t[o+40>>2];t[p>>2]=t[p>>2]&-268435441;t[o+44>>2]=0;break g}if((t[t[o+40>>2]>>2]&15)==14){p=t[o+40>>2];t[p>>2]=t[p>>2]&-268435441;t[o+44>>2]=0;break g}if(w[t[o+32>>2]>>2]<3){t[o+44>>2]=11;break g}t[o+20>>2]=0;p=t[t[o+36>>2]>>2];l=u[p|0]|u[p+1|0]<<8;q[o+20|0]=l;q[o+21|0]=l>>>8;q[o+22|0]=u[p+2|0];p=t[o+36>>2];t[p>>2]=t[p>>2]+3;p=t[o+32>>2];t[p>>2]=t[p>>2]-3;p=t[o+40>>2];t[p>>2]=t[p>>2]&-268435441|(t[o+20>>2]&16777215)<<4;if(w[t[o+32>>2]>>2]<w[o+20>>2]){t[o+44>>2]=11;break g}if((t[t[o+40>>2]>>2]&15)==15){t[t[o+40>>2]+12>>2]=t[o+20>>2];p=D(t[o+20>>2]);t[t[o+40>>2]+8>>2]=p;if(!t[t[o+40>>2]+8>>2]){t[o+44>>2]=3;break g}ba(t[t[o+40>>2]+8>>2],t[t[o+36>>2]>>2],t[o+20>>2]);p=t[o+36>>2];t[p>>2]=t[o+20>>2]+t[p>>2];p=t[o+32>>2];t[p>>2]=t[p>>2]-t[o+20>>2];t[o+44>>2]=0;break g}if((t[t[o+40>>2]>>2]&15)==5){t[t[o+40>>2]+12>>2]=t[o+20>>2];p=D(t[o+20>>2]);t[t[o+40>>2]+8>>2]=p;if(!t[t[o+40>>2]+8>>2]){t[o+44>>2]=3;break g}ba(t[t[o+40>>2]+8>>2],t[t[o+36>>2]>>2],t[o+20>>2]);p=t[o+36>>2];t[p>>2]=t[o+20>>2]+t[p>>2];p=t[o+32>>2];t[p>>2]=t[p>>2]-t[o+20>>2];t[o+44>>2]=0;break g}h:{if(!((t[t[o+40>>2]>>2]&15)!=6?(t[t[o+40>>2]>>2]&15)!=7:0)){z=o,B=Q(t[o+36>>2],t[o+32>>2],o+19|0,o+18|0),t[z+12>>2]=B;if(t[o+12>>2]){t[o+44>>2]=t[o+12>>2];break g}break h}if(!((t[t[o+40>>2]>>2]&15)!=13?(t[t[o+40>>2]>>2]&15)!=12:0)){l=t[o+32>>2];p=A-32|0;t[p+24>>2]=t[o+36>>2];t[p+20>>2]=l;t[p+16>>2]=o+19;t[p+12>>2]=o+16;s[p+10>>1]=0;i:{if(w[t[p+20>>2]>>2]<2){t[p+28>>2]=1;break i}l=t[t[p+24>>2]>>2];l=u[l|0]|u[l+1|0]<<8;q[p+10|0]=l;q[p+11|0]=l>>>8;l=t[p+24>>2];t[l>>2]=t[l>>2]+2;l=t[p+20>>2];t[l>>2]=t[l>>2]-2;q[t[p+16>>2]]=(v[p+10>>1]&32768)==32768;s[t[p+12>>2]>>1]=v[p+10>>1]&32767;t[p+28>>2]=0}t[o+12>>2]=t[p+28>>2];if(t[o+12>>2]){t[o+44>>2]=t[o+12>>2];break g}}}if((t[t[o+40>>2]>>2]&15)==12){p=t[o+40>>2];s[p+8>>1]=s[p+8>>1]&1|v[o+16>>1]<<1;t[o+44>>2]=0;break g}if((t[t[o+40>>2]>>2]&15)==7){p=t[o+40>>2];q[p+8|0]=q[p+8|0]&1|u[o+18|0]<<1;t[o+44>>2]=0;break g}if((t[t[o+40>>2]>>2]&15)==13){l=t[o+32>>2];r=t[o+20>>2];m=t[o+40>>2]+12|0;n=t[o+40>>2];p=A-32|0;A=p;t[p+24>>2]=t[o+36>>2];t[p+20>>2]=l;t[p+16>>2]=r;t[p+12>>2]=m;t[p+8>>2]=n+16;j:{if(w[p+16>>2]<2){t[p+28>>2]=9;break j}t[t[p+8>>2]>>2]=t[p+16>>2]-2;if(w[t[p+20>>2]>>2]<w[t[p+8>>2]>>2]){t[p+28>>2]=1;break j}l=D(t[t[p+8>>2]>>2]);t[t[p+12>>2]>>2]=l;if(!t[t[p+12>>2]>>2]){t[p+28>>2]=3;break j}ba(t[t[p+12>>2]>>2],t[t[p+24>>2]>>2],t[t[p+8>>2]>>2]);l=t[p+24>>2];t[l>>2]=t[t[p+8>>2]>>2]+t[l>>2];l=t[p+20>>2];t[l>>2]=t[l>>2]-t[t[p+8>>2]>>2];t[p+28>>2]=0}A=p+32|0;t[o+8>>2]=t[p+28>>2];if(t[o+8>>2]){t[o+44>>2]=t[o+8>>2];break g}p=t[o+40>>2];s[p+8>>1]=q[o+19|0]&1|v[p+8>>1]&65534;p=t[o+40>>2];s[p+8>>1]=s[p+8>>1]&1|v[o+16>>1]<<1;t[o+44>>2]=0;break g}if((t[t[o+40>>2]>>2]&15)==6){z=o,B=M(t[o+36>>2],t[o+32>>2],t[o+20>>2],t[o+40>>2]+12|0,t[o+40>>2]+16|0),t[z+4>>2]=B;if(t[o+4>>2]){t[o+44>>2]=t[o+4>>2];break g}p=t[o+40>>2];q[p+8|0]=q[o+19|0]&1|u[p+8|0]&254;p=t[o+40>>2];q[p+8|0]=q[p+8|0]&1|u[o+18|0]<<1;t[o+44>>2]=0;break g}t[o+44>>2]=1}A=o+48|0;t[y+20>>2]=t[o+44>>2];if(!t[y+20>>2]){t[y+40>>2]=t[y+40>>2]+20;break f}O(t[y+44>>2],t[y+28>>2]);t[y+76>>2]=t[y+20>>2];break a}t[y+16>>2]=0;if(w[y+32>>2]<3){O(t[y+44>>2],t[y+28>>2]);t[y+76>>2]=1;break a}o=t[y+36>>2];p=u[o|0]|u[o+1|0]<<8;q[y+16|0]=p;q[y+17|0]=p>>>8;q[y+18|0]=u[o+2|0];t[y+36>>2]=t[y+36>>2]+3;t[y+32>>2]=t[y+32>>2]-3;if(!(t[y+16>>2]==1|u[y+27|0]!=1)){O(t[y+44>>2],t[y+28>>2]);t[y+76>>2]=7;break a}o=t[y+40>>2];t[o>>2]=t[o>>2]&-268435441|(t[y+16>>2]&16777215)<<4;if(u[y+27|0]==3){if(t[y+16>>2]!=1){O(t[y+44>>2],t[y+28>>2]);t[y+76>>2]=10;break a}q[y+15|0]=0;if(w[y+32>>2]<1){J(t[y+44>>2]);t[y+76>>2]=1;break a}q[y+15|0]=u[t[y+36>>2]];t[y+36>>2]=t[y+36>>2]+1;t[y+32>>2]=t[y+32>>2]-1;k:{if(u[y+15|0]<=4){q[t[y+40>>2]+4|0]=u[y+15|0];break k}q[t[y+40>>2]+4|0]=4}t[y+40>>2]=t[y+40>>2]+20;break f}z=y,B=Q(y+36|0,y+32|0,y+14|0,y+13|0),t[z+8>>2]=B;if(t[y+8>>2]){O(t[y+44>>2],t[y+28>>2]);t[y+76>>2]=t[y+8>>2];break a}if(u[y+27|0]==1){o=t[y+40>>2];q[o+4|0]=q[o+4|0]&1|u[y+13|0]<<1;t[y+40>>2]=t[y+40>>2]+20;break f}if(!u[y+27|0]){z=y,B=M(y+36|0,y+32|0,t[y+16>>2],t[y+40>>2]+8|0,t[y+40>>2]+12|0),t[z+4>>2]=B;if(t[y+4>>2]){O(t[y+44>>2],t[y+28>>2]);t[y+76>>2]=t[y+4>>2];break a}o=t[y+40>>2];q[o+4|0]=q[y+14|0]&1|u[o+4|0]&254;o=t[y+40>>2];q[o+4|0]=q[o+4|0]&1|u[y+13|0]<<1;t[y+40>>2]=t[y+40>>2]+20}}t[y+28>>2]=t[y+28>>2]+1;continue}break}if(t[y+32>>2]){O(t[y+44>>2],t[y+48>>2]);t[y+76>>2]=1;break a}t[t[y+64>>2]>>2]=t[y+44>>2];t[t[y+60>>2]>>2]=t[y+48>>2];t[y+76>>2]=0}A=y+80|0;return t[y+76>>2]}function D(o){var q=0,l=0,r=0,m=0,n=0,s=0,u=0,v,w=0,x,p;w=8;a:{b:{if(o>>>0>4294967239)break b;while(1){w=w>>>0>8?w:8;l=t[603];n=l;m=t[602];u=m;o=o>>>0>8?o+3&-4:8;c:{if(o>>>0<=127){s=(o>>>3|0)-1|0;break c}r=y(o);s=((o>>>29-r^4)-(r<<2)|0)+110|0;if(o>>>0<=4095)break c;r=((o>>>30-r^2)-(r<<1)|0)+71|0;s=r>>>0<63?r:63}q=s;r=q&31;(q&63)>>>0>=32?(q=0,l=l>>>r|0):(q=l>>>r|0,l=((1<<r)-1&l)<<32-r|u>>>r);r=q;if(l|q){while(1){n=l;q=r;d:{if(q|l){m=q-1|0;v=m+1|0;u=m;m=l-1|0;u=(m|0)!=-1?v:u;m=y(l^m)+32|0;l=y(q^u);l=(l|0)==32?m:l;q=63-l|0;0-(l>>>0>63)|0;break d}q=64}m=q;q=m;l=q&31;(q&63)>>>0>=32?(q=0,u=r>>>l|0):(q=r>>>l|0,u=((1<<l)-1&r)<<32-l|n>>>l);r=q;s=m+s|0;n=s<<4;q=t[n+1384>>2];m=n+1376|0;e:{if((q|0)!=(m|0)){l=I(q,w,o);if(l)break b;l=t[q+4>>2];t[l+8>>2]=t[q+8>>2];t[t[q+8>>2]+4>>2]=l;t[q+8>>2]=m;l=n+1380|0;t[q+4>>2]=t[l>>2];t[l>>2]=q;t[t[q+4>>2]+8>>2]=q;s=s+1|0;l=(r&1)<<31|u>>>1;r=r>>>1|0;break e}x=t[603];q=s;v=q&63;l=v;n=l&31;l>>>0>=32?(l=0,m=-1>>>n|0):(l=-1>>>n|0,m=(1<<n)-1<<32-n|-1>>>n);m=m&-2;n=v&31;v>>>0>=32?(l=m<<n,v=0):(l=(1<<n)-1&m>>>32-n|l<<n,v=m<<n);n=l;m=0-q&63;l=m;q=l&31;l>>>0>=32?(l=-1<<q,q=0):(l=(1<<q)-1&-1>>>32-q|-1<<q,q=-1<<q);p=q&-2;q=m&31;m>>>0>=32?(m=0,q=l>>>q|0):(m=l>>>q|0,q=((1<<q)-1&l)<<32-q|p>>>q);l=q|v;B=n|m;t[602]=t[602]&l;t[603]=B&x;l=u^1}if(l|r)continue;break}m=t[602];n=t[603]}f:{if(n|m){r=y(n);r=63-((r|0)==32?y(m)+32|0:r)<<4;q=r+1376|0;r=t[r+1384>>2];g:{if(!n&m>>>0<1073741824)break g;s=98;if((q|0)==(r|0))break g;while(1){l=I(r,w,o);if(l)break b;r=t[r+8>>2];if(!s)break g;s=s-1|0;if((q|0)!=(r|0))continue;break}}if(G(o+48|0))break f;if(!r|(q|0)==(r|0))break a;while(1){l=I(r,w,o);if(l)break b;r=t[r+8>>2];if((q|0)!=(r|0))continue;break}break a}if(!G(o+48|0))break a}l=0;if(o>>>0>4294967239)break b;r=w;q=0;while(1){s=q;if(r){r=r-1&r;q=q+1|0;continue}break}if(s>>>0<=1)continue;break}}return l}return 0}function E(o,p,l,r,m,n,x){o=o|0;p=p|0;l=l|0;r=r|0;m=m|0;n=n|0;x=x|0;var y=0,z=0;y=A-32|0;A=y;s[y+26>>1]=o;t[y+20>>2]=p;t[y+16>>2]=l;q[y+15|0]=r;s[y+12>>1]=m;t[y+8>>2]=n;t[y+4>>2]=x;a:{if(!(!(q[y+15|0]&1)|v[y+12>>1]<=32767)){t[y+28>>2]=4;break a}p=t[y+20>>2];l=t[y+16>>2];r=t[y+8>>2];m=t[y+4>>2];n=q[y+15|0]&1;o=A+-64|0;A=o;t[o+56>>2]=y+26;t[o+52>>2]=p;t[o+48>>2]=l;t[o+44>>2]=r;t[o+40>>2]=m;q[o+39|0]=2;q[o+38|0]=13;t[o+32>>2]=y+12;q[o+31|0]=n;q[o+30|0]=2;b:{c:{if(!(!t[o+52>>2]|(!t[o+44>>2]|!t[o+40>>2]))&&w[o+48>>2]<=16777215)break c;t[o+60>>2]=5;break b}t[o+24>>2]=t[o+48>>2]+(u[o+39|0]+(u[o+30|0]+4|0)|0);z=o,x=D(t[o+24>>2]),t[z+20>>2]=x;if(!t[o+20>>2]){t[o+60>>2]=3;break b}t[o+16>>2]=t[o+20>>2];q[t[o+16>>2]]=u[o+38|0];t[o+16>>2]=t[o+16>>2]+1;ba(t[o+16>>2],t[o+56>>2],u[o+30|0]);t[o+16>>2]=u[o+30|0]+t[o+16>>2];t[o+12>>2]=u[o+39|0]+t[o+48>>2];if(w[o+12>>2]<w[o+48>>2]){J(t[o+20>>2]);t[o+60>>2]=9;break b}p=t[o+16>>2];l=u[o+12|0]|u[o+13|0]<<8;q[p|0]=l;q[p+1|0]=l>>>8;q[p+2|0]=u[o+14|0];t[o+16>>2]=t[o+16>>2]+3;if(q[o+31|0]&1)d:{if(u[o+38|0]==6){p=t[o+32>>2];q[p|0]=u[p|0]|128;break d}e:{if(u[o+38|0]==13){p=t[o+32>>2];s[p>>1]=v[p>>1]|32768;break e}J(t[o+20>>2]);t[o+60>>2]=1;break b}}ba(t[o+16>>2],t[o+32>>2],u[o+39|0]);t[o+16>>2]=u[o+39|0]+t[o+16>>2];ba(t[o+16>>2],t[o+52>>2],t[o+48>>2]);t[t[o+44>>2]>>2]=t[o+20>>2];t[t[o+40>>2]>>2]=t[o+24>>2];t[o+60>>2]=0}A=o- -64|0;t[y+28>>2]=t[o+60>>2]}A=y+32|0;return t[y+28>>2]}function F(o,p,l,r,m){o=o|0;p=p|0;l=l|0;r=r|0;m=m|0;var n=0,v=0;n=A-32|0;A=n;s[n+30>>1]=o;t[n+24>>2]=p;t[n+20>>2]=l;t[n+16>>2]=r;t[n+12>>2]=m;p=t[n+24>>2];l=t[n+20>>2];r=t[n+16>>2];m=t[n+12>>2];o=A-48|0;A=o;t[o+40>>2]=n+30;t[o+36>>2]=p;t[o+32>>2]=l;t[o+28>>2]=r;t[o+24>>2]=m;q[o+23|0]=2;q[o+22|0]=15;a:{if(!(t[o+24>>2]?t[o+28>>2]:0)){t[o+44>>2]=5;break a}t[t[o+28>>2]>>2]=0;t[t[o+24>>2]>>2]=0;if(!(w[o+32>>2]<=16777215?t[o+36>>2]:0)){t[o+44>>2]=5;break a}t[o+16>>2]=t[o+32>>2]+(u[o+23|0]+4|0);v=o,r=D(t[o+16>>2]),t[v+12>>2]=r;if(!t[o+12>>2]){t[o+44>>2]=3;break a}t[o+8>>2]=t[o+12>>2];q[t[o+8>>2]]=u[o+22|0];t[o+8>>2]=t[o+8>>2]+1;ba(t[o+8>>2],t[o+40>>2],u[o+23|0]);t[o+8>>2]=u[o+23|0]+t[o+8>>2];p=t[o+8>>2];l=u[o+32|0]|u[o+33|0]<<8;q[p|0]=l;q[p+1|0]=l>>>8;q[p+2|0]=u[o+34|0];t[o+8>>2]=t[o+8>>2]+3;ba(t[o+8>>2],t[o+36>>2],t[o+32>>2]);t[o+8>>2]=t[o+32>>2]+t[o+8>>2];t[t[o+28>>2]>>2]=t[o+12>>2];t[t[o+24>>2]>>2]=t[o+16>>2];t[o+44>>2]=0}A=o+48|0;A=n+32|0;return t[o+44>>2]}function G(o){var p=0,l,r=0,m=0,n,s=0;r=t[343];l=o+3&-4;p=r+l|0;a:{b:{if(p>>>0<=r>>>0?l:0)break b;if(p>>>0>wa()<<16>>>0&&!(z(p|0)|0))break b;t[343]=p;break a}t[604]=48;r=-1}if((r|0)!=-1){l=o+r|0;p=l-16|0;t[p+12>>2]=16;t[p>>2]=16;o=t[600];o?s=t[o+8>>2]:s=0;c:{d:{if((s|0)==(r|0)){m=r-(t[r-4>>2]&-2)|0;n=t[m-4>>2];t[o+8>>2]=l;o=m-(n&-2)|0;l=-16;if(!(q[(o+t[o>>2]|0)-4|0]&1))break d;l=t[o+4>>2];t[l+8>>2]=t[o+8>>2];t[t[o+8>>2]+4>>2]=l;p=p-o|0;t[o>>2]=p;break c}t[r+12>>2]=16;t[r>>2]=16;t[r+8>>2]=l;t[r+4>>2]=o;t[600]=r;l=16}o=r+l|0;p=p-o|0;t[o>>2]=p}t[((p&-4)+o|0)-4>>2]=p|1;s=o;m=t[o>>2]-8|0;e:{if(m>>>0<=127){p=(m>>>3|0)-1|0;break e}n=y(m);p=((m>>>29-n^4)-(n<<2)|0)+110|0;if(m>>>0<=4095)break e;p=((m>>>30-n^2)-(n<<1)|0)+71|0;p=p>>>0<63?p:63}l=p<<4;t[s+4>>2]=l+1376;l=l+1384|0;t[o+8>>2]=t[l>>2];t[l>>2]=o;t[t[o+8>>2]+4>>2]=o;l=t[603];o=p&31;(p&63)>>>0>=32?(p=1<<o,o=0):(p=(1<<o)-1&1>>>32-o,o=1<<o);t[602]=o|t[602];t[603]=p|l}return(r|0)!=-1}function la(o,p,l,r){o=o|0;p=p|0;l=l|0;r=r|0;var m=0,n=0;m=A-16|0;A=m;s[m+10>>1]=o;s[m+8>>1]=p;t[m+4>>2]=l;t[m>>2]=r;a:{if(v[m+8>>1]>32767){t[m+12>>2]=4;break a}p=t[m+4>>2];l=t[m>>2];o=A-48|0;A=o;t[o+40>>2]=m+10;t[o+36>>2]=p;t[o+32>>2]=l;q[o+31|0]=2;q[o+30|0]=12;t[o+24>>2]=m+8;q[o+23|0]=2;b:{if(!(t[o+32>>2]?t[o+36>>2]:0)){t[o+44>>2]=5;break b}t[o+16>>2]=u[o+31|0]+(u[o+23|0]+4|0);n=o,r=D(t[o+16>>2]),t[n+12>>2]=r;if(!t[o+12>>2]){t[o+44>>2]=3;break b}t[o+8>>2]=t[o+12>>2];q[t[o+8>>2]]=u[o+30|0];t[o+8>>2]=t[o+8>>2]+1;ba(t[o+8>>2],t[o+40>>2],u[o+23|0]);t[o+8>>2]=u[o+23|0]+t[o+8>>2];t[o+4>>2]=u[o+31|0];p=t[o+8>>2];l=u[o+4|0]|u[o+5|0]<<8;q[p|0]=l;q[p+1|0]=l>>>8;q[p+2|0]=u[o+6|0];t[o+8>>2]=t[o+8>>2]+3;ba(t[o+8>>2],t[o+24>>2],u[o+31|0]);t[t[o+32>>2]>>2]=t[o+16>>2];t[t[o+36>>2]>>2]=t[o+12>>2];t[o+44>>2]=0}A=o+48|0;t[m+12>>2]=t[o+44>>2]}A=m+16|0;return t[m+12>>2]}function H(o,p,l){o=o|0;p=p|0;l=l|0;var q=0,m=0,n=0,r=0,s=0;n=A+-64|0;A=n;m=1;a:{if(R(o,p,0))break a;m=0;if(!p)break a;q=A+-64|0;A=q;m=t[p>>2];r=t[m-4>>2];s=t[m-8>>2];t[q+20>>2]=0;t[q+16>>2]=1084;t[q+12>>2]=p;t[q+8>>2]=1132;m=0;ca(q+24|0,39);p=p+s|0;b:{if(R(r,1132,0)){t[q+56>>2]=1;ka[t[t[r>>2]+20>>2]](r,q+8|0,p,p,1,0);m=t[q+32>>2]==1?p:0;break b}ka[t[t[r>>2]+24>>2]](r,q+8|0,p,1,0);c:switch(t[q+44>>2]){case 0:m=t[q+48>>2]==1?t[q+36>>2]==1?t[q+40>>2]==1?t[q+28>>2]:0:0:0;break b;case 1:break c;default:break b}if(t[q+48>>2]|t[q+36>>2]!=1|t[q+40>>2]!=1?t[q+32>>2]!=1:0)break b;m=t[q+24>>2]}A=q- -64|0;p=m;m=0;if(!p)break a;ca(n+8|4,52);t[n+56>>2]=1;t[n+20>>2]=-1;t[n+16>>2]=o;t[n+8>>2]=p;ka[t[t[p>>2]+28>>2]](p,n+8|0,t[l>>2],1);o=t[n+32>>2];(o|0)==1&&(t[l>>2]=t[n+24>>2]);m=(o|0)==1}o=m;A=n- -64|0;return o|0}function I(o,p,l){var q=0,m,n=0,r=0;q=o+4|0;m=(q+p|0)-1&0-p;p=t[o>>2];if(m+l>>>0<=(p+o|0)-4>>>0){n=t[o+4>>2];t[n+8>>2]=t[o+8>>2];t[t[o+8>>2]+4>>2]=n;(q|0)!=(m|0)&&(m=m-q|0,n=o-(t[o-4>>2]&-2)|0,q=m+t[n>>2]|0,t[n>>2]=q,t[(n+(q&-4)|0)-4>>2]=q,o=o+m|0,p=p-m|0,t[o>>2]=p);a:{if(l+24>>>0<=p>>>0){q=(o+l|0)+8|0;p=(p-l|0)-8|0;t[q>>2]=p;t[(q+(p&-4)|0)-4>>2]=p|1;r=q;n=t[q>>2]-8|0;b:{if(n>>>0<=127){m=(n>>>3|0)-1|0;break b}p=y(n);m=((n>>>29-p^4)-(p<<2)|0)+110|0;if(n>>>0<=4095)break b;p=((n>>>30-p^2)-(p<<1)|0)+71|0;m=p>>>0<63?p:63}p=m;m=p<<4;t[r+4>>2]=m+1376;m=m+1384|0;t[q+8>>2]=t[m>>2];t[m>>2]=q;t[t[q+8>>2]+4>>2]=q;m=t[603];q=p&31;(p&63)>>>0>=32?(p=1<<q,r=0):(p=(1<<q)-1&1>>>32-q,r=1<<q);t[602]=r|t[602];t[603]=p|m;p=l+8|0;t[o>>2]=p;t[((p&-4)+o|0)-4>>2]=p;break a}t[(o+p|0)-4>>2]=p}o=o+4|0}else o=0;return o}function J(o){var p=0,l,q=0,m,n=0;if(o){l=o-4|0;m=t[l>>2];q=m;p=l;n=t[o-8>>2];o=n&-2;(o|0)!=(n|0)&&(p=l-o|0,q=t[p+4>>2],t[q+8>>2]=t[p+8>>2],t[t[p+8>>2]+4>>2]=q,q=o+m|0);o=l+m|0;l=t[o>>2];(l|0)!=t[(o+l|0)-4>>2]&&(m=t[o+4>>2],t[m+8>>2]=t[o+8>>2],t[t[o+8>>2]+4>>2]=m,q=q+l|0);t[p>>2]=q;t[((q&-4)+p|0)-4>>2]=q|1;n=p;q=t[p>>2]-8|0;a:{if(q>>>0<=127){o=(q>>>3|0)-1|0;break a}m=y(q);o=((q>>>29-m^4)-(m<<2)|0)+110|0;if(q>>>0<=4095)break a;o=((q>>>30-m^2)-(m<<1)|0)+71|0;o=o>>>0<63?o:63}l=o<<4;t[n+4>>2]=l+1376;l=l+1384|0;t[p+8>>2]=t[l>>2];t[l>>2]=p;t[t[p+8>>2]+4>>2]=p;l=t[603];p=o&31;(o&63)>>>0>=32?(o=1<<p,p=0):(o=(1<<p)-1&1>>>32-p,p=1<<p);t[602]=p|t[602];t[603]=o|l}}function K(n,o,l){n=n|0;o=o|0;l=l|0;var p=0,m=0;p=A-48|0;A=p;t[p+40>>2]=n;t[p+36>>2]=o;t[p+32>>2]=l;a:{if(!(t[p+32>>2]?t[p+36>>2]:0)){t[p+44>>2]=5;break a}if(w[p+40>>2]>4){t[p+44>>2]=8;break a}t[p+28>>2]=5;m=p,l=D(t[p+28>>2]),t[m+24>>2]=l;if(!t[p+24>>2]){t[p+44>>2]=3;break a}t[p+20>>2]=t[p+24>>2];q[p+19|0]=3;q[t[p+20>>2]]=u[p+19|0];t[p+20>>2]=t[p+20>>2]+1;t[p+12>>2]=1;n=t[p+20>>2];o=u[p+12|0]|u[p+13|0]<<8;q[n|0]=o;q[n+1|0]=o>>>8;q[n+2|0]=u[p+14|0];t[p+20>>2]=t[p+20>>2]+3;q[p+11|0]=t[p+40>>2];q[t[p+20>>2]]=u[p+11|0];t[t[p+36>>2]>>2]=t[p+24>>2];t[t[p+32>>2]>>2]=t[p+28>>2];t[p+44>>2]=0}A=p+48|0;return t[p+44>>2]}function L(n,o,l,p,m){n=n|0;o=o|0;l=l|0;p=p|0;m=m|0;if(R(n,t[o+8>>2],m)){da(o,l,p);return}a:{if(R(n,t[o>>2],m)){if(!(t[o+20>>2]!=(l|0)?t[o+16>>2]!=(l|0):0)){if((p|0)!=1)break a;t[o+32>>2]=1;return}t[o+32>>2]=p;b:{if(t[o+44>>2]==4)break b;s[o+52>>1]=0;n=t[n+8>>2];ka[t[t[n>>2]+20>>2]](n,o,l,l,1,m);if(u[o+53|0]){t[o+44>>2]=3;if(!u[o+52|0])break b;break a}t[o+44>>2]=4}t[o+20>>2]=l;t[o+40>>2]=t[o+40>>2]+1;if(t[o+36>>2]!=1|t[o+24>>2]!=2)break a;q[o+54|0]=1;return}n=t[n+8>>2];ka[t[t[n>>2]+24>>2]](n,o,l,p,m)}}function M(o,p,l,q,m){var n=0;n=A-32|0;A=n;t[n+24>>2]=o;t[n+20>>2]=p;t[n+16>>2]=l;t[n+12>>2]=q;t[n+8>>2]=m;a:{if(w[n+16>>2]<1){t[n+28>>2]=9;break a}t[t[n+8>>2]>>2]=t[n+16>>2]-1;if(w[t[n+20>>2]>>2]<w[t[n+8>>2]>>2]){t[n+28>>2]=1;break a}o=D(t[t[n+8>>2]>>2]);t[t[n+12>>2]>>2]=o;if(!t[t[n+12>>2]>>2]){t[n+28>>2]=3;break a}ba(t[t[n+12>>2]>>2],t[t[n+24>>2]>>2],t[t[n+8>>2]>>2]);o=t[n+24>>2];t[o>>2]=t[t[n+8>>2]>>2]+t[o>>2];o=t[n+20>>2];t[o>>2]=t[o>>2]-t[t[n+8>>2]>>2];t[n+28>>2]=0}A=n+32|0;return t[n+28>>2]}function N(n,o,l){n=n|0;o=o|0;l=l|0;var p=0,m=0;p=A-32|0;A=p;s[p+26>>1]=n;t[p+20>>2]=o;t[p+16>>2]=l;t[t[p+16>>2]>>2]=3;m=p,l=D(t[t[p+16>>2]>>2]),t[m+12>>2]=l;a:{if(!t[p+12>>2]){t[p+28>>2]=3;break a}t[t[p+20>>2]>>2]=t[p+12>>2];q[p+11|0]=14;q[t[p+12>>2]]=u[p+11|0];t[p+12>>2]=t[p+12>>2]+1;n=t[p+12>>2];o=u[p+26|0]|u[p+27|0]<<8;q[n|0]=o;q[n+1|0]=o>>>8;t[p+28>>2]=0}A=p+32|0;return t[p+28>>2]}function O(m,n){var l=0;l=A-16|0;A=l;t[l+12>>2]=m;t[l+8>>2]=n;t[l+4>>2]=0;while(1){if(w[l+4>>2]<w[l+8>>2]){t[l>>2]=t[l+12>>2]+x(t[l+4>>2],20);a:{if(!(t[t[l>>2]>>2]&15)){J(t[t[l>>2]+8>>2]);break a}b:{if((t[t[l>>2]>>2]&15)==5){J(t[t[l>>2]+8>>2]);break b}(t[t[l>>2]>>2]&15)==6&&J(t[t[l>>2]+12>>2])}}t[l+4>>2]=t[l+4>>2]+1;continue}break}J(t[l+12>>2]);A=l+16|0}function P(m,n,l,o){q[m+53|0]=1;a:{if(t[m+4>>2]!=(l|0))break a;q[m+52|0]=1;l=t[m+16>>2];if(!l){t[m+36>>2]=1;t[m+24>>2]=o;t[m+16>>2]=n;if((o|0)!=1|t[m+48>>2]!=1)break a;q[m+54|0]=1;return}if((n|0)==(l|0)){l=t[m+24>>2];(l|0)==2&&(t[m+24>>2]=o,l=o);if(t[m+48>>2]!=1|(l|0)!=1)break a;q[m+54|0]=1;return}q[m+54|0]=1;t[m+36>>2]=t[m+36>>2]+1}}function Q(n,o,l,p){var m;m=A-32|0;t[m+24>>2]=n;t[m+20>>2]=o;t[m+16>>2]=l;t[m+12>>2]=p;q[m+11|0]=0;a:{if(w[t[m+20>>2]>>2]<1){t[m+28>>2]=1;break a}q[m+11|0]=u[t[t[m+24>>2]>>2]];n=t[m+24>>2];t[n>>2]=t[n>>2]+1;n=t[m+20>>2];t[n>>2]=t[n>>2]-1;q[t[m+16>>2]]=(u[m+11|0]&128)==128;q[t[m+12>>2]]=u[m+11|0]&127;t[m+28>>2]=0}return t[m+28>>2]}function ma(n,o,l,p,m){n=n|0;o=o|0;l=l|0;p=p|0;m=m|0;if(R(n,t[o+8>>2],m)){da(o,l,p);return}a:{if(!R(n,t[o>>2],m))break a;if(!(t[o+20>>2]!=(l|0)?t[o+16>>2]!=(l|0):0)){if((p|0)!=1)break a;t[o+32>>2]=1;return}t[o+20>>2]=l;t[o+32>>2]=p;t[o+40>>2]=t[o+40>>2]+1;t[o+36>>2]!=1|t[o+24>>2]!=2||(q[o+54|0]=1);t[o+44>>2]=4}}function R(m,n,l){var o;if(!l)return t[m+4>>2]==t[n+4>>2];if((m|0)==(n|0))return 1;l=t[m+4>>2];m=u[l|0];n=t[n+4>>2];o=u[n|0];a:{if(!m|(o|0)!=(m|0))break a;while(1){o=u[n+1|0];m=u[l+1|0];if(!m)break a;n=n+1|0;l=l+1|0;if((m|0)==(o|0))continue;break}}return(m|0)==(o|0)}function na(m,n){m=m|0;n=n|0;var l=0,o=0;l=A-32|0;A=l;t[l+24>>2]=m;t[l+20>>2]=n;o=l,m=D(1),t[o+16>>2]=m;a:{if(!t[l+16>>2]){t[l+28>>2]=3;break a}q[l+15|0]=9;q[t[l+16>>2]]=u[l+15|0];t[t[l+24>>2]>>2]=t[l+16>>2];t[t[l+20>>2]>>2]=1;t[l+28>>2]=0}A=l+32|0;return t[l+28>>2]}function S(m,n){m=m|0;n=n|0;var l=0,o=0;l=A-32|0;A=l;t[l+24>>2]=m;t[l+20>>2]=n;o=l,m=D(1),t[o+16>>2]=m;a:{if(!t[l+16>>2]){t[l+28>>2]=3;break a}q[l+15|0]=10;q[t[l+16>>2]]=u[l+15|0];t[t[l+24>>2]>>2]=t[l+16>>2];t[t[l+20>>2]>>2]=1;t[l+28>>2]=0}A=l+32|0;return t[l+28>>2]}function T(m,n){m=m|0;n=n|0;var l=0,o=0;l=A-32|0;A=l;t[l+24>>2]=m;t[l+20>>2]=n;o=l,m=D(1),t[o+16>>2]=m;a:{if(!t[l+16>>2]){t[l+28>>2]=3;break a}q[l+15|0]=2;q[t[l+16>>2]]=u[l+15|0];t[t[l+24>>2]>>2]=t[l+16>>2];t[t[l+20>>2]>>2]=1;t[l+28>>2]=0}A=l+32|0;return t[l+28>>2]}function U(m,n){m=m|0;n=n|0;var l=0,o=0;l=A-32|0;A=l;t[l+24>>2]=m;t[l+20>>2]=n;o=l,m=D(1),t[o+16>>2]=m;a:{if(!t[l+16>>2]){t[l+28>>2]=3;break a}q[l+15|0]=4;q[t[l+16>>2]]=u[l+15|0];t[t[l+24>>2]>>2]=t[l+16>>2];t[t[l+20>>2]>>2]=1;t[l+28>>2]=0}A=l+32|0;return t[l+28>>2]}function V(l){var m=0;m=A-16|0;A=m;t[m+12>>2]=l;l=1;a:{if(X(t[m+12>>2])&1)break a;l=1;if(t[m+12>>2]==15)break a;l=1;if(t[m+12>>2]==13)break a;l=1;if(t[m+12>>2]==12)break a;l=t[m+12>>2]==14}A=m+16|0;return l}function W(m,n,l){var o;o=t[m+16>>2];if(!o){t[m+36>>2]=1;t[m+24>>2]=l;t[m+16>>2]=n;return}a:{if((n|0)==(o|0)){if(t[m+24>>2]!=2)break a;t[m+24>>2]=l;return}q[m+54|0]=1;t[m+24>>2]=2;t[m+36>>2]=t[m+36>>2]+1}}function X(l){var m;m=A-16|0;t[m+12>>2]=l;l=1;a:{if(t[m+12>>2]==5)break a;l=1;if(t[m+12>>2]==6)break a;l=1;if(t[m+12>>2]==7)break a;l=t[m+12>>2]==8}return l}function Y(o,p,l,q,m,n){o=o|0;p=p|0;l=l|0;q=q|0;m=m|0;n=n|0;if(R(o,t[p+8>>2],n)){P(p,l,q,m);return}o=t[o+8>>2];ka[t[t[o>>2]+20>>2]](o,p,l,q,m,n)}function Z(){var m=0,n,l;while(1){n=m<<4;l=n+1376|0;t[n+1380>>2]=l;t[n+1384>>2]=l;m=m+1|0;if((m|0)!=64)continue;break}G(48)}function $(m,n,l,o){m=m|0;n=n|0;l=l|0;o=o|0;if(R(m,t[n+8>>2],0)){W(n,l,o);return}m=t[m+8>>2];ka[t[t[m>>2]+28>>2]](m,n,l,o)}function aa(o,p,l,q,m,n){o=o|0,p=p|0,l=l|0,q=q|0,m=m|0,n=n|0,R(o,t[p+8>>2],n)&&P(p,l,q,m)}function ba(m,n,l){if(l)while(1){q[m|0]=u[n|0];m=m+1|0;n=n+1|0;l=l-1|0;if(l)continue;break}}function ca(l,m){if(m)while(1){q[l|0]=0;l=l+1|0;m=m-1|0;if(m)continue;break}}function oa(m,n,l,o){m=m|0,n=n|0,l=l|0,o=o|0,R(m,t[n+8>>2],0)&&W(n,l,o)}function da(m,n,l){t[m+28>>2]==1|t[m+4>>2]!=(n|0)||(t[m+28>>2]=l)}function pa(l,m){l=l|0;m=m|0;return x(m,20)+l|0}function ea(l){l=l|0;return v[l+8>>1]>>>1|0}function qa(l){l=l|0;return s[l+8>>1]&1}function fa(l){l=l|0;return t[l+12>>2]}function ra(l){l=l|0;return t[l>>2]&15}function sa(l){l=l|0;return t[l+16>>2]}function ga(l){l=l|0;return v[l+4>>1]}function ha(l){l=l|0;return t[l+8>>2]}function ia(l){l=l|0;return u[l+4|0]}function ja(l){l=l|0;return l|0}function ta(l){return D(l)}function ua(l){l=l|0,J(l)}function va(l){l|0}n=u;r(l);var ka=m([null,ja,ua,va,va,H,aa,ma,oa,ua,Y,L,$]);function wa(){return p.byteLength/65536|0}function xa(l){l=l|0;var m=wa()|0;l=m+l|0;if(m<l&&l<65536){l=new ArrayBuffer(x(l,65536));var r=new Int8Array(l);r.set(q);q=new Int8Array(l);s=new Int16Array(l);t=new Int32Array(l);u=new Uint8Array(l);v=new Uint16Array(l);w=new Uint32Array(l);new Float32Array(l);new Float64Array(l);p=l;o.buffer=p;n=u}return m}return{c:Z,d:ta,e:ua,f:T,g:U,h:K,i:F,j:N,k:E,l:la,m:na,n:S,o:C,p:ra,q:ia,r:pa,s:ga,t:ha,u:fa,v:fa,w:sa,x:ea,y:qa,z:ea,A:ka}}return s(l)}(ha)},instantiate:function(l,m){return{then:function(n){var m=new D.Module(l);n({instance:new D.Instance(m)})}}},RuntimeError:Error};C=[];typeof D!=="object"&&Y("no native wasm support detected");var E,F=!1;function G(l,m){l||Y("Assertion failed: "+m)}function la(l,m){l%m>0&&(l+=m-l%m);return l}var H,I;function J(l){H=l,m.HEAP8=new Int8Array(l),m.HEAP16=new Int16Array(l),m.HEAP32=new Int32Array(l),m.HEAPU8=I=new Uint8Array(l),m.HEAPU16=new Uint16Array(l),m.HEAPU32=new Uint32Array(l),m.HEAPF32=new Float32Array(l),m.HEAPF64=new Float64Array(l)}u=m.INITIAL_MEMORY||2097152;m.wasmMemory?E=m.wasmMemory:E=new D.Memory({initial:u/65536,maximum:2147483648/65536});E&&(H=E.buffer);H.byteLength;J(H);var K,L=[],M=[],N=[];function O(){if(m.preRun){typeof m.preRun=="function"&&(m.preRun=[m.preRun]);while(m.preRun.length)ma(m.preRun.shift())}da(L)}function P(){da(M)}function Q(){if(m.postRun){typeof m.postRun=="function"&&(m.postRun=[m.postRun]);while(m.postRun.length)na(m.postRun.shift())}da(N)}function ma(l){L.unshift(l)}function R(l){M.unshift(l)}function na(l){N.unshift(l)}(!Math.imul||Math.imul(4294967295,5)!==-5)&&(Math.imul=function(l,m){var n=l>>>16;l=l&65535;var o=m>>>16;m=m&65535;return l*m+(n*m+l*o<<16)|0});if(!Math.fround){var S=new Float32Array(1);Math.fround=function(l){S[0]=l;return S[0]}}Math.clz32||(Math.clz32=function(l){var m=32,n=l>>16;n&&(m-=16,l=n);n=l>>8;n&&(m-=8,l=n);n=l>>4;n&&(m-=4,l=n);n=l>>2;n&&(m-=2,l=n);n=l>>1;return n?m-2:m-l});Math.trunc||(Math.trunc=function(l){return l<0?Math.ceil(l):Math.floor(l)});var T=0,U=null,V=null;function W(l){T++,m.monitorRunDependencies&&m.monitorRunDependencies(T)}function X(l){T--;m.monitorRunDependencies&&m.monitorRunDependencies(T);if(T==0){U!==null&&(clearInterval(U),U=null);if(V){l=V;V=null;l()}}}m.preloadedImages={};m.preloadedAudios={};function Y(l){m.onAbort&&m.onAbort(l);l+="";B(l);F=!0;l="abort("+l+"). Build with -s ASSERTIONS=1 for more info.";l=new D.RuntimeError(l);s(l);throw l}var Z="data:application/octet-stream;base64,";function $(l){return l.startsWith(Z)}var aa="dgwcppbridge.wasm";$(aa)||(aa=z(aa));function ba(l){try{if(l==aa&&C)return new Uint8Array(C);var m=ga(l);if(m)return m;if(A)return A(l);else throw"both async and sync fetching of the wasm failed"}catch(l){Y(l)}}function ca(){return!C&&(w||x)&&typeof fetch==="function"?fetch(aa,{credentials:"same-origin"}).then(function(l){if(!l.ok)throw"failed to load wasm binary file at '"+aa+"'";return l.arrayBuffer()})["catch"](function(){return ba(aa)}):n.resolve().then(function(){return ba(aa)})}function oa(){var n={a:ha};function o(n,l){l=n.exports;m.asm=l;K=m.asm.A;R(m.asm.c);X("wasm-instantiate")}W("wasm-instantiate");function r(l){o(l.instance)}function t(l){return ca().then(function(l){l=D.instantiate(l,n);return l}).then(l,function(l){B("failed to asynchronously prepare wasm: "+l),Y(l)})}function u(){if(!C&&typeof D.instantiateStreaming==="function"&&!$(aa)&&typeof fetch==="function")return fetch(aa,{credentials:"same-origin"}).then(function(l){l=D.instantiateStreaming(l,n);return l.then(r,function(l){B("wasm streaming compile failed: "+l);B("falling back to ArrayBuffer instantiation");return t(r)})});else return t(r)}if(m.instantiateWasm)try{var l=m.instantiateWasm(n,o);return l}catch(l){B("Module.instantiateWasm callback failed with error: "+l);return!1}u()["catch"](s);return{}}function da(l){while(l.length>0){var n=l.shift();if(typeof n=="function"){n(m);continue}var o=n.func;typeof o==="number"?n.arg===void 0?K.get(o)():K.get(o)(n.arg):o(n.arg===void 0?null:n.arg)}}function pa(l){try{E.grow(l-H.byteLength+65535>>>16);J(E.buffer);return 1}catch(l){}}function ea(l){var m=I.length;l=l>>>0;var n=2147483648;if(l>n)return!1;for(var o=1;o<=4;o*=2){var p=m*(1+.2/o);p=Math.min(p,l+100663296);p=Math.min(n,la(Math.max(l,p),65536));p=pa(p);if(p)return!0}return!1}var qa=!1;function fa(l){var m=[];for(var n=0;n<l.length;n++){var o=l[n];o>255&&(qa&&G(!1,"Character code "+o+" ("+String.fromCharCode(o)+")  at offset "+n+" not in 0x00-0xFF."),o&=255);m.push(String.fromCharCode(o))}return m.join("")}var ra=typeof atob==="function"?atob:function(l){var m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="",o,p,q,r,s,t=0;l=l.replace(/[^A-Za-z0-9\+\/\=]/g,"");do p=m.indexOf(l.charAt(t++)),q=m.indexOf(l.charAt(t++)),r=m.indexOf(l.charAt(t++)),s=m.indexOf(l.charAt(t++)),p=p<<2|q>>4,q=(q&15)<<4|r>>2,o=(r&3)<<6|s,n=n+String.fromCharCode(p),r!==64&&(n=n+String.fromCharCode(q)),s!==64&&(n=n+String.fromCharCode(o));while(t<l.length);return n};function sa(l){try{l=ra(l);var m=new Uint8Array(l.length);for(var n=0;n<l.length;++n)m[n]=l.charCodeAt(n);return m}catch(l){throw new Error("Converting base64 string to bytes failed.")}}function ga(l){if(!$(l))return;return sa(l.slice(Z.length))}var ha={b:ea,a:E};oa();m.___wasm_call_ctors=function(){return(m.___wasm_call_ctors=m.asm.c).apply(null,arguments)};m.__malloc=function(){return(m.__malloc=m.asm.d).apply(null,arguments)};m.__free=function(){return(m.__free=m.asm.e).apply(null,arguments)};m.__DgwCodecEncodeEmpty=function(){return(m.__DgwCodecEncodeEmpty=m.asm.f).apply(null,arguments)};m.__DgwCodecEncodeDeauth=function(){return(m.__DgwCodecEncodeDeauth=m.asm.g).apply(null,arguments)};m.__DgwCodecEncodeDrain=function(){return(m.__DgwCodecEncodeDrain=m.asm.h).apply(null,arguments)};m.__DgwCodecEncodeStreamGroup_EstabStream=function(){return(m.__DgwCodecEncodeStreamGroup_EstabStream=m.asm.i).apply(null,arguments)};m.__DgwCodecEncodeStreamGroup_EndOfData=function(){return(m.__DgwCodecEncodeStreamGroup_EndOfData=m.asm.j).apply(null,arguments)};m.__DgwCodecEncodeStreamGroup_Data=function(){return(m.__DgwCodecEncodeStreamGroup_Data=m.asm.k).apply(null,arguments)};m.__DgwCodecEncodeStreamGroup_Ack=function(){return(m.__DgwCodecEncodeStreamGroup_Ack=m.asm.l).apply(null,arguments)};m.__DgwCodecEncodePing=function(){return(m.__DgwCodecEncodePing=m.asm.m).apply(null,arguments)};m.__DgwCodecEncodePong=function(){return(m.__DgwCodecEncodePong=m.asm.n).apply(null,arguments)};m.__DgwCodecDecode=function(){return(m.__DgwCodecDecode=m.asm.o).apply(null,arguments)};m.__getFrameType=function(){return(m.__getFrameType=m.asm.p).apply(null,arguments)};m.__getDrainReasonFromDrainFrame=function(){return(m.__getDrainReasonFromDrainFrame=m.asm.q).apply(null,arguments)};m.__getDGWFramePtr=function(){return(m.__getDGWFramePtr=m.asm.r).apply(null,arguments)};m.__getStreamIdFromStreamGroupFrame=function(){return(m.__getStreamIdFromStreamGroupFrame=m.asm.s).apply(null,arguments)};m.__getEncodedParamsFromEstablishStreamFrame=function(){return(m.__getEncodedParamsFromEstablishStreamFrame=m.asm.t).apply(null,arguments)};m.__getEncodedParamsSizeFromEstablishStreamFrame=function(){return(m.__getEncodedParamsSizeFromEstablishStreamFrame=m.asm.u).apply(null,arguments)};m.__getDataFromGroupedStreamDataFrame=function(){return(m.__getDataFromGroupedStreamDataFrame=m.asm.v).apply(null,arguments)};m.__getDataSizeFromGroupedStreamDataFrame=function(){return(m.__getDataSizeFromGroupedStreamDataFrame=m.asm.w).apply(null,arguments)};m.__getAckIdFromGroupedStreamDataFrame=function(){return(m.__getAckIdFromGroupedStreamDataFrame=m.asm.x).apply(null,arguments)};m.__getRequiresAckFromGroupedStreamDataFrame=function(){return(m.__getRequiresAckFromGroupedStreamDataFrame=m.asm.y).apply(null,arguments)};m.__getAckIdFromGroupedStreamAckFrame=function(){return(m.__getAckIdFromGroupedStreamAckFrame=m.asm.z).apply(null,arguments)};var ia;V=function l(){ia||ja(),ia||(V=l)};function ja(l){l||v;if(T>0)return;O();if(T>0)return;function n(){if(ia)return;ia=!0;m.calledRun=!0;if(F)return;P();o(m);m.onRuntimeInitialized&&m.onRuntimeInitialized();Q()}m.setStatus?(m.setStatus("Running..."),setTimeout(function(){setTimeout(function(){m.setStatus("")},1),n()},1)):n()}m.run=ja;if(m.preInit){typeof m.preInit=="function"&&(m.preInit=[m.preInit]);while(m.preInit.length>0)m.preInit.pop()()}ja();return m.ready}}();typeof q==="object"&&typeof p==="object"?p.exports=r:typeof define==="function"&&define.amd?define([],function(){return r}):typeof q==="object"&&(q.Module=r)}),null);
__d("DGWUtils",["Base64","DGWConstants","DGWCppBridge","DGWLoggingContext","Random","URI"],(function(a,b,c,d,e,f,g){"use strict";var h,i=4;function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=d("Random").random()*16|0;a=a==="x"?b:b&3|8;return a.toString(16)})}function j(a){var b=new TextDecoder();b=b.decode(a);a=c("Base64").encode(b);b=a.replace(/\+/gi,"-").replace(/\//gi,"_").replace(/=/gi,"");return b}var k=null,l=null;function m(){l==null&&(l=Promise.resolve().then(function(){return c("DGWCppBridge")()}).then(function(a){k=a}));return l}b=function(){function a(){}a.initialize=async function(){return m()};a.constructConnectUrl=function(a){var b,e,f=a.appId,g=a.appVersion,i=a.authType,k=a.deviceId,l=a.dgwVersion,m=a.fbId,n=a.tier,o=a.loggingId,p=a.headers,q=a.endpoint,r=a.serviceId,s=a.regionHint,t=a.establishStreamFrame,u=a.trafficTracing;a=a.authToken;var v=(b={},b[(e=d("DGWConstants")).HEADER_CONSTANTS.HEADER_APPID]=f,b[e.HEADER_CONSTANTS.HEADER_APPVERSION]=g,b[e.HEADER_CONSTANTS.HEADER_AUTHTYPE]=i,b[e.HEADER_CONSTANTS.HEADER_DGW_VERSION]=""+l,b[e.HEADER_CONSTANTS.HEADER_UUID]=m,b[e.HEADER_CONSTANTS.HEADER_TARGET_TIER]=n,b);t!==void 0&&(v[d("DGWConstants").HEADER_CONSTANTS.HEADER_ESTABLISH_STREAM_FRAME_BASE64]=j(t));o!==void 0&&(v[d("DGWConstants").HEADER_CONSTANTS.HEADER_LOGGING_ID]=o);s!==void 0&&(v[d("DGWConstants").HEADER_CONSTANTS.HEADER_REGIONHINT]=s);k!==void 0&&(v[d("DGWConstants").HEADER_CONSTANTS.HEADER_DEVICE_ID]=k);u!==void 0&&(v[d("DGWConstants").HEADER_CONSTANTS.TRAFFIC_TRACING]="debug:"+u);a!==void 0&&(v[d("DGWConstants").HEADER_CONSTANTS.HEADER_AUTHTOKEN]=a);Object.keys(p).forEach(function(a){var b=d("DGWConstants").HEADER_CONSTANTS.APPHEADER_PREFIX+a;Object.prototype.hasOwnProperty.call(v,b)||(v[b]=p[a])});f=new(h||(h=c("URI")))(q);f.setQueryData(v);f.setPath(f.getPath()+"/"+r);f.toString().length>2e3&&(delete v[d("DGWConstants").HEADER_CONSTANTS.HEADER_ESTABLISH_STREAM_FRAME_BASE64],f.setQueryData(v));return f.toStringRawQuery()};return a}();e=function(){function a(a,b,c){this.$1=null,this.$2=a,this.$3=b,this.$4=c}a.initialize=async function(){return m()};var b=a.prototype;b.malloc=function(a){try{a=k.__malloc(a);if(a===0){var b;(b=this.$2)==null||b.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"wasm malloc failure","malloc returned 0");return-1}return a}catch(a){(b=this.$2)==null||b.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"wasm malloc failure","exception during malloc",a.toString());return-1}};b.free=function(a){k.__free(a)};b.append=function(a){if(this.$1==null){this.$1=a;return}var b=this.$1.length,c=new Uint8Array(b+a.length);c.set(this.$1,0);c.set(a,b);this.$1=c};b.processData=function(){var a=this;if(this.$1==null)return;var b=this.$1.length,c=this.malloc(b);if(c===-1)return;var e=k.HEAPU8.subarray(c,c+b);if(this.$1)for(var f=0;f<e.length;++f)e[f]=this.$1[f];f=this.malloc(i*4);if(f===-1)return;e=f;var g=e+i,h=g+i,j=h+i;b=k.__DgwCodecDecode(c,b,e,g,h,j);this.free(c);if(b!==d("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){this.free(f);(h=this.$2)==null||h.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"Codec Decode Failure","Failed to decode Frame(s). Received error code "+d("DGWConstants").DgwCodecReturnCodeToString(b));return}c=k.HEAPU32.subarray(j/i,j/i+1)[0];if(this.$1==null){this.free(f);return}h=this.$1.length-c;if(this.$1&&this.$1.length>h){this.$1=new Uint8Array(((b=this.$1)==null?void 0:b.subarray(h))||[])}else this.$1=null;j=k.HEAPU32.subarray(g/i,g/i+1)[0];var l=k.HEAPU32.subarray(e/i,e/i+1)[0],m=[];c=function(){var b=k.__getDGWFramePtr(l,n),c=k.__getFrameType(b);switch(c){case d("DGWConstants").DgwFrameType.DgwFrameType_Drain:c=k.__getDrainReasonFromDrainFrame(b);var e=d("DGWConstants").drainReasonToDrainReasonString(c);(c=a.$2)==null||c.logEvent(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"Received Drain Frame from server","DrainReason: "+e);m.push(function(){var b;return(b=a.$3)==null?void 0:b.receivedDrainSignal(e)});break;case d("DGWConstants").DgwFrameType.DgwFrameType_StreamGroup_EstabStream:var f=k.__getStreamIdFromStreamGroupFrame(b);c=k.__getEncodedParamsFromEstablishStreamFrame(b);var g=new Uint8Array(k.HEAPU8.subarray(c,c+k.__getEncodedParamsSizeFromEstablishStreamFrame(b)));a.free(c);m.push(function(){var b;return(b=a.$3)==null?void 0:b.onGroupedStreamEstablishStreamReceived(f,g)});break;case d("DGWConstants").DgwFrameType.DgwFrameType_StreamGroup_Data:var h=k.__getStreamIdFromStreamGroupFrame(b);c=k.__getDataFromGroupedStreamDataFrame(b);var i=new Uint8Array(k.HEAPU8.subarray(c,c+k.__getDataSizeFromGroupedStreamDataFrame(b)));a.free(c);var j=k.__getRequiresAckFromGroupedStreamDataFrame(b)?k.__getAckIdFromGroupedStreamDataFrame(b):null;m.push(function(){var b;return(b=a.$3)==null?void 0:b.onGroupedStreamDataReceived(h,i,j)});break;case d("DGWConstants").DgwFrameType.DgwFrameType_StreamGroup_Ack:var o=k.__getStreamIdFromStreamGroupFrame(b),p=k.__getAckIdFromGroupedStreamAckFrame(b);m.push(function(){var b;return(b=a.$3)==null?void 0:b.onGroupedStreamAckReceived(o,p)});break;case d("DGWConstants").DgwFrameType.DgwFrameType_StreamGroup_EndOfData:var q=k.__getStreamIdFromStreamGroupFrame(b);m.push(function(){var b;return(b=a.$3)==null?void 0:b.onGroupedStreamEndOfDataReceived(q)});break;case d("DGWConstants").DgwFrameType.DgwFrameType_Ping:m.push(function(){var b;return(b=a.$3)==null?void 0:b.onPingReceived()});break;case d("DGWConstants").DgwFrameType.DgwFrameType_Pong:m.push(function(){var b;return(b=a.$3)==null?void 0:b.onPongReceived()});break;default:break}a.free(b)};for(var n=0;n<j;++n)c();this.free(f);for(b=0;b<m.length;b++)m[b]()};b.encodeData=function(a,b,c,e){var f=this.malloc(a.length);if(f===-1)return null;var g=k.HEAPU8.subarray(f,f+a.length);for(var h=0;h<g.length;++h)g[h]=a[h];a=this.malloc(i*2);h=a;var j=a+i;e=k.__DgwCodecEncodeStreamGroup_Data(e,f,g.length,b,c,h,j);this.free(f);if(e!==d("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){(g=this.$2)==null||g.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"Data Frame encode failure","Failed to decode DGW Data Frame. Received error code "+d("DGWConstants").DgwCodecReturnCodeToString(e));return null}b=k.HEAPU32.subarray(h/i,h/i+1)[0];c=k.HEAPU32.subarray(j/i,j/i+1)[0];f=new Uint8Array(k.HEAPU8.subarray(b,b+c));this.free(b);this.free(a);return f};b.encodeAck=function(a,b){var c=this.malloc(i*2);if(c===-1)return null;var e=c,f=c+i;b=k.__DgwCodecEncodeStreamGroup_Ack(b,a,e,f);if(b!==d("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){(a=this.$2)==null||a.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"ACK Frame encode failure","Failed to encode ACK Frame. Received error code "+d("DGWConstants").DgwCodecReturnCodeToString(b));return null}a=k.HEAPU32.subarray(e/i,e/i+1)[0];b=k.HEAPU32.subarray(f/i,f/i+1)[0];e=new Uint8Array(k.HEAPU8.subarray(a,a+b));this.free(a);this.free(c);return e};b.encodeDrain=function(a){var b=this.malloc(i*2);if(b===-1)return null;var c=b,e=b+i;a=k.__DgwCodecEncodeDrain(a,c,e);if(a!==d("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){var f;(f=this.$2)==null||f.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"Drain Frame encode failure","Failed to encode Drain Frame. Received error code "+d("DGWConstants").DgwCodecReturnCodeToString(a));return null}f=k.HEAPU32.subarray(c/i,c/i+1)[0];a=k.HEAPU32.subarray(e/i,e/i+1)[0];c=new Uint8Array(k.HEAPU8.subarray(f,f+a));this.free(f);this.free(b);return c};b.encodeEstablishStream=function(a,b){var c=this.malloc(b.length);if(c===-1)return null;var e=k.HEAPU8.subarray(c,c+b.length);for(var f=0;f<b.length;++f)e[f]=b[f];e=this.malloc(i*2);f=e;var g=e+i;b=k.__DgwCodecEncodeStreamGroup_EstabStream(a,c,b.length,f,g);this.free(c);if(b!==d("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){(c=this.$2)==null||c.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"EstablishStream Frame encode failure","Failed to encode EstablishStream Frame. Received error code "+d("DGWConstants").DgwCodecReturnCodeToString(b)+" for StreamId "+a);return null}c=k.HEAPU32.subarray(f/i,f/i+1)[0];b=k.HEAPU32.subarray(g/i,g/i+1)[0];a=new Uint8Array(k.HEAPU8.subarray(c,c+b));this.free(c);this.free(e);return a};b.encodeEndOfData=function(a){var b=this.malloc(i*2);if(b===-1)return null;var c=b,e=b+i;a=k.__DgwCodecEncodeStreamGroup_EndOfData(a,c,e);if(a!==d("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){var f;(f=this.$2)==null||f.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"EndOfData Frame encode failure","Failed to encode EndOfData Frame. Received error code "+d("DGWConstants").DgwCodecReturnCodeToString(a));return null}f=k.HEAPU32.subarray(c/i,c/i+1)[0];a=k.HEAPU32.subarray(e/i,e/i+1)[0];c=new Uint8Array(k.HEAPU8.subarray(f,f+a));this.free(f);this.free(b);return c};b.encodePing=function(){var a=this.malloc(i*2);if(a===-1)return null;var b=a,c=a+i,e=k.__DgwCodecEncodePing(b,c);if(e!==d("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){var f;(f=this.$2)==null||f.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"Ping Frame encode failure","Failed to encode Ping Frame. Received error code "+d("DGWConstants").DgwCodecReturnCodeToString(e));return null}f=k.HEAPU32.subarray(b/i,b/i+1)[0];e=k.HEAPU32.subarray(c/i,c/i+1)[0];b=new Uint8Array(k.HEAPU8.subarray(f,f+e));this.free(f);this.free(a);return b};b.encodePong=function(){if(this.$5!=null)return this.$5;var a=this.malloc(i*2);if(a===-1)return null;var b=a,c=a+i,e=k.__DgwCodecEncodePong(b,c);if(e!==d("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){var f;(f=this.$2)==null||f.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"Pong Frame encode failure","Failed to encode Pong Frame. Received error code "+d("DGWConstants").DgwCodecReturnCodeToString(e));return null}f=k.HEAPU32.subarray(b/i,b/i+1)[0];e=k.HEAPU32.subarray(c/i,c/i+1)[0];b=new Uint8Array(k.HEAPU8.subarray(f,f+e));this.free(f);this.free(a);this.$5=b;return b};return a}();g.uuidv4=a;g.Uint8ArrayToBase64UrlStr=j;g.DGWUtils=b;g.DGWCodec=e}),98);
__d("DGWExponentialBackoff",[],(function(a,b,c,d,e,f){"use strict";var g={maxRetries:5,baseRetryInterval:1e3,backoffFactor:Math.sqrt(2)},h=function(a){function b(b,c){b=a.call(this,b)||this;b.errors=c;return b}babelHelpers.inheritsLoose(b,a);return b}(babelHelpers.wrapNativeSuper(Error));async function a(a,b){b===void 0&&(b=g);try{return await i(a,b)}catch(a){throw a.errors[a.errors.length-1]}}async function i(a,b){var c=0,d=[],e=b.baseRetryInterval,f=b.backoffFactor;while(c<=b.maxRetries){try{var g=await a();return g}catch(a){d.push(a)}await j(e*Math.pow(f,c));++c}throw new h("Max call count exceeded",d)}async function j(a){await new Promise(function(b){return window.setTimeout(b,a)})}f.callWithExponentialBackoff=a}),66);
__d("DGWGlobalLogger",["gkx","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){var a=this;this.tabID=c("uuidv4")();this.isTabClosed=!1;this.otherTabs=new Map();this.thisTab={realtime:0,lightspeed:0};this.broadcastChannel=this.$1("DGWGlobalLogger");this.broadcastChannel.onmessage=function(b){b=JSON.parse(String(b.data));var c=!a.otherTabs.has(b.key);b.event==="DELETE"?a.otherTabs["delete"](b.key):b.event==="UPDATE"&&b.value!=null&&(a.otherTabs.set(b.key,b.value),c&&a.$2())}}var b=a.prototype;b.$1=function(a){if(window.BroadcastChannel!=null)return new BroadcastChannel(a);else return{onmessage:function(a){},postMessage:function(a){}}};b.streamRequested=function(a){switch(a){case"realtime":this.thisTab.realtime++;break;case"lightspeed":this.thisTab.lightspeed++;break}this.$2()};b.streamClosed=function(a){switch(a){case"realtime":this.thisTab.realtime=Math.max(0,this.thisTab.realtime-1);break;case"lightspeed":this.thisTab.lightspeed=Math.max(0,this.thisTab.lightspeed-1);break}this.$2()};b.tabClosed=function(){if(this.isTabClosed)return;this.isTabClosed=!0;var a={key:this.tabID,event:"DELETE"};this.broadcastChannel.postMessage(JSON.stringify(a))};b.getGlobalState=function(){var a={realtime:this.thisTab.realtime,lightspeed:this.thisTab.lightspeed};this.otherTabs.forEach(function(b){a.realtime+=b.realtime,a.lightspeed+=b.lightspeed});return a};b.$2=function(){var a={key:this.tabID,event:"UPDATE",value:this.thisTab};this.broadcastChannel.postMessage(JSON.stringify(a))};return a}();var h=c("gkx")("4337")?new a():{streamRequested:function(){},streamClosed:function(){},tabClosed:function(){},getGlobalState:function(){return{realtime:-1,lightspeed:-1}}};b=function(){return h};g.getInstance=b}),98);
__d("DGWPinger",["DGWLoggingContext"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b,c){this.$1=a,this.$4=b,this.$5=c,this.$3=!1}var b=a.prototype;b.$6=function(){var a=this;if(this.$3){var b;(b=d("DGWLoggingContext")).DGWLoggingContext.bumpODSKey(b.DGWLoggingComponent.PINGER,"timeout_fired.reset");this.$3=!1;this.$4();b.DGWLoggingContext.bumpODSKey(b.DGWLoggingComponent.PINGER,"timeout.newtimeout");this.$2=window.setTimeout(function(){a.$6()},this.$1)}else d("DGWLoggingContext").DGWLoggingContext.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.PINGER,"timeout_fired.disconnect"),this.$5()};b.reset=function(){var a=this;this.$3=!0;this.$2&&(d("DGWLoggingContext").DGWLoggingContext.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.PINGER,"reset"),window.clearTimeout(this.$2),this.$2=null);this.$1>0&&(d("DGWLoggingContext").DGWLoggingContext.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.PINGER,"reset.newtimeout"),this.$2=window.setTimeout(function(){a.$6()},this.$1))};b.cancel=function(){this.$2&&(d("DGWLoggingContext").DGWLoggingContext.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.PINGER,"canceled"),window.clearTimeout(this.$2),this.$2=null)};return a}();g.DGWPinger=a}),98);
__d("DGWStreamGroupCallbacks",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";var g=b("$InternalEnum")({TRANSPORT_SERVER_INTERNAL_ERROR:0,TRANSPORT_ABNORMAL_CLOSURE:1,TRANSPORT_GOING_AWAY:2,TRANSPORT_UNKNOWN_ERROR:3,TRANSPORT_KEEPALIVE_TIMEOUT:4,TRANSPORT_UNAUTHORIZED:5,TRANSPORT_REJECTED:6,TRANSPORT_BAD_REQUEST:7,TRANSPORT_DGW_SERVER_ERROR:8,TRANSPORT_NORMAL_CLOSURE:9});function a(a){switch(a){case g.TRANSPORT_UNAUTHORIZED:return!1;default:return!0}}c=function(){function a(){}var b=a.prototype;b.onStreamGroupError=function(){};b.onStreamGroupMustDrain=function(){};b.onStreamGroupTransportClose=function(){};return a}();f.DGWStreamGroupError=g;f.isRetryableError=a;f.NoOpDGWStreamGroupCallbacks=c}),66);
__d("DGWTransportEvents",["DGWLoggingContext","NetworkStatus"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){this.$3=a}var b=a.prototype;b.transportEstablished=function(a){this.$3.logEvent(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"open",a),this.$2=Date.now(),this.$3.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"stream_group_establishment_success")};b.transportPingSent=function(a){this.$3.logEvent(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Ping Frame Sent",a,!0)};b.transportPongReceived=function(a){this.$3.logEvent(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Pong Frame Received",a,!0)};b.transportEstablishmentPending=function(){this.$1=Date.now(),this.$3.logEvent(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"transportPending",null,!0),this.$3.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"stream_group_establishment_pending")};b.transportClosed=function(a,b,c){this.$4=Date.now(),a?(this.$3.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"transport_close_graceful"),this.$3.logEvent(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Transport closed gracefully",null,!0)):(this.$3.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"transport_close_with_error"),this.$3.logError(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Transport closed abnormally",b,c))};b.transportEstablishmentFailure=function(a){this.$3.logError(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"WebSocket transport establishment failure","WebSocket close code: "+a.code+" reason: "+a.reason+" wasClean: "+String(a.wasClean)),this.$3.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"stream_group_establishment_failure")};b.streamEstablishmentTimeout=function(a,b,e){this.$3.logError(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Grouped Stream establishment timeout",a,"streamId:"+b+", onLine:"+String(c("NetworkStatus").isOnline()),!1,e),this.$3.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"stream_establishment_timeout")};b.streamEstablishmentPending=function(a,b){this.$3.logEvent(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Grouped Stream establishment pending","streamId:"+a,!0,b),this.$3.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"stream_establishment_pending")};b.streamEstablishmentSuccess=function(a,b){this.$3.logEvent(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Grouped Stream establishment success","streamId:"+a,!0,b),this.$3.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"stream_establishment_success")};b.transportError=function(a,b,c){this.$3.logError(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,a,b,c)};b.receivedFrameForInactiveStream=function(a,b,c){this.$3.logWarn(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Frame received for inactive stream","frameType: "+a+", streamID: "+b,c)};b.ranOutOfStreamIds=function(a){this.$3.logWarn(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Hit max StreamId limit","Hit max StreamId limit",a)};return a}();g.DGWTransportEvents=a}),98);
__d("DGWWebSocketTransport",[],(function(a,b,c,d,e,f){"use strict";function a(a){a=new WebSocket(a);a.binaryType="arraybuffer";a.onopen=function(){};a.onclose=function(){};a.onerror=function(){};return a}f.getWebSocketConnection=a}),66);
__d("DGWStreamEvents",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,b,c){this.$4=new Map(),this.$5=new Map(),this.$6=a,this.$1=b,c!=null&&(this.$8="streamId:"+c+"::")}var b=a.prototype;b.dataSent=function(a,b,c){var d=b?"sendWithAckRequested":"sendWithoutAckRequested";this.$6.logEvent(this.$1,d,((d=this.$8)!=null?d:"")+"sendId:"+c+", payloadSize:"+a,!0);this.$4.set(c,{ackRequested:b,payloadSize:a,sendTimestamp:Date.now()})};b.ackReceived=function(a){var b;this.$6.logEvent(this.$1,"AckReceived",((b=this.$8)!=null?b:"")+"sendId:"+a,!0);this.$6.bumpODSKey(this.$1,"ack_received");b=this.$4.get(a);b!=null&&(b.ackReceivedTimestamp=Date.now())};b.ackSent=function(a){var b;this.$6.bumpODSKey(this.$1,"ack_sent");this.$6.logEvent(this.$1,"ACK sent",((b=this.$8)!=null?b:"")+"ackId:"+a,!0)};b.drainSent=function(a){var b;this.$6.logEvent(this.$1,"Drain sent",((b=this.$8)!=null?b:"")+"drainReason: "+a)};b.dataReceived=function(a,b,c){var d;this.$6.bumpODSKey(this.$1,"data_received");this.$6.logEvent(this.$1,"Data received",((d=this.$8)!=null?d:"")+"sendId:"+(c!=null?c:"null")+", ackRequested:"+b.toString()+", payloadSize:"+a,!0);c!=null&&this.$5.set(c,{ackRequested:b,payloadSize:a,receiveTimestamp:Date.now()})};b.endOfDataReceived=function(){this.$6.bumpODSKey(this.$1,"end_of_data_received"),this.$6.logEvent(this.$1,"EndOfDataReceived",this.$8,!0)};b.endOfDataSent=function(){this.$6.bumpODSKey(this.$1,"end_of_data_sent"),this.$6.logEvent(this.$1,"EndOfDataSent",this.$8,!0)};b.streamClosed=function(a,b){this.$7=Date.now();var c=this.$9();if(a){this.$6.bumpODSKey(this.$1,"stream_closed_gracefully");this.$6.logEvent(this.$1,"Stream closed gracefully",""+((a=this.$8)!=null?a:"")+c)}else{this.$6.bumpODSKey(this.$1,"stream_closed_with_error");this.$6.logError(this.$1,"Stream closed abnormally",b,""+((a=this.$8)!=null?a:"")+c)}};b.connectionEstablishmentFailure=function(a){this.$6.logEvent(this.$1,"WebSocket connection establishment failure","WebSocket close code: "+a)};b.streamEstablishmentFailure=function(a,b){this.$6.logError(this.$1,"Failed to establish DGW Stream","Last seen error: "+a.toString(),""+((a=this.$8)!=null?a:"")+b);this.$6.bumpODSKey(this.$1,"stream_establishment_failure")};b.error=function(a,b){b={msg:b,state:this.$9()};this.$6.logError(this.$1,a,JSON.stringify(b),this.$8)};b.$9=function(){var a={currentNetworkCondition:window.navigator&&window.navigator.onLine===!0,establishRequestTimestamp:this.$2,establishedTimestamp:this.$3,streamClosedTimestamp:this.$7,sendHistory:JSON.stringify(Array.from(this.$4.entries())),receiveHistory:JSON.stringify(Array.from(this.$5.entries()))};return JSON.stringify(a)};return a}();f.DGWStreamEvents=a}),66);
__d("GroupedStream",["DGWAckManager","DGWConstants","DGWLoggingContext","DGWStream","DGWStreamEvents","QuickPerformanceLogger","Random","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("qpl")._(701242292,"2919");a=function(){function a(a,b,e,f,g,j,k){this.$1=a,this.$3=!1,this.$4=!1,this.$5=!1,this.$6=b,this.$7=e,this.$8=f,this.$2=j,this.$9=g,this.$10=new(d("DGWAckManager").DGWAckManager)(this.$9),this.$12=new(d("DGWStreamEvents").DGWStreamEvents)(this.$9,d("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,this.$1),this.$11=0,this.$13=k,this.$14=Date.now()+(Math.round(d("Random").random()*1e4)+1e4),(h||(h=c("QuickPerformanceLogger"))).markerStart(i,this.$14)}var b=a.prototype;b.send=async function(a,b){var c=this.$11++%d("DGWConstants").MAX_ACK_ID;a=this.$15(a,!0,c);if(!this.$16(a,!0,c))return!1;a=await this.$10.waitForAck(c,b!=null?b:d("DGWConstants").DEFAULT_ACK_TIMEOUT_MS);return a};b.sendFrame=async function(a,b,c){var e=this.$11++%d("DGWConstants").MAX_ACK_ID;b=this.$15(b,!0,e);if(b==null)return!1;var f=new Uint8Array(a.length+b.length);f.set(a);f.set(b,a.length);if(!this.$16(f,!0,e))return!1;b=await this.$10.waitForAck(e,c!=null?c:d("DGWConstants").DEFAULT_ACK_TIMEOUT_MS);this.__markerPoint(b?"ack_recevied":"ack_timeout");if(!b){this.__endMarker(3);return Promise.reject(d("DGWStream").StreamError.ACK_TIMEOUT)}return b};b.sendAndForget=function(a){a=this.$15(a,!1,0);return this.$16(a,!1,0)};b.sendFrameAndForget=function(a,b){b=this.$15(b,!1,0);if(b==null)return!1;var c=new Uint8Array(a.length+b.length);c.set(a);c.set(b,a.length);return this.$16(c,!1,0)};b.close=function(){var a=this.$2.encodeEndOfData(this.$1);if(a==null){this.$9.logError(d("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,"Failed to encode EndOfData","streamId: "+this.$1);return}a=this.$8.send(a);if(!a){this.$9.logError(d("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,"Failed to send EndOfData","streamId: "+this.$1+". StreamGroupTransport not open during send");return}this.$12.endOfDataSent();this.$5=!0;this.$4&&this.$17()};b.loggingContext=function(){return this.$9};b.__sendDrain=function(a){var b=d("DGWConstants").drainReasonToDrainReasonString(a);if(this.$5)return!1;a=this.$2.encodeDrain(a);if(a==null)return!1;this.$12.drainSent(b);b=this.$8.send(a);return b};b.__transportCloseHook=function(a){this.$13(),this.$10.clearPendingAcks(),a?(this.$12.error("Received StreamError","StreamErrorType: "+a),this.$6.onError(a)):this.$5&&this.$4?this.$17():(this.$12.streamClosed(!1,"Stream closed: ClosedLocally: "+this.$5.toString()+", EndOfDataReceived: "+this.$4.toString()),this.$6.onError(d("DGWStream").StreamError.PREMATURE_CLOSE))};b.$17=function(){this.$13(),this.$12.streamClosed(!0,"Graceful close"),this.$6.onClose(this)};b.__dataReceivedHook=function(a,b){this.$12.dataReceived(a.length,b!=null,b),b!=null&&this.$18(b),this.$6.onDataReceived(a)};b.__ackReceivedHook=function(a){this.$12.ackReceived(a),this.$10.handleAckReceived(a)};b.__drainReceivedHook=function(a){this.$3===!1&&(this.$6.onStreamMustDrain(this,a),this.$3=!0)};b.__endOfDataHook=function(){this.$12.endOfDataReceived(),this.$4=!0,this.$5?this.$17():this.$6.onServerHasFinishedSendingData(this)};b.__markerPoint=function(a){var b=this.$14;(h||(h=c("QuickPerformanceLogger"))).markerPoint(i,a,{instanceKey:b})};b.__markerAnnotate=function(a){var b=this.$14;(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(i,a,{instanceKey:b})};b.__endMarker=function(a){(h||(h=c("QuickPerformanceLogger"))).markerEnd(i,a,this.$14)};b.$15=function(a,b,c){return this.$2.encodeData(a,b,c,this.$1)};b.$16=function(a,b,c){this.__markerPoint("send_data_start");if(this.$5){this.$9.logError(d("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,"Failed to send data","Stream closed locally");return!1}if(a==null)return!1;var e=this.$8.send(a);if(!e){this.$9.logError(d("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,"Failed to send data","ClosedLocally: "+this.$5.toString());return!1}this.__markerPoint("send_data_end");this.$12.dataSent(a.length,b,c);return!0};b.$18=function(a){var b=this.$2.encodeAck(a,this.$1);if(b==null){this.$9.logError(d("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,"Failed to encode ACK","ackId: "+a);return!1}b=this.$8.send(b);if(!b){this.$9.logError(d("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,"Failed to send ACK","ackId: "+a);return!1}this.$12.ackSent(a);return!0};return a}();g.GroupedStream=a}),98);
__d("StreamIdGenerator",["err"],(function(a,b,c,d,e,f,g){"use strict";var h=65535;a=function(){function a(){this.$1=new Set(),this.$2=0}var b=a.prototype;b.getNextStreamId=function(){var a;if(!this.streamIdAvailable())throw c("err")("Max number of stream IDs reached");if(this.$2<=h)return this.$2++;a=(a=this.$1.values().next().value)!=null?a:0;this.$1["delete"](a);return a};b.putBackStreamId=function(a){this.$1.add(a)};b.streamIdAvailable=function(){return this.$1.size>0||this.$2<=h};return a}();g.MAX_STREAM_ID=h;g.StreamIdGeneratorImpl=a}),98);
__d("StreamGroupWebSocketTransport",["DGWConstants","DGWExponentialBackoff","DGWGlobalLogger","DGWLoggingContext","DGWPinger","DGWStream","DGWStreamGroupCallbacks","DGWTransportEvents","DGWUtils","DGWWebSocketTransport","GroupedStream","QuickPerformanceLogger","Random","Run","StreamIdGenerator","err","qex","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("qpl")._(701238781,"3037"),j=(a=c("qex")._("2101"))!=null?a:20,k=(b=c("qex")._("2102"))!=null?b:3e4,l=(e=c("qex")._("2103"))!=null?e:!1,m=function(a,b,c,e,f){var g=this;this.groupedStream=a;this.$1=window.setTimeout(function(){c(d("DGWStream").StreamError.ESTABLISHMENT_TIMEOUT)},e);this.handleEstablishFrameReceived=function(){window.clearTimeout(g.$1),b(g.groupedStream)};this.abortStream=function(a){f(),c(a)}};f=function(){function a(b,e,f,g,j,k,l,m){var n=this;this.$18=-1;this.$15=j;this.$17=this.__getStreamIdGenerator();this.$5=new Map();this.$6=new Map();this.$7=g.keepAliveMs;this.$8=!1;this.$9=!1;this.$3=!0;this.$4=!1;this.$21=!1;this.$22=!1;this.$13=f;this.$11=new TextEncoder();this.$12=new TextDecoder();this.$14=g;j={onDataReceived:function(){},handleAckReceived:function(){},receivedDrainSignal:function(a){n.$9||(n.$9=!0,n.$15(),n.$13.transportClosed(!0,""),n.$14.streamGroupCallbacks.onStreamGroupMustDrain(a),n.$5.forEach(function(b){b.__drainReceivedHook(a)}),n.onClose(d("DGWConstants").WebsocketCloseCodes.GRACEFUL_CLOSE))},onGroupedStreamDataReceived:function(a,b,c){if(n.$5.has(a)){var d=n.$5.get(a);d==null||d.__dataReceivedHook(b,c)}else n.$13.receivedFrameForInactiveStream("Data",a,"sendAckID: "+(c!=null?c:"null"))},onGroupedStreamAckReceived:function(a,b){if(n.$5.has(a)){var c=n.$5.get(a);c==null||c.__ackReceivedHook(b)}else n.$13.receivedFrameForInactiveStream("ACK",a,"ackId: "+(b!=null?b:"null"))},onGroupedStreamEndOfDataReceived:function(a){if(n.$5.has(a)){var b=n.$5.get(a);b==null||b.__endOfDataHook()}else n.$13.receivedFrameForInactiveStream("EndOfData",a)},onGroupedStreamEstablishStreamReceived:function(a,b){if(n.$6.has(a)){var c=n.$6.get(a);n.$6.delete(a);b=JSON.parse(n.$12.decode(b));(b.code===void 0||b.code!==200)&&(c==null||c.abortStream(d("DGWStream").StreamError.ABNORMAL_CLOSURE));c==null||c.handleEstablishFrameReceived()}else n.$13.receivedFrameForInactiveStream("EstablishStream",a,"EstablishStream received for non-inflight stream")},onPingReceived:function(){var a=n.$2.encodePing();if(a==null)return;n.send(a)},onPongReceived:function(){n.$3=!1,n.$22||(n.$22=!0,n.__markerPoint("auth_success")),n.$13.transportPongReceived("readyState:"+n.$1.readyState+", bufferedAmount:"+n.$1.bufferedAmount)}};this.$2=new(d("DGWUtils").DGWCodec)(k,j,g.dgwVersion);this.$20=Date.now()+(Math.round(d("Random").random()*1e4)+1e4);this.$23=d("DGWGlobalLogger").getInstance();d("Run").onUnload(function(){n.$23.tabClosed()});if(g.enableFirstStreamOnWsHandshake){if(l===void 0)throw c("err")("Missing grouped stream options");if(m===void 0)throw c("err")("Missing grouped stream callbacks");var o=this.$17.getNextStreamId();f=this.createEstablishStreamFrame(o,l);k=d("DGWUtils").DGWUtils.constructConnectUrl({appId:g.appId,appVersion:g.appVersion,authType:g.authType,deviceId:(k=g.deviceId)!=null?k:void 0,dgwVersion:g.dgwVersion,fbId:g.fbId,tier:g.tier,loggingId:(j=g.loggingId)!=null?j:void 0,headers:a.__prefixAppHeaders(g.headers),endpoint:g.connectEndpoint,serviceId:g.serviceId,regionHint:(k=g.regionHint)!=null?k:void 0,establishStreamFrame:f,authToken:(j=g.authToken)!=null?j:void 0});this.$1=e(k);if(!k.includes(d("DGWConstants").HEADER_CONSTANTS.HEADER_ESTABLISH_STREAM_FRAME_BASE64))return;f=new(d("DGWLoggingContext").DGWLoggingContext)(this.$14.dgwVersion,l.loggingId,this.$14.serviceId,this.$14.fbId,this.$14.loggingId,l.disableFalcoLogging);j=this.__createGroupedStream(o,m,l,f);this.$16=this.waitForEstablishStream(o,j,l,function(a){n.$5.set(o,a)},function(){n.$17.putBackStreamId(o)})}else this.$1=e(b);this.$23.streamRequested(g.serviceId);(h||(h=c("QuickPerformanceLogger"))).markerStart(i,this.$20);this.__markerAnnotate({string:{serviceId:this.$14.serviceId,streamGroupId:this.$14.loggingId}})}var b=a.prototype;b.send=function(a){try{this.$1.send(a);return!0}catch(a){this.$13.transportError("Failed to send over transport","readyState: "+this.$1.readyState,a.toString());return!1}};b.close=function(){var a;this.$23.streamClosed(this.$14.serviceId);this.__markerPoint("teardown");this.$8=!0;(a=this.$10)==null||a.cancel();this.$1.onopen=function(a){};this.$1.onmessage=function(a){};this.$1.onerror=function(a){};this.$1.onclose=function(a){};this.$1.close()};b.onClose=function(a){var b;this.$23.streamClosed(this.$14.serviceId);this.__markerPoint("abort");this.__markerAnnotate({int:{abort_code:a}});this.$8=!0;(b=this.$10)==null||b.cancel();this.$1.close(a)};b.abort=function(a,b,c,d,e){if(this.$8)return;this.$23.streamClosed(this.$14.serviceId);this.$8=!0;this.$13.transportClosed(!1,d,e);this.$5.forEach(function(a){a.__transportCloseHook(b)});this.$6.forEach(function(a){a.abortStream(b)});this.$14.streamGroupCallbacks.onStreamGroupError(a);this.$5.clear();this.$6.clear();this.$15();this.onClose(c)};a.getTransportWithInitialStream=async function(b,c,e,f,g,h){await d("DGWUtils").DGWCodec.initialize();var i=new(d("DGWTransportEvents").DGWTransportEvents)(f);i.transportEstablishmentPending();var j=function(){return a.$24("",e,i,g,f,b,c)};try{j=await d("DGWExponentialBackoff").callWithExponentialBackoff(j,h);h=j.$16!=null?j.$16:j.establishGroupedStream(c,b,new(d("DGWLoggingContext").DGWLoggingContext)(e.dgwVersion,b.loggingId,e.serviceId,e.fbId,e.loggingId,b.disableFalcoLogging));return{transport:j,streamPromise:h}}catch(a){throw a}};a.getTransport_DEPRECATED=async function(b,c,e,f,g){await d("DGWUtils").DGWCodec.initialize();var h=new(d("DGWTransportEvents").DGWTransportEvents)(e);h.transportEstablishmentPending();var i=function(){return a.$24(b,c,h,f,e)};try{return await d("DGWExponentialBackoff").callWithExponentialBackoff(i,g)}catch(a){throw a}};b.establishGroupedStream=async function(a,b,d,e,f,g){var h=this;f===void 0&&(f=!0);var i=this.getStreamId(),j=this.createEstablishStreamFrame(i,b);a=this.__createGroupedStream(i,a,b,d);a.__markerAnnotate({string:{serviceId:this.$14.serviceId,streamGroupId:this.$14.loggingId,streamId:b.streamTraceId}});g!=null&&a.__markerAnnotate(g);d=this.waitForEstablishStream(i,a,b,function(a){h.$5.set(i,a)},function(){h.$17.putBackStreamId(i)});if(e!=null){a.__markerPoint("send_payload_start");a.__markerAnnotate({int:{establishStreamPayloadSize:e.byteLength}});g=f?await a.sendFrame(j,e,k):a.sendFrameAndForget(j,e);if(!g){a.__endMarker(3);return Promise.reject("Failed to send data when establishing stream")}a.__markerPoint("send_payload_end");a.__endMarker(2);return Promise.resolve(a)}a.__markerPoint("send_establish_stream_start");if(!this.send(j)){a.__endMarker(3);throw c("err")("Websocket connection closed before stream established")}a.__markerPoint("send_establish_stream_end");b=await d;a.__endMarker(2);return b};a.__prefixAppHeaders=function(a){return Object.keys(a).reduce(function(b,c){b[""+d("DGWConstants").HEADER_CONSTANTS.APPHEADER_PREFIX+c]=a[c];return b},{})};b.waitForEstablishStream=async function(a,b,c,d,e){var f=this;this.$13.streamEstablishmentPending(a,c.loggingId);try{var g=await new Promise(function(c,d){f.$6.set(a,new m(b,c,d,3e4,function(){f.streamEndCallback(a)}))});d(b);this.$13.streamEstablishmentSuccess(a,c.loggingId);return g}catch(b){e();this.$13.streamEstablishmentTimeout("Stream establishment timeout. readyState: "+this.$1.readyState,a,c.loggingId);throw b}};a.$24=async function(b,c,e,f,g,h,i){var j=new a(b,d("DGWWebSocketTransport").getWebSocketConnection,e,c,f,g,h,i);j.$1.onmessage=a.$25(j);j.$1.onopen=function(){j.__markerPoint("onopen"),e.transportEstablished(b),j.$10!=null&&j.$10.cancel(),j.$7!=null&&(j.$10=new(d("DGWPinger").DGWPinger)(j.$7,function(){j.$26()},function(){j.abort(d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_KEEPALIVE_TIMEOUT,d("DGWStream").StreamError.KEEPALIVE_TIMEOUT,d("DGWConstants").WebsocketCloseCodes.KEEPALIVE_TIMEOUT,"Aborting transport because of keepalive timeout","readyState:"+j.$1.readyState+", bufferedAmount:"+j.$1.bufferedAmount)}))};j.$1.onerror=function(){j.__markerPoint("onerror"),j.$13.transportError("onerror","readyState: "+j.$1.readyState)};j.$1.onclose=a.$27(j);c=await a.getTransportPromise(j);return c};a.getTransportPromise=async function(a){var b=await new Promise(function(b,c){var e=a.$1.onerror,f=a.$1.onmessage,g=a.$1.onclose;a.$19=window.setTimeout(function(){a.$15(),a.$13.transportClosed(!1,"TIMEOUT"),a.__markerPoint("connect_timeout"),a.close(),c(d("DGWStream").StreamError.TRANSPORT_ESTABLISHMENT_TIMEOUT)},j*1e3);a.$1.onerror=function(){a.$19!=null&&(window.clearTimeout(a.$19),a.$19=null),e(),a.close(),l||c(d("DGWStream").StreamError.ESTABLISHMENT_ERROR)};a.$1.onclose=function(b){a.$19!=null&&(window.clearTimeout(a.$19),a.$19=null),g(b),b.code===d("DGWConstants").WebsocketCloseCodes.UNAUTHORIZED?c(d("DGWStream").StreamError.UNAUTHORIZED):c(b.code+":"+b.reason)};a.$1.onmessage=function(c){f(c),a.$19!=null&&!a.$3&&(window.clearTimeout(a.$19),a.$19=null,a.__markerPoint("connect_success"),b(a))}});return b};a.$25=function(a){return function(b){var c;a.$21||(a.$21=!0,a.__markerPoint("onmessage"));(c=a.$10)==null||c.reset();if(!(b.data instanceof ArrayBuffer)){a.$13.transportError("Incorrect Data Protocol","Received "+typeof b.data+" instead of ArrayBuffer");return}a.$2.append(new Uint8Array(b.data));a.$2.processData()}};a.$27=function(a){return function(b){var c=a.$23.getGlobalState();a.__markerPoint("onclose");a.__markerAnnotate({string:{reason:b.reason},int:{code:b.code,realtimeWebSockets:c.realtime,lightspeedWebSockets:c.lightspeed}});a.__endMarker(b.code===d("DGWConstants").WebsocketCloseCodes.GRACEFUL_CLOSE?2:3);(c=a.$10)==null||c.cancel();if(a.$8===!0||a.$4)return;a.$23.streamClosed(a.$14.serviceId);a.$8=!0;if(a.$3===!0){a.$13.transportEstablishmentFailure(b);a.$5.clear();a.$15();return}a.$15();a.$3=!0;if(b.code!==d("DGWConstants").WebsocketCloseCodes.GRACEFUL_CLOSE){a.$13.transportClosed(!1,"Websocket connection failure with code: "+b.code+" reason: "+b.reason+" wasClean: "+String(b.wasClean));c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_UNKNOWN_ERROR;var e=d("DGWStream").StreamError.UNKNOWN_ERROR;switch(b.code){case d("DGWConstants").WebsocketCloseCodes.NORMAL_CLOSURE:c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_NORMAL_CLOSURE;e=d("DGWStream").StreamError.ABNORMAL_CLOSURE;break;case d("DGWConstants").WebsocketCloseCodes.ABNORMAL_CLOSURE:c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_ABNORMAL_CLOSURE;e=d("DGWStream").StreamError.ABNORMAL_CLOSURE;break;case d("DGWConstants").WebsocketCloseCodes.SERVER_INTERNAL_ERROR:c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_SERVER_INTERNAL_ERROR;e=d("DGWStream").StreamError.SERVER_INTERNAL_ERROR;break;case d("DGWConstants").WebsocketCloseCodes.GOING_AWAY:c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_GOING_AWAY;e=d("DGWStream").StreamError.GOING_AWAY;break;case d("DGWConstants").WebsocketCloseCodes.UNAUTHORIZED:c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_UNAUTHORIZED;e=d("DGWStream").StreamError.UNAUTHORIZED;break;case d("DGWConstants").WebsocketCloseCodes.REJECTED:c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_REJECTED;e=d("DGWStream").StreamError.REJECTED;break;case d("DGWConstants").WebsocketCloseCodes.BAD_REQUEST:c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_BAD_REQUEST;e=d("DGWStream").StreamError.BAD_REQUEST;break;case d("DGWConstants").WebsocketCloseCodes.DGW_SERVER_ERROR:c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_SERVER_INTERNAL_ERROR;e=d("DGWStream").StreamError.DGW_SERVER_ERROR;c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_DGW_SERVER_ERROR;break;default:c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_UNKNOWN_ERROR;e=d("DGWStream").StreamError.UNKNOWN_ERROR;break}a.$14.streamGroupCallbacks.onStreamGroupError(c);a.$5.forEach(function(a){a.__transportCloseHook(e)});a.$6.forEach(function(a){a.abortStream(e)})}else a.$13.transportClosed(!0,""),a.$14.streamGroupCallbacks.onStreamGroupTransportClose(),a.$5.forEach(function(a){a.__transportCloseHook()}),a.$6.forEach(function(a){a.abortStream(d("DGWStream").StreamError.TRANSPORT_CLOSED_BEFORE_STREAM_INIT)});a.$5.clear();a.$6.clear()}};b.$26=function(){var a=this.$2.encodePing();if(a==null)throw c("err")("Failed to encode Ping Frame");var b=this.send(a);this.$18=this.$1.bufferedAmount;this.$13.transportPingSent("readyState:"+this.$1.readyState+", bufferedAmount:"+this.$18+", payloadSize:"+(a==null?void 0:a.byteLength)+", sent:"+String(b))};b.isClosedLocally=function(){return this.$3||this.$8||this.$4};b.streamEndCallback=function(a){this.$5.delete(a),this.$6.delete(a),this.$17.putBackStreamId(a)};b.canCreateGroupedStream=function(){return this.$17.streamIdAvailable()};b.createEstablishStreamFrame=function(b,e){var f=a.__prefixAppHeaders(e.groupedStreamHeaders);e.streamTraceId!=null&&(f[d("DGWConstants").HEADER_CONSTANTS.HEADER_STREAM_TRACE_ID]=e.streamTraceId);e=this.$2.encodeEstablishStream(b,new Uint8Array(this.$11.encode(JSON.stringify(f))));if(e==null){this.$17.putBackStreamId(b);throw c("err")("Failed to encode EstablishStreamFrame")}return e};b.getStreamId=function(){try{return this.$17.getNextStreamId()}catch(a){this.$13.ranOutOfStreamIds("inFlightGroupedStreamSize: "+this.$6.size+" groupedStreamSize: "+this.$5.size);throw a}};b.__createGroupedStream=function(a,b,c,e){var f=this;return new(d("GroupedStream").GroupedStream)(a,b,c,this,e,this.$2,function(){f.streamEndCallback(a)})};b.__getStreamIdGenerator=function(){return new(d("StreamIdGenerator").StreamIdGeneratorImpl)()};b.__markerPoint=function(a){var b=this.$20;(h||(h=c("QuickPerformanceLogger"))).markerPoint(i,a,{instanceKey:b})};b.__markerAnnotate=function(a){var b=this.$20;(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(i,a,{instanceKey:b})};b.__endMarker=function(a){(h||(h=c("QuickPerformanceLogger"))).markerEnd(i,a,this.$20)};return a}();g.StreamGroupWebSocketTransport=f}),98);
__d("StreamGroup",["DGWConstants","DGWLoggingContext","DGWUtils","StreamGroupWebSocketTransport","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h={maxRetries:c("justknobx")._("2595"),baseRetryInterval:1e3,backoffFactor:Math.sqrt(2)};a=function(){function a(a,b,e,f,g,h,i,j,k){this.$2=k;this.$1=k.getNewStreamGroupId();k=(k=i.overrideUrl)!=null?k:g;this.$5=null;g=h;if(c("justknobx")._("3090")){var l;g=(l=i.guestFbid)!=null?l:h}this.$3={appId:a,appVersion:b,authType:(l=i.authType)!=null?l:e,deviceId:i.deviceId,dgwVersion:f,headers:i.streamGroupAppHeaders,tier:(h=i.serviceTier)!=null?h:d("DGWConstants").DEFAULT_SERVICE_TIER,connectEndpoint:k,fbId:g,loggingId:i.loggingId,serviceId:i.serviceId,streamGroupCallbacks:j,keepAliveMs:i.keepAliveMs,regionHint:i.regionHint,enableFirstStreamOnWsHandshake:!1,authToken:i.authToken};this.$4=i;this.streamGroupLoggingContext=new(d("DGWLoggingContext").DGWLoggingContext)(this.$3.dgwVersion,null,this.$3.serviceId,this.$3.fbId,this.$4.loggingId,!1,(a=i.verboseLoggingEnabled)!=null?a:!1);this.$6=d("DGWUtils").DGWUtils.constructConnectUrl({appId:this.$3.appId,appVersion:this.$3.appVersion,authType:this.$3.authType,deviceId:(b=this.$3.deviceId)!=null?b:void 0,dgwVersion:this.$3.dgwVersion,fbId:this.$3.fbId,headers:babelHelpers.extends({},this.$3.headers),loggingId:(l=this.$3.loggingId)!=null?l:void 0,tier:this.$3.tier,serviceId:this.$3.serviceId,endpoint:this.$3.connectEndpoint,regionHint:(e=this.$3.regionHint)!=null?e:void 0,trafficTracing:(f=this.$4.trafficTracing)!=null?f:void 0,authToken:(h=this.$4.authToken)!=null?h:void 0})}var b=a.prototype;b.initTransport=async function(){var b=this,a={maxRetries:0,baseRetryInterval:1e3,backoffFactor:Math.sqrt(2)};this.$5=this.$5||d("StreamGroupWebSocketTransport").StreamGroupWebSocketTransport.getTransport_DEPRECATED(this.$6,this.$3,this.streamGroupLoggingContext,function(){b.$2.removeStreamGroupAndTransport(b.$1)},a);var c;try{c=await this.$5,this.$5=null}catch(a){this.$5=null;throw a}this.$2.containsStreamGroup(this.$1)||this.$2.setStreamGroupAndTransport(this.$1,c);return c};b.establishStream=async function(a,b,c,e,f){var g=this;if(this.$2.containsStreamGroup(this.$1)===!1){this.streamGroupLoggingContext.logEvent(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,"createTransportWhenEstablishStream");if(!this.$3.enableFirstStreamOnWsHandshake){this.$5=this.$5||d("StreamGroupWebSocketTransport").StreamGroupWebSocketTransport.getTransport_DEPRECATED(this.$6,this.$3,this.streamGroupLoggingContext,function(){g.$2.removeStreamGroupAndTransport(g.$1)},h);var i;try{i=await this.$5,this.$5=null}catch(a){this.$5=null;throw a}this.$2.containsStreamGroup(this.$1)||this.$2.setStreamGroupAndTransport(this.$1,i)}else{var j=await d("StreamGroupWebSocketTransport").StreamGroupWebSocketTransport.getTransportWithInitialStream(a,b,this.$3,this.streamGroupLoggingContext,function(){g.$2.removeStreamGroupAndTransport(g.$1)},h);this.$2.setStreamGroupAndTransport(this.$1,j.transport);return j.streamPromise}}return this.establishStreamWithTransport(a,b,c,e,f)};b.establishStreamWithTransport=async function(a,b,c,e,f){var g=a.loggingId;this.streamGroupLoggingContext.logEvent(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,"Establishing Grouped Stream","initialData:"+String(c!=null),!0,g);g=await this.$2.getStreamGroupTransport(this.$1).establishGroupedStream(b,a,new(d("DGWLoggingContext").DGWLoggingContext)(this.$3.dgwVersion,g,this.$3.serviceId,this.$3.fbId,this.$3.loggingId,a.disableFalcoLogging,(b=a.verboseLoggingEnabled)!=null?b:!1),c,e,f);return g};b.canCreateGroupedStream=function(){var a=!0;if(this.$2.containsStreamGroup(this.$1)!==!1){var b=this.$2.getStreamGroupTransport(this.$1);a=b.canCreateGroupedStream()}d("DGWLoggingContext").DGWLoggingContext.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,a?"can_create":"cannot_create");return a};b.close=function(){var a=this.$2.getStreamGroupTransport(this.$1);a.close()};return a}();g.StreamGroup=a}),98);
__d("StreamGroupRegistry",["Random","err"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){this.$1=new Map(),this.$2=new Set()}var b=a.prototype;b.setStreamGroupAndTransport=function(a,b){this.$1.set(a,b)};b.containsStreamGroup=function(a){return this.$1.has(a)};b.removeStreamGroupAndTransport=function(a){this.$1["delete"](a)};b.getStreamGroupTransport=function(a){a=this.$1.get(a);if(a==null)throw c("err")("No stream group transport");return a};b.getNewStreamGroupId=function(){var a=d("Random").uint32();while(this.$2.has(a))a=d("Random").uint32();this.$2.add(a);return a};return a}();g.StreamGroupRegistry=a}),98);
__d("RawDGWClient",["CurrentUser","DGWAuth","DGWLoggingContext","DGWStream","StreamGroup","StreamGroupRegistry","isFastRefreshEnabledForCurrentDomain"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){var b=a.appId,c=a.appVersion,e=a.authType,f=a.dgwVersion,g=a.endpoint;a=a.fbId;this.$1=b;this.$2=c;this.$3=e;this.$4=f;this.$5=g;this.$6=a;this.$7=new(d("StreamGroupRegistry").StreamGroupRegistry)()}var b=a.prototype;b.createStreamGroup=function(a,b){var c;this.handleUserChecks((c=b.authType)!=null?c:this.$3);return new(d("StreamGroup").StreamGroup)(this.$1,this.$2,this.$3,this.$4,this.$5,this.$6,b,a,this.$7)};b.handleUserChecks=function(a){if(!c("CurrentUser").isLoggedInNow()&&d("DGWAuth").fromDGWAuthToString(a)!=="GUEST"&&!c("isFastRefreshEnabledForCurrentDomain")()){d("DGWLoggingContext").DGWLoggingContext.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.RAW_CLIENT,"unauthenticated");throw d("DGWStream").StreamError.UNAUTHENTICATED}};return a}();g.RawDGWClient=a}),98);
__d("DGWClient",["DGWAuth","DGWEnvUtil","DGWWebConfig","RawDGWClient","err"],(function(a,b,c,d,e,f,g){"use strict";var h=new(d("RawDGWClient").RawDGWClient)({appId:c("DGWWebConfig").appId,appVersion:c("DGWWebConfig").appVersion,authType:d("DGWAuth").fromStringToDGWAuth(c("DGWEnvUtil").getDGWAuthType()),dgwVersion:c("DGWEnvUtil").getDGWVersion(),endpoint:c("DGWEnvUtil").getDGWEndpoint(),fbId:c("DGWWebConfig").fbId});function a(){if(c("DGWEnvUtil").isDGWEnvCompatible())return h;else throw c("err")("unsupported_environment_retry_with_mqtt")}g["default"]=a}),98);
__d("DGWRequestStreamUtils",["Base64","WebDriverConfig","cr:3024","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a,d,e,f){var g={};for(a of Object.entries(a)){var h=a[0],i=a[1];typeof i=="string"?g["XRSS-"+h]=i:typeof i=="number"?g["XRSN-"+h]=i.toString():typeof i=="boolean"?g["XRSB-"+h]=i.toString():typeof i=="object"&&i!=null&&(g["XRSO-"+h]=c("Base64").encode(JSON.stringify(i)))}d&&(g["xrs-body"]="true");e!=null&&e.length>0&&(g["xrs-instrumentation"]=c("Base64").encode(e));g["XRS-Accept-Ack"]="RSAck";f!=null&&f.ackTimeoutSec!=null&&(g["XRS-SRAck-Timeout"]=f.ackTimeoutSec.toString());g["XRSS-http_referer"]=window.location.href;if(c("WebDriverConfig").isTestRunning&&c("gkx")("20919")){h=b("cr:3024")==null?void 0:b("cr:3024").get();h!=null&&(g["XRSB-is_test"]="true",g["XRSS-original_request_id"]=h)}return g}function h(a){return Object.keys(a).reduce(function(b,c){(typeof a[c]==="string"||typeof a[c]==="boolean"||typeof a[c]==="number"||typeof a[c]==="object")&&(b[c]=a[c]);return b},{})}function d(a){if(a.response&&a.response.instrumentation_data!=null&&a.response.instrumentation_data.length>0)try{a=JSON.parse(new TextDecoder("utf-8").decode(a.response.instrumentation_data));return{auxId:a.auxId,dfTraceId:(a=a.dataFlowTracingData)==null?void 0:a.traceId}}catch(a){}return null}function e(a,b){var c=a.headers;a=a.body;b.kill_body===!0&&(a=null);b.new_body!=null&&(a=b.new_body);if(b.new_headers!=null)try{c=h(JSON.parse(b.new_headers))}catch(a){}if(b.patch_headers!=null)try{c=babelHelpers["extends"]({},c,h(JSON.parse(b.patch_headers)))}catch(a){}return{headers:c,body:a}}g.convertHeaders=a;g.cleanHeaders=h;g.getInstrumentationDataFieldsFromPayload=d;g.transformContextWithRewriteDelta=e}),98);
__d("DGWStreamHandler",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,b,c,d,e){this.$2=a,this.$3=b,this.$4=c,this.$5=d,this.$6=e,this.$1=!0}var b=a.prototype;b.onClose=function(a){if(!this.$1)return;this.$2(a)};b.onDataReceived=function(a){if(!this.$1)return;this.$3(a)};b.onError=function(a){if(!this.$1)return;this.$4(a)};b.onStreamMustDrain=function(a,b){if(!this.$1)return;this.$5(a,b)};b.onServerHasFinishedSendingData=function(a){if(!this.$1)return;this.$6(a)};b.stop=function(){this.$1=!1};b.isStopped=function(){return!this.$1};return a}();f["default"]=a}),66);
__d("InflightAmends",["Deferred","err"],(function(a,b,c,d,e,f,g){"use strict";var h="inflight_amends_timeout",i="inflight_amends_duplicate_id";a=function(){function a(a,b,c){this.$1=a,this.$3=b,this.$4=c,this.$2=new Map()}var b=a.prototype;b.add=function(a){var b=this;if(this.$2.has(a))throw c("err")(i);var d=new(c("Deferred"))(),e=Date.now(),f=setTimeout(function(){b.$2.has(a)&&b.reject(a,c("err")(h))},this.$1);this.$2.set(a,{id:a,deferred:d,createdTimestampMs:e,timeoutId:f});return d.getPromise()};b.getPromise=function(a){return(a=this.$5(a))==null?void 0:a.deferred.getPromise()};b.resolve=function(a,b){a=this.$5(a);a&&(a.deferred.resolve==null||a.deferred.resolve(b),this.$3(a.id,Date.now()-a.createdTimestampMs),this.$6(a))};b.reject=function(a,b){a=this.$5(a);a&&(a.deferred.reject==null||a.deferred.reject(b),this.$4(a.id,b),this.$6(a))};b.rejectAll=function(a){for(var b of this.$2.entries()){var c=b[0];b[1];this.reject(c,a)}};b.getSize=function(){return this.$2.size};b.getAllPromises=function(){var a=[];for(var b of this.$2.values())a.push(b.deferred.getPromise());return a};b.$6=function(a){clearTimeout(a.timeoutId),this.$2["delete"](a.id)};b.$5=function(a){return this.$2.get(a)};return a}();g["default"]=a}),98);
__d("RequestStreamCloseReason",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["UserIntention","StartStreamFailure","StreamError","RemoteTermination","ServerDataEnd","ServerDrain","ReestablishError","ClientError"]);f.RequestStreamCloseReason=a}),66);
__d("RequestStreamCommonRequestStreamCommonSerializers",["RequestStreamCommonRequestStreamCommonTypes","ThriftTypes","jsbi"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return{}}function b(){return{expected_existing_headers:"",patch_headers_if_match:""}}function e(){return{bytes:Uint8Array.of()}}function f(){return{message:""}}function i(){return{reason:d("RequestStreamCommonRequestStreamCommonTypes").TerminationReason.cast(0)}}function j(){return{}}function k(){return{stream_id:"0",last_sequencer:0,amendment_count:0,last_status:d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.cast(0)}}function l(){return{caller_timestamp_ms:"0"}}function m(){return{original_ping_timestamp_ms:"0"}}function n(){return{}}function o(a,b){b.writeStructBegin("ResponseRewriteRequest"),a.new_headers!=null&&(b.writeFieldBegin({fname:"new_headers",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:1}),b.writeString(a.new_headers),b.writeFieldEnd()),a.new_body!=null&&(b.writeFieldBegin({fname:"new_body",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:2}),b.writeBinary(a.new_body),b.writeFieldEnd()),a.patch_headers!=null&&(b.writeFieldBegin({fname:"patch_headers",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:3}),b.writeString(a.patch_headers),b.writeFieldEnd()),a.kill_body!=null&&(b.writeFieldBegin({fname:"kill_body",ftype:(h||(h=c("ThriftTypes"))).BOOL,fid:4}),b.writeBool(a.kill_body),b.writeFieldEnd()),a.temporary!=null&&(b.writeFieldBegin({fname:"temporary",ftype:(h||(h=c("ThriftTypes"))).BOOL,fid:5}),b.writeBool(a.temporary),b.writeFieldEnd()),a.conditional_patch_headers!=null&&(b.writeFieldBegin({fname:"conditional_patch_headers",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:6}),p(a.conditional_patch_headers,b),b.writeFieldEnd()),b.writeFieldStop(),b.writeStructEnd()}function p(a,b){b.writeStructBegin("ResponseRewriteConditionalPatchHeaders");b.writeFieldBegin({fname:"expected_existing_headers",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:1});if(a.expected_existing_headers!=null)b.writeString(a.expected_existing_headers);else{var d="";b.writeString(d)}b.writeFieldEnd();b.writeFieldBegin({fname:"patch_headers_if_match",ftype:h.STRING,fid:2});if(a.patch_headers_if_match!=null)b.writeString(a.patch_headers_if_match);else{d="";b.writeString(d)}b.writeFieldEnd();a.patch_headers_otherwise!=null&&(b.writeFieldBegin({fname:"patch_headers_otherwise",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:3}),b.writeString(a.patch_headers_otherwise),b.writeFieldEnd());b.writeFieldStop();b.writeStructEnd()}function q(a,b){b.writeStructBegin("ResponseData");b.writeFieldBegin({fname:"bytes",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:1});if(a.bytes!=null)b.writeBinary(a.bytes);else{var d=Uint8Array.of();b.writeBinary(d)}b.writeFieldEnd();a.metadata!=null&&(b.writeFieldBegin({fname:"metadata",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:2}),b.writeString(a.metadata),b.writeFieldEnd());b.writeFieldStop();b.writeStructEnd()}function r(a,b){b.writeStructBegin("LogMessage");b.writeFieldBegin({fname:"message",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:1});if(a.message!=null)b.writeString(a.message);else{a="";b.writeString(a)}b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd()}function s(a,b){b.writeStructBegin("Termination");b.writeFieldBegin({fname:"reason",ftype:(h||(h=c("ThriftTypes"))).I32,fid:1});if(a.reason!=null){var e;b.writeI32((e=a.reason)!=null?e:0)}else{e=d("RequestStreamCommonRequestStreamCommonTypes").TerminationReason.cast(0);b.writeI32(e!=null?e:0)}b.writeFieldEnd();a.message!=null&&(b.writeFieldBegin({fname:"message",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:2}),b.writeString(a.message),b.writeFieldEnd());a.retry_delay_ms!=null&&(b.writeFieldBegin({fname:"retry_delay_ms",ftype:(h||(h=c("ThriftTypes"))).I64,fid:3}),b.writeI64(c("jsbi").BigInt(a.retry_delay_ms)),b.writeFieldEnd());b.writeFieldStop();b.writeStructEnd()}function t(a,b){b.writeStructBegin("AmendStreamAck"),a.amendment_id!=null&&(b.writeFieldBegin({fname:"amendment_id",ftype:(h||(h=c("ThriftTypes"))).I64,fid:1}),b.writeI64(c("jsbi").BigInt(a.amendment_id)),b.writeFieldEnd()),a.accepted!=null&&(b.writeFieldBegin({fname:"accepted",ftype:(h||(h=c("ThriftTypes"))).BOOL,fid:2}),b.writeBool(a.accepted),b.writeFieldEnd()),a.result!=null&&(b.writeFieldBegin({fname:"result",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:3}),b.writeBinary(a.result),b.writeFieldEnd()),b.writeFieldStop(),b.writeStructEnd()}function u(a,b){b.writeStructBegin("StreamCheck");b.writeFieldBegin({fname:"stream_id",ftype:(h||(h=c("ThriftTypes"))).I64,fid:1});if(a.stream_id!=null)b.writeI64(c("jsbi").BigInt(a.stream_id));else{var e="0";b.writeI64(c("jsbi").BigInt(e))}b.writeFieldEnd();b.writeFieldBegin({fname:"last_sequencer",ftype:h.I32,fid:2});if(a.last_sequencer!=null)b.writeI32(a.last_sequencer);else{e=0;b.writeI32(e)}b.writeFieldEnd();b.writeFieldBegin({fname:"amendment_count",ftype:h.I32,fid:4});if(a.amendment_count!=null)b.writeI32(a.amendment_count);else{e=0;b.writeI32(e)}b.writeFieldEnd();b.writeFieldBegin({fname:"last_status",ftype:h.I32,fid:3});if(a.last_status!=null){b.writeI32((e=a.last_status)!=null?e:0)}else{a=d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.cast(0);b.writeI32(a!=null?a:0)}b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd()}function v(a,b){b.writeStructBegin("Ping");b.writeFieldBegin({fname:"caller_timestamp_ms",ftype:(h||(h=c("ThriftTypes"))).I64,fid:1});if(a.caller_timestamp_ms!=null)b.writeI64(c("jsbi").BigInt(a.caller_timestamp_ms));else{var d="0";b.writeI64(c("jsbi").BigInt(d))}b.writeFieldEnd();if(a.streams_to_check!=null){b.writeFieldBegin({fname:"streams_to_check",ftype:(h||(h=c("ThriftTypes"))).LIST,fid:2});b.writeListBegin({etype:h.STRUCT,size:a.streams_to_check.length});for(d of a.streams_to_check)u(d,b);b.writeListEnd();b.writeFieldEnd()}b.writeFieldStop();b.writeStructEnd()}function w(a,b){b.writeStructBegin("Pong");b.writeFieldBegin({fname:"original_ping_timestamp_ms",ftype:(h||(h=c("ThriftTypes"))).I64,fid:1});if(a.original_ping_timestamp_ms!=null)b.writeI64(c("jsbi").BigInt(a.original_ping_timestamp_ms));else{var d="0";b.writeI64(c("jsbi").BigInt(d))}b.writeFieldEnd();if(a.stream_ids_missing!=null){b.writeFieldBegin({fname:"stream_ids_missing",ftype:(h||(h=c("ThriftTypes"))).LIST,fid:2});b.writeListBegin({etype:h.I64,size:a.stream_ids_missing.length});for(d of a.stream_ids_missing)b.writeI64(c("jsbi").BigInt(d));b.writeListEnd();b.writeFieldEnd()}if(a.stream_ids_behind!=null){b.writeFieldBegin({fname:"stream_ids_behind",ftype:(h||(h=c("ThriftTypes"))).LIST,fid:3});b.writeListBegin({etype:h.I64,size:a.stream_ids_behind.length});for(d of a.stream_ids_behind)b.writeI64(c("jsbi").BigInt(d));b.writeListEnd();b.writeFieldEnd()}if(a.stream_ids_with_lost_amendments!=null){b.writeFieldBegin({fname:"stream_ids_with_lost_amendments",ftype:(h||(h=c("ThriftTypes"))).LIST,fid:4});b.writeListBegin({etype:h.I64,size:a.stream_ids_with_lost_amendments.length});for(d of a.stream_ids_with_lost_amendments)b.writeI64(c("jsbi").BigInt(d));b.writeListEnd();b.writeFieldEnd()}if(a.stream_ids_with_wrong_status!=null){b.writeFieldBegin({fname:"stream_ids_with_wrong_status",ftype:(h||(h=c("ThriftTypes"))).LIST,fid:5});b.writeListBegin({etype:h.I64,size:a.stream_ids_with_wrong_status.length});for(d of a.stream_ids_with_wrong_status)b.writeI64(c("jsbi").BigInt(d));b.writeListEnd();b.writeFieldEnd()}b.writeFieldStop();b.writeStructEnd()}function x(a,b){b.writeStructBegin("StreamResponseDelta");if(a.flow_status!=null){var d;b.writeFieldBegin({fname:"flow_status",ftype:(h||(h=c("ThriftTypes"))).I32,fid:1});b.writeI32((d=a.flow_status)!=null?d:0);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.log!=null){b.writeFieldBegin({fname:"log",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:2});r(a.log,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.rewrite!=null){b.writeFieldBegin({fname:"rewrite",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:3});o(a.rewrite,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.data!=null){b.writeFieldBegin({fname:"data",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:4});q(a.data,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.termination!=null){b.writeFieldBegin({fname:"termination",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:5});s(a.termination,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.amend_ack!=null){b.writeFieldBegin({fname:"amend_ack",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:6});t(a.amend_ack,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}b.writeFieldStop();b.writeStructEnd()}function y(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).STRING?b.new_headers=a.readString():a.skip(e);break;case 2:e===(h||(h=c("ThriftTypes"))).STRING?b.new_body=a.readBinary():a.skip(e);break;case 3:e===(h||(h=c("ThriftTypes"))).STRING?b.patch_headers=a.readString():a.skip(e);break;case 4:e===(h||(h=c("ThriftTypes"))).BOOL?b.kill_body=a.readBool():a.skip(e);break;case 5:e===(h||(h=c("ThriftTypes"))).BOOL?b.temporary=a.readBool():a.skip(e);break;case 6:e===(h||(h=c("ThriftTypes"))).STRUCT?b.conditional_patch_headers=z(a):a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();return b}function z(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).STRING?b.expected_existing_headers=a.readString():a.skip(e);break;case 2:e===(h||(h=c("ThriftTypes"))).STRING?b.patch_headers_if_match=a.readString():a.skip(e);break;case 3:e===(h||(h=c("ThriftTypes"))).STRING?b.patch_headers_otherwise=a.readString():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();b.expected_existing_headers===void 0&&(b.expected_existing_headers="");b.patch_headers_if_match===void 0&&(b.patch_headers_if_match="");return b}function A(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).STRING?b.bytes=a.readBinary():a.skip(e);break;case 2:e===(h||(h=c("ThriftTypes"))).STRING?b.metadata=a.readString():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();b.bytes===void 0&&(b.bytes=Uint8Array.of());return b}function B(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).STRING?b.message=a.readString():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();b.message===void 0&&(b.message="");return b}function C(a){var b={};a.readStructBegin();while(!0){var e=a.readFieldBegin(),f=e.ftype;e=e.fid;if(f===(h||(h=c("ThriftTypes"))).STOP)break;switch(e){case 1:f===(h||(h=c("ThriftTypes"))).I32?b.reason=d("RequestStreamCommonRequestStreamCommonTypes").TerminationReason.cast(a.readI32()):a.skip(f);break;case 2:f===(h||(h=c("ThriftTypes"))).STRING?b.message=a.readString():a.skip(f);break;case 3:f===(h||(h=c("ThriftTypes"))).I64?b.retry_delay_ms=a.readI64().toString():a.skip(f);break;default:a.skip(f)}a.readFieldEnd()}a.readStructEnd();b.reason===void 0&&(b.reason=d("RequestStreamCommonRequestStreamCommonTypes").TerminationReason.cast(0));return b}function D(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).I64?b.amendment_id=a.readI64().toString():a.skip(e);break;case 2:e===(h||(h=c("ThriftTypes"))).BOOL?b.accepted=a.readBool():a.skip(e);break;case 3:e===(h||(h=c("ThriftTypes"))).STRING?b.result=a.readBinary():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();return b}function E(a){var b={};a.readStructBegin();while(!0){var e=a.readFieldBegin(),f=e.ftype;e=e.fid;if(f===(h||(h=c("ThriftTypes"))).STOP)break;switch(e){case 1:f===(h||(h=c("ThriftTypes"))).I64?b.stream_id=a.readI64().toString():a.skip(f);break;case 2:f===(h||(h=c("ThriftTypes"))).I32?b.last_sequencer=a.readI32():a.skip(f);break;case 4:f===(h||(h=c("ThriftTypes"))).I32?b.amendment_count=a.readI32():a.skip(f);break;case 3:f===(h||(h=c("ThriftTypes"))).I32?b.last_status=d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.cast(a.readI32()):a.skip(f);break;default:a.skip(f)}a.readFieldEnd()}a.readStructEnd();b.stream_id===void 0&&(b.stream_id="0");b.last_sequencer===void 0&&(b.last_sequencer=0);b.amendment_count===void 0&&(b.amendment_count=0);b.last_status===void 0&&(b.last_status=d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.cast(0));return b}function F(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).I64?b.caller_timestamp_ms=a.readI64().toString():a.skip(e);break;case 2:if(e===(h||(h=c("ThriftTypes"))).LIST){b.streams_to_check=[];d=a.readListBegin();for(var f=0;f<d.size;f++){var g=E(a);b.streams_to_check.push(g)}}else a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();b.caller_timestamp_ms===void 0&&(b.caller_timestamp_ms="0");return b}function G(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).I64?b.original_ping_timestamp_ms=a.readI64().toString():a.skip(e);break;case 2:if(e===(h||(h=c("ThriftTypes"))).LIST){b.stream_ids_missing=[];d=a.readListBegin();for(var f=0;f<d.size;f++){var g=a.readI64().toString();b.stream_ids_missing.push(g)}}else a.skip(e);break;case 3:if(e===(h||(h=c("ThriftTypes"))).LIST){b.stream_ids_behind=[];g=a.readListBegin();for(f=0;f<g.size;f++){d=a.readI64().toString();b.stream_ids_behind.push(d)}}else a.skip(e);break;case 4:if(e===(h||(h=c("ThriftTypes"))).LIST){b.stream_ids_with_lost_amendments=[];d=a.readListBegin();for(f=0;f<d.size;f++){g=a.readI64().toString();b.stream_ids_with_lost_amendments.push(g)}}else a.skip(e);break;case 5:if(e===(h||(h=c("ThriftTypes"))).LIST){b.stream_ids_with_wrong_status=[];g=a.readListBegin();for(f=0;f<g.size;f++){d=a.readI64().toString();b.stream_ids_with_wrong_status.push(d)}}else a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();b.original_ping_timestamp_ms===void 0&&(b.original_ping_timestamp_ms="0");return b}function H(a){var b,e={};a.readStructBegin();while(!0){var f=a.readFieldBegin(),g=f.ftype;f=f.fid;if(g===(h||(h=c("ThriftTypes"))).STOP)break;switch(f){case 1:if(g===(h||(h=c("ThriftTypes"))).I32)if(b==null)e.flow_status=d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.cast(a.readI32()),b="flow_status";else throw new Error("more than one field have been deserialized in union type: StreamResponseDelta; current field: flow_status, previous deserialized field: "+b);else a.skip(g);break;case 2:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.log=B(a),b="log";else throw new Error("more than one field have been deserialized in union type: StreamResponseDelta; current field: log, previous deserialized field: "+b);else a.skip(g);break;case 3:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.rewrite=y(a),b="rewrite";else throw new Error("more than one field have been deserialized in union type: StreamResponseDelta; current field: rewrite, previous deserialized field: "+b);else a.skip(g);break;case 4:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.data=A(a),b="data";else throw new Error("more than one field have been deserialized in union type: StreamResponseDelta; current field: data, previous deserialized field: "+b);else a.skip(g);break;case 5:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.termination=C(a),b="termination";else throw new Error("more than one field have been deserialized in union type: StreamResponseDelta; current field: termination, previous deserialized field: "+b);else a.skip(g);break;case 6:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.amend_ack=D(a),b="amend_ack";else throw new Error("more than one field have been deserialized in union type: StreamResponseDelta; current field: amend_ack, previous deserialized field: "+b);else a.skip(g);break;default:a.skip(g)}a.readFieldEnd()}a.readStructEnd();return e}g.ResponseRewriteRequest$DefaultConstructor=a;g.ResponseRewriteConditionalPatchHeaders$DefaultConstructor=b;g.ResponseData$DefaultConstructor=e;g.LogMessage$DefaultConstructor=f;g.Termination$DefaultConstructor=i;g.AmendStreamAck$DefaultConstructor=j;g.StreamCheck$DefaultConstructor=k;g.Ping$DefaultConstructor=l;g.Pong$DefaultConstructor=m;g.StreamResponseDelta$DefaultConstructor=n;g.serializeResponseRewriteRequest=o;g.serializeResponseRewriteConditionalPatchHeaders=p;g.serializeResponseData=q;g.serializeLogMessage=r;g.serializeTermination=s;g.serializeAmendStreamAck=t;g.serializeStreamCheck=u;g.serializePing=v;g.serializePong=w;g.serializeStreamResponseDelta=x;g.deserializeResponseRewriteRequest=y;g.deserializeResponseRewriteConditionalPatchHeaders=z;g.deserializeResponseData=A;g.deserializeLogMessage=B;g.deserializeTermination=C;g.deserializeAmendStreamAck=D;g.deserializeStreamCheck=E;g.deserializePing=F;g.deserializePong=G;g.deserializeStreamResponseDelta=H}),98);
__d("RequestStreamSingleChannelSingleChannelRequestStreamTypes",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({Ignored:100,Success:200,Queued:250,UnknownStream:400,HandledUnknownResult:450,Failure:500});c=b("$InternalEnum")({Request_headers:"request_headers",Request_body:"request_body",Amend:"amend",Ack:"ack",Response:"response",Ping:"ping",Pong:"pong"});e.exports={Ack:a,Payload$Types:c}}),null);
__d("RequestStreamSingleChannelSingleChannelRequestStreamSerializers",["RequestStreamCommonRequestStreamCommonSerializers","RequestStreamCommonRequestStreamCommonTypes","RequestStreamSingleChannelSingleChannelRequestStreamTypes","ThriftTypes","jsbi"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return{}}function b(){return{body:Uint8Array.of()}}function e(){return{amendment:Uint8Array.of()}}function f(){return{ack:d("RequestStreamSingleChannelSingleChannelRequestStreamTypes").Ack.cast(0)}}function i(){return{delta:[]}}function j(){return{}}function k(a,b){b.writeStructBegin("RequestStreamHeaders"),a.headers!=null&&(b.writeFieldBegin({fname:"headers",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:1}),b.writeBinary(a.headers),b.writeFieldEnd()),a.instrumentation_data!=null&&(b.writeFieldBegin({fname:"instrumentation_data",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:2}),b.writeBinary(a.instrumentation_data),b.writeFieldEnd()),b.writeFieldStop(),b.writeStructEnd()}function l(a,b){b.writeStructBegin("RequestStreamBody");b.writeFieldBegin({fname:"body",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:1});if(a.body!=null)b.writeBinary(a.body);else{a=Uint8Array.of();b.writeBinary(a)}b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd()}function m(a,b){b.writeStructBegin("AmendStream");a.amendment_id!=null&&(b.writeFieldBegin({fname:"amendment_id",ftype:(h||(h=c("ThriftTypes"))).I64,fid:1}),b.writeI64(c("jsbi").BigInt(a.amendment_id)),b.writeFieldEnd());b.writeFieldBegin({fname:"amendment",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:2});if(a.amendment!=null)b.writeBinary(a.amendment);else{var d=Uint8Array.of();b.writeBinary(d)}b.writeFieldEnd();a.is_query!=null&&(b.writeFieldBegin({fname:"is_query",ftype:(h||(h=c("ThriftTypes"))).BOOL,fid:3}),b.writeBool(a.is_query),b.writeFieldEnd());a.instrumentation_data!=null&&(b.writeFieldBegin({fname:"instrumentation_data",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:4}),b.writeBinary(a.instrumentation_data),b.writeFieldEnd());b.writeFieldStop();b.writeStructEnd()}function n(a,b){b.writeStructBegin("StreamResponseAck");a.response_id!=null&&(b.writeFieldBegin({fname:"response_id",ftype:(h||(h=c("ThriftTypes"))).I64,fid:1}),b.writeI64(c("jsbi").BigInt(a.response_id)),b.writeFieldEnd());b.writeFieldBegin({fname:"ack",ftype:(h||(h=c("ThriftTypes"))).I32,fid:2});if(a.ack!=null){var e;b.writeI32((e=a.ack)!=null?e:0)}else{e=d("RequestStreamSingleChannelSingleChannelRequestStreamTypes").Ack.cast(0);b.writeI32(e!=null?e:0)}b.writeFieldEnd();a.query_result!=null&&(b.writeFieldBegin({fname:"query_result",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:3}),b.writeBinary(a.query_result),b.writeFieldEnd());b.writeFieldStop();b.writeStructEnd()}function o(a,b){b.writeStructBegin("StreamResponse");a.response_id!=null&&(b.writeFieldBegin({fname:"response_id",ftype:(h||(h=c("ThriftTypes"))).I64,fid:1}),b.writeI64(c("jsbi").BigInt(a.response_id)),b.writeFieldEnd());b.writeFieldBegin({fname:"delta",ftype:(h||(h=c("ThriftTypes"))).LIST,fid:2});if(a.delta!=null){b.writeListBegin({etype:(h||(h=c("ThriftTypes"))).STRUCT,size:a.delta.length});for(var e of a.delta)d("RequestStreamCommonRequestStreamCommonSerializers").serializeStreamResponseDelta(e,b);b.writeListEnd()}else{e=[];b.writeListBegin({etype:(h||(h=c("ThriftTypes"))).STRUCT,size:e.length});for(e of e)d("RequestStreamCommonRequestStreamCommonSerializers").serializeStreamResponseDelta(e,b);b.writeListEnd()}b.writeFieldEnd();if(a.ack_level!=null){b.writeFieldBegin({fname:"ack_level",ftype:(h||(h=c("ThriftTypes"))).I32,fid:3});b.writeI32((e=a.ack_level)!=null?e:0);b.writeFieldEnd()}a.query_request!=null&&(b.writeFieldBegin({fname:"query_request",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:4}),b.writeBinary(a.query_request),b.writeFieldEnd());a.instrumentation_data!=null&&(b.writeFieldBegin({fname:"instrumentation_data",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:5}),b.writeBinary(a.instrumentation_data),b.writeFieldEnd());b.writeFieldStop();b.writeStructEnd()}function p(a,b){b.writeStructBegin("Payload");if(a.request_headers!=null){b.writeFieldBegin({fname:"request_headers",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:1});k(a.request_headers,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.request_body!=null){b.writeFieldBegin({fname:"request_body",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:2});l(a.request_body,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.amend!=null){b.writeFieldBegin({fname:"amend",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:3});m(a.amend,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.ack!=null){b.writeFieldBegin({fname:"ack",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:4});n(a.ack,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.response!=null){b.writeFieldBegin({fname:"response",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:5});o(a.response,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.ping!=null){b.writeFieldBegin({fname:"ping",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:6});d("RequestStreamCommonRequestStreamCommonSerializers").serializePing(a.ping,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.pong!=null){b.writeFieldBegin({fname:"pong",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:7});d("RequestStreamCommonRequestStreamCommonSerializers").serializePong(a.pong,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}b.writeFieldStop();b.writeStructEnd()}function q(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).STRING?b.headers=a.readBinary():a.skip(e);break;case 2:e===(h||(h=c("ThriftTypes"))).STRING?b.instrumentation_data=a.readBinary():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();return b}function r(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).STRING?b.body=a.readBinary():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();b.body===void 0&&(b.body=Uint8Array.of());return b}function s(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).I64?b.amendment_id=a.readI64().toString():a.skip(e);break;case 2:e===(h||(h=c("ThriftTypes"))).STRING?b.amendment=a.readBinary():a.skip(e);break;case 3:e===(h||(h=c("ThriftTypes"))).BOOL?b.is_query=a.readBool():a.skip(e);break;case 4:e===(h||(h=c("ThriftTypes"))).STRING?b.instrumentation_data=a.readBinary():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();b.amendment===void 0&&(b.amendment=Uint8Array.of());return b}function t(a){var b={};a.readStructBegin();while(!0){var e=a.readFieldBegin(),f=e.ftype;e=e.fid;if(f===(h||(h=c("ThriftTypes"))).STOP)break;switch(e){case 1:f===(h||(h=c("ThriftTypes"))).I64?b.response_id=a.readI64().toString():a.skip(f);break;case 2:f===(h||(h=c("ThriftTypes"))).I32?b.ack=d("RequestStreamSingleChannelSingleChannelRequestStreamTypes").Ack.cast(a.readI32()):a.skip(f);break;case 3:f===(h||(h=c("ThriftTypes"))).STRING?b.query_result=a.readBinary():a.skip(f);break;default:a.skip(f)}a.readFieldEnd()}a.readStructEnd();b.ack===void 0&&(b.ack=d("RequestStreamSingleChannelSingleChannelRequestStreamTypes").Ack.cast(0));return b}function u(a){var b={};a.readStructBegin();while(!0){var e=a.readFieldBegin(),f=e.ftype;e=e.fid;if(f===(h||(h=c("ThriftTypes"))).STOP)break;switch(e){case 1:f===(h||(h=c("ThriftTypes"))).I64?b.response_id=a.readI64().toString():a.skip(f);break;case 2:if(f===(h||(h=c("ThriftTypes"))).LIST){b.delta=[];e=a.readListBegin();for(var g=0;g<e.size;g++){var i=d("RequestStreamCommonRequestStreamCommonSerializers").deserializeStreamResponseDelta(a);b.delta.push(i)}}else a.skip(f);break;case 3:f===(h||(h=c("ThriftTypes"))).I32?b.ack_level=d("RequestStreamCommonRequestStreamCommonTypes").AckLevel.cast(a.readI32()):a.skip(f);break;case 4:f===(h||(h=c("ThriftTypes"))).STRING?b.query_request=a.readBinary():a.skip(f);break;case 5:f===(h||(h=c("ThriftTypes"))).STRING?b.instrumentation_data=a.readBinary():a.skip(f);break;default:a.skip(f)}a.readFieldEnd()}a.readStructEnd();b.delta===void 0&&(b.delta=[]);return b}function v(a){var b,e={};a.readStructBegin();while(!0){var f=a.readFieldBegin(),g=f.ftype;f=f.fid;if(g===(h||(h=c("ThriftTypes"))).STOP)break;switch(f){case 1:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.request_headers=q(a),b="request_headers";else throw new Error("more than one field have been deserialized in union type: Payload; current field: request_headers, previous deserialized field: "+b);else a.skip(g);break;case 2:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.request_body=r(a),b="request_body";else throw new Error("more than one field have been deserialized in union type: Payload; current field: request_body, previous deserialized field: "+b);else a.skip(g);break;case 3:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.amend=s(a),b="amend";else throw new Error("more than one field have been deserialized in union type: Payload; current field: amend, previous deserialized field: "+b);else a.skip(g);break;case 4:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.ack=t(a),b="ack";else throw new Error("more than one field have been deserialized in union type: Payload; current field: ack, previous deserialized field: "+b);else a.skip(g);break;case 5:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.response=u(a),b="response";else throw new Error("more than one field have been deserialized in union type: Payload; current field: response, previous deserialized field: "+b);else a.skip(g);break;case 6:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.ping=d("RequestStreamCommonRequestStreamCommonSerializers").deserializePing(a),b="ping";else throw new Error("more than one field have been deserialized in union type: Payload; current field: ping, previous deserialized field: "+b);else a.skip(g);break;case 7:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.pong=d("RequestStreamCommonRequestStreamCommonSerializers").deserializePong(a),b="pong";else throw new Error("more than one field have been deserialized in union type: Payload; current field: pong, previous deserialized field: "+b);else a.skip(g);break;default:a.skip(g)}a.readFieldEnd()}a.readStructEnd();return e}g.RequestStreamHeaders$DefaultConstructor=a;g.RequestStreamBody$DefaultConstructor=b;g.AmendStream$DefaultConstructor=e;g.StreamResponseAck$DefaultConstructor=f;g.StreamResponse$DefaultConstructor=i;g.Payload$DefaultConstructor=j;g.serializeRequestStreamHeaders=k;g.serializeRequestStreamBody=l;g.serializeAmendStream=m;g.serializeStreamResponseAck=n;g.serializeStreamResponse=o;g.serializePayload=p;g.deserializeRequestStreamHeaders=q;g.deserializeRequestStreamBody=r;g.deserializeAmendStream=s;g.deserializeStreamResponseAck=t;g.deserializeStreamResponse=u;g.deserializePayload=v}),98);
__d("RequestStreamState",["RequestStreamCommonRequestStreamCommonTypes"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){switch(b){case d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Accepted:if(a.seenAccepted)return a;return a.flowStatus===d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Started?a:{flowStatus:d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Accepted,seenAccepted:!0};default:if(!a.seenAccepted||a.flowStatus===b)return a;else return{flowStatus:b,seenAccepted:!0}}}g.getNextState=a}),98);
__d("StreamRetryState",[],(function(a,b,c,d,e,f){"use strict";var g=1e3,h=2*60*1e3;a=function(){function a(){this.$1=0}var b=a.prototype;b.resetErrorAndRetryCount=function(){this.$1=0};b.onRetry=function(){this.$1+=1};b.getRetryCount=function(){return this.$1};b.getBackoffDelayMs=function(){if(this.$1<=1)return 0;if(this.$1===2)return g*Math.random();var a=g*Math.pow(2,this.$1-3),b=a*Math.random();a=a+b;return Math.min(a,h)};return a}();f["default"]=a}),66);
__d("DGWRequestStreamRef",["CompactSerializerPolyfill","DGWRequestStreamUtils","DGWStream","DGWStreamHandler","InflightAmends","ODS","RequestStreamCloseReason","RequestStreamCommonRequestStreamCommonTypes","RequestStreamE2EClientLoggerEvent","RequestStreamE2EClientLoggerMessageType","RequestStreamE2ELogger","RequestStreamE2ESampling","RequestStreamSingleChannelSingleChannelRequestStreamSerializers","RequestStreamSingleChannelSingleChannelRequestStreamTypes","RequestStreamState","RequestStreamTransport","RtiWebRequestStreamClient","StreamRetryState","err","gkx","justknobx","qex"],(function(a,b,c,d,e,f,g){"use strict";var h,i=4,j=0,k=1e3,l=2,m=c("gkx")("20915")?3e4:5e3,n="dgw_stream_send_ack_failure",o=(a=c("qex")._("2097"))!=null?a:!1,p=(b=c("qex")._("2100"))!=null?b:!1;function q(a){if(!a){a=c("err")(n);a.stack;throw a}}function r(a,b){if(a==null||a.length===0)return null;a=JSON.parse(a);a.auxId=b;return new TextEncoder().encode(JSON.stringify(a))}function s(a){var b={};a=a.delta;a.forEach(function(a){if(a.flow_status){b.type=d("RequestStreamCommonRequestStreamCommonTypes").StreamResponseDelta$Types.Flow_status;switch(a.flow_status){case d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Accepted:b.flow_status="Accepted";break;case d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Started:b.flow_status="Started";break;case d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Stopped:b.flow_status="Stopped";break}}else a.log?b.type=d("RequestStreamCommonRequestStreamCommonTypes").StreamResponseDelta$Types.Log:a.rewrite?b.type=d("RequestStreamCommonRequestStreamCommonTypes").StreamResponseDelta$Types.Rewrite:a.data?b.type=d("RequestStreamCommonRequestStreamCommonTypes").StreamResponseDelta$Types.Data:a.termination?b.type=d("RequestStreamCommonRequestStreamCommonTypes").StreamResponseDelta$Types.Termination:a.amend_ack&&(b.type=d("RequestStreamCommonRequestStreamCommonTypes").StreamResponseDelta$Types.Amend_ack)});return b}e=function(){function a(a,b,e,f,g,h){var j=this,k;this.$6=null;this.$7={};this.$10=!1;this.$15=new(c("StreamRetryState"))();this.$16=0;this.$17=0;this.$18=0;this.$21=0;var l=null;typeof b==="string"?l=new TextEncoder().encode(b):typeof b==="object"&&(l=b);this.$1={headers:a,body:l};this.$3=e;this.$4=f;this.$12=i;this.$9=!1;this.$14=!1;this.$20=h;l=f==null?void 0:f.serviceId;g!=null&&(this.$22()||(g.dgwStreamGroupLoggingId=this.$20.getStreamGroupLoggingId(l)),g.dgwCountPriorStreamsInGroup=this.$20.guessStreamGroupPriorStreamCount(l),g.transport="WEB_RS_STARGATE");this.$5=d("RequestStreamE2ESampling").validateInstrumentationData(a,g,f==null?void 0:f.requestLogContext,f==null?void 0:f.upsampleMultiplier);!this.$22()?this.$6=d("RequestStreamE2ELogger").createStreamLogger(a,this.$5,d("RequestStreamTransport").RequestStreamTransport.WEB_RS_STARGATE):this.$7.disableFalcoLogging=!0;(f==null?void 0:f.deviceId)!=null&&(this.$7.deviceId=f.deviceId);this.$6&&(this.$7.loggingId=this.$6.getRequestId());f&&f.overrideUrl!=null&&(this.$7.overrideUrl=f.overrideUrl);l!=null&&(this.$7.serviceId=l);this.$8={flowStatus:d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Stopped,seenAccepted:!1};this.$19=new(c("InflightAmends"))(m,function(a,b){var d;(d=j.$6)==null||d.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT_ACK,c("RequestStreamE2EClientLoggerEvent").RECEIVED,babelHelpers.extends({},j.$23(),{latency:b.toString()}),a)},function(a,b){if(b.message!==n){var d;(d=j.$6)==null||d.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT_ACK,c("RequestStreamE2EClientLoggerEvent").FAILURE,babelHelpers.extends({},j.$23(),{reason:b.message}),a)}});(e=this.$6)==null||e.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").RECEIVED,{data_size:(h=b==null||(k=b.length)==null?void 0:k.toString())!=null?h:"0"},"0","0")}var b=a.prototype;b.getInstrumentationData=function(){return this.$5};b.getE2EClientLogger=function(){return this.$6};b.amendWithAck=function(a){a=this.$24(a,!0);return a==null?Promise.resolve(!1):this.$19.getPromise(a)||Promise.resolve(!1)};b.amendWithoutAck=function(a){this.$24(a,!1)};b.cancel=function(){var a;(a=this.$6)==null||a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").CANCEL,c("RequestStreamE2EClientLoggerEvent").RECEIVED);this.$9=!0;this.$25(d("RequestStreamCloseReason").RequestStreamCloseReason.UserIntention,"user cancel the stream",!0)};b.start=function(a){var b=this;a===void 0&&(a=!1);var e=String(this.$16++),f=Date.now();return this.$26(e).then(function(){var a;b.$14=!1;b.$21=0;var d=(Date.now()-f).toString();(a=b.$6)==null||a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").PUBACK,{latency:d},e,String(b.$18))}).catch(function(f){f.stack;if(f.message===n&&b.$10)return;b.$14=!1;if(f!==d("DGWStream").StreamError.ESTABLISHMENT_ERROR){var g,h=f.message;f===d("DGWStream").StreamError.UNAUTHENTICATED?h="UNAUTHENTICATED":f===d("DGWStream").StreamError.UNAUTHORIZED&&(h="UNAUTHORIZED");(g=b.$6)==null||g.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:h},e,String(b.$18));b.$25(a?d("RequestStreamCloseReason").RequestStreamCloseReason.ReestablishError:d("RequestStreamCloseReason").RequestStreamCloseReason.StartStreamFailure,h,!0);if(f===d("DGWStream").StreamError.UNAUTHENTICATED||f===d("DGWStream").StreamError.UNAUTHORIZED)return;throw f}else{(g=b.$6)==null||g.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:(h=f.message)!=null?h:f},e,String(b.$18));b.$15.onRetry();var i=c("gkx")("20916")?b.$15.getBackoffDelayMs():k*Math.pow(l,b.$21);return new Promise(function(a){return window.setTimeout(a,i)}).then(function(){b.$21++;b.$18++;return b.start()})}})};b.getFlowStatus=function(){return this.$8.flowStatus};b.shouldTerminateOrRetry=function(a,b,e,f){var g=this;if(this.$14)return;var h=b;this.$12||(h="cannot retry for error: "+b+" because of hit max retry limitation");if(a!==d("RequestStreamCloseReason").RequestStreamCloseReason.ClientError){(b=this.$6)==null||b.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:h},null,String(this.$18))}b=e&&(c("gkx")("20916")||this.$12);this.$25(a,h,!b);if(b){var i=c("gkx")("20916")?Math.max(f!=null?f:0,this.$15.getBackoffDelayMs()):f!=null?f:j;this.$14=!0;return new Promise(function(a){return window.setTimeout(a,i)}).then(function(){return g.$27()}).catch(function(a){})}};b.$28=function(){return this.$11!=null};b.$24=function(a,b){var e,f=this,g=typeof a==="string"?new TextEncoder().encode(a):a,h=String(this.$17++);(e=this.$6)==null||e.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").RECEIVED,{},h);e=r(this.$5,h);g={amend:{amendment:g,instrumentation_data:e}};b&&g.amend&&(g.amend.amendment_id=h);e=d("CompactSerializerPolyfill").serialize(g,d("RequestStreamSingleChannelSingleChannelRequestStreamSerializers").serializePayload);var i=Date.now();if(this.$29()&&this.$11!=null){var j;b&&this.$19.add(h);this.$11.send(e).then(function(a){var b;q(a);a=(Date.now()-i).toString();(b=f.$6)==null||b.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").PUBACK,{latency:a},h)}).catch(function(a){var b;(b=f.$6)==null||b.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:a.message},h);f.$19.reject(h,a)});(g=this.$6)==null||g.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").SENT,{data_size:(b=a==null||(j=a.length)==null?void 0:j.toString())!=null?b:"0"},h);return h}else{(e=this.$6)==null||e.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:"not_started"},h)}};b.$26=async function(a){var b=this;if(!this.$9){var e=this.$2||this.$1;try{var f=this.$30();this.$13=f;var g=e.headers.graphiql_sandbox,h=babelHelpers.extends({},e.headers,this.$31());g!=null&&(h=babelHelpers.extends({},h,{www_sandbox:g,distillery_sandbox:g+":8086"}));g=d("DGWRequestStreamUtils").convertHeaders(h,e.body!=null,this.$5);this.$11=await this.$20.establishStream(g,f,this.$7)}catch(a){if(a===d("DGWStream").StreamError.ESTABLISHMENT_ERROR)throw a;if(d("DGWStream").StreamError.isValid(a)&&!d("DGWStream").isRetryableError(a))throw a;else if(d("DGWStream").StreamError.isValid(a)&&d("DGWStream").isRetryableError(a)){this.$32(a);return}throw a}if(this.$9){this.$25(d("RequestStreamCloseReason").RequestStreamCloseReason.UserIntention,"user cancel the stream",!0);return}h=new Uint8Array([]);if(e.body!=null){g={request_body:{body:e.body}};h=d("CompactSerializerPolyfill").serialize(g,d("RequestStreamSingleChannelSingleChannelRequestStreamSerializers").serializePayload)}if(!this.$11)throw new Error("dgwstream_is_null");f=this.$11.send(h).then(function(a){q(a),b.$9&&b.$25(d("RequestStreamCloseReason").RequestStreamCloseReason.UserIntention,"user cancel the stream",!0)});(e=this.$6)==null||e.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").SENT,{},a,String(this.$18));this.$12=i;return f}else throw new Error("stream_already_canceled")};b.$29=function(){return this.$8.flowStatus===d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Started||this.$8.flowStatus===d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Accepted};b.$25=function(a,b,c){var e;this.$11&&a!==d("RequestStreamCloseReason").RequestStreamCloseReason.StreamError&&a!==d("RequestStreamCloseReason").RequestStreamCloseReason.RemoteTermination&&this.$11.close();(e=this.$13)==null||e.stop();this.$11=null;this.$10=!0;this.$33(d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Stopped)&&this.$3.onFlowStatus(d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Stopped);c&&!this.$9&&this.$3.onTermination("terminate stream because "+a+" with msg : "+b)};b.$33=function(a){var b=this.$8;this.$8=d("RequestStreamState").getNextState(b,a);return b!==this.$8};b.$27=function(){this.$12--;this.$18++;this.$15.onRetry();return this.start(!0)};b.$34=function(a){var b=this;a=d("CompactSerializerPolyfill").deserialize(a,d("RequestStreamSingleChannelSingleChannelRequestStreamSerializers").deserializePayload);if(a.response){var e=d("DGWRequestStreamUtils").getInstrumentationDataFieldsFromPayload(a),f=e==null?void 0:e.auxId;e=e==null?void 0:e.dfTraceId;if(!this.$28()){var g;(g=this.$6)==null||g.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").RESPONSE,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:"response_received_after_close"},f,String(this.$18),e);return}var i;(g=this.$6)==null||g.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").RESPONSE,c("RequestStreamE2EClientLoggerEvent").RECEIVED,s(a.response),f,String(this.$18),e,i);g=a.response.delta;g.forEach(function(a){if(a.data)b.$15.resetErrorAndRetryCount(),c("justknobx")._("4109")?b.$3.onData(new TextDecoder("utf-8").decode(a.data.bytes)):b.$8.flowStatus===d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Started?b.$3.onData(new TextDecoder("utf-8").decode(a.data.bytes)):(h||(h=d("ODS"))).bumpEntityKey(110,"RequestStream","data_before_started_"+(b.$22()?"falco":"graphql"));else if(a.flow_status){var e=a.flow_status;e===d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Started&&b.$15.resetErrorAndRetryCount();b.$33(e)&&b.$3.onFlowStatus(e)}else if(a.termination){e=(e=a.termination.message)!=null?e:"unknown termination msg";b.$2=null;b.shouldTerminateOrRetry(d("RequestStreamCloseReason").RequestStreamCloseReason.RemoteTermination,e,a.termination.reason===d("RequestStreamCommonRequestStreamCommonTypes").TerminationReason.TryAgain,a.termination.retry_delay_ms!=null?parseInt(a.termination.retry_delay_ms,10):null)}else if(a.log)b.$3.onLog(a.log.message);else if(a.amend_ack){e=a.amend_ack.amendment_id;if(e!=null){var f=a.amend_ack.accepted||!1;b.$19.resolve(e,f)}}else if(a.rewrite){e=d("DGWRequestStreamUtils").transformContextWithRewriteDelta(b.$1,a.rewrite);a.rewrite.temporary===!0?b.$2=e:b.$1=e}});(g=this.$6)==null||g.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").RESPONSE,c("RequestStreamE2EClientLoggerEvent").SENT,s(a.response),f,String(this.$18),e);a.response.ack_level===d("RequestStreamCommonRequestStreamCommonTypes").AckLevel.Device&&a.response.response_id!=null&&this.$35(a.response.response_id,f)}else{(g=this.$6)==null||g.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").RESPONSE,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:"unexpected_payload_type"},null,String(this.$18))}};b.$35=function(a,b){a={ack:{response_id:a,ack:d("RequestStreamSingleChannelSingleChannelRequestStreamTypes").Ack.Success}};a=d("CompactSerializerPolyfill").serialize(a,d("RequestStreamSingleChannelSingleChannelRequestStreamSerializers").serializePayload);if(this.$11!=null){this.$11.send(a);(a=this.$6)==null||a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").RESPONSE_ACK,c("RequestStreamE2EClientLoggerEvent").SENT,{},b,String(this.$18))}else{(a=this.$6)==null||a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").RESPONSE_ACK,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:"not_started"},b,String(this.$18))}};b.$22=function(){return this.$1.headers.method==="Falco"};b.$30=function(){return new(c("DGWStreamHandler"))(this.$36.bind(this),this.$37.bind(this),this.$32.bind(this),this.$38.bind(this),this.$39.bind(this))};b.$39=function(a){(a=this.$6)==null||a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:"OnClose: Server Has FinishedSendingData"},null,String(this.$18));this.$25(d("RequestStreamCloseReason").RequestStreamCloseReason.ServerDataEnd,"Client receive OnServerHasFinishedSendingData and Server will not send more data",!0)};b.$36=function(a){(a=this.$6)==null||a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:"OnClose: Server Close Connection"},null,String(this.$18));this.$25(d("RequestStreamCloseReason").RequestStreamCloseReason.RemoteTermination,"Client receive OnClose and Server will not send more data",!0)};b.$37=function(a){try{this.$34(a)}catch(b){(a=this.$6)==null||a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").RESPONSE,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:b.message},null,String(this.$18));this.shouldTerminateOrRetry(d("RequestStreamCloseReason").RequestStreamCloseReason.ClientError,b.message,!1)}};b.$32=function(a){var b="",c=d("DGWStream").isRetryableError(a);b="StreamError: Received "+a;a=o?this.$12>0:c;c=p?k*l:void 0;this.shouldTerminateOrRetry(d("RequestStreamCloseReason").RequestStreamCloseReason.StreamError,b,a,c)};b.$38=function(a,b){this.shouldTerminateOrRetry(d("RequestStreamCloseReason").RequestStreamCloseReason.ServerDrain,b,!0)};b.$31=function(){return c("RtiWebRequestStreamClient").overrideHeaders};b.$23=function(){var a={};c("gkx")("20918")&&(a.pending_amendments_size=this.$19.getSize().toString());return a};return a}();g.default=e}),98);
__d("DGWRequestStreamClient",["DGWRequestStreamRef","DGWStreamFactory","Promise","cr:2046346"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){function a(a){this.$1=a!=null?a:c("DGWStreamFactory").get()}var d=a.prototype;d.createStream=function(a,d,e,f,g){b("cr:2046346")!=null&&b("cr:2046346").startPulsarTest();return(h||(h=b("Promise"))).resolve(new(c("DGWRequestStreamRef"))(a,d,f,g,e,this.$1))};return a}();g["default"]=a}),98);
__d("cometComposerQPLLogger",["QPLUserFlow","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a.type){case"COMPOSER_ENTRY":break;case"COMPOSER_FEATURE_INTENT":break;case"COMPOSER_POST":break;case"COMPOSER_POST_MUTATION_START":break;case"COMPOSER_POST_SUCCESS":h(a.fields);break;case"COMPOSER_POST_FAILURE":i(a.fields);break;case"COMPOSER_POST_CANCEL":j(a.fields);break;case"COMPOSER_POST_TERMINAL":break;case"COMPOSER_POST_SERVER_CONTENT_RENDERED":break;case"COMPOSER_PUBLISH_FLOW_OPTIMISTIC_PROCESS":break;default:break}}function h(a){a=(a=a.payload)==null?void 0:a.qplEvent;if(a!=null)switch(a){case c("qpl")._(37631558,"4977"):c("QPLUserFlow").addPoint(c("qpl")._(37631558,"4977"),"composer_post_success");c("QPLUserFlow").endSuccess(c("qpl")._(37631558,"4977"));break;default:break}}function i(a){var b;b=(b=a.payload)==null?void 0:b.qplEvent;if(b!=null){a=a.errorDescription!=null?a.errorDescription:"";switch(b){case c("qpl")._(37631558,"4977"):c("QPLUserFlow").endFailure(c("qpl")._(37631558,"4977"),"composer_post_cancel",{debugInfo:a});break;default:break}}}function j(a){a=(a=a.payload)==null?void 0:a.qplEvent;if(a!=null)switch(a){case c("qpl")._(37631558,"4977"):c("QPLUserFlow").addPoint(c("qpl")._(37631558,"4977"),"composer_post_cancel");c("QPLUserFlow").endCancel(c("qpl")._(37631558,"4977"));break;default:break}}g["default"]=a}),98);/*FB_PKG_DELIM*/
__d("EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="30303731999218226"}),null);
__d("EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery.graphql",["EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={defaultValue:null,kind:"LocalArgument",name:"request_uuid"},c={defaultValue:null,kind:"LocalArgument",name:"virtual_device_id"},d={alias:null,args:null,kind:"ScalarField",name:"epoch_id",storageKey:null},e={alias:null,args:null,kind:"ScalarField",name:"epoch_anon_id",storageKey:null},f={alias:null,args:null,concreteType:"FetchVirtualDeviceInfoMinosEpochSerializablePayload",kind:"LinkedField",name:"minos_epoch",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"epoch_head",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"self_epoch_signature",storageKey:null}],storageKey:null};d=[{alias:null,args:[{fields:[{kind:"Variable",name:"request_uuid",variableName:"request_uuid"},{kind:"Variable",name:"virtual_device_id",variableName:"virtual_device_id"}],kind:"ObjectValue",name:"request"}],concreteType:"FetchVirtualDeviceInfoResponseWrapper",kind:"LinkedField",name:"fetch_virtual_device_info_for_device_addition_v2",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},{alias:null,args:null,concreteType:"FetchVirtualDeviceInfoError",kind:"LinkedField",name:"error",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"code",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"FetchVirtualDeviceInfoResponse",kind:"LinkedField",name:"data",plural:!1,selections:[{alias:null,args:null,concreteType:"FetchVirtualDeviceInfoEncryptedSecretValues",kind:"LinkedField",name:"encrypted_secret_values",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"encrypted_epoch_anon_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_epoch_root_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_epoch_storage_private_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_mailbox_root_key_blob",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_oblivious_validation_token_blob",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_ocmf_client_state",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_orf_client_state_v2",storageKey:null}],storageKey:null},d,{alias:null,args:null,kind:"ScalarField",name:"epoch_storage_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_epoch_id",storageKey:null},{alias:null,args:null,concreteType:"FetchVirtualDeviceInfoSyncEpochsPayload",kind:"LinkedField",name:"sync_epochs",plural:!0,selections:[d,{alias:null,args:null,kind:"ScalarField",name:"encrypted_epoch_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_id",storageKey:null},e,{alias:null,args:null,kind:"ScalarField",name:"epoch_auth_public_key",storageKey:null},{alias:null,args:null,concreteType:"FetchVirtualDeviceInfoEpochDataSerializablePayload",kind:"LinkedField",name:"epoch_data_v2",plural:!1,selections:[e,{alias:null,args:null,kind:"ScalarField",name:"epoch_root_key",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_active_epoch",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_epoch_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"prev_epoch_id",storageKey:null},f],storageKey:null},f],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[a,c],kind:"Fragment",metadata:null,name:"EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery",selections:d,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[c,a],kind:"Operation",name:"EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery",selections:d},params:{id:b("EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery_facebookRelayOperation"),metadata:{},name:"EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("EBGetLSVirtualDevices",["ReQL"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.encrypted_backups_virtual_devices))}g.getLSVirtualDevices=a}),98);
__d("LSHandleWrongRecoveryCode",["LSAppendDataTraceAddon","LSIsMobileClient","LSLogMebClientEvent.nop","LSQplAnnotateString.nop","LSQplMarkPoint.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure] Beginning execution."),a[0]!==void 0?c.nativeOperation(b("LSQplMarkPoint.nop"),c.i64.cast([0,1021646192]),a[0],"dasm_handle_wrong_recovery_code_sproc_start"):c.resolve()},function(d){return a[0]!==void 0?a[1]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,1021646192]),a[0],"dasm_handle_wrong_recovery_code_error_message",a[1]):c.resolve():c.resolve()},function(e){return c.sequence([function(d){return a[0]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[0],c.i64.cast([0,1415]),c.i64.cast([0,2]),a[1],void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[7]=a[0],a})},function(a){return d[7]?d[8]=!0:d[8]=!1,d[8]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[10]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[10]].join("")),d[9]=c.createArray(),void 0!==void 0?d[11]=(d[9].push(void 0),d[9]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[10],d[9],c.i64.cast([0,3]))):c.resolve()}])},function(a){return c.db.table(178).put({pk:c.i64.cast([0,1]),recoveryCodeStatus:c.i64.cast([0,3])})},function(e){return a[2]?c.resolve(0):a[1]!==void 0?(function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure] ","",a[1]].join("")),d[7]=c.createArray(),void 0!==void 0?d[8]=(d[7].push(void 0),d[7]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure",a[1],d[7],c.i64.cast([0,3]))):c.resolve()},function(d){return a[0]!==void 0?c.nativeOperation(b("LSQplMarkPoint.nop"),c.i64.cast([0,1021646192]),a[0],"dasm_handle_wrong_recovery_code_sproc_end"):c.resolve()},function(a){return d[1]=c.i64.of_float(Date.now()),d[2]=c.i64.random(),d[4]="Finishing execution. Execution time: ",d[5]=c.i64.to_string(c.i64.sub(d[1],d[0])),d[6]=" ms",d[3]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure] ",d[3],d[4],d[3],d[5],d[3],d[6]].join("")),c.i64.eq(c.i64.mod_(d[2],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[7]=",",d[8]=c.createArray(),void 0!==void 0?d[9]=(d[8].push(void 0),d[8]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure",[d[4],d[7],d[5],d[7],d[6]].join(""),d[8],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsHandleWrongRecoveryCodeStoredProcedure";a.__tables__=["secure_encrypted_backups_recovery_code_status"];e.exports=a}),null);
__d("LSIsValidEpochAnonIdFlow",[],(function(a,b,c,d,e,f){"use strict";var g=11;function a(a){if(a.byteLength>g)return!1;a=new Int8Array(a);var b=0;for(var c=0;c<a.length;c++)b|=+(a[c]<48),b|=+(a[c]>57);return b===0}f.call=a}),66);
__d("LSIsValidEpochAnonId.nop",["LSIsValidEpochAnonIdFlow","LSResult","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,e,f){return(h||(h=b("Promise"))).resolve(c("LSResult")(d("LSIsValidEpochAnonIdFlow").call(f)))};a.__nop_name__="LSIsValidEpochAnonId";g["default"]=a}),98);
__d("LSAddDeviceWithVirtualDeviceAndDecryptionKey",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Decode.nop","LSBase64Encode.nop","LSCreateAuthKeyPair.nop","LSCreateDebugToken.nop","LSCreateDerivedKeys.nop","LSCreateEncryptionKeyPair.nop","LSCreateSignatureKeyPair.nop","LSCreateSignatureWithArmadilloKey.nop","LSCreateSignature_v2.nop","LSDeleteBackupOnClient","LSGetArmadilloPublicKey.nop","LSGetBlobFromString.nop","LSHandleWrongRecoveryCode","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIsValidEpochAnonId.nop","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSOcmfClientEvolve_v2.nop","LSPublicEncryptionCreateDecryptedData.nop","LSQplAnnotateInt.nop","LSQplAnnotateString.nop","LSQplMarkPoint.nop","LSSymmetricEncryptionCreateDecryptedString.nop","justknobx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1],e=[],f=[];return d.sequence([function(f){return d.sequence([function(c){return e[0]=d.i64.of_float(Date.now()),function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] Beginning execution."),a[8]!==void 0?d.nativeOperation(b("LSQplMarkPoint.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_add_device_with_virtual_device_and_decryption_key_sproc_start"):d.resolve()},function(f){return d.filter(d.db.table(168).fetch(),function(a){return d.i64.eq(a.authorityLevel,d.i64.cast([0,80]))}).next().then(function(f,g){g=f.done;f=f.value;return g?d.sequence([function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplMarkPoint.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_add_device_with_virtual_device_and_decryption_key_delete_client_state_start"):d.resolve()},function(a){return d.db.table(168).fetch().next().then(function(a,c){var e=a.done;a=a.value;return e?0:(c=a.item,d.storedProcedure(b("LSDeleteBackupOnClient"),c.backupId,void 0,!1,void 0,"null",!0))})},function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplMarkPoint.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_add_device_with_virtual_device_and_decryption_key_delete_client_state_end"):d.resolve()},function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplMarkPoint.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_add_device_with_virtual_device_and_decryption_key_decrypt_virtual_device_secrets_start"):d.resolve()},function(c){return e[8]=a[3].get("encrypted_ocmf_client_state"),d.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedString.nop"),a[9],d.blob("dmlydHVhbF9kZXZpY2U6b2NtZl9jbGllbnRfc3RhdGU="),e[8]).then(function(a){return a=a,e[9]=a[0],a})},function(a){return d.nativeOperation(b("LSBase64Decode.nop"),e[9]).then(function(a){return a=a,e[10]=a[0],a})},function(c){return d.blobs.neq(e[10],void 0)?d.resolve(e[11]=e[10]):d.sequence([function(c){return d.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedString.nop"),a[9],d.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),e[8]).then(function(a){return a=a,e[40]=a[0],a})},function(a){return d.nativeOperation(b("LSBase64Decode.nop"),e[40]).then(function(a){return a=a,e[41]=a[0],a})},function(a){return e[11]=e[41]}])},function(c){return e[12]=a[3].get("encrypted_oblivious_validation_token_blob"),d.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedString.nop"),a[9],d.blob("dmlydHVhbF9kZXZpY2U6b2JsaXZpb3VzX3ZhbGlkYXRpb25fdG9rZW4="),e[12]).then(function(a){return a=a,e[13]=a[0],a})},function(a){return d.nativeOperation(b("LSBase64Decode.nop"),e[13]).then(function(a){return a=a,e[14]=a[0],a})},function(c){return d.blobs.neq(e[14],void 0)?d.resolve(e[15]=e[14]):d.sequence([function(c){return d.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedString.nop"),a[9],d.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),e[12]).then(function(a){return a=a,e[40]=a[0],a})},function(a){return d.nativeOperation(b("LSBase64Decode.nop"),e[40]).then(function(a){return a=a,e[41]=a[0],a})},function(a){return e[15]=e[41]}])},function(c){return e[16]=a[3].get("encrypted_epoch_anon_id"),d.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedString.nop"),a[9],d.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfYW5vbl9pZA=="),e[16]).then(function(a){return a=a,e[17]=a[0],a})},function(a){return d.nativeOperation(b("LSBase64Decode.nop"),e[17]).then(function(a){return a=a,e[18]=a[0],a})},function(c){return d.blobs.neq(e[18],void 0)?d.resolve(e[19]=e[18]):d.sequence([function(c){return d.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedString.nop"),a[9],d.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),e[16]).then(function(a){return a=a,e[40]=a[0],a})},function(a){return d.nativeOperation(b("LSBase64Decode.nop"),e[40]).then(function(a){return a=a,e[41]=a[0],a})},function(a){return e[19]=e[41]}])},function(a){return d.blobs.neq(e[19],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSIsValidEpochAnonId.nop"),e[19]).then(function(a){return a=a,e[40]=a[0],a})},function(a){return e[20]=e[40]}]):d.resolve(e[20]=!1)},function(c){return e[20]?e[21]=e[19]:e[21]=void 0,e[22]=a[3].get("encrypted_epoch_root_key"),d.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedString.nop"),a[9],d.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfcm9vdF9rZXk="),e[22]).then(function(a){return a=a,e[23]=a[0],a})},function(a){return d.nativeOperation(b("LSBase64Decode.nop"),e[23]).then(function(a){return a=a,e[24]=a[0],a})},function(c){return d.blobs.neq(e[24],void 0)?d.resolve(e[25]=e[24]):d.sequence([function(c){return d.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedString.nop"),a[9],d.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),e[22]).then(function(a){return a=a,e[40]=a[0],a})},function(a){return d.nativeOperation(b("LSBase64Decode.nop"),e[40]).then(function(a){return a=a,e[41]=a[0],a})},function(a){return e[25]=e[41]}])},function(c){return e[26]=a[3].get("encrypted_mailbox_root_key_blob"),d.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedString.nop"),a[9],d.blob("dmlydHVhbF9kZXZpY2U6bWFpbGJveF9yb290X2tleQ=="),e[26]).then(function(a){return a=a,e[27]=a[0],a})},function(a){return d.nativeOperation(b("LSBase64Decode.nop"),e[27]).then(function(a){return a=a,e[28]=a[0],a})},function(c){return d.blobs.neq(e[28],void 0)?d.resolve(e[29]=e[28]):d.sequence([function(c){return d.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedString.nop"),a[9],d.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),e[26]).then(function(a){return a=a,e[40]=a[0],a})},function(a){return d.nativeOperation(b("LSBase64Decode.nop"),e[40]).then(function(a){return a=a,e[41]=a[0],a})},function(a){return e[29]=e[41]}])},function(c){return e[30]=a[3].get("encrypted_epoch_storage_private_key"),e[30]!==void 0?d.sequence([function(c){return d.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedString.nop"),a[9],d.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfc3RvcmFnZV9wcml2YXRlX2tleQ=="),e[30]).then(function(a){return a=a,e[40]=a[0],a})},function(a){return d.nativeOperation(b("LSBase64Decode.nop"),e[40]).then(function(a){return a=a,e[41]=a[0],a})},function(c){return d.blobs.neq(e[41],void 0)?d.resolve(e[42]=e[41]):d.sequence([function(c){return d.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedString.nop"),a[9],d.blob("c2VjcmV0X3ZhbHVlc19tZXRhZGF0YQ=="),e[30]).then(function(a){return a=a,e[43]=a[0],a})},function(a){return d.nativeOperation(b("LSBase64Decode.nop"),e[43]).then(function(a){return a=a,e[44]=a[0],a})},function(a){return e[42]=e[44]}])},function(a){return e[31]=e[42]}]):d.resolve(e[31]=void 0)},function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplMarkPoint.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_add_device_with_virtual_device_and_decryption_key_decrypt_virtual_device_secrets_end"):d.resolve()},function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplMarkPoint.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_add_device_with_virtual_device_and_decryption_key_generate_keys_start"):d.resolve()},function(a){return d.nativeOperation(b("LSCreateSignatureKeyPair.nop")).then(function(a){return a=a,e[32]=a[0],e[33]=a[1],a})},function(a){return d.nativeOperation(b("LSCreateEncryptionKeyPair.nop")).then(function(a){return a=a,e[34]=a[0],e[35]=a[1],a})},function(a){return d.nativeOperation(b("LSCreateSignature_v2.nop"),e[32],d.blob("MA=="),e[35]).then(function(a){return a=a,e[36]=a[0],a})},function(a){return d.nativeOperation(b("LSCreateAuthKeyPair.nop")).then(function(a){return a=a,e[37]=a[0],e[38]=a[1],a})},function(a){return d.nativeOperation(b("LSCreateSignature_v2.nop"),e[32],d.blob("MQ=="),e[38]).then(function(a){return a=a,e[39]=a[0],a})},function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplMarkPoint.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_add_device_with_virtual_device_and_decryption_key_generate_keys_end"):d.resolve()},function(f){return d.blobs.neq(e[11],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSOcmfClientEvolve_v2.nop"),e[11]).then(function(a){return a=a,e[40]=a[0],e[41]=a[1],a})},function(a){return d.blobs.neq(void 0,void 0)?d.sequence([function(a){return d.nativeOperation(b("LSOcmfClientEvolve_v2.nop"),void 0).then(function(a){return a=a,e[46]=a[0],e[47]=a[1],a})},function(a){return a=[e[40],e[41],e[46],e[47]],e[42]=a[0],e[43]=a[1],e[44]=a[2],e[45]=a[3],a}]):d.resolve((a=[e[40],e[41],void 0,void 0],e[42]=a[0],e[43]=a[1],e[44]=a[2],e[45]=a[3],a))},function(f){return d.blobs.neq(e[21],void 0)?d.blobs.neq(e[25],void 0)?d.blobs.neq(e[15],void 0)?d.blobs.neq(e[29],void 0)?d.sequence([function(c){return a[12]!==void 0?(e[61]=a[12].get("epoch_head"),e[46]=e[61]):e[46]=void 0,e[47]=d.createArray(),d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,0])).then(function(a){return a=a,e[48]=a[0],a})},function(a){return e[48]?e[61]=(e[47].push(d.i64.cast([0,0])),e[47]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,2])).then(function(a){return a=a,e[49]=a[0],a})},function(a){return e[49]?e[61]=(e[47].push(d.i64.cast([0,2])),e[47]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,3])).then(function(a){return a=a,e[50]=a[0],a})},function(a){return e[50]?e[61]=(e[47].push(d.i64.cast([0,3])),e[47]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,4])).then(function(a){return a=a,e[51]=a[0],a})},function(a){return e[51]?e[61]=(e[47].push(d.i64.cast([0,4])),e[47]):0,e[52]="",e[53]=d.i64.of_int32(e[47].length),d.i64.gt(e[53],d.i64.cast([0,0]))?d.loopAsync(e[53],function(a){return e[61]=a,d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[47],e[61]).then(function(a){return a=a,e[62]=a[0],e[63]=a[1],a})},function(a){return e[52]=[e[52],"_",d.i64.to_string(e[62])].join("")}])}):d.resolve()},function(a){return d.nativeOperation(b("LSGetBlobFromString.nop"),["supported_versions_",e[52],"revision_version_",d.i64.to_string(d.i64.cast([0,1]))].join("")).then(function(a){return a=a,e[54]=a[0],a})},function(a){return d.nativeOperation(b("LSCreateSignature_v2.nop"),e[32],d.blob("Mg=="),e[54]).then(function(a){return a=a,e[55]=a[0],a})},function(a){return d.blobs.neq(e[55],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[55]).then(function(a){return a=a,e[61]=a[0],a})},function(a){return e[56]=e[61]}]):d.resolve(e[56]=void 0)},function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplMarkPoint.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_add_device_with_virtual_device_and_decryption_key_cleanup_state_start"):d.resolve()},function(a){return d.forEach(d.db.table(168).fetch(),function(a){return a["delete"]()})},function(a){return d.forEach(d.db.table(169).fetch(),function(a){return a["delete"]()})},function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplMarkPoint.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_add_device_with_virtual_device_and_decryption_key_cleanup_state_end"):d.resolve()},function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplMarkPoint.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_add_device_with_virtual_device_and_decryption_key_insert_optimisitc_client_state_start"):d.resolve()},function(b){return d.forEach(d.filter(d.db.table(168).fetch([[[a[1]]]]),function(b){return d.i64.eq(b.backupId,a[1])&&d.i64.lt(b.authorityLevel,d.i64.cast([0,20]))}),function(a){return a["delete"]()})},function(b){return d.db.table(168).add({backupId:a[1],devicePublicKeyBlob:e[33],devicePrivateKeyBlob:e[32],epochStoragePublicKeyBlob:e[35],epochStoragePrivateKeyBlob:e[34],epochAuthPublicKeyBlob:e[38],epochAuthPrivateKeyBlob:e[37],mailboxRootKeyBlob:e[29],ocmfClientStateBlob:e[42],obliviousValidationTokenBlob:e[15],encryptionVersion:d.i64.cast([0,0]),revisionVersion:d.i64.cast([0,1]),authorityLevel:d.i64.cast([0,20]),backupTenancy:a[7]})},function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplMarkPoint.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_add_device_with_virtual_device_and_decryption_key_insert_optimisitc_client_state_end"):d.resolve()},function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplMarkPoint.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_add_device_with_virtual_device_and_decryption_key_insert_epoch_data_start"):d.resolve()},function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplMarkPoint.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_add_device_with_virtual_device_and_decryption_key_populate_epochs_table_start"):d.resolve()},function(b){return d.forEach(d.filter(d.db.table(169).fetch([[[a[2]]]]),function(b){return d.i64.eq(b.epochId,a[2])&&d.i64.lt(b.authorityLevel,d.i64.cast([0,80]))}),function(a){return a["delete"]()})},function(b){return d.db.table(169).add({epochId:a[2],authorityLevel:d.i64.cast([0,80]),backupId:a[1],epochAnonIdBlob:e[21],epochRootKeyBlob:e[25],epochStatus:d.i64.cast([0,1]),epochHead:e[46]})},function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplMarkPoint.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_add_device_with_virtual_device_and_decryption_key_populate_epochs_table_end"):d.resolve()},function(c){return e[57]=a[5].keys(),e[58]=d.i64.of_int32(e[57].length),a[8]!==void 0?d.nativeOperation(b("LSQplAnnotateInt.nop"),d.i64.cast([0,1021646192]),a[8],"num_epochs",e[58]):d.resolve()},function(f){return d.i64.eq(e[58],d.i64.cast([0,1]))?d.sequence([function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplMarkPoint.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_add_device_with_virtual_device_and_decryption_key_epoch_derivation_skipped"):d.resolve()},function(c){return e[61]=a[5].has(d.i64.to_string(a[2])),e[61]?d.resolve(0):(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] sync_epochs does not contain base epoch"),e[63]="sync_epochs does not contain base epoch",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",e[63]].join("")),e[62]=d.createArray(),void 0!==void 0?e[64]=(e[62].push(void 0),e[62]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",e[63],e[62],d.i64.cast([0,3])))}]):d.sequence([function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplMarkPoint.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_add_device_with_virtual_device_and_decryption_key_epoch_derivation_start"):d.resolve()},function(a){return function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] Triggering epoch derivation."),e[61]=c("justknobx")._("1310"),void 0!==void 0?e[61]?d.sequence([function(a){return void 0!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),void 0,d.i64.cast([0,2866]),d.i64.cast([0,2]),void 0,void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[62]=a[0],a})},function(a){return e[62]?e[63]=!0:e[63]=!1,e[63]&&!0?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[65]="LSDataTraceMciTraceLog native op not supported",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",e[65]].join("")),e[64]=d.createArray(),void 0!==void 0?e[66]=(e[64].push(void 0),e[64]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",e[65],e[64],d.i64.cast([0,3]))):d.resolve()}]):d.sequence([function(a){return void 0!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),void 0,d.i64.cast([0,2867]),d.i64.cast([0,2]),void 0,void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[62]=a[0],a})},function(a){return e[62]?e[63]=!0:e[63]=!1,e[63]&&!0?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[65]="LSDataTraceMciTraceLog native op not supported",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",e[65]].join("")),e[64]=d.createArray(),void 0!==void 0?e[66]=(e[64].push(void 0),e[64]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",e[65],e[64],d.i64.cast([0,3]))):d.resolve()}]):d.resolve()},function(c){return e[61]===!1?function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] Epoch rotation is disabled for the user but received more than one epoch."):0,d.blobs.neq(e[31],void 0)?d.sequence([function(a){return e[65]="Starting epoch derivation at base epoch of anon id (base64) = ",d.nativeOperation(b("LSBase64Encode.nop"),e[21]).then(function(a){return a=a,e[62]=a[0],a})},function(a){return e[66]=e[62]==null?"":e[62],e[63]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][MEBEpochDerivationUtils] ",e[63],e[65],e[63],e[66]].join("")),d.resolve()},function(c){return e[64]=a[5].get(d.i64.to_string(a[2])),e[64]!==void 0?d.sequence([function(b){return e[67]=e[64].get("minos_epoch"),e[67]!==void 0?(e[79]=e[67].get("epoch_head"),e[68]=e[79]):e[68]=void 0,e[69]=e[64].get("is_active_epoch"),e[69]?e[70]=d.i64.cast([0,1]):e[70]=d.i64.cast([0,2]),d.forEach(d.db.table(169).fetch([[[a[2]]]]),function(a){var b=a.update;a.item;return b({authorityLevel:d.i64.cast([0,80]),epochStatus:e[70],epochHead:e[68]})})},function(c){return e[71]=new d.Map(),e[71].set("epoch_id",a[2]),e[71].set("authority_level",d.i64.cast([0,80])),e[71].set("backup_id",a[1]),e[71].set("epoch_anon_id_blob",e[21]),e[71].set("epoch_root_key_blob",e[25]),e[71].set("epoch_status",d.i64.cast([0,1])),e[71].set("epoch_head",e[46]),e[72]=e[71],e[73]=a[5].keys(),e[74]=d.i64.of_int32(e[73].length),d.i64.gt(e[74],d.i64.cast([0,0]))?d.loopAsync(e[74],function(c){return e[79]=c,d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[73],e[79]).then(function(a){return a=a,e[80]=a[0],e[81]=a[1],a})},function(c){return e[82]=e[72].get("epoch_id"),e[83]=e[72].get("backup_id"),e[84]=e[72].get("epoch_anon_id_blob"),e[85]=e[72].get("epoch_root_key_blob"),e[86]=e[72].get("epoch_status"),e[87]=e[72].get("authority_level"),e[88]=e[72].get("epoch_head"),e[89]=a[5].get(d.i64.to_string(e[82])),e[89]!==void 0?d.sequence([function(c){return e[98]=e[89].get("next_epoch_id"),d.i64.neq(e[98],void 0)?d.sequence([function(c){return e[106]=a[5].get(d.i64.to_string(e[98])),e[106]!==void 0?d.sequence([function(a){return e[114]=e[106].get("backup_id"),e[115]=e[106].get("is_active_epoch"),e[115]?e[116]=d.i64.cast([0,1]):e[116]=d.i64.cast([0,2]),e[117]=e[106].get("epoch_anon_id"),e[118]=e[106].get("minos_epoch"),e[118]!==void 0?(e[137]=e[118].get("epoch_head"),e[119]=e[137]):e[119]=void 0,e[120]=d.createArray(),e[137]=(e[120].push(d.i64.cast([0,32])),e[120]),e[137]=(e[120].push(d.i64.cast([0,32])),e[120]),e[121]="_",d.nativeOperation(b("LSGetBlobFromString.nop"),["epoch_chaining",e[121],d.blobs.to_string(e[84]),e[121],d.i64.to_string(e[82])].join("")).then(function(a){return a=a,e[122]=a[0],a})},function(a){return d.nativeOperation(b("LSCreateDerivedKeys.nop"),e[122],void 0,e[85],e[120]).then(function(a){return a=a,e[123]=a[0],a})},function(a){return e[123]?e[124]=!1:e[124]=!0,e[124]?d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] Failed to generate epoch_chaining_key and epoch_distribution_pre_shared_key."),e[138]="Failed to generate epoch_chaining_key and epoch_distribution_pre_shared_key.",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",e[138]].join("")),e[137]=d.createArray(),void 0!==void 0?e[141]=(e[137].push(void 0),e[137]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",e[138],e[137],d.i64.cast([0,3]))},function(a){return d.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,e[139]=a[0],a})},function(a){return d.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,e[140]=a[0],a})},function(a){return a=[e[139],e[140]],e[125]=a[0],e[126]=a[1],a}]):d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[123],d.i64.cast([0,0])).then(function(a){return a=a,e[137]=a[0],e[138]=a[1],a})},function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[123],d.i64.cast([0,1])).then(function(a){return a=a,e[139]=a[0],e[140]=a[1],a})},function(a){return a=[e[137],e[139]],e[125]=a[0],e[126]=a[1],a}])},function(c){return e[127]=e[106].get("encrypted_epoch_key"),d.blobs.neq(e[127],void 0)?d.sequence([function(c){return e[137]=e[106].get("epoch_auth_public_key"),e[138]=e[106].get("epoch_anon_id"),d.nativeOperation(b("LSPublicEncryptionCreateDecryptedData.nop"),a[6],e[31],e[137],e[126],d.blobs.of_string(["epoch_","_",d.blobs.to_string(e[138])].join("")),e[127]).then(function(a){return a=a,e[139]=a[0],a})},function(a){return d.blobs.neq(e[139],void 0)?d.resolve(e[140]=e[139]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] Couldn't decrypt epoch key. Returning null entropy"),e[142]="Couldn't decrypt epoch key. Returning null entropy",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",e[142]].join("")),e[141]=d.createArray(),void 0!==void 0?e[143]=(e[141].push(void 0),e[141]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",e[142],e[141],d.i64.cast([0,3]))},function(a){return e[140]=void 0}])},function(a){return e[128]=e[140]}]):d.sequence([function(a){return e[140]="encrypted_epoch_key is null. Can't generate epoch entropy. epoch_anon_id(base64) = ",e[137]=e[106].get("epoch_anon_id"),d.nativeOperation(b("LSBase64Encode.nop"),e[137]).then(function(a){return a=a,e[138]=a[0],a})},function(a){return e[141]=e[138]==null?"":e[138],e[139]="",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBEpochDerivationUtils] ",e[139],e[140],e[139],e[141]].join("")),e[142]=d.createArray(),void 0!==void 0?e[143]=(e[142].push(void 0),e[142]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",[e[140],",",e[141]].join(""),e[142],d.i64.cast([0,3]))},function(a){return e[128]=void 0}])},function(a){return d.blobs.neq(e[128],void 0)?d.sequence([function(a){return e[137]=d.createArray(),e[142]=(e[137].push(d.i64.cast([0,32])),e[137]),d.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_root_key").then(function(a){return a=a,e[138]=a[0],a})},function(a){return d.nativeOperation(b("LSCreateDerivedKeys.nop"),e[138],e[125],e[128],e[137]).then(function(a){return a=a,e[139]=a[0],a})},function(a){return e[139]?e[140]=!1:e[140]=!0,e[140]?d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] Unable to generate epoch root key."),e[143]="Unable to generate epoch root key.",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",e[143]].join("")),e[142]=d.createArray(),void 0!==void 0?e[145]=(e[142].push(void 0),e[142]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",e[143],e[142],d.i64.cast([0,3]))},function(a){return d.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,e[144]=a[0],a})},function(a){return e[141]=e[144]}]):d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[139],d.i64.cast([0,0])).then(function(a){return a=a,e[142]=a[0],e[143]=a[1],a})},function(a){return e[141]=e[142]}])},function(a){return e[129]=e[141]}]):d.sequence([function(a){return e[140]="epoch entropy is null. Can't generate epoch root key. epoch_anon_id(base64) = ",e[137]=e[106].get("epoch_anon_id"),d.nativeOperation(b("LSBase64Encode.nop"),e[137]).then(function(a){return a=a,e[138]=a[0],a})},function(a){return e[141]=e[138]==null?"":e[138],e[139]="",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBEpochDerivationUtils] ",e[139],e[140],e[139],e[141]].join("")),e[142]=d.createArray(),void 0!==void 0?e[143]=(e[142].push(void 0),e[142]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",[e[140],",",e[141]].join(""),e[142],d.i64.cast([0,3]))},function(a){return e[129]=void 0}])},function(a){return d.blobs.neq(e[129],void 0)?d.sequence([function(a){return d.filter(d.db.table(169).fetch([[[e[98]]]]),function(a){return d.i64.eq(a.epochId,e[98])&&d.i64.gt(a.authorityLevel,d.i64.cast([0,80]))}).next().then(function(a){var b=a.done;a.value;return b?d.db.table(169).put({epochId:e[98],backupId:e[114],epochAnonIdBlob:e[117],epochRootKeyBlob:e[129],epochStatus:e[116],authorityLevel:d.i64.cast([0,80]),epochHead:e[119]}):0})},function(a){return a=[e[98],e[114],e[117],e[129],e[116],e[119],d.i64.cast([0,80])],e[130]=a[0],e[131]=a[1],e[132]=a[2],e[133]=a[3],e[134]=a[4],e[135]=a[5],e[136]=a[6],a}]):d.sequence([function(a){return e[140]="Epoch root key is null. Can't write the epoch to the table. epoch_anon_id(base64) = ",e[137]=e[106].get("epoch_anon_id"),d.nativeOperation(b("LSBase64Encode.nop"),e[137]).then(function(a){return a=a,e[138]=a[0],a})},function(a){return e[141]=e[138]==null?"":e[138],e[139]="",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBEpochDerivationUtils] ",e[139],e[140],e[139],e[141]].join("")),e[142]=d.createArray(),void 0!==void 0?e[143]=(e[142].push(void 0),e[142]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",[e[140],",",e[141]].join(""),e[142],d.i64.cast([0,3]))},function(a){return a=[e[82],e[83],e[84],e[85],e[86],e[88],e[87]],e[130]=a[0],e[131]=a[1],e[132]=a[2],e[133]=a[3],e[134]=a[4],e[135]=a[5],e[136]=a[6],a}])},function(a){return a=[e[130],e[131],e[132],e[133],e[134],e[135],e[136]],e[107]=a[0],e[108]=a[1],e[109]=a[2],e[110]=a[3],e[111]=a[4],e[112]=a[5],e[113]=a[6],a}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBEpochDerivationUtils] Unexpected error! New epoch is null even though we have a new_epoch_id value"),e[115]="Unexpected error! New epoch is null even though we have a new_epoch_id value",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBEpochDerivationUtils] ","",e[115]].join("")),e[114]=d.createArray(),void 0!==void 0?e[116]=(e[114].push(void 0),e[114]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",e[115],e[114],d.i64.cast([0,3]))},function(a){return a=[e[82],e[83],e[84],e[85],e[86],e[88],e[87]],e[107]=a[0],e[108]=a[1],e[109]=a[2],e[110]=a[3],e[111]=a[4],e[112]=a[5],e[113]=a[6],a}])},function(a){return a=[e[107],e[108],e[109],e[110],e[111],e[112],e[113]],e[99]=a[0],e[100]=a[1],e[101]=a[2],e[102]=a[3],e[103]=a[4],e[104]=a[5],e[105]=a[6],a}]):d.sequence([function(a){return e[108]="New epoch is null. This is expected if epoch_id is the root or last epoch. epoch_anon_id(base64) = ",d.nativeOperation(b("LSBase64Encode.nop"),e[84]).then(function(a){return a=a,e[106]=a[0],a})},function(a){return e[109]=e[106]==null?"":e[106],e[110]=" , is_forward = ",e[111]="1",e[107]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][MEBEpochDerivationUtils] ",e[107],e[108],e[107],e[109],e[107],e[110],e[107],e[111]].join("")),d.resolve()},function(a){return a=[e[82],e[83],e[84],e[85],e[86],e[88],e[87]],e[99]=a[0],e[100]=a[1],e[101]=a[2],e[102]=a[3],e[103]=a[4],e[104]=a[5],e[105]=a[6],a}])},function(a){return a=[e[99],e[100],e[101],e[102],e[103],e[104],e[105]],e[90]=a[0],e[91]=a[1],e[92]=a[2],e[93]=a[3],e[94]=a[4],e[95]=a[5],e[96]=a[6],a}]):d.sequence([function(a){return e[100]="Unexpected error! server epoch is null even though we have epoch_id. epoch_anon_id(base64) = ",d.nativeOperation(b("LSBase64Encode.nop"),e[84]).then(function(a){return a=a,e[98]=a[0],a})},function(a){return e[101]=e[98]==null?"":e[98],e[99]="",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBEpochDerivationUtils] ",e[99],e[100],e[99],e[101]].join("")),e[102]=d.createArray(),void 0!==void 0?e[103]=(e[102].push(void 0),e[102]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",[e[100],",",e[101]].join(""),e[102],d.i64.cast([0,3]))},function(a){return a=[e[82],e[83],e[84],e[85],e[86],e[88],e[87]],e[90]=a[0],e[91]=a[1],e[92]=a[2],e[93]=a[3],e[94]=a[4],e[95]=a[5],e[96]=a[6],a}])},function(a){return e[97]=new d.Map(),e[97].set("epoch_id",e[90]),e[97].set("backup_id",e[91]),e[97].set("epoch_anon_id_blob",e[92]),e[97].set("epoch_root_key_blob",e[93]),e[97].set("epoch_status",e[94]),e[97].set("epoch_head",e[95]),e[97].set("authority_level",e[96]),e[72]=e[97]}])}):d.resolve()},function(a){return d.sequence([function(a){return void 0!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),void 0,d.i64.cast([0,1438]),d.i64.cast([0,2]),void 0,void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[79]=a[0],a})},function(a){return e[79]?e[80]=!0:e[80]=!1,e[80]&&!0?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[82]="LSDataTraceMciTraceLog native op not supported",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",e[82]].join("")),e[81]=d.createArray(),void 0!==void 0?e[83]=(e[81].push(void 0),e[81]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",e[82],e[81],d.i64.cast([0,3]))):d.resolve()}])},function(c){return e[75]=new d.Map(),e[75].set("epoch_id",a[2]),e[75].set("authority_level",d.i64.cast([0,80])),e[75].set("backup_id",a[1]),e[75].set("epoch_anon_id_blob",e[21]),e[75].set("epoch_root_key_blob",e[25]),e[75].set("epoch_status",d.i64.cast([0,1])),e[75].set("epoch_head",e[46]),e[76]=e[75],e[77]=a[5].keys(),e[78]=d.i64.of_int32(e[77].length),d.i64.gt(e[78],d.i64.cast([0,0]))?d.loopAsync(e[78],function(c){return e[79]=c,d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[77],e[79]).then(function(a){return a=a,e[80]=a[0],e[81]=a[1],a})},function(c){return e[82]=e[76].get("epoch_id"),e[83]=e[76].get("backup_id"),e[84]=e[76].get("epoch_anon_id_blob"),e[85]=e[76].get("epoch_root_key_blob"),e[86]=e[76].get("epoch_status"),e[87]=e[76].get("authority_level"),e[88]=e[76].get("epoch_head"),e[89]=a[5].get(d.i64.to_string(e[82])),e[89]!==void 0?d.sequence([function(c){return e[98]=e[89].get("prev_epoch_id"),d.i64.neq(e[98],void 0)?d.sequence([function(c){return e[106]=a[5].get(d.i64.to_string(e[98])),e[106]!==void 0?d.sequence([function(a){return e[114]=e[106].get("backup_id"),e[115]=e[106].get("is_active_epoch"),e[115]?e[116]=d.i64.cast([0,1]):e[116]=d.i64.cast([0,2]),e[117]=e[89].get("epoch_data_v2"),e[117]!==void 0?d.sequence([function(a){return e[125]=d.createArray(),e[144]=(e[125].push(d.i64.cast([0,32])),e[125]),d.nativeOperation(b("LSBase64Encode.nop"),e[84]).then(function(a){return a=a,e[126]=a[0],a})},function(a){return e[126]!==void 0?d.sequence([function(a){return d.nativeOperation(b("LSCreateDerivedKeys.nop"),d.blobs.of_string(["epoch_data_storage","_",e[126]].join("")),void 0,e[85],e[125]).then(function(a){return a=a,e[144]=a[0],a})},function(a){return e[144]?e[145]=!1:e[145]=!0,e[145]?d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),e[148]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",e[148]].join("")),e[147]=d.createArray(),void 0!==void 0?e[150]=(e[147].push(void 0),e[147]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",e[148],e[147],d.i64.cast([0,3]))},function(a){return d.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,e[149]=a[0],a})},function(a){return e[146]=e[149]}]):d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[144],d.i64.cast([0,0])).then(function(a){return a=a,e[147]=a[0],e[148]=a[1],a})},function(a){return e[146]=e[147]}])},function(a){return e[127]=e[146]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),e[145]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",e[145]].join("")),e[144]=d.createArray(),void 0!==void 0?e[147]=(e[144].push(void 0),e[144]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",e[145],e[144],d.i64.cast([0,3]))},function(a){return d.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,e[146]=a[0],a})},function(a){return e[127]=e[146]}])},function(a){return e[128]=e[117].get("epoch_anon_id"),d.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedString.nop"),e[127],d.blob("ZXBvY2hfZGF0YV9tZXRhZGF0YQ=="),e[128]).then(function(a){return a=a,e[129]=a[0],a})},function(a){return d.nativeOperation(b("LSBase64Decode.nop"),e[129]).then(function(a){return a=a,e[130]=a[0],a})},function(a){return d.blobs.neq(e[130],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSIsValidEpochAnonId.nop"),e[130]).then(function(a){return a=a,e[144]=a[0],a})},function(a){return e[131]=e[144]}]):d.resolve(e[131]=!1)},function(a){return e[131]?e[132]=e[130]:e[132]=void 0,e[133]=e[117].get("epoch_root_key"),d.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedString.nop"),e[127],d.blob("ZXBvY2hfZGF0YV9tZXRhZGF0YQ=="),e[133]).then(function(a){return a=a,e[134]=a[0],a})},function(a){return d.nativeOperation(b("LSBase64Decode.nop"),e[134]).then(function(a){return a=a,e[135]=a[0],a})},function(a){return d.blobs.neq(e[132],void 0)?d.sequence([function(a){return d.blobs.neq(e[135],void 0)?d.resolve((e[145]=new d.Map(),e[145].set("epoch_anon_id",e[132]),e[145].set("epoch_root_key",e[135]),e[144]=e[145])):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBEpochDerivationUtils] Error while decrypting epoch_root_key. Returning null"),e[146]="Error while decrypting epoch_root_key. Returning null",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBEpochDerivationUtils] ","",e[146]].join("")),e[145]=d.createArray(),void 0!==void 0?e[147]=(e[145].push(void 0),e[145]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",e[146],e[145],d.i64.cast([0,3]))},function(a){return e[144]=void 0}])},function(a){return e[136]=e[144]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBEpochDerivationUtils] Error while decrypting epoch_anon_id. Returning null"),e[145]="Error while decrypting epoch_anon_id. Returning null",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBEpochDerivationUtils] ","",e[145]].join("")),e[144]=d.createArray(),void 0!==void 0?e[146]=(e[144].push(void 0),e[144]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",e[145],e[144],d.i64.cast([0,3]))},function(a){return e[136]=void 0}])},function(a){return e[136]!==void 0?d.sequence([function(a){return e[144]=e[136].get("epoch_anon_id"),e[145]=e[136].get("epoch_root_key"),e[146]=e[106].get("minos_epoch"),e[146]!==void 0?(e[148]=e[146].get("epoch_head"),e[147]=e[148]):e[147]=void 0,d.filter(d.db.table(169).fetch([[[e[98]]]]),function(a){return d.i64.eq(a.epochId,e[98])&&d.i64.gt(a.authorityLevel,d.i64.cast([0,80]))}).next().then(function(a){var b=a.done;a.value;return b?d.db.table(169).put({epochId:e[98],backupId:e[114],epochAnonIdBlob:e[144],epochRootKeyBlob:e[145],epochStatus:e[116],authorityLevel:d.i64.cast([0,80]),epochHead:e[147]}):0})},function(a){return a=[e[98],e[114],e[144],e[145],e[116],e[147],d.i64.cast([0,80])],e[137]=a[0],e[138]=a[1],e[139]=a[2],e[140]=a[3],e[141]=a[4],e[142]=a[5],e[143]=a[6],a}]):d.sequence([function(a){return e[146]="Error while decrypting epoch data of epoch_anon_id(base64) = ",d.nativeOperation(b("LSBase64Encode.nop"),e[84]).then(function(a){return a=a,e[144]=a[0],a})},function(a){return e[147]=e[144]==null?"":e[144],e[145]="",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBEpochDerivationUtils] ",e[145],e[146],e[145],e[147]].join("")),e[148]=d.createArray(),void 0!==void 0?e[149]=(e[148].push(void 0),e[148]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",[e[146],",",e[147]].join(""),e[148],d.i64.cast([0,3]))},function(a){return a=[e[82],e[83],e[84],e[85],e[86],e[88],e[87]],e[137]=a[0],e[138]=a[1],e[139]=a[2],e[140]=a[3],e[141]=a[4],e[142]=a[5],e[143]=a[6],a}])},function(a){return a=[e[137],e[138],e[139],e[140],e[141],e[142],e[143]],e[118]=a[0],e[119]=a[1],e[120]=a[2],e[121]=a[3],e[122]=a[4],e[123]=a[5],e[124]=a[6],a}]):d.sequence([function(a){return e[127]="Error while reading epoch_data_v2. This is expected if this is the root epoch. epoch_anon_id(base64) = ",d.nativeOperation(b("LSBase64Encode.nop"),e[84]).then(function(a){return a=a,e[125]=a[0],a})},function(a){return e[128]=e[125]==null?"":e[125],e[126]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][MEBEpochDerivationUtils] ",e[126],e[127],e[126],e[128]].join("")),d.resolve()},function(a){return a=[e[82],e[83],e[84],e[85],e[86],e[88],e[87]],e[118]=a[0],e[119]=a[1],e[120]=a[2],e[121]=a[3],e[122]=a[4],e[123]=a[5],e[124]=a[6],a}])},function(a){return a=[e[118],e[119],e[120],e[121],e[122],e[123],e[124]],e[107]=a[0],e[108]=a[1],e[109]=a[2],e[110]=a[3],e[111]=a[4],e[112]=a[5],e[113]=a[6],a}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBEpochDerivationUtils] Unexpected error! New epoch is null even though we have a new_epoch_id value"),e[115]="Unexpected error! New epoch is null even though we have a new_epoch_id value",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBEpochDerivationUtils] ","",e[115]].join("")),e[114]=d.createArray(),void 0!==void 0?e[116]=(e[114].push(void 0),e[114]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",e[115],e[114],d.i64.cast([0,3]))},function(a){return a=[e[82],e[83],e[84],e[85],e[86],e[88],e[87]],e[107]=a[0],e[108]=a[1],e[109]=a[2],e[110]=a[3],e[111]=a[4],e[112]=a[5],e[113]=a[6],a}])},function(a){return a=[e[107],e[108],e[109],e[110],e[111],e[112],e[113]],e[99]=a[0],e[100]=a[1],e[101]=a[2],e[102]=a[3],e[103]=a[4],e[104]=a[5],e[105]=a[6],a}]):d.sequence([function(a){return e[108]="New epoch is null. This is expected if epoch_id is the root or last epoch. epoch_anon_id(base64) = ",d.nativeOperation(b("LSBase64Encode.nop"),e[84]).then(function(a){return a=a,e[106]=a[0],a})},function(a){return e[109]=e[106]==null?"":e[106],e[110]=" , is_forward = ",e[111]="0",e[107]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][MEBEpochDerivationUtils] ",e[107],e[108],e[107],e[109],e[107],e[110],e[107],e[111]].join("")),d.resolve()},function(a){return a=[e[82],e[83],e[84],e[85],e[86],e[88],e[87]],e[99]=a[0],e[100]=a[1],e[101]=a[2],e[102]=a[3],e[103]=a[4],e[104]=a[5],e[105]=a[6],a}])},function(a){return a=[e[99],e[100],e[101],e[102],e[103],e[104],e[105]],e[90]=a[0],e[91]=a[1],e[92]=a[2],e[93]=a[3],e[94]=a[4],e[95]=a[5],e[96]=a[6],a}]):d.sequence([function(a){return e[100]="Unexpected error! server epoch is null even though we have epoch_id. epoch_anon_id(base64) = ",d.nativeOperation(b("LSBase64Encode.nop"),e[84]).then(function(a){return a=a,e[98]=a[0],a})},function(a){return e[101]=e[98]==null?"":e[98],e[99]="",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBEpochDerivationUtils] ",e[99],e[100],e[99],e[101]].join("")),e[102]=d.createArray(),void 0!==void 0?e[103]=(e[102].push(void 0),e[102]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils",[e[100],",",e[101]].join(""),e[102],d.i64.cast([0,3]))},function(a){return a=[e[82],e[83],e[84],e[85],e[86],e[88],e[87]],e[90]=a[0],e[91]=a[1],e[92]=a[2],e[93]=a[3],e[94]=a[4],e[95]=a[5],e[96]=a[6],a}])},function(a){return e[97]=new d.Map(),e[97].set("epoch_id",e[90]),e[97].set("backup_id",e[91]),e[97].set("epoch_anon_id_blob",e[92]),e[97].set("epoch_root_key_blob",e[93]),e[97].set("epoch_status",e[94]),e[97].set("epoch_head",e[95]),e[97].set("authority_level",e[96]),e[76]=e[97]}])}):d.resolve()},function(a){return d.sequence([function(a){return void 0!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),void 0,d.i64.cast([0,1439]),d.i64.cast([0,2]),void 0,void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[79]=a[0],a})},function(a){return e[79]?e[80]=!0:e[80]=!1,e[80]&&!0?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[82]="LSDataTraceMciTraceLog native op not supported",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",e[82]].join("")),e[81]=d.createArray(),void 0!==void 0?e[83]=(e[81].push(void 0),e[81]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",e[82],e[81],d.i64.cast([0,3]))):d.resolve()}])}]):(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBEpochDerivationUtils] Unexpected Error. A base epoch exists on client but not found on server"),e[67]=d.createArray(),void 0!==void 0?e[68]=(e[67].push(void 0),e[67]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBEpochDerivationUtils","Unexpected Error. A base epoch exists on client but not found on server",e[67],d.i64.cast([0,3])))}]):d.sequence([function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: epoch storage private key is null"):d.resolve()},function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] epoch storage private key is null"),e[63]="epoch storage private key is null",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",e[63]].join("")),e[62]=d.createArray(),void 0!==void 0?e[64]=(e[62].push(void 0),e[62]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",e[63],e[62],d.i64.cast([0,3]))}])},function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplMarkPoint.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_add_device_with_virtual_device_and_decryption_key_epoch_derivation_end"):d.resolve()}])},function(c){return d.db.table(169).fetch([[[a[4]]]]).next().then(function(c,f){var g=c.done;c=c.value;return g?d.sequence([function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: No epochs keys found."):d.resolve()},function(a){return function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] No epochs keys found."),e[59]=void 0}]):(f=c.item,e[61]=new d.Map(),e[61].set("epoch_root_key",f.epochRootKeyBlob),e[61].set("epoch_anon_id",f.epochAnonIdBlob),e[61].set("epoch_id",a[4]),e[61].set("epoch_head",f.epochHead),e[59]=e[61])})},function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplMarkPoint.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_add_device_with_virtual_device_and_decryption_key_insert_epoch_data_end"):d.resolve()},function(c){return e[59]!==void 0?d.sequence([function(a){return e[61]=e[59].get("epoch_anon_id"),e[62]=e[59].get("epoch_root_key"),e[63]=d.createArray(),e[69]=(e[63].push(d.i64.cast([0,32])),e[63]),d.nativeOperation(b("LSBase64Encode.nop"),e[61]).then(function(a){return a=a,e[64]=a[0],a})},function(a){return e[64]!==void 0?d.sequence([function(a){return d.nativeOperation(b("LSCreateDerivedKeys.nop"),d.blobs.of_string(["epoch_devices","_",e[64]].join("")),void 0,e[62],e[63]).then(function(a){return a=a,e[69]=a[0],a})},function(a){return e[69]?e[70]=!1:e[70]=!0,e[70]?d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),e[73]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",e[73]].join("")),e[72]=d.createArray(),void 0!==void 0?e[75]=(e[72].push(void 0),e[72]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",e[73],e[72],d.i64.cast([0,3]))},function(a){return d.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,e[74]=a[0],a})},function(a){return e[71]=e[74]}]):d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[69],d.i64.cast([0,0])).then(function(a){return a=a,e[72]=a[0],e[73]=a[1],a})},function(a){return e[71]=e[72]}])},function(a){return e[65]=e[71]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),e[70]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",e[70]].join("")),e[69]=d.createArray(),void 0!==void 0?e[72]=(e[69].push(void 0),e[69]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",e[70],e[69],d.i64.cast([0,3]))},function(a){return d.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,e[71]=a[0],a})},function(a){return e[65]=e[71]}])},function(a){return d.nativeOperation(b("LSHmac_v2.nop"),e[65],e[33]).then(function(a){return a=a,e[66]=a[0],a})},function(a){return e[67]=e[59].get("epoch_root_key"),d.blobs.neq(e[67],void 0)?d.sequence([function(a){return e[69]=d.createArray(),e[75]=(e[69].push(d.i64.cast([0,18])),e[69]),d.nativeOperation(b("LSCreateDerivedKeys.nop"),d.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,e[67],e[69]).then(function(a){return a=a,e[70]=a[0],a})},function(a){return e[70]!==void 0?d.sequence([function(a){return e[75]=d.i64.of_int32(e[70].length),d.i64.ge(e[75],d.i64.cast([0,1]))?d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[70],d.i64.cast([0,0])).then(function(a){return a=a,e[77]=a[0],e[78]=a[1],a})},function(a){return e[76]=e[77]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),e[78]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",e[78]].join("")),e[77]=d.createArray(),void 0!==void 0?e[79]=(e[77].push(void 0),e[77]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",e[78],e[77],d.i64.cast([0,3]))},function(a){return e[76]=void 0}])},function(a){return e[71]=e[76]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),e[76]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",e[76]].join("")),e[75]=d.createArray(),void 0!==void 0?e[77]=(e[75].push(void 0),e[75]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",e[76],e[75],d.i64.cast([0,3]))},function(a){return e[71]=void 0}])},function(a){return d.blobs.neq(e[71],void 0)?e[72]=!0:e[72]=!1,e[72]?0:(function(a){d.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),d["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),d.nativeOperation(b("LSBase64Encode.nop"),e[71]).then(function(a){return a=a,e[73]=a[0],a})},function(a){return e[73]!==void 0?e[74]=e[73]:e[74]="encodingfailed",e[68]=e[74]}]):d.resolve(e[68]="null")},function(c){return d.blobs.neq(e[66],void 0)?d.sequence([function(a){return e[69]=e[59].get("epoch_id"),d.nativeOperation(b("LSBase64Encode.nop"),e[33]).then(function(a){return a=a,e[70]=a[0],a})},function(a){return e[88]=e[70]==null?"":e[70],d.nativeOperation(b("LSBase64Encode.nop"),e[66]).then(function(a){return a=a,e[71]=a[0],a})},function(a){return e[87]=e[71]==null?"":e[71],d.nativeOperation(b("LSBase64Encode.nop"),e[35]).then(function(a){return a=a,e[72]=a[0],a})},function(a){return e[89]=e[72]==null?"":e[72],d.nativeOperation(b("LSBase64Encode.nop"),e[36]==null?d.blob("bnVsbA=="):e[36]).then(function(a){return a=a,e[73]=a[0],a})},function(a){return e[90]=e[73]==null?"":e[73],d.nativeOperation(b("LSBase64Encode.nop"),e[38]).then(function(a){return a=a,e[74]=a[0],a})},function(a){return e[91]=e[74]==null?"":e[74],d.nativeOperation(b("LSBase64Encode.nop"),e[39]==null?d.blob("bnVsbA=="):e[39]).then(function(a){return a=a,e[75]=a[0],a})},function(a){return e[92]=e[75]==null?"":e[75],d.nativeOperation(b("LSBase64Encode.nop"),e[43]).then(function(a){return a=a,e[76]=a[0],a})},function(c){return e[93]=e[76]==null?"":e[76],d.nativeOperation(b("LSBase64Encode.nop"),a[10]).then(function(a){return a=a,e[77]=a[0],a})},function(a){return e[94]=e[77]==null?"":e[77],d.blobs.neq(e[29],void 0)?d.sequence([function(a){return e[95]=new d.Map(),d.nativeOperation(b("LSCreateDebugToken.nop"),e[29],"private_key",e[32],d.i64.cast([0,1]),e[95]).then(function(a){return a=a,e[96]=a[0],a})},function(a){return d.blobs.neq(e[96],void 0)?e[97]=e[96]:e[97]=void 0,e[78]=e[97]}]):d.resolve(e[78]=void 0)},function(a){return d.blobs.neq(e[78],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[78]).then(function(a){return a=a,e[95]=a[0],a})},function(a){return e[79]=e[95]}]):d.resolve(e[79]=void 0)},function(a){return d.blobs.neq(e[29],void 0)?d.sequence([function(a){return e[95]=new d.Map(),d.nativeOperation(b("LSCreateDebugToken.nop"),e[29],"ocmf_client_state",e[42],d.i64.cast([0,1]),e[95]).then(function(a){return a=a,e[96]=a[0],a})},function(a){return d.blobs.neq(e[96],void 0)?e[97]=e[96]:e[97]=void 0,e[80]=e[97]}]):d.resolve(e[80]=void 0)},function(a){return d.blobs.neq(e[80],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[80]).then(function(a){return a=a,e[95]=a[0],a})},function(a){return e[81]=e[95]}]):d.resolve(e[81]=void 0)},function(a){return d.blobs.neq(e[29],void 0)?d.sequence([function(a){return e[95]=new d.Map(),d.nativeOperation(b("LSCreateDebugToken.nop"),e[29],"epoch_storage_private_key",e[34],d.i64.cast([0,1]),e[95]).then(function(a){return a=a,e[96]=a[0],a})},function(a){return d.blobs.neq(e[96],void 0)?e[97]=e[96]:e[97]=void 0,e[82]=e[97]}]):d.resolve(e[82]=void 0)},function(a){return d.blobs.neq(e[82],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[82]).then(function(a){return a=a,e[95]=a[0],a})},function(a){return e[83]=e[95]}]):d.resolve(e[83]=void 0)},function(c){return e[84]=new d.Map(),e[84].set("supported_encryption_versions",e[47]),e[84].set("client_version",d.i64.cast([0,1])),e[84].set("version_sig",e[56]==null?"":e[56]),a[8]!==void 0?d.nativeOperation(b("LSQplMarkPoint.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_add_device_with_virtual_device_and_decryption_key_issue_add_device_task_start"):d.resolve()},function(c){return d.i64.eq(a[7],d.i64.cast([0,2]))?d.resolve(e[85]=void 0):d.sequence([function(a){return d.nativeOperation(b("LSGetArmadilloPublicKey.nop")).then(function(a){return a=a,e[95]=a[0],a})},function(a){return e[85]=e[95]}])},function(a){return d.blobs.neq(e[85],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSCreateSignatureWithArmadilloKey.nop"),e[33]).then(function(a){return a=a,e[95]=a[0],a})},function(a){return d.blobs.neq(e[95],void 0)?d.resolve(e[96]=e[95]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoKeySigningUtils] Failed to create labyrinth signature"),e[101]="Failed to create labyrinth signature",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoKeySigningUtils] ","",e[101]].join("")),e[100]=d.createArray(),void 0!==void 0?e[102]=(e[100].push(void 0),e[100]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoKeySigningUtils",e[101],e[100],d.i64.cast([0,3]))},function(a){return e[96]=void 0}])},function(a){return d.nativeOperation(b("LSCreateSignature_v2.nop"),e[32],d.blob("Mw=="),e[85]).then(function(a){return a=a,e[97]=a[0],a})},function(a){return d.blobs.neq(e[97],void 0)?d.resolve(e[98]=e[97]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoKeySigningUtils] Failed to create armadillo signature"),e[101]="Failed to create armadillo signature",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoKeySigningUtils] ","",e[101]].join("")),e[100]=d.createArray(),void 0!==void 0?e[102]=(e[100].push(void 0),e[100]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoKeySigningUtils",e[101],e[100],d.i64.cast([0,3]))},function(a){return e[98]=void 0}])},function(a){return d.blobs.neq(e[98],void 0)?(d.blobs.neq(e[96],void 0)?(e[101]=new d.Map(),e[101].set("armadillo_public_key",e[85]),e[101].set("armadillo_key_signature",e[98]),e[101].set("labyrinth_key_signature",e[96]),e[100]=e[101]):e[100]=void 0,e[99]=e[100]):e[99]=void 0,e[86]=e[99]}]):d.resolve(e[86]=void 0)},function(c){return e[86]!==void 0?d.sequence([function(a){return e[95]=e[86].get("armadillo_public_key"),d.nativeOperation(b("LSBase64Encode.nop"),e[95]).then(function(a){return a=a,e[96]=a[0],a})},function(a){return e[97]=e[86].get("armadillo_key_signature"),d.nativeOperation(b("LSBase64Encode.nop"),e[97]).then(function(a){return a=a,e[98]=a[0],a})},function(a){return e[99]=e[86].get("labyrinth_key_signature"),d.nativeOperation(b("LSBase64Encode.nop"),e[99]).then(function(a){return a=a,e[100]=a[0],a})},function(c){return e[105]=d.i64.cast([0,1e3]),e[101]=e[105],e[102]=new d.Map(),e[102].set("backup_id",a[1]),e[102].set("device_epoch_hmac",e[87]),e[102].set("epoch_root_key_fingerprint",e[68]),e[102].set("device_public_key",e[88]),e[102].set("epoch_storage_pubkey",e[89]),e[102].set("epoch_storage_pubkey_sig",e[90]),e[102].set("epoch_auth_pubkey",e[91]),e[102].set("epoch_auth_pubkey_sig",e[92]),e[102].set("ocmf_rotation_token",e[93]),e[102].set("virtual_device_id",e[94]),e[102].set("device_registration_id",a[11]),e[102].set("base_epoch_id",e[69]),e[102].set("encryption_version_data",e[84]),e[102].set("private_key_debug_token",e[79]),e[102].set("ocmf_client_state_debug_token",e[81]),e[102].set("epoch_storage_pvtkey_debug_token",e[83]),e[102].set("trace_id",a[8]),e[102].set("occam_only_eligible",!0),e[102].set("armadillo_public_key",e[96]==null?"":e[96]),e[102].set("armadillo_key_signature",e[98]==null?"":e[98]),e[102].set("labyrinth_key_signature",e[100]==null?"":e[100]),e[103]=d.toJSON(e[102]),d.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",d.i64.cast([0,50006]),e[103],d.i64.cast([0,0]),d.i64.cast([0,93]),d.i64.cast([0,0]),void 0,e[101]).then(function(a){return a=a,e[104]=a[0],a})}]):(function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] failed to get armadillo key and device signatures"),e[99]=d.i64.cast([0,1e3]),e[95]=e[99],e[96]=new d.Map(),e[96].set("backup_id",a[1]),e[96].set("device_epoch_hmac",e[87]),e[96].set("epoch_root_key_fingerprint",e[68]),e[96].set("device_public_key",e[88]),e[96].set("epoch_storage_pubkey",e[89]),e[96].set("epoch_storage_pubkey_sig",e[90]),e[96].set("epoch_auth_pubkey",e[91]),e[96].set("epoch_auth_pubkey_sig",e[92]),e[96].set("ocmf_rotation_token",e[93]),e[96].set("virtual_device_id",e[94]),e[96].set("device_registration_id",a[11]),e[96].set("base_epoch_id",e[69]),e[96].set("encryption_version_data",e[84]),e[96].set("private_key_debug_token",e[79]),e[96].set("ocmf_client_state_debug_token",e[81]),e[96].set("epoch_storage_pvtkey_debug_token",e[83]),e[96].set("trace_id",a[8]),e[96].set("occam_only_eligible",!0),e[97]=d.toJSON(e[96]),d.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",d.i64.cast([0,50006]),e[97],d.i64.cast([0,0]),d.i64.cast([0,93]),d.i64.cast([0,0]),void 0,e[95]).then(function(a){return a=a,e[98]=a[0],a}))},function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplMarkPoint.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_add_device_with_virtual_device_and_decryption_key_issue_add_device_task_end"):d.resolve()}]):d.sequence([function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: $device_epoch_hmac found to be null"):d.resolve()},function(a){return d.db.table(178).put({pk:d.i64.cast([0,1]),recoveryCodeStatus:d.i64.cast([0,4])})},function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] $device_epoch_hmac found to be null"),e[70]="$device_epoch_hmac found to be null",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",e[70]].join("")),e[69]=d.createArray(),void 0!==void 0?e[71]=(e[69].push(void 0),e[69]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",e[70],e[69],d.i64.cast([0,3]))}])}]):d.sequence([function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: $latest_epoch_data is null."):d.resolve()},function(a){return d.db.table(178).put({pk:d.i64.cast([0,1]),recoveryCodeStatus:d.i64.cast([0,4])})},function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] $latest_epoch_data is null."),e[62]="$latest_epoch_data is null.",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",e[62]].join("")),e[61]=d.createArray(),void 0!==void 0?e[63]=(e[61].push(void 0),e[61]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",e[62],e[61],d.i64.cast([0,3]))}])}]):d.sequence([function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: $mailbox root key is null"):d.resolve()},function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] $mailbox root key is null"),e[47]="$mailbox root key is null",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",e[47]].join("")),e[46]=d.createArray(),void 0!==void 0?e[48]=(e[46].push(void 0),e[46]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",e[47],e[46],d.i64.cast([0,3]))},function(a){return d.storedProcedure(b("LSHandleWrongRecoveryCode"),void 0,"[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] $mailbox root key is null",!1)}]):d.sequence([function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: oblivious validation token is null"):d.resolve()},function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] oblivious validation token is null"),e[47]="oblivious validation token is null",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",e[47]].join("")),e[46]=d.createArray(),void 0!==void 0?e[48]=(e[46].push(void 0),e[46]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",e[47],e[46],d.i64.cast([0,3]))},function(a){return d.storedProcedure(b("LSHandleWrongRecoveryCode"),void 0,"[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] oblivious validation token is null",!1)}]):d.sequence([function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: epoch root key is null"):d.resolve()},function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] epoch root key is null"),e[47]="epoch root key is null",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",e[47]].join("")),e[46]=d.createArray(),void 0!==void 0?e[48]=(e[46].push(void 0),e[46]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",e[47],e[46],d.i64.cast([0,3]))},function(a){return d.storedProcedure(b("LSHandleWrongRecoveryCode"),void 0,"[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] epoch root key is null",!1)}]):d.sequence([function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: epoch anon id is null"):d.resolve()},function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] epoch anon id is null"),e[47]="epoch anon id is null",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",e[47]].join("")),e[46]=d.createArray(),void 0!==void 0?e[48]=(e[46].push(void 0),e[46]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",e[47],e[46],d.i64.cast([0,3]))},function(a){return d.storedProcedure(b("LSHandleWrongRecoveryCode"),void 0,"[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] epoch anon id is null",!1)}])}]):d.sequence([function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_error","LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure: orf client state v1 is null"):d.resolve()},function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] orf client state v1 is null"),e[41]="orf client state v1 is null",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ","",e[41]].join("")),e[40]=d.createArray(),void 0!==void 0?e[42]=(e[40].push(void 0),e[40]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",e[41],e[40],d.i64.cast([0,3]))},function(a){return d.storedProcedure(b("LSHandleWrongRecoveryCode"),void 0,"[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] orf client state v1 is null",!1)}])},function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplMarkPoint.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_add_device_with_virtual_device_and_decryption_key_sproc_end"):d.resolve()}]):(f.item,d.sequence([function(a){return function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] An authoritative row already exists, aborting execution of addDeviceFromVirtualDevice"),d.db.table(178).put({pk:d.i64.cast([0,1]),recoveryCodeStatus:d.i64.cast([0,2])})},function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplMarkPoint.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_add_device_with_virtual_device_and_decryption_key_device_already_added"):d.resolve()},function(c){return a[8]!==void 0?d.nativeOperation(b("LSQplMarkPoint.nop"),d.i64.cast([0,1021646192]),a[8],"dasm_add_device_with_virtual_device_and_decryption_key_sproc_end"):d.resolve()}]))})},function(a){return e[2]=d.i64.of_float(Date.now()),e[3]=d.i64.random(),e[5]="Finishing execution. Execution time: ",e[6]=d.i64.to_string(d.i64.sub(e[2],e[0])),e[7]=" ms",e[4]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure] ",e[4],e[5],e[4],e[6],e[4],e[7]].join("")),d.i64.eq(d.i64.mod_(e[3],d.i64.cast([0,1e3])),d.i64.cast([0,0]))?(e[8]=",",e[9]=d.createArray(),void 0!==void 0?e[10]=(e[9].push(void 0),e[9]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",[e[5],e[8],e[6],e[8],e[7]].join(""),e[9],d.i64.cast([0,4]))):d.resolve()}])},function(a){return d.resolve(f)}])}a.__sproc_name__="LSEncryptedBackupsAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_recovery_code_status","secure_encrypted_backups_epochs"];d=a;g["default"]=d}),98);
__d("LSAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure",["LSAddDeviceWithVirtualDeviceAndDecryptionKey","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSAddDeviceWithVirtualDeviceAndDecryptionKey"),e.taskId,e.backupId,e.epochId,e.encryptedSecretValues,e.lastEpochId,e.syncEpochs,e.epochStoragePublicKey,e.backupTenancy,e.traceId,e.blobDecryptionKey,e.virtualDeviceId,e.deviceRegistrationId,e.minosEpoch);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("EBAddDeviceGraphQL",["CometRelay","EBAPIQPLPoints","EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery.graphql","EBGetLSVirtualDevices","EBMinosCheckWasmFeatureSupport","FBLogger","I64","LSAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure","LSDict","LSEncryptedBackupsBackupTenancy","LSFactory","LSParseRecoveryCode_v2.nop","LSShape","LSVec","MWEncryptedBackupsDeviceRegistrationId","ReQL","WAArrayBufferUtils","WABase64","WAResultOrError","WorkerRelay","WorkerRelayNetwork","gkx","qex"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h!==void 0?h:h=b("EBAddDeviceGraphQLEBFetchVirtualDeviceInfoQuery.graphql");function a(a){var b=a.backupId,c=a.qplFlow,e=a.recoveryCode,f=a.storage,g=a.userId;return d("WorkerRelayNetwork").getWorkerNetworkExecute().then(function(){return k({backupId:b,fetchQueryGraphQLFn:function(a,b){return d("WorkerRelay").createWorkerQuery(a,b)},qplFlow:c,recoveryCode:e,storage:f,userId:g})}).catch(function(){return d("WAResultOrError").makeError("worker-environment-error")})}function e(a){var b=a.backupId,c=a.environment,e=a.qplFlow,f=a.recoveryCode,g=a.storage;a=a.userId;return k({backupId:b,fetchQueryGraphQLFn:function(a,b){return d("CometRelay").fetchQuery(c,a,b,{fetchPolicy:"network-only"}).toPromise()},qplFlow:e,recoveryCode:f,storage:g,userId:a})}async function k(a){var b=a.backupId,e=a.fetchQueryGraphQLFn,g=a.qplFlow,h=a.recoveryCode,k=a.storage,p=a.userId,q=await d("EBMinosCheckWasmFeatureSupport").checkWasFeatureSupportAndGK();try{return o(k).then(function(a){var b=a!=null?a:p;g.addPoint(d("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_PARSE_RECOVERY_CODE_START);return Promise.all([k.runInTransaction(function(a){return c("LSParseRecoveryCode_v2.nop")(a,0,h,b,c("LSVec").ofArray([]))},"readwrite","ui",void 0,f.id+":209"),Promise.resolve(b)])}).then(function(a){g.addPoint(d("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_PARSE_RECOVERY_CODE_END);var h=a[0][0],o=a[0][1];a=a[1];if(h==null||o==null)return d("WAResultOrError").makeError("missing-mandatory-field");var p=d("WABase64").encodeB64(h);g.addPoint(d("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_FETCH_VD_GRAPHQL_START);return e(j,{request_uuid:a,virtual_device_id:p}).then(function(a){var e,j;if((a==null||(e=a.fetch_virtual_device_info_for_device_addition_v2)==null?void 0:e.ok)===!1){var p,r,s;g.addAnnotations({string:{fetch_vd_info_error_code:(p=a==null||(r=a.fetch_virtual_device_info_for_device_addition_v2)==null||(r=r.error)==null?void 0:r.code)!=null?p:""}});g.addPoint(d("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_FETCH_VD_GRAPHQL_END);return(a==null||(s=a.fetch_virtual_device_info_for_device_addition_v2)==null||(s=s.error)==null?void 0:s.code)==="NO_VIRTUAL_DEVICE_FOUND"?d("EBGetLSVirtualDevices").getLSVirtualDevices(k).then(function(a){a.length>0&&g.addPoint(d("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_VIRTUAL_DEVICE_EXISTS);return d("WAResultOrError").makeError("graphql-fetch-vd-error")}):d("WAResultOrError").makeError("graphql-fetch-vd-error")}g.addPoint(d("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_FETCH_VD_GRAPHQL_END);p=a==null||(j=a.fetch_virtual_device_info_for_device_addition_v2)==null?void 0:j.data;a=d("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId();var t=(p==null?void 0:p.encrypted_secret_values)!=null?n(p==null?void 0:p.encrypted_secret_values):null,u=p==null?void 0:p.epoch_storage_public_key,v=p==null?void 0:p.epoch_id,w=p==null?void 0:p.last_epoch_id;if(p==null||a===""||t==null||v==null||u==null||w==null){var x=[];p==null&&x.push("payload");a===""&&x.push("deviceRegistrationId");t==null&&x.push("validated_encrypted_secret_values");v==null&&x.push("epoch_id");u==null&&x.push("epoch_storage_public_key");w==null&&x.push("last_epoch_id");g.addPoint(d("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_MISSING_GRAPHQL_FIELDS,{string_array:{missing_mandatory_field:x}});return d("WAResultOrError").makeError("missing-mandatory-field")}var y=new(c("LSDict"))();p.sync_epochs.forEach(function(a){var b=l(a);b!=null&&a.epoch_id!=null&&y.set(a.epoch_id,d("LSShape").ofRecord(b))});p=m({epoch_head:(x=p.minos_epoch)==null?void 0:x.epoch_head,self_epoch_signature:(x=p.minos_epoch)==null?void 0:x.self_epoch_signature});g.addPoint(d("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_VIRTUAL_DEVICE_KEY_SPROC_START);var z={backupId:b,backupTenancy:(i||(i=d("I64"))).of_int32(c("LSEncryptedBackupsBackupTenancy").PRODUCTION),blobDecryptionKey:o,deviceRegistrationId:a,encryptedSecretValues:d("LSShape").ofRecord(t),epochId:i.of_string(v),epochStoragePublicKey:d("WABase64").decodeB64(u),lastEpochId:i.of_string(w),syncEpochs:y,taskId:i.of_int32(0),traceId:g.getQPLAttrs().instanceKey.toString(),virtualDeviceId:h};(q||c("gkx")("17219"))&&(z=babelHelpers.extends({},z,{minosEpoch:p}));return k.runInTransaction(function(a){return c("LSAddDeviceWithVirtualDeviceAndDecryptionKeyStoredProcedure")(c("LSFactory")(a),z)},"readwrite",void 0,void 0,f.id+":382").then(function(){g.addPoint(d("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_VIRTUAL_DEVICE_KEY_SPROC_END);return d("WAResultOrError").makeResult()}).catch(function(a){g.addPoint(d("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_VIRTUAL_DEVICE_KEY_SPROC_FAIL,{string:{error_message:a.message}});return d("WAResultOrError").makeError("vd-and-decryption-key-sproc-error")})}).catch(function(a){g.addPoint(d("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_FETCH_VD_GRAPHQL_FAIL,{string:{error_message:a.message}});return d("WAResultOrError").makeError("graphql-fetch-vd-error")})}).catch(function(a){g.addPoint(d("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_PARSE_RECOVERY_CODE_FAIL,{string:{error_message:a.message}});return d("WAResultOrError").makeError("parse-recovery-code-error")})}catch(a){c("FBLogger")("wmi_eb").catching(a).mustfix("Runtime error performing EBAddDeviceGraphQL: %s",a);g.addPoint(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_RUNTIME_ERROR,{string:{error_message:a.message}});return Promise.resolve(d("WAResultOrError").makeError("runtime-error"))}}function l(a){var b=a.backup_id,e=a.encrypted_epoch_key,f=a.epoch_anon_id,g=a.epoch_auth_public_key,h=a.epoch_data_v2,j=a.epoch_id,k=a.is_active_epoch,l=a.minos_epoch,m=a.next_epoch_id;a=a.prev_epoch_id;if(b==null||f==null||g==null||j==null||k==null)return null;var n=l==null?void 0:l.epoch_head;l=l==null?void 0:l.self_epoch_signature;n=n!=null&&l!=null?d("LSShape").ofRecord({epoch_head:d("WABase64").decodeB64(n),self_epoch_signature:d("WABase64").decodeB64(l)}):void 0;l=h==null?void 0:h.epoch_anon_id;h=h==null?void 0:h.epoch_root_key;l=l!=null&&h!=null?{epoch_anon_id:l,epoch_root_key:h}:null;h={backup_id:(i||(i=d("I64"))).of_string(b),encrypted_epoch_key:e!=null?d("WABase64").decodeB64(e):null,epoch_anon_id:d("WAArrayBufferUtils").stringToArrayBuffer(f),epoch_auth_public_key:d("WABase64").decodeB64(g),epoch_data_v2:l?d("LSShape").ofRecord(l):null,epoch_id:i.of_string(j),is_active_epoch:k,next_epoch_id:m!=null?(i||(i=d("I64"))).of_string(m):null,prev_epoch_id:a!=null?(i||(i=d("I64"))).of_string(a):null};(c("qex")._("208")===!0||c("gkx")("17219"))&&(h=babelHelpers.extends({},h,{minos_epoch:n}));return h}function m(a){var b=a.epoch_head;a=a.self_epoch_signature;return b==null||a==null?void 0:d("LSShape").ofRecord({epoch_head:d("WABase64").decodeB64(b),self_epoch_signature:d("WABase64").decodeB64(a)})}function n(a){var b=a.encrypted_epoch_anon_id,c=a.encrypted_epoch_root_key,d=a.encrypted_epoch_storage_private_key,e=a.encrypted_mailbox_root_key_blob,f=a.encrypted_oblivious_validation_token_blob,g=a.encrypted_ocmf_client_state;a=a.encrypted_orf_client_state_v2;return b==null||c==null||e==null||f==null||g==null?null:{encrypted_epoch_anon_id:b,encrypted_epoch_root_key:c,encrypted_epoch_storage_private_key:d,encrypted_mailbox_root_key_blob:e,encrypted_oblivious_validation_token_blob:f,encrypted_ocmf_client_state:g,encrypted_orf_client_state_v2:a}}function o(a){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.encrypted_backups)).then(function(a){a=a==null?void 0:a.encryptionManagementDelegatorId;return a!=null?(i||(i=d("I64"))).to_string(a):null})}g.addDeviceGraphQLWorker=a;g.addDeviceGraphQL=e}),98);
__d("LSOnboardFromExistingDeviceStart",["LSGetLatestEpochKeys","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][onboardFromExistingDeviceStart] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.db.table(282).add({stateKey:"auto_restored",stateValue:"true"})},function(b){return c.db.table(185).add({pk:c.i64.cast([0,1]),backupId:a[0],deviceRegistrationId:a[2],taskId:c.i64.cast([0,1])})},function(a){return c.storedProcedure(b("LSGetLatestEpochKeys"),!1).then(function(a){return a=a,d[2]=a[0],d[3]=a[1],a})},function(e){return d[2]!==void 0?c.sequence([function(e){return d[11]=d[2].get("epoch_keys"),d[12]=d[11].get("epoch_id"),d[13]=new c.Map(),d[13].set("existing_device_id",a[1]),d[13].set("base_epoch_id",d[12]),d[14]=new c.Map(),d[14].set("success",d[13]),d[15]=c.toJSON(d[14]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"meb_onboard_from_existing_device",c.i64.cast([0,50036]),d[15],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[4]=void 0}]):c.sequence([function(a){return d[3]!==void 0?c.sequence([function(a){return d[12]=d[3].get("error_message"),d[13]=d[3].get("error_code"),d[14]=new c.Map(),d[14].set("error_code",d[13]),d[14].set("stored_procedure","onboardFromExistingDeviceStart"),d[14].set("error_message",d[12]),d[15]=new c.Map(),d[15].set("failure",d[14]),d[16]=c.toJSON(d[15]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"meb_onboard_from_existing_device",c.i64.cast([0,50036]),d[16],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[17]=a[0],a})},function(a){return d[18]=new c.Map(),d[18].set("error_code",d[13]),d[18].set("stored_procedure","LSEncryptedBackupsOnboardFromExistingDeviceStartStoredProcedure"),d[18].set("error_message",""),d[11]=d[18]}]):c.sequence([function(a){return d[12]=new c.Map(),d[12].set("error_code",c.i64.cast([0,603])),d[12].set("stored_procedure","onboardFromExistingDeviceStart"),d[12].set("error_message","Unknown error encountered"),d[13]=new c.Map(),d[13].set("failure",d[12]),d[14]=c.toJSON(d[13]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"meb_onboard_from_existing_device",c.i64.cast([0,50036]),d[14],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[15]=a[0],a})},function(a){return d[16]=new c.Map(),d[16].set("error_code",c.i64.cast([0,603])),d[16].set("stored_procedure","LSEncryptedBackupsOnboardFromExistingDeviceStartStoredProcedure"),d[16].set("error_message",""),d[11]=d[16]}])},function(a){return d[4]=d[11]}])},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[8]="Finishing execution. Execution time: ",d[9]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[10]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][onboardFromExistingDeviceStart] ",d[7],d[8],d[7],d[9],d[7],d[10]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[11]=",",d[12]=c.createArray(),void 0!==void 0?d[13]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"onboardFromExistingDeviceStart",[d[8],d[11],d[9],d[11],d[10]].join(""),d[12],c.i64.cast([0,4]))):c.resolve()},function(a){return e[0]=d[4]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsOnboardFromExistingDeviceStartStoredProcedure";a.__tables__=["experiences_shared_state","device_metadata"];e.exports=a}),null);
__d("LSOnboardFromExistingDeviceStartStoredProcedure",["LSOnboardFromExistingDeviceStart","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSOnboardFromExistingDeviceStart"),e.backupId,e.previousDeviceId,e.newDeviceRegistrationId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("EBAddDeviceWithKeys",["ClientConsistencyEventEmitter","CurrentAppID","EBAPIQPLPoints","EBDB","EBSMAPI","EBSMGatingUI","I64","LSAuthorityLevel","LSFactory","LSIntEnum","LSOnboardFromExistingDeviceStartStoredProcedure","LSShape","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEBODSEntityName.enum","MWEncryptedBackupsInitializeRestoreDeferred","MWEncryptedBackupsLocalStorageEntryEnum","MWEncryptedBackupsSharedState","ODS","Promise","QPLFlow","QPLUserFlow","ReQL","WAHashStringToNumber","WALogger","err","getErrorSafe","justknobx","promiseDone","qpl","requireDeferred","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t=c("requireDeferred")("MWEBUseLocalStorage").__setRef("EBAddDeviceWithKeys");function a(a){var e=a.backupId,g=a.db,o=a.newDeviceRegistrationId,v=a.previousDeviceId,w=a.source,x=a.trackAddingDevice;return new(s||(s=b("Promise")))(function(a,b){d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithEBKeys start"])));c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"START_LS_ADD_DEVICE_WITH_EB_KEYS_SPROC");var s=d("WAHashStringToNumber").hashStringToNumber(c("uuidv4")()),y=c("qpl")._(521473756,"2768"),z=w,A=d("QPLFlow").startQPLFlow(y,{annotations:{bool:{isEBAddDeviceWithKeys:!0,isInWorker:!1},string:{restore_type:z}},instanceKey:s,timeoutInMs:c("justknobx")._("2444")});A.addPoint(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_START);(p||(p=d("ODS"))).bumpEntityKey(7319,z,"start");d("WALogger").LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithEBKeys caling LSOnboardFromExistingDeviceStartStoredProcedure"])));g.runInTransaction(function(a){return c("LSOnboardFromExistingDeviceStartStoredProcedure")(c("LSFactory")(a),{backupId:e,newDeviceRegistrationId:o,previousDeviceId:v})},"readwrite",void 0,void 0,f.id+":103").then(function(e){e=e[0];c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"END_LS_ADD_DEVICE_WITH_EB_KEYS_SPROC");A.addPoint(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_END);if(e!=null){var f,h=d("LSShape").toRecord(e).error_message;c("QPLUserFlow").addPoint((f=d("MWChatEncryptedBackupsQPLEvents")).restoreDeviceAuthQplEvent,"FAIL_LS_ADD_DEVICE_WITH_EB_KEYS_SPROC_WIPE_EBSM");c("QPLUserFlow").addPoint(f.restoreQplEvent,"FAIL_LS_ADD_DEVICE_WITH_EB_KEYS_SPROC_WIPE_EBSM");d("MWChatEncryptedBackupsLogging").endFailure({errorName:h,event:f.restoreQplEvent});d("MWChatEncryptedBackupsLogging").endFailure({errorName:h,event:f.restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH});A.endFail(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_FAILURE,{string:{error_code:(q||(q=d("I64"))).to_string(d("LSShape").toRecord(e).error_code),error_message:h}});(p||(p=d("ODS"))).bumpEntityKey(7319,z,"fail");d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithKeys sproc failed, isInWorker: false, error: ",""])),h);c("promiseDone")(d("EBDB").clearEbStores());switch(d("CurrentAppID").getAppID()){case 772021112871879..toString():c("ClientConsistencyEventEmitter").emit("hardRefresh","eb_autorestore_error");break;default:c("ClientConsistencyEventEmitter").emit("softRefresh","eb_autorestore_error")}b(c("err")(h))}A.addPoint(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SUBSCRIPTION_START);var i=d("ReQL").fromTableAscending(g.tables.secure_encrypted_backups_client_state).subscribe(function(e,f){if(f.operation==="delete"){i();e="[wmi][ebsm] EBAPI addDeviceWithKeys subscription failed, isInWorker: false, error: client state deleted";u(e,A,z);b(c("err")(e))}else if(f.operation==="add"||f.operation==="put"){e=f.value;f=e.authorityLevel;e=e.deviceId;(q||(q=d("I64"))).equal(f,(r||(r=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))&&(c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"END_LS_ADD_DEVICE_WITH_EB_KEYS_TASK"),A.addPoint(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SUBSCRIPTION_END),i(),c("promiseDone")(d("MWEncryptedBackupsSharedState").upsertEBSharedStateEntry({db:g,stateKey:c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_RESTORED_SUCCESSFULLY})),d("WALogger").LOG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithEBKeys client state row added"]))),x(e),t.onReady(function(a){var b=a.mwEBCreateLocalStorageEntry;a=a.mwEBDeleteLocalStorageEntry;b(c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_RESTORED_IN_CURRENT_SESSION);b(c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_RESTORED_IN_CURRENT_SESSION_2);a(c("MWEncryptedBackupsLocalStorageEntryEnum").EBSM_CORRUPTION_WIPE)}),d("MWEncryptedBackupsInitializeRestoreDeferred").encryptedBackupsInitializeRestoreDeferred({db:g,onFailure:function(){d("MWChatEncryptedBackupsLogging").endFailure({annotations:{bool:{is_backend_setup:d("EBSMGatingUI").isBackendSetupSuccessfulForEBSM()}},errorName:"FAILED_TO_RESTORE_ENCRYPTED_BACKUP",event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),d("MWChatEncryptedBackupsLogging").endFailure({annotations:{bool:{is_backend_setup:d("EBSMGatingUI").isBackendSetupSuccessfulForEBSM()}},errorName:"FAILED_TO_RESTORE_ENCRYPTED_BACKUP",event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH}),d("WALogger").ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithEBKeys initialize restore failed"])))},onSuccess:function(){c("QPLUserFlow").addAnnotations(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,{string:{restore_type:"auto_restore"}}),d("MWChatEncryptedBackupsLogging").endSuccess({annotations:{bool:{is_backend_setup:d("EBSMGatingUI").isBackendSetupSuccessfulForEBSM()}},event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH}),d("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI addDeviceWithEBKeys initialize restore success"])))}}),c("EBSMAPI").fetchBackupIds("EBAddDeviceWithKeys")["catch"](function(a){d("WALogger").ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["",""])),c("getErrorSafe")(a).message)}),A.endSuccess(),(p||(p=d("ODS"))).bumpEntityKey(7319,z,"success"),a())}})})["catch"](function(a){a="[wmi][ebsm] EBAPI addDeviceWithKeys sproc error, isInWorker: false, error: "+c("getErrorSafe")(a).message;u(a,A,z);b(c("err")(a))})})}function u(a,b,e){d("MWChatEncryptedBackupsLogging").endFailure({annotations:{bool:{isBackendSetupOnFail:d("EBSMGatingUI").isBackendSetupSuccessfulForEBSM()}},errorName:a,event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),d("MWChatEncryptedBackupsLogging").endFailure({errorName:a,event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH}),b.endFail(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_SPROC_FAILURE,{string:{error_message:a}}),(p||(p=d("ODS"))).bumpEntityKey(7319,e,"fail"),d("WALogger").ERROR(o||(o=babelHelpers.taggedTemplateLiteralLoose(["",""])),a)}g.addDeviceWithEBKeys=a}),98);
__d("MWEncryptedBackupsRecoveryCodeStatus",["FBLogger","I64","LSEncryptedBackupsRecoveryCodeStatus"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var b=a.onFailure,e=a.onInvalidRecoveryCode,f=a.onSuccess;a=a.recoveryCodeStatusData;if((a==null?void 0:a.length)!==1)return;a=a[0].recoveryCodeStatus;switch((h||(h=d("I64"))).to_int32(a)){case c("LSEncryptedBackupsRecoveryCodeStatus").OPTIMISTIC:return c("LSEncryptedBackupsRecoveryCodeStatus").OPTIMISTIC;case c("LSEncryptedBackupsRecoveryCodeStatus").INVALID:e==null||e();return c("LSEncryptedBackupsRecoveryCodeStatus").INVALID;case c("LSEncryptedBackupsRecoveryCodeStatus").VALID:f==null||f();return c("LSEncryptedBackupsRecoveryCodeStatus").VALID;case c("LSEncryptedBackupsRecoveryCodeStatus").SYSTEM_ERROR:b==null||b();return c("LSEncryptedBackupsRecoveryCodeStatus").SYSTEM_ERROR;default:b==null||b(),c("FBLogger")("wmi_eb").mustfix("Invalid Recovery Code Status type")}}g.encryptedBackupsGetRecoveryCodeStatus=a}),98);
__d("EBAddDeviceWithRecoveryCode",["EBAPIQPLPoints","EBAddDeviceGraphQL","EBDeps","FBLogger","MWEncryptedBackupsRecoveryCodeStatus","QPLUserFlow","ReQL","WALogger","WAResultOrError","isInstamadilloEB","justknobx","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=10;function k(a){var b=a.count,e=a.storage;return new Promise(function(a,f){if(b===j)return a();c("promiseDone")(d("ReQL").firstAsync(d("ReQL").fromTableAscending(e.tables.encrypted_backups)),function(c){c=c==null?void 0:c.backupId;if(c!=null)return a(c);window.setTimeout(function(){a(k({count:b+1,storage:e}))},1e3)},function(a){return f(a)})})}var l=c("qpl")._(521484295,"1460");function a(a){var b=a.environment,e=a.qplFlow,f=a.recoveryCode,g=a.userId,j=function(){},o=!1;a=new Promise(function(a,b){window.setTimeout(function(){if(o)return;c("FBLogger")("wmi_eb").warn("Add device failed by timeout 90 sec");e.addPoint(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_TIMEOUT);a("ADD_DEVICE_TIMEOUT")},c("justknobx")._("4226"))});var p=new Promise(async function(a,m){e.addPoint(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_WAIT_FOR_EBLS_START);var o=await d("EBDeps").getDeps().getLSDB();e.addPoint(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_WAIT_FOR_EBLS_END);void d("EBDeps").getDeps().trackOverprompting(l);j=o.tables.secure_encrypted_backups_recovery_code_status.subscribe(function(b,f){if(f.operation==="delete")return;b=[f.value];e.addPoint(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_CHECK_RC_STATUS);d("MWEncryptedBackupsRecoveryCodeStatus").encryptedBackupsGetRecoveryCodeStatus({onFailure:function(){n(e,d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_FAILED_TO_GET_RC_STATUS),j(),a("ADD_DEVICE_FAILED_TO_GET_RC_STATUS")},onInvalidRecoveryCode:function(){n(e,d("EBAPIQPLPoints").EBAddDeviceQPLPoints.INVALID_RECOVERY_CODE),j(),a("INVALID_RECOVERY_CODE")},onSuccess:function(){e.addPoint(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_TASK_END),e.endSuccess({bool:{isBackendSetupOnSuccess:d("EBDeps").getDeps().isBackendSetupSuccessful()}}),j(),c("isInstamadilloEB")()&&c("QPLUserFlow").endSuccess(l),d("EBDeps").getDeps().trackAddingNewDevice().finally(function(){a("SUCCESS")})},recoveryCodeStatusData:b})});c("promiseDone")(k({count:0,storage:o}),function(c){if(c!=null){d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI add device gql start"])));e.addPoint(d("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_GQL_START);c=b!=null?d("EBAddDeviceGraphQL").addDeviceGraphQL({backupId:c,environment:b,qplFlow:e,recoveryCode:f,storage:o,userId:g}):d("EBAddDeviceGraphQL").addDeviceGraphQLWorker({backupId:c,qplFlow:e,recoveryCode:f,storage:o,userId:g});return c.then(function(b){if(b.success)e.addPoint(d("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_GQL_END),e.addPoint(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_TASK_START),d("WALogger").LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[wmi][ebsm] EBAPI add device gql success"])));else{n(e,d("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_GQL_FAIL,{string:{fail_result:b.error}});e.addPoint(d("EBAPIQPLPoints").EBAddDeviceGraphqlQPLPoints.ADD_DEVICE_GQL_FAIL);j();return a("ADD_DEVICE_GRAPHQL_ERROR")}})}else{n(e,d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_FAILURE_BACKUP_NOT_FOUND);j();return a("ADD_DEVICE_ERROR_BACKUP_ID_NOT_DEFINED")}},function(b){c("FBLogger")("wmi_eb").catching(b).mustfix("Add device failed. Could not find backup.");n(e,d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_COULD_NOT_FIND_BACKUP,{string:{error_message:b.message}});j();return a("ADD_DEVICE_ERROR_COULD_NOT_READ_BACKUP_TABLE")})});return Promise.race([p,a]).then(function(a){o=!0;return m(a)})}function m(a){return a==="SUCCESS"?d("WAResultOrError").makeResult():d("WAResultOrError").makeError(a)}var n=function(a,b,c){a.endFail(b,babelHelpers.extends({},c!=null?c:{},{bool:{isBackendSetupOnFail:d("EBDeps").getDeps().isBackendSetupSuccessful()}}))};g.addDeviceWithRecoveryCode=a}),98);
__d("EBBucketUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a,b,c){b===void 0&&(b=100);c===void 0&&(c=5);if(a===0)return"zero";if(a<0)return"negative";if(c<=0)return"invalidIncrement";if(a>b)return"greaterThanLimit";a=Math.floor((a-1)/c)*c+1;c=Math.min(a+c-1,b);return a+"-"+c}f.getBucketName=a}),66);
__d("LSDeleteBackups",["LSBase64Encode.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSOcmfClientMap.nop","justknobx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1],e=[],f=[];return d.sequence([function(g){return d.sequence([function(f){return e[0]=d.i64.of_float(Date.now()),function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsDeleteBackupsStoredProcedure] Beginning execution."),c("justknobx")._("803")?d.sequence([function(c){return d.db.table(168).fetch([[[a[0]]]]).next().then(function(c,f){var g=c.done;c=c.value;return g?(function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsDeleteBackupsStoredProcedure] Row not found in client state table for the backupidDeleting the backup without deleting mailbox"),e[9]=new d.Map(),e[9].set("backup_id",a[0]),e[9].set("trace_id",a[1]),e[9].set("backup_deletion_source",a[2]),e[10]=d.toJSON(e[9]),d.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",d.i64.cast([0,50011]),e[10],d.i64.cast([0,0]),d.i64.cast([0,93]),d.i64.cast([0,0]),a[1],d.i64.cast([0,0])).then(function(a){return a=a,e[11]=a[0],a})):(f=c.item,d.sequence([function(c){return e[13]=f.deviceId,d.nativeOperation(b("LSGetBlobFromString.nop"),d.i64.to_string(a[0])).then(function(a){return a=a,e[9]=a[0],a})},function(a){return d.nativeOperation(b("LSHmac_v2.nop"),d.blob("bWFpbGJveF9pZF9zY29wZQ=="),e[9]).then(function(a){return a=a,e[10]=a[0],a})},function(a){return d.nativeOperation(b("LSOcmfClientMap.nop"),f.ocmfClientStateBlob,e[10]).then(function(a){return a=a,e[11]=a[0],a})},function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[11]).then(function(a){return a=a,e[12]=a[0],a})},function(c){return d.i64.neq(e[13],void 0)?(e[14]=new d.Map(),e[14].set("device_id",e[13]),e[14].set("mailbox_partial_id",e[12]==null?"":e[12]),e[14].set("trace_id",a[1]),e[14].set("backup_deletion_source",a[2]),e[15]=d.toJSON(e[14]),d.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"messenger_encrypted_backups",d.i64.cast([0,50014]),e[15],d.i64.cast([0,0]),d.i64.cast([0,93]),d.i64.cast([0,0]),a[1],d.i64.cast([0,0])).then(function(a){return a=a,e[16]=a[0],a})):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDeleteBackupsStoredProcedure] device_id is null"),e[15]="device_id is null",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsDeleteBackupsStoredProcedure] ","",e[15]].join("")),e[14]=d.createArray(),void 0!==void 0?e[19]=(e[14].push(void 0),e[14]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeleteBackupsStoredProcedure",e[15],e[14],d.i64.cast([0,3]))},function(c){return e[16]=new d.Map(),e[16].set("backup_id",a[0]),e[16].set("trace_id",a[1]),e[16].set("backup_deletion_source",a[2]),e[17]=d.toJSON(e[16]),d.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",d.i64.cast([0,50011]),e[17],d.i64.cast([0,0]),d.i64.cast([0,93]),d.i64.cast([0,0]),a[1],d.i64.cast([0,0])).then(function(a){return a=a,e[18]=a[0],a})}])}]))})},function(a){return e[1]=d.i64.cast([0,0])}]):d.resolve((function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsDeleteBackupsStoredProcedure] backup deletion flow is not enabled"),e[1]=d.i64.cast([0,1])))},function(a){return e[2]=d.i64.of_float(Date.now()),e[3]=d.i64.random(),e[5]="Finishing execution. Execution time: ",e[6]=d.i64.to_string(d.i64.sub(e[2],e[0])),e[7]=" ms",e[4]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsDeleteBackupsStoredProcedure] ",e[4],e[5],e[4],e[6],e[4],e[7]].join("")),d.i64.eq(d.i64.mod_(e[3],d.i64.cast([0,1e3])),d.i64.cast([0,0]))?(e[8]=",",e[9]=d.createArray(),void 0!==void 0?e[10]=(e[9].push(void 0),e[9]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeleteBackupsStoredProcedure",[e[5],e[8],e[6],e[8],e[7]].join(""),e[9],d.i64.cast([0,4]))):d.resolve()},function(a){return f[0]=e[1]}])},function(a){return d.resolve(f)}])}a.__sproc_name__="LSEncryptedBackupsDeleteBackupsStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state"];d=a;g["default"]=d}),98);
__d("LSDeleteBackupsStoredProcedure",["LSDeleteBackups","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSDeleteBackups"),e.backupId,e.traceId,e.backupDeletionSource);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("encryptedBackupsDeleteBackupsStoredProcedure",["LSDeleteBackupsStoredProcedure","LSEncryptedBackupsOpStatus","LSFactory","LSIntEnum","LSResult","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.encrypted_backups)).then(async function(g){var i=c("LSResult")((h||(h=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsOpStatus").FAILURE));if(g!=null){var j=g.backupId;j!=null&&(i=await a.runInTransaction(function(a){return c("LSDeleteBackupsStoredProcedure")(c("LSFactory")(a),{backupDeletionSource:(h||(h=d("LSIntEnum"))).ofNumber(b),backupId:j,traceId:e})},"readwrite",void 0,void 0,f.id+":37"))}return i})}g.default=a}),98);
__d("EBDeleteMailbox",["EBAPIQPLPoints","EBDeps","EBSMAPI","LSEncryptedBackupsOpStatus","LSIntEnum","QPLUserFlow","Random","WAGetSafeQPLError","WATagsLogger","encryptedBackupsDeleteBackupsStoredProcedure","err","justknobx","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=d("WATagsLogger").TAGS(["EB","EBAPIDeleteMailbox"]);async function a(a){var b=a.reason,e=await d("EBDeps").getDeps().getLSDB(),f=c("qpl")._(521484370,"2995"),g=d("Random").uint32();c("QPLUserFlow").start(f,{instanceKey:g,timeoutInMs:c("justknobx")._("4553")});c("QPLUserFlow").addPoint(f,d("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_SPROC_START,{instanceKey:g});c("QPLUserFlow").addAnnotations(f,{int:{instanceKey:g},string:{traceId:g.toString()}},{instanceKey:g});return new Promise(function(a,k){c("encryptedBackupsDeleteBackupsStoredProcedure")(e,b,g.toString()).then(function(b){b=b[0];if(b===(i||(i=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsOpStatus").FAILURE)){c("QPLUserFlow").addPoint(f,d("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_SPROC_FAIL,{instanceKey:g});c("QPLUserFlow").endFailure(f,"delete_eb_sproc_fail",{instanceKey:g});k(c("err")("delete_eb_sproc_fail"));return}c("QPLUserFlow").addPoint(f,d("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_SPROC_SUCCESS,{instanceKey:g});var h=e.tables.encrypted_backups.subscribe(function(b,e){if(e.operation==="put")if(e.value.backupId==null){c("QPLUserFlow").addPoint(f,d("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_TASK_SUCCESS,{instanceKey:g});c("QPLUserFlow").addPoint(f,d("EBAPIQPLPoints").EBDeleteEBQPLPoints.FETCH_BACKUP_IDS_START,{instanceKey:g});c("promiseDone")(c("EBSMAPI").fetchBackupIds("EBDeleteMailbox"),function(){c("QPLUserFlow").addPoint(f,d("EBAPIQPLPoints").EBDeleteEBQPLPoints.FETCH_BACKUP_IDS_END,{instanceKey:g}),c("QPLUserFlow").endSuccess(f,{instanceKey:g})},function(){c("QPLUserFlow").addPoint(f,d("EBAPIQPLPoints").EBDeleteEBQPLPoints.FETCH_BACKUP_IDS_END,{instanceKey:g}),c("QPLUserFlow").endFailure(f,"fetch_backup_ids_fail",{instanceKey:g})});a();return h()}else c("QPLUserFlow").addPoint(f,d("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_NON_DELETE_OPERATION,{instanceKey:g});else c("QPLUserFlow").addPoint(f,d("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_NON_PUT_OPERATION,{instanceKey:g})},void 0,["backupId"])}).catch(function(a){j.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Exception while calling deleteBackups stored procedure: ",""])),a),c("QPLUserFlow").addPoint(f,d("EBAPIQPLPoints").EBDeleteEBQPLPoints.DELETE_EB_SPROC_FAIL,{data:{string:{error:d("WAGetSafeQPLError").getSafeQPLErrorMessage(a)}},instanceKey:g}),c("QPLUserFlow").endFailure(f,"delete_eb_sproc_fail",{instanceKey:g}),k(a)})})}g.deleteMailbox=a}),98);
__d("EBFetchBackupIds",["EBDeps","I64","LSAuthorityLevel","LSEncryptedBackupsBackupTenancy","LSFactory","LSFetchBackupIdsStoredProcedure","LSIntEnum","MWEBODSEntityName.enum","ODS","err","justknobx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=c("justknobx")._("3868");async function a(a,b){(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MW_EBSM_FETCH_BACKUP_IDS,a);b.addPoint("eb_fetch_backup_ids_get_storage_start");var e=await d("EBDeps").getDeps().getLSDB();b.addPoint("eb_fetch_backup_ids_get_storage_ended");return new Promise(function(a,f){var g,h=e.tables.encrypted_backups.subscribe(function(e,f){if(f.operation==="delete"||!(i||(i=d("I64"))).equal(f.value.authorityLevel,(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))){f.operation==="delete"?b.addPoint("eb_fetch_backup_ids_delete_detected"):b.addPoint("eb_fetch_backup_ids_authority_level_not_auth");return}h();window.clearTimeout(g);b.addPoint("eb_fetch_backup_ids_success");b.endSuccess();a()});b.addPoint("eb_fetch_backup_ids_sproc_start");c("promiseDone")(e.runInTransaction(function(a){return c("LSFetchBackupIdsStoredProcedure")(c("LSFactory")(a),{backupTenancy:(j||(j=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION),isUiBlocking:!1}).then(function(){b.addPoint("eb_fetch_backup_ids_sproc_ended"),g=window.setTimeout(function(){b.endFail("eb_fetch_backup_ids_timeout"),f(c("err")("[wmi][ebapi] Timeout fetching backup ids"))},k)})},"readwrite"))})}g.fetchBackupIds=a}),98);
__d("EBGetCryptoWasm",["WAWasmModuleCache","bx"],(function(a,b,c,d,e,f,g){"use strict";var h=c("bx").getURL(c("bx")("32099"));a=function(){return d("WAWasmModuleCache").loadWasmModule(h)};g.getCryptoWasm=a}),98);
__d("EBGetEBStateQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="23909871918604871"}),null);
__d("EBGetEBStateQuery.graphql",["EBGetEBStateQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};a={alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'},{alias:null,args:null,kind:"ScalarField",name:"has_seen_eb_auto_restore_notice",storageKey:null},a,{alias:null,args:null,kind:"ScalarField",name:"is_user_opted_out",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_creation_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_tenancy",storageKey:null},{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"creation_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_created_on",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null},a,{alias:null,args:null,kind:"ScalarField",name:"migration_status",storageKey:null}],storageKey:null}],storageKey:null},{kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"backup_state",storageKey:null}]}],storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"EBGetEBStateQuery",selections:[{kind:"RequiredField",field:a,action:"LOG",path:"viewer"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"EBGetEBStateQuery",selections:[a]},params:{id:b("EBGetEBStateQuery_facebookRelayOperation"),metadata:{},name:"EBGetEBStateQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("EBGetEBState",["EBGetEBStateQuery.graphql","FBLogger","MAWOneTimeCodeGating","RelayHooks","WAResultOrError","XPlatRelayEnvironment"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h!==void 0?h:h=b("EBGetEBStateQuery.graphql");async function a(){try{var a,b,e,f,g,h,j,k,l,m,n=await d("RelayHooks").fetchQuery(d("XPlatRelayEnvironment").getRelayEnvironment(),i,{}).toPromise().then(function(a){return a}),o=n==null||(a=n.viewer)==null?void 0:a.backup_state;if(o===1||o===0)return d("WAResultOrError").makeResult({backupStatus:o});o=(o=n==null||(b=n.viewer)==null||(b=b.encrypted_backup)==null?void 0:b.virtual_devices)!=null?o:[];var p=o.filter(function(a){return a.device_type==="HSM"});o=o.filter(function(a){return a.device_type===1});return d("WAResultOrError").makeResult({backupStatus:(n==null||(e=n.viewer)==null?void 0:e.backup_state)!=null?n.viewer.backup_state:0,ebState:{backupMetadata:{backupId:(f=n==null||(g=n.viewer)==null||(g=g.encrypted_backup)==null?void 0:g.id)!=null?f:"",creationTime:(f=n==null||(h=n.viewer)==null||(h=h.encrypted_backup)==null?void 0:h.backup_creation_time)!=null?f:0,deviceCreatedOn:(f=p[0].device_created_on)!=null?f:"",removalStatus:"",requiresHsmMigration:p[0].migration_status!=="DOES_NOT_REQUIRE_MIGRATION",virtualDeviceCreationTime:(f=(f=p[0])==null?void 0:f.creation_time)!=null?f:0,virtualDeviceId:(f=(f=p[0])==null?void 0:f.id)!=null?f:"",virtualDeviceType:(f=(f=p[0])==null?void 0:f.device_type)!=null?f:""},backupTenancy:(f=n==null||(j=n.viewer)==null||(j=j.encrypted_backup)==null?void 0:j.backup_tenancy)!=null?f:"PRODUCTION",hasOtcEligibleDevices:!!(d("MAWOneTimeCodeGating").isOneTimeCodeEnabled&&(n==null||(k=n.viewer)==null||(k=k.encrypted_backup)==null?void 0:k.has_otc_eligible_devices)!==!1),hasSeenEbAutoRestoreNotice:(f=n==null||(l=n.viewer)==null||(l=l.encrypted_backup)==null?void 0:l.has_seen_eb_auto_restore_notice)!=null?f:!1,isPINCodeRegistered:((f=p[0])==null?void 0:f.id)!=null,isUserOptedOut:(p=n==null||(m=n.viewer)==null||(m=m.encrypted_backup)==null?void 0:m.is_user_opted_out)!=null?p:!1,offlineDevicesCount:o.length}})}catch(a){c("FBLogger")("wmi_eb").catching(a).mustfix("Failed to check EB enabled");return d("WAResultOrError").makeResult({backupStatus:0})}}g.GetEbState=a}),98);
__d("LSOcmfClientInit_v2.nop",["CryptoLogger","LSResult","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("ristretto255").__setRef("LSOcmfClientInit_v2.nop");a=function(a,b){return h.load().then(function(a){return c("LSResult")(a.scalar.getRandom().buffer)})["catch"](function(a){d("CryptoLogger").captureError(d("CryptoLogger").CryptoLogger("ocmf_client_init_v2"),a).mustfix("Failed to init OCMF client.");throw a})};a.__nop_name__="LSOcmfClientInit_v2";g["default"]=a}),98);
__d("LSRandom.nop",["CryptoLogger","I64","LSMaxInt32","LSResult","Promise","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(a,e,f){a=d("CryptoLogger").CryptoLogger("ope_encrypt");if((i||(i=d("I64"))).gt(f,c("LSMaxInt32"))){a.mustfix("numBytes '"+String(f)+"' too large. Returning an empty array");return(h||(h=b("Promise"))).resolve(c("LSResult")(new Uint8Array(0).buffer))}e=(i||(i=d("I64"))).to_int32(f);a=new Uint8Array(e);f=65536;for(var g=0;g<e;g+=f){var j=a.subarray(g,g+Math.min(e-g,f));d("XPlatReactCrypto").getRandomValues(j)}return(h||(h=b("Promise"))).resolve(c("LSResult")(a.buffer))};a.__nop_name__="LSRandom";g["default"]=a}),98);
__d("LSGenerateInitialDeviceSetupPayload",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateAuthKeyPair.nop","LSCreateEncryptionKeyPair.nop","LSCreateSignatureKeyPair.nop","LSCreateSignature_v2.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop","LSOcmfClientInit_v2.nop","LSOcmfClientMap.nop","LSRandom.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][generateInitialDeviceSetupPayload] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!0}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[33]=new c.Map(),d[33].set("error_msg","Expected a nonempty query result"),d[33].set("code",c.i64.cast([0,3])),d[33].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[34]=c.createArray(),d[35]=(d[34].push(d[33]),d[34]),e=[void 0,d[34]],d[2]=e[0],d[3]=e[1]):(b=a.item,d[33]=new c.Map(),d[33].set("backup_id",b.backupId),d[33].set("device_public_key_blob",b.devicePublicKeyBlob),d[33].set("device_private_key_blob",b.devicePrivateKeyBlob),d[33].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[33].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[33].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[33].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[33].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[33].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[33].set("orf_client_state_v2_blob",void 0),d[33].set("orf_v2_authority_level",void 0),d[33].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[33].set("device_id",b.deviceId),d[33].set("backup_tenancy",b.backupTenancy),d[33].set("encryption_version",b.encryptionVersion),d[33].set("revision_version",b.revisionVersion),d[33].set("initialize_restore_result",void 0),d[33].set("device_creation_timestamp_sec",void 0),d[33].set("authority_level",b.authorityLevel),e=[d[33],void 0],d[2]=e[0],d[3]=e[1])})},function(a){return d[5]=new c.Map(),d[5].set("value",d[2]),d[5].set("errors",d[3]),d[6]=d[5].get("value"),d[6]!==void 0?c.sequence([function(a){return d[33]=d[6].get("backup_id"),d[34]=d[6].get("device_public_key_blob"),d[35]=d[6].get("device_private_key_blob"),d[36]=d[6].get("epoch_storage_public_key_blob"),d[37]=d[6].get("epoch_storage_private_key_blob"),d[38]=d[6].get("epoch_auth_public_key_blob"),d[39]=d[6].get("epoch_auth_private_key_blob"),d[40]=d[6].get("mailbox_root_key_blob"),d[41]=d[6].get("ocmf_client_state_blob"),d[42]=d[6].get("orf_client_state_v2_blob"),d[43]=d[6].get("orf_v2_authority_level"),d[44]=d[6].get("oblivious_validation_token_blob"),d[45]=d[6].get("device_id"),d[46]=d[6].get("backup_tenancy"),d[47]=d[6].get("encryption_version"),d[48]=d[6].get("revision_version"),d[49]=d[6].get("initialize_restore_result"),d[50]=d[6].get("device_creation_timestamp_sec"),d[51]=d[6].get("authority_level"),c.i64.neq(d[45],void 0)?c.sequence([function(a){return d[70]=void 0,c.i64.neq(d[70],void 0)?c.resolve(d[71]=d[70]):c.sequence([function(a){return d[74]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[75]=a[0],a})},function(a){return d[75]?d[84]=(d[74].push(c.i64.cast([0,0])),d[74]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[76]=a[0],a})},function(a){return d[76]?d[84]=(d[74].push(c.i64.cast([0,2])),d[74]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[77]=a[0],a})},function(a){return d[77]?d[84]=(d[74].push(c.i64.cast([0,3])),d[74]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[78]=a[0],a})},function(a){return d[78]?d[84]=(d[74].push(c.i64.cast([0,4])),d[74]):0,d[79]=c.createArray(),d[80]=c.i64.of_int32(d[74].length),c.i64.gt(d[80],c.i64.cast([0,0]))?c.loopAsync(d[80],function(a){return d[84]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[74],d[84]).then(function(a){return a=a,d[85]=a[0],d[86]=a[1],a})},function(a){return d[87]=(d[79].push(d[85]),d[79])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[84]=c.createArray(),d[85]=c.i64.of_int32(d[79].length),c.i64.gt(d[85],c.i64.cast([0,0]))?c.loopAsync(d[85],function(a){return d[87]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[79],d[87]).then(function(a){return a=a,d[88]=a[0],d[89]=a[1],a})},function(a){return d[90]=(d[84].push(c.i64.to_string(d[88])),d[84])}])}):c.resolve()},function(a){return d[86]=d[84].join(","),d[81]=d[86]}])},function(a){return d[79].some(function(a){return c.i64.eq(d[47],a)})?d[82]=d[47]:d[82]=void 0,c.i64.neq(d[82],void 0)?d[83]=d[82]:d[83]=void 0,d[71]=d[83]}])},function(a){return c.i64.neq(d[71],void 0)?d[72]=d[71]:d[72]=c.i64.cast([0,0]),c.i64.neq(d[46],void 0)?d[73]=d[46]:d[73]=c.i64.cast([0,1]),a=[d[33],d[45],d[40],d[41],void 0,void 0,d[72],d[73],d[38],d[39],d[34],d[35],d[36],d[37],d[44],d[51],void 0,void 0],d[52]=a[0],d[53]=a[1],d[54]=a[2],d[55]=a[3],d[56]=a[4],d[57]=a[5],d[58]=a[6],d[59]=a[7],d[60]=a[8],d[61]=a[9],d[62]=a[10],d[63]=a[11],d[64]=a[12],d[65]=a[13],d[66]=a[14],d[67]=a[15],d[68]=a[16],d[69]=a[17]}]):c.sequence([function(a){return c.forEach(c.db.table(169).fetch(),function(a){return a["delete"]()})},function(a){return d[70]=c.i64.random(),d[71]=c.i64.random(),c.nativeOperation(b("LSCreateSignatureKeyPair.nop")).then(function(a){return a=a,d[72]=a[0],d[73]=a[1],a})},function(a){return c.nativeOperation(b("LSCreateEncryptionKeyPair.nop")).then(function(a){return a=a,d[74]=a[0],d[75]=a[1],a})},function(a){return c.nativeOperation(b("LSCreateAuthKeyPair.nop")).then(function(a){return a=a,d[76]=a[0],d[77]=a[1],a})},function(a){return c.nativeOperation(b("LSRandom.nop"),c.i64.cast([0,32])).then(function(a){return a=a,d[78]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientInit_v2.nop")).then(function(a){return a=a,d[79]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientInit_v2.nop")).then(function(a){return a=a,d[80]=a[0],a})},function(a){return c.nativeOperation(b("LSRandom.nop"),c.i64.cast([0,32])).then(function(a){return a=a,d[81]=a[0],a})},function(a){return d[82]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[83]=a[0],a})},function(a){return d[83]?d[109]=(d[82].push(c.i64.cast([0,0])),d[82]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[84]=a[0],a})},function(a){return d[84]?d[109]=(d[82].push(c.i64.cast([0,2])),d[82]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[85]=a[0],a})},function(a){return d[85]?d[109]=(d[82].push(c.i64.cast([0,3])),d[82]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[86]=a[0],a})},function(a){return d[86]?d[109]=(d[82].push(c.i64.cast([0,4])),d[82]):0,d[87]=c.i64.of_int32(d[82].length),c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[82],c.i64.sub(d[87],c.i64.cast([0,1]))).then(function(a){return a=a,d[88]=a[0],d[89]=a[1],a})},function(a){return c.forEach(c.filter(c.db.table(168).fetch([[[d[70]]]]),function(a){return c.i64.eq(a.backupId,d[70])&&c.i64.lt(a.authorityLevel,c.i64.cast([0,20]))}),function(a){return a["delete"]()})},function(a){return c.db.table(168).add({backupId:d[70],deviceId:d[71],devicePublicKeyBlob:d[73],devicePrivateKeyBlob:d[72],epochStoragePublicKeyBlob:d[75],epochStoragePrivateKeyBlob:d[74],epochAuthPublicKeyBlob:d[77],epochAuthPrivateKeyBlob:d[76],mailboxRootKeyBlob:d[78],ocmfClientStateBlob:d[79],obliviousValidationTokenBlob:d[81],authorityLevel:c.i64.cast([0,20]),encryptionVersion:d[88],revisionVersion:c.i64.cast([0,1]),backupTenancy:c.i64.cast([0,1])})},function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,20]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,e){var f=a.done;a=a.value;return f?(f=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,20]),void 0,void 0],d[90]=f[0],d[91]=f[1],d[92]=f[2],d[93]=f[3],d[94]=f[4],d[95]=f[5],d[96]=f[6],d[97]=f[7],d[98]=f[8],d[99]=f[9],d[100]=f[10],d[101]=f[11],d[102]=f[12],d[103]=f[13],d[104]=f[14],d[105]=f[15],d[106]=f[16],d[107]=f[17],f):(e=a.item,c.sequence([function(a){return d[114]=e.backupTenancy,d[113]=e.encryptionVersion,d[109]=void 0,c.i64.neq(d[109],void 0)?c.resolve(d[110]=d[109]):c.sequence([function(a){return d[115]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[116]=a[0],a})},function(a){return d[116]?d[125]=(d[115].push(c.i64.cast([0,0])),d[115]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[117]=a[0],a})},function(a){return d[117]?d[125]=(d[115].push(c.i64.cast([0,2])),d[115]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[118]=a[0],a})},function(a){return d[118]?d[125]=(d[115].push(c.i64.cast([0,3])),d[115]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[119]=a[0],a})},function(a){return d[119]?d[125]=(d[115].push(c.i64.cast([0,4])),d[115]):0,d[120]=c.createArray(),d[121]=c.i64.of_int32(d[115].length),c.i64.gt(d[121],c.i64.cast([0,0]))?c.loopAsync(d[121],function(a){return d[125]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[115],d[125]).then(function(a){return a=a,d[126]=a[0],d[127]=a[1],a})},function(a){return d[128]=(d[120].push(d[126]),d[120])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[125]=c.createArray(),d[126]=c.i64.of_int32(d[120].length),c.i64.gt(d[126],c.i64.cast([0,0]))?c.loopAsync(d[126],function(a){return d[128]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[120],d[128]).then(function(a){return a=a,d[129]=a[0],d[130]=a[1],a})},function(a){return d[131]=(d[125].push(c.i64.to_string(d[129])),d[125])}])}):c.resolve()},function(a){return d[127]=d[125].join(","),d[122]=d[127]}])},function(a){return d[120].some(function(a){return c.i64.eq(d[113],a)})?d[123]=d[113]:d[123]=void 0,c.i64.neq(d[123],void 0)?d[124]=d[123]:d[124]=void 0,d[110]=d[124]}])},function(a){return c.i64.neq(d[110],void 0)?d[111]=d[110]:d[111]=c.i64.cast([0,0]),c.i64.neq(d[114],void 0)?d[112]=d[114]:d[112]=c.i64.cast([0,1]),a=[e.backupId,e.deviceId,e.mailboxRootKeyBlob,e.ocmfClientStateBlob,void 0,void 0,d[111],d[112],e.epochAuthPublicKeyBlob,e.epochAuthPrivateKeyBlob,e.devicePublicKeyBlob,e.devicePrivateKeyBlob,e.epochStoragePublicKeyBlob,e.epochStoragePrivateKeyBlob,e.obliviousValidationTokenBlob,e.authorityLevel,void 0,void 0],d[90]=a[0],d[91]=a[1],d[92]=a[2],d[93]=a[3],d[94]=a[4],d[95]=a[5],d[96]=a[6],d[97]=a[7],d[98]=a[8],d[99]=a[9],d[100]=a[10],d[101]=a[11],d[102]=a[12],d[103]=a[13],d[104]=a[14],d[105]=a[15],d[106]=a[16],d[107]=a[17]}]))})},function(a){return a=[d[90],d[91],d[92],d[93],d[94],d[95],d[96],d[97],d[98],d[99],d[100],d[101],d[102],d[103],d[104],d[105],d[106],d[107]],d[52]=a[0],d[53]=a[1],d[54]=a[2],d[55]=a[3],d[56]=a[4],d[57]=a[5],d[58]=a[6],d[59]=a[7],d[60]=a[8],d[61]=a[9],d[62]=a[10],d[63]=a[11],d[64]=a[12],d[65]=a[13],d[66]=a[14],d[67]=a[15],d[68]=a[16],d[69]=a[17],a}])},function(a){return a=[d[52],d[53],d[54],d[55],d[56],d[57],d[58],d[59],d[60],d[61],d[62],d[63],d[64],d[65],d[66],d[67],d[68],d[69]],d[7]=a[0],d[8]=a[1],d[9]=a[2],d[10]=a[3],d[11]=a[4],d[12]=a[5],d[13]=a[6],d[14]=a[7],d[15]=a[8],d[16]=a[9],d[17]=a[10],d[18]=a[11],d[19]=a[12],d[20]=a[13],d[21]=a[14],d[22]=a[15],d[23]=a[16],d[24]=a[17],a}]):c.sequence([function(a){return d[33]=d[5].get("errors"),d[34]=d[5].get("errors"),c.forEach(c.db.table(169).fetch(),function(a){return a["delete"]()})},function(a){return d[35]=c.i64.random(),d[36]=c.i64.random(),c.nativeOperation(b("LSCreateSignatureKeyPair.nop")).then(function(a){return a=a,d[37]=a[0],d[38]=a[1],a})},function(a){return c.nativeOperation(b("LSCreateEncryptionKeyPair.nop")).then(function(a){return a=a,d[39]=a[0],d[40]=a[1],a})},function(a){return c.nativeOperation(b("LSCreateAuthKeyPair.nop")).then(function(a){return a=a,d[41]=a[0],d[42]=a[1],a})},function(a){return c.nativeOperation(b("LSRandom.nop"),c.i64.cast([0,32])).then(function(a){return a=a,d[43]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientInit_v2.nop")).then(function(a){return a=a,d[44]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientInit_v2.nop")).then(function(a){return a=a,d[45]=a[0],a})},function(a){return c.nativeOperation(b("LSRandom.nop"),c.i64.cast([0,32])).then(function(a){return a=a,d[46]=a[0],a})},function(a){return d[47]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[48]=a[0],a})},function(a){return d[48]?d[74]=(d[47].push(c.i64.cast([0,0])),d[47]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[49]=a[0],a})},function(a){return d[49]?d[74]=(d[47].push(c.i64.cast([0,2])),d[47]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[50]=a[0],a})},function(a){return d[50]?d[74]=(d[47].push(c.i64.cast([0,3])),d[47]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[51]=a[0],a})},function(a){return d[51]?d[74]=(d[47].push(c.i64.cast([0,4])),d[47]):0,d[52]=c.i64.of_int32(d[47].length),c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[47],c.i64.sub(d[52],c.i64.cast([0,1]))).then(function(a){return a=a,d[53]=a[0],d[54]=a[1],a})},function(a){return c.forEach(c.filter(c.db.table(168).fetch([[[d[35]]]]),function(a){return c.i64.eq(a.backupId,d[35])&&c.i64.lt(a.authorityLevel,c.i64.cast([0,20]))}),function(a){return a["delete"]()})},function(a){return c.db.table(168).add({backupId:d[35],deviceId:d[36],devicePublicKeyBlob:d[38],devicePrivateKeyBlob:d[37],epochStoragePublicKeyBlob:d[40],epochStoragePrivateKeyBlob:d[39],epochAuthPublicKeyBlob:d[42],epochAuthPrivateKeyBlob:d[41],mailboxRootKeyBlob:d[43],ocmfClientStateBlob:d[44],obliviousValidationTokenBlob:d[46],authorityLevel:c.i64.cast([0,20]),encryptionVersion:d[53],revisionVersion:c.i64.cast([0,1]),backupTenancy:c.i64.cast([0,1])})},function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,20]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,e){var f=a.done;a=a.value;return f?(f=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,20]),void 0,void 0],d[55]=f[0],d[56]=f[1],d[57]=f[2],d[58]=f[3],d[59]=f[4],d[60]=f[5],d[61]=f[6],d[62]=f[7],d[63]=f[8],d[64]=f[9],d[65]=f[10],d[66]=f[11],d[67]=f[12],d[68]=f[13],d[69]=f[14],d[70]=f[15],d[71]=f[16],d[72]=f[17],f):(e=a.item,c.sequence([function(a){return d[79]=e.backupTenancy,d[78]=e.encryptionVersion,d[74]=void 0,c.i64.neq(d[74],void 0)?c.resolve(d[75]=d[74]):c.sequence([function(a){return d[80]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[81]=a[0],a})},function(a){return d[81]?d[90]=(d[80].push(c.i64.cast([0,0])),d[80]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[82]=a[0],a})},function(a){return d[82]?d[90]=(d[80].push(c.i64.cast([0,2])),d[80]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[83]=a[0],a})},function(a){return d[83]?d[90]=(d[80].push(c.i64.cast([0,3])),d[80]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[84]=a[0],a})},function(a){return d[84]?d[90]=(d[80].push(c.i64.cast([0,4])),d[80]):0,d[85]=c.createArray(),d[86]=c.i64.of_int32(d[80].length),c.i64.gt(d[86],c.i64.cast([0,0]))?c.loopAsync(d[86],function(a){return d[90]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[80],d[90]).then(function(a){return a=a,d[91]=a[0],d[92]=a[1],a})},function(a){return d[93]=(d[85].push(d[91]),d[85])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[90]=c.createArray(),d[91]=c.i64.of_int32(d[85].length),c.i64.gt(d[91],c.i64.cast([0,0]))?c.loopAsync(d[91],function(a){return d[93]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[85],d[93]).then(function(a){return a=a,d[94]=a[0],d[95]=a[1],a})},function(a){return d[96]=(d[90].push(c.i64.to_string(d[94])),d[90])}])}):c.resolve()},function(a){return d[92]=d[90].join(","),d[87]=d[92]}])},function(a){return d[85].some(function(a){return c.i64.eq(d[78],a)})?d[88]=d[78]:d[88]=void 0,c.i64.neq(d[88],void 0)?d[89]=d[88]:d[89]=void 0,d[75]=d[89]}])},function(a){return c.i64.neq(d[75],void 0)?d[76]=d[75]:d[76]=c.i64.cast([0,0]),c.i64.neq(d[79],void 0)?d[77]=d[79]:d[77]=c.i64.cast([0,1]),a=[e.backupId,e.deviceId,e.mailboxRootKeyBlob,e.ocmfClientStateBlob,void 0,void 0,d[76],d[77],e.epochAuthPublicKeyBlob,e.epochAuthPrivateKeyBlob,e.devicePublicKeyBlob,e.devicePrivateKeyBlob,e.epochStoragePublicKeyBlob,e.epochStoragePrivateKeyBlob,e.obliviousValidationTokenBlob,e.authorityLevel,void 0,void 0],d[55]=a[0],d[56]=a[1],d[57]=a[2],d[58]=a[3],d[59]=a[4],d[60]=a[5],d[61]=a[6],d[62]=a[7],d[63]=a[8],d[64]=a[9],d[65]=a[10],d[66]=a[11],d[67]=a[12],d[68]=a[13],d[69]=a[14],d[70]=a[15],d[71]=a[16],d[72]=a[17]}]))})},function(a){return a=[d[55],d[56],d[57],d[58],d[59],d[60],d[61],d[62],d[63],d[64],d[65],d[66],d[67],d[68],d[69],d[70],d[71],d[72]],d[7]=a[0],d[8]=a[1],d[9]=a[2],d[10]=a[3],d[11]=a[4],d[12]=a[5],d[13]=a[6],d[14]=a[7],d[15]=a[8],d[16]=a[9],d[17]=a[10],d[18]=a[11],d[19]=a[12],d[20]=a[13],d[21]=a[14],d[22]=a[15],d[23]=a[16],d[24]=a[17],a}])},function(e){return c.i64.neq(d[7],void 0)?c.sequence([function(e){return c.blobs.neq(d[18],void 0)?c.sequence([function(e){return c.blobs.neq(d[17],void 0)?c.sequence([function(e){return c.blobs.neq(d[19],void 0)?c.sequence([function(e){return c.blobs.neq(d[15],void 0)?c.sequence([function(e){return c.blobs.neq(d[10],void 0)?c.sequence([function(e){return c.blobs.neq(d[9],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSCreateSignature_v2.nop"),d[18],c.blob("MA=="),d[19]).then(function(a){return a=a,d[45]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateSignature_v2.nop"),d[18],c.blob("MQ=="),d[15]).then(function(a){return a=a,d[46]=a[0],a})},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),c.i64.to_string(d[7])).then(function(a){return a=a,d[47]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWFpbGJveF9pZF9zY29wZQ=="),d[47]).then(function(a){return a=a,d[48]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[10],d[48]).then(function(a){return a=a,d[49]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[49]).then(function(a){return a=a,d[50]=a[0],a})},function(b){return d[51]=new c.Map(),d[51].set("optimistic_backup_id",d[7]),d[51].set("device_private_key",d[18]),d[51].set("device_public_key",d[17]),d[51].set("epoch_storage_public_key",d[19]),d[51].set("epoch_storage_public_key_sig",d[45]==null?c.blob("bnVsbA=="):d[45]),d[51].set("epoch_auth_public_key",d[15]),d[51].set("epoch_auth_public_key_sig",d[46]==null?c.blob("bnVsbA=="):d[46]),d[51].set("ocmf_client_state",d[10]),d[51].set("mailbox_partial_id",d[50]==null?"":d[50]),d[51].set("mailbox_root_key",d[9]),d[51].set("device_registration_id",a[0]),d[51].set("orf_client_state_v2",void 0),b=[d[51],void 0],d[43]=b[0],d[44]=b[1]}]):c.resolve((d[45]=new c.Map(),d[45].set("error_code",c.i64.cast([0,9])),d[45].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),d[45].set("error_message",""),e=[void 0,d[45]],d[43]=e[0],d[44]=e[1]))},function(a){return a=[d[43],d[44]],d[41]=a[0],d[42]=a[1],a}]):c.resolve((d[43]=new c.Map(),d[43].set("error_code",c.i64.cast([0,9])),d[43].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),d[43].set("error_message",""),e=[void 0,d[43]],d[41]=e[0],d[42]=e[1]))},function(a){return a=[d[41],d[42]],d[39]=a[0],d[40]=a[1],a}]):c.resolve((d[41]=new c.Map(),d[41].set("error_code",c.i64.cast([0,9])),d[41].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),d[41].set("error_message",""),e=[void 0,d[41]],d[39]=e[0],d[40]=e[1]))},function(a){return a=[d[39],d[40]],d[37]=a[0],d[38]=a[1],a}]):c.resolve((d[39]=new c.Map(),d[39].set("error_code",c.i64.cast([0,9])),d[39].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),d[39].set("error_message",""),e=[void 0,d[39]],d[37]=e[0],d[38]=e[1]))},function(a){return a=[d[37],d[38]],d[35]=a[0],d[36]=a[1],a}]):c.resolve((d[37]=new c.Map(),d[37].set("error_code",c.i64.cast([0,9])),d[37].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),d[37].set("error_message",""),e=[void 0,d[37]],d[35]=e[0],d[36]=e[1]))},function(a){return a=[d[35],d[36]],d[33]=a[0],d[34]=a[1],a}]):c.resolve((d[35]=new c.Map(),d[35].set("error_code",c.i64.cast([0,9])),d[35].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),d[35].set("error_message",""),e=[void 0,d[35]],d[33]=e[0],d[34]=e[1]))},function(a){return a=[d[33],d[34]],d[25]=a[0],d[26]=a[1],a}]):c.resolve((d[33]=new c.Map(),d[33].set("error_code",c.i64.cast([0,9])),d[33].set("stored_procedure","LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure"),d[33].set("error_message",""),e=[void 0,d[33]],d[25]=e[0],d[26]=e[1]))},function(a){return d[27]=c.i64.of_float(Date.now()),d[28]=c.i64.random(),d[30]="Finishing execution. Execution time: ",d[31]=c.i64.to_string(c.i64.sub(d[27],d[0])),d[32]=" ms",d[29]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][generateInitialDeviceSetupPayload] ",d[29],d[30],d[29],d[31],d[29],d[32]].join("")),c.i64.eq(c.i64.mod_(d[28],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[33]=",",d[34]=c.createArray(),void 0!==void 0?d[35]=(d[34].push(void 0),d[34]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"generateInitialDeviceSetupPayload",[d[30],d[33],d[31],d[33],d[32]].join(""),d[34],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[25],d[26]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsGenerateInitialDeviceSetupPayloadStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSGenerateInitialEpochSetupPayload",["LSCreateMinosEpochParams.nop","LSCreateSymmetricEncryptionSecretKey.nop","LSGetNextEpochAnonId.nop","LSLogMebClientEvent.nop","LSStoreEpoch","gkx","qex"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1],e=[],f=[];return d.sequence([function(g){return d.sequence([function(f){return e[0]=d.i64.of_float(Date.now()),function(a){d.logger(a).info(a)}("[EncryptedBackups][generateInitialEpochSetupPayload] Beginning execution."),e[1]=d.i64.of_float(Date.now()),d.filter(d.db.table(169).fetch(),function(a){return d.i64.eq(a.epochStatus,d.i64.cast([0,1]))&&d.i64.eq(a.authorityLevel,d.i64.cast([0,20]))}).next().then(function(f,g){var h=f.done;f=f.value;return h?d.sequence([function(a){return function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateInitialEpochSetupPayloadStoredProcedure] Generating new initial epoch."),d.nativeOperation(b("LSGetNextEpochAnonId.nop"),void 0).then(function(a){return a=a,e[16]=a[0],a})},function(a){return d.nativeOperation(b("LSCreateSymmetricEncryptionSecretKey.nop")).then(function(a){return a=a,e[17]=a[0],a})},function(a){return e[21]=function(a){return a==void 0?void 0:a}(c("qex")._("201")),e[21]!==void 0?e[18]=e[21]:e[18]=!1,c("gkx")("16269")&&e[18]||!1?d.sequence([function(a){return d.nativeOperation(b("LSCreateMinosEpochParams.nop"),e[17],e[16],void 0,void 0,void 0).then(function(a){return a=a,e[22]=a[0],e[23]=a[1],e[24]=a[2],e[25]=a[3],e[26]=a[4],e[27]=a[5],a})},function(a){return e[19]=e[25]}]):d.resolve(e[19]=void 0)},function(c){return e[20]=d.i64.random(),d.storedProcedure(b("LSStoreEpoch"),e[20],a[0],e[16],e[17],d.i64.cast([0,1]),d.i64.cast([0,20]),!1,e[19])},function(a){return a=[e[20],e[16],e[17],void 0,void 0,e[19]],e[2]=a[0],e[3]=a[1],e[4]=a[2],e[5]=a[3],e[6]=a[4],e[7]=a[5],a}]):(g=f.item,function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateInitialEpochSetupPayloadStoredProcedure] Using local optimistic initial epoch."),h=[g.epochId,g.epochAnonIdBlob,g.epochRootKeyBlob,void 0,void 0,g.epochHead],e[2]=h[0],e[3]=h[1],e[4]=h[2],e[5]=h[3],e[6]=h[4],e[7]=h[5])})},function(a){return e[9]=new d.Map(),e[9].set("optimistic_epoch_id",e[2]),e[9].set("epoch_anon_id",e[3]),e[9].set("epoch_root_key",e[4]),e[10]=d.i64.of_float(Date.now()),e[11]=d.i64.random(),e[13]="Finishing execution. Execution time: ",e[14]=d.i64.to_string(d.i64.sub(e[10],e[0])),e[15]=" ms",e[12]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][generateInitialEpochSetupPayload] ",e[12],e[13],e[12],e[14],e[12],e[15]].join("")),d.i64.eq(d.i64.mod_(e[11],d.i64.cast([0,1e3])),d.i64.cast([0,0]))?(e[16]=",",e[17]=d.createArray(),void 0!==void 0?e[18]=(e[17].push(void 0),e[17]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"generateInitialEpochSetupPayload",[e[13],e[16],e[14],e[16],e[15]].join(""),e[17],d.i64.cast([0,4]))):d.resolve()},function(a){return a=[e[9],void 0],f[0]=a[0],f[1]=a[1],a}])},function(a){return d.resolve(f)}])}a.__sproc_name__="LSEncryptedBackupsGenerateInitialEpochSetupPayloadStoredProcedure";a.__tables__=["secure_encrypted_backups_epochs"];d=a;g["default"]=d}),98);
__d("LSGenerateInitialVirtualDeviceSetupPayload",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSCreateEncryptionKeyPair.nop","LSCreateSignatureKeyPair.nop","LSCreateSignature_v2.nop","LSGetBlobFromString.nop","LSGetOpenEpochKeys","LSGetViewerFBID","LSHandleCreateVirtualDeviceFailure","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop","LSOcmfClientEvolve_v2.nop","LSParseRecoveryCode_v2.nop","LSSymmetricEncryptionCreateEncryptedString.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][generateInitialVirtualDeviceSetupPayload] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.db.table(174).fetch([[[c.i64.cast([0,1])]]]).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] No recovery code found in recovery code table"),d[12]="No recovery code found in recovery code table",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",d[12]].join("")),d[11]=c.createArray(),void 0!==void 0?d[14]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",d[12],d[11],c.i64.cast([0,3]))},function(d){return c.storedProcedure(b("LSHandleCreateVirtualDeviceFailure"),a[0],!0,void 0)},function(a){return d[13]=new c.Map(),d[13].set("error_code",c.i64.cast([0,501])),d[13].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),d[13].set("error_message",""),a=[void 0,d[13]],d[2]=a[0],d[3]=a[1]}]):(f=e.item,c.sequence([function(a){return d[11]=c.createArray(),c.storedProcedure(b("LSGetViewerFBID")).then(function(a){return a=a,d[12]=a[0],a})},function(a){return c.nativeOperation(b("LSParseRecoveryCode_v2.nop"),f.recoveryCode,void 0==null?c.i64.to_string(d[12]):void 0,d[11]).then(function(a){return a=a,d[13]=a[0],d[14]=a[1],a})},function(e){return c.blobs.neq(d[14],void 0)?c.sequence([function(e){return c.blobs.neq(d[13],void 0)?c.sequence([function(a){return c.storedProcedure(b("LSGetOpenEpochKeys"),!0).then(function(a){return a=a,d[19]=a[0],a})},function(e){return d[19]!==void 0?c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!0}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,e){var a=b.done;b=b.value;return a?(d[29]=new c.Map(),d[29].set("error_msg","Expected a nonempty query result"),d[29].set("code",c.i64.cast([0,3])),d[29].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[30]=c.createArray(),d[31]=(d[30].push(d[29]),d[30]),a=[void 0,d[30]],d[22]=a[0],d[23]=a[1]):(e=b.item,d[29]=new c.Map(),d[29].set("backup_id",e.backupId),d[29].set("device_public_key_blob",e.devicePublicKeyBlob),d[29].set("device_private_key_blob",e.devicePrivateKeyBlob),d[29].set("epoch_storage_public_key_blob",e.epochStoragePublicKeyBlob),d[29].set("epoch_storage_private_key_blob",e.epochStoragePrivateKeyBlob),d[29].set("epoch_auth_public_key_blob",e.epochAuthPublicKeyBlob),d[29].set("epoch_auth_private_key_blob",e.epochAuthPrivateKeyBlob),d[29].set("mailbox_root_key_blob",e.mailboxRootKeyBlob),d[29].set("ocmf_client_state_blob",e.ocmfClientStateBlob),d[29].set("orf_client_state_v2_blob",void 0),d[29].set("orf_v2_authority_level",void 0),d[29].set("oblivious_validation_token_blob",e.obliviousValidationTokenBlob),d[29].set("device_id",e.deviceId),d[29].set("backup_tenancy",e.backupTenancy),d[29].set("encryption_version",e.encryptionVersion),d[29].set("revision_version",e.revisionVersion),d[29].set("initialize_restore_result",void 0),d[29].set("device_creation_timestamp_sec",void 0),d[29].set("authority_level",e.authorityLevel),a=[d[29],void 0],d[22]=a[0],d[23]=a[1])})},function(a){return d[25]=new c.Map(),d[25].set("value",d[22]),d[25].set("errors",d[23]),d[26]=d[25].get("value"),d[26]!==void 0?c.sequence([function(a){return d[29]=d[26].get("backup_id"),d[30]=d[26].get("device_public_key_blob"),d[31]=d[26].get("device_private_key_blob"),d[32]=d[26].get("epoch_storage_public_key_blob"),d[33]=d[26].get("epoch_storage_private_key_blob"),d[34]=d[26].get("epoch_auth_public_key_blob"),d[35]=d[26].get("epoch_auth_private_key_blob"),d[36]=d[26].get("mailbox_root_key_blob"),d[37]=d[26].get("ocmf_client_state_blob"),d[38]=d[26].get("orf_client_state_v2_blob"),d[39]=d[26].get("orf_v2_authority_level"),d[40]=d[26].get("oblivious_validation_token_blob"),d[41]=d[26].get("device_id"),d[42]=d[26].get("backup_tenancy"),d[43]=d[26].get("encryption_version"),d[44]=d[26].get("revision_version"),d[45]=d[26].get("initialize_restore_result"),d[46]=d[26].get("device_creation_timestamp_sec"),d[47]=d[26].get("authority_level"),c.i64.neq(d[41],void 0)?c.sequence([function(a){return d[50]=void 0,c.i64.neq(d[50],void 0)?c.resolve(d[51]=d[50]):c.sequence([function(a){return d[102]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[103]=a[0],a})},function(a){return d[103]?d[112]=(d[102].push(c.i64.cast([0,0])),d[102]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[104]=a[0],a})},function(a){return d[104]?d[112]=(d[102].push(c.i64.cast([0,2])),d[102]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[105]=a[0],a})},function(a){return d[105]?d[112]=(d[102].push(c.i64.cast([0,3])),d[102]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[106]=a[0],a})},function(a){return d[106]?d[112]=(d[102].push(c.i64.cast([0,4])),d[102]):0,d[107]=c.createArray(),d[108]=c.i64.of_int32(d[102].length),c.i64.gt(d[108],c.i64.cast([0,0]))?c.loopAsync(d[108],function(a){return d[112]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[102],d[112]).then(function(a){return a=a,d[113]=a[0],d[114]=a[1],a})},function(a){return d[115]=(d[107].push(d[113]),d[107])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[112]=c.createArray(),d[113]=c.i64.of_int32(d[107].length),c.i64.gt(d[113],c.i64.cast([0,0]))?c.loopAsync(d[113],function(a){return d[115]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[107],d[115]).then(function(a){return a=a,d[116]=a[0],d[117]=a[1],a})},function(a){return d[118]=(d[112].push(c.i64.to_string(d[116])),d[112])}])}):c.resolve()},function(a){return d[114]=d[112].join(","),d[109]=d[114]}])},function(a){return d[107].some(function(a){return c.i64.eq(d[43],a)})?d[110]=d[43]:d[110]=void 0,c.i64.neq(d[110],void 0)?d[111]=d[110]:d[111]=void 0,d[51]=d[111]}])},function(a){return c.i64.neq(d[51],void 0)?d[52]=d[51]:d[52]=c.i64.cast([0,0]),c.i64.neq(d[42],void 0)?d[53]=d[42]:d[53]=c.i64.cast([0,1]),c.nativeOperation(b("LSCreateSignatureKeyPair.nop")).then(function(a){return a=a,d[54]=a[0],d[55]=a[1],a})},function(a){return c.nativeOperation(b("LSCreateEncryptionKeyPair.nop")).then(function(a){return a=a,d[56]=a[0],d[57]=a[1],a})},function(a){return c.nativeOperation(b("LSCreateSignature_v2.nop"),d[54],c.blob("MA=="),d[57]).then(function(a){return a=a,d[58]=a[0],a})},function(a){return d[59]=d[19].get("epoch_anon_id"),d[60]=d[19].get("epoch_root_key"),d[61]=c.createArray(),d[102]=(d[61].push(c.i64.cast([0,32])),d[61]),c.nativeOperation(b("LSBase64Encode.nop"),d[59]).then(function(a){return a=a,d[62]=a[0],a})},function(a){return d[62]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blobs.of_string(["epoch_devices","_",d[62]].join("")),void 0,d[60],d[61]).then(function(a){return a=a,d[102]=a[0],a})},function(a){return d[102]?d[103]=!1:d[103]=!0,d[103]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),d[106]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",d[106]].join("")),d[105]=c.createArray(),void 0!==void 0?d[108]=(d[105].push(void 0),d[105]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",d[106],d[105],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[107]=a[0],a})},function(a){return d[104]=d[107]}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[102],c.i64.cast([0,0])).then(function(a){return a=a,d[105]=a[0],d[106]=a[1],a})},function(a){return d[104]=d[105]}])},function(a){return d[63]=d[104]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),d[103]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",d[103]].join("")),d[102]=c.createArray(),void 0!==void 0?d[105]=(d[102].push(void 0),d[102]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",d[103],d[102],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[104]=a[0],a})},function(a){return d[63]=d[104]}])},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),d[63],d[55]).then(function(a){return a=a,d[64]=a[0],a})},function(a){return c.blobs.neq(d[64],void 0)?c.resolve(d[65]=d[64]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] device_epoch_hmac is null!"),d[103]="device_epoch_hmac is null!",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",d[103]].join("")),d[102]=c.createArray(),void 0!==void 0?d[105]=(d[102].push(void 0),d[102]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",d[103],d[102],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[104]=a[0],a})},function(a){return d[65]=d[104]}])},function(a){return d[66]=d[19].get("epoch_root_key"),d[67]=c.createArray(),d[102]=(d[67].push(c.i64.cast([0,18])),d[67]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[66],d[67]).then(function(a){return a=a,d[68]=a[0],a})},function(a){return d[68]!==void 0?c.sequence([function(a){return d[102]=c.i64.of_int32(d[68].length),c.i64.ge(d[102],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[68],c.i64.cast([0,0])).then(function(a){return a=a,d[104]=a[0],d[105]=a[1],a})},function(a){return d[103]=d[104]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[105]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[105]].join("")),d[104]=c.createArray(),void 0!==void 0?d[106]=(d[104].push(void 0),d[104]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[105],d[104],c.i64.cast([0,3]))},function(a){return d[103]=void 0}])},function(a){return d[69]=d[103]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[103]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[103]].join("")),d[102]=c.createArray(),void 0!==void 0?d[104]=(d[102].push(void 0),d[102]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[103],d[102],c.i64.cast([0,3]))},function(a){return d[69]=void 0}])},function(a){return c.blobs.neq(d[69],void 0)?d[70]=!0:d[70]=!1,d[70]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.nativeOperation(b("LSOcmfClientEvolve_v2.nop"),d[37]).then(function(a){return a=a,d[71]=a[0],d[72]=a[1],a})},function(a){return c.blobs.neq(void 0,void 0)?c.sequence([function(a){return c.nativeOperation(b("LSOcmfClientEvolve_v2.nop"),void 0).then(function(a){return a=a,d[102]=a[0],d[103]=a[1],a})},function(a){return a=[d[71],d[72],d[102],d[103]],d[73]=a[0],d[74]=a[1],d[75]=a[2],d[76]=a[3],a}]):c.resolve((a=[d[71],d[72],void 0,void 0],d[73]=a[0],d[74]=a[1],d[75]=a[2],d[76]=a[3],a))},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[54]).then(function(a){return a=a,d[77]=a[0],a})},function(a){return c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedString.nop"),d[14],c.blob("dmlydHVhbF9kZXZpY2U6dmlydHVhbF9kZXZpY2VfcHJpdmF0ZV9rZXk="),d[77]==null?"":d[77]).then(function(a){return a=a,d[78]=a[0],a})},function(a){return d[78]!==void 0?d[79]=d[78]:d[79]="",d[79]===""?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_device_private_key is empty!"),d[103]="encrypted_device_private_key is empty!",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",d[103]].join("")),d[102]=c.createArray(),void 0!==void 0?d[104]=(d[102].push(void 0),d[102]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",d[103],d[102],c.i64.cast([0,3]))):c.resolve()},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[56]).then(function(a){return a=a,d[80]=a[0],a})},function(a){return c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedString.nop"),d[14],c.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfc3RvcmFnZV9wcml2YXRlX2tleQ=="),d[80]==null?"":d[80]).then(function(a){return a=a,d[81]=a[0],a})},function(a){return d[81]!==void 0?d[82]=d[81]:d[82]="",d[82]===""?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_epoch_storage_private_key is empty!"),d[103]="encrypted_epoch_storage_private_key is empty!",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",d[103]].join("")),d[102]=c.createArray(),void 0!==void 0?d[104]=(d[102].push(void 0),d[102]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",d[103],d[102],c.i64.cast([0,3]))):c.resolve()},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[73]).then(function(a){return a=a,d[83]=a[0],a})},function(a){return c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedString.nop"),d[14],c.blob("dmlydHVhbF9kZXZpY2U6b2NtZl9jbGllbnRfc3RhdGU="),d[83]==null?"":d[83]).then(function(a){return a=a,d[84]=a[0],a})},function(a){return d[84]!==void 0?d[85]=d[84]:d[85]="",d[85]===""?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_orf_client_state_v1_shape is empty!"),d[103]="encrypted_orf_client_state_v1_shape is empty!",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",d[103]].join("")),d[102]=c.createArray(),void 0!==void 0?d[104]=(d[102].push(void 0),d[102]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",d[103],d[102],c.i64.cast([0,3]))):c.resolve()},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[40]).then(function(a){return a=a,d[86]=a[0],a})},function(a){return c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedString.nop"),d[14],c.blob("dmlydHVhbF9kZXZpY2U6b2JsaXZpb3VzX3ZhbGlkYXRpb25fdG9rZW4="),d[86]==null?"":d[86]).then(function(a){return a=a,d[87]=a[0],a})},function(a){return d[87]!==void 0?d[88]=d[87]:d[88]="",d[88]===""?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_oblivious_validation_token is empty!"),d[103]="encrypted_oblivious_validation_token is empty!",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",d[103]].join("")),d[102]=c.createArray(),void 0!==void 0?d[104]=(d[102].push(void 0),d[102]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",d[103],d[102],c.i64.cast([0,3]))):c.resolve()},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[36]).then(function(a){return a=a,d[89]=a[0],a})},function(a){return c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedString.nop"),d[14],c.blob("dmlydHVhbF9kZXZpY2U6bWFpbGJveF9yb290X2tleQ=="),d[89]==null?"":d[89]).then(function(a){return a=a,d[90]=a[0],a})},function(a){return d[90]!==void 0?d[91]=d[90]:d[91]="",d[91]===""?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_mailbox_root_key is empty!"),d[103]="encrypted_mailbox_root_key is empty!",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",d[103]].join("")),d[102]=c.createArray(),void 0!==void 0?d[104]=(d[102].push(void 0),d[102]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",d[103],d[102],c.i64.cast([0,3]))):c.resolve()},function(a){return d[92]=d[19].get("epoch_anon_id"),c.nativeOperation(b("LSBase64Encode.nop"),d[92]).then(function(a){return a=a,d[93]=a[0],a})},function(a){return c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedString.nop"),d[14],c.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfYW5vbl9pZA=="),d[93]==null?"":d[93]).then(function(a){return a=a,d[94]=a[0],a})},function(a){return d[94]!==void 0?d[95]=d[94]:d[95]="",d[95]===""?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_epoch_anon_id is empty!"),d[103]="encrypted_epoch_anon_id is empty!",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",d[103]].join("")),d[102]=c.createArray(),void 0!==void 0?d[104]=(d[102].push(void 0),d[102]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",d[103],d[102],c.i64.cast([0,3]))):c.resolve()},function(a){return d[96]=d[19].get("epoch_root_key"),c.nativeOperation(b("LSBase64Encode.nop"),d[96]).then(function(a){return a=a,d[97]=a[0],a})},function(a){return c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedString.nop"),d[14],c.blob("dmlydHVhbF9kZXZpY2U6ZXBvY2hfcm9vdF9rZXk="),d[97]==null?"":d[97]).then(function(a){return a=a,d[98]=a[0],a})},function(a){return d[98]!==void 0?d[99]=d[98]:d[99]="",d[99]===""?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] encrypted_epoch_root_key is empty!"),d[103]="encrypted_epoch_root_key is empty!",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",d[103]].join("")),d[102]=c.createArray(),void 0!==void 0?d[104]=(d[102].push(void 0),d[102]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",d[103],d[102],c.i64.cast([0,3]))):c.resolve()},function(a){return d[100]=new c.Map(),d[100].set("encrypted_device_private_key",d[79]),d[100].set("encrypted_epoch_storage_private_key",d[82]),d[100].set("encrypted_ocmf_client_state",d[85]),d[100].set("encrypted_orf_client_state_v2",void 0),d[100].set("encrypted_oblivious_validation_token_blob",d[88]),d[100].set("encrypted_mailbox_root_key_blob",d[91]),d[100].set("encrypted_epoch_anon_id",d[95]),d[100].set("encrypted_epoch_root_key",d[99]),d[101]=new c.Map(),d[101].set("virtual_device_public_key",d[55]),d[101].set("virtual_device_id",d[13]),d[101].set("virtual_device_epoch_storage_public_key",d[57]),d[101].set("virtual_device_epoch_storage_public_key_sig",d[58]==null?c.blob("bnVsbA=="):d[58]),d[101].set("device_epoch_hmac",d[65]),d[101].set("epoch_root_key_fingerprint",d[69]),d[101].set("virtual_device_type",f.virtualDeviceType),d[101].set("action_type",c.i64.cast([0,1])),d[101].set("ocmf_rotation_token",d[74]),d[101].set("encrypted_secret_values_payload",d[100]),d[101].set("cloud_service_account",f.cloudServiceAccount),d[101].set("hsm_pin_normalization_status",f.hsmPinNormalizationStatus),d[101].set("security_question_type",void 0),d[101].set("trusted_contact_id",void 0),a=[d[101],void 0],d[48]=a[0],d[49]=a[1]}]):c.resolve((d[50]=new c.Map(),d[50].set("error_code",c.i64.cast([0,9])),d[50].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),d[50].set("error_message",""),a=[void 0,d[50]],d[48]=a[0],d[49]=a[1]))},function(a){return a=[d[48],d[49]],d[27]=a[0],d[28]=a[1],a}]):c.resolve((d[29]=d[25].get("errors"),d[30]=d[25].get("errors"),d[31]=new c.Map(),d[31].set("error_code",c.i64.cast([0,9])),d[31].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),d[31].set("error_message",""),a=[void 0,d[31]],d[27]=a[0],d[28]=a[1]))},function(a){return a=[d[27],d[28]],d[20]=a[0],d[21]=a[1],a}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] Epoch keys are unavailable."),d[23]="Epoch keys are unavailable.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",d[23]].join("")),d[22]=c.createArray(),void 0!==void 0?d[25]=(d[22].push(void 0),d[22]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",d[23],d[22],c.i64.cast([0,3]))},function(d){return c.storedProcedure(b("LSHandleCreateVirtualDeviceFailure"),a[0],!0,void 0)},function(a){return d[24]=new c.Map(),d[24].set("error_code",c.i64.cast([0,11])),d[24].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),d[24].set("error_message",""),a=[void 0,d[24]],d[20]=a[0],d[21]=a[1]}])},function(a){return a=[d[20],d[21]],d[17]=a[0],d[18]=a[1],a}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] Invalid Recovery Code Provided"),d[20]="Invalid Recovery Code Provided",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",d[20]].join("")),d[19]=c.createArray(),void 0!==void 0?d[22]=(d[19].push(void 0),d[19]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",d[20],d[19],c.i64.cast([0,3]))},function(d){return c.storedProcedure(b("LSHandleCreateVirtualDeviceFailure"),a[0],!0,void 0)},function(a){return d[21]=new c.Map(),d[21].set("error_code",c.i64.cast([0,10])),d[21].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),d[21].set("error_message",""),a=[void 0,d[21]],d[17]=a[0],d[18]=a[1]}])},function(a){return a=[d[17],d[18]],d[15]=a[0],d[16]=a[1],a}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] Invalid Recovery Code Provided"),d[18]="Invalid Recovery Code Provided",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure] ","",d[18]].join("")),d[17]=c.createArray(),void 0!==void 0?d[20]=(d[17].push(void 0),d[17]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure",d[18],d[17],c.i64.cast([0,3]))},function(d){return c.storedProcedure(b("LSHandleCreateVirtualDeviceFailure"),a[0],!0,void 0)},function(a){return d[19]=new c.Map(),d[19].set("error_code",c.i64.cast([0,10])),d[19].set("stored_procedure","LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure"),d[19].set("error_message",""),a=[void 0,d[19]],d[15]=a[0],d[16]=a[1]}])},function(a){return a=[d[15],d[16]],d[2]=a[0],d[3]=a[1],a}]))})},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[8]="Finishing execution. Execution time: ",d[9]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[10]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][generateInitialVirtualDeviceSetupPayload] ",d[7],d[8],d[7],d[9],d[7],d[10]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[11]=",",d[12]=c.createArray(),void 0!==void 0?d[13]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"generateInitialVirtualDeviceSetupPayload",[d[8],d[11],d[9],d[11],d[10]].join(""),d[12],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[2],d[3]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsGenerateInitialVirtualDeviceSetupPayloadStoredProcedure";a.__tables__=["secure_encrypted_backups_generated_recovery_code","secure_encrypted_backups_client_state"];e.exports=a}),null);
__d("LSInitializeBackupV2",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSCreateMinosEpochParams.nop","LSCreateSignature_v2.nop","LSGenerateInitialDeviceSetupPayload","LSGenerateInitialEpochSetupPayload","LSGenerateInitialVirtualDeviceSetupPayload","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","gkx","qex"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1],e=[],f=[];return d.sequence([function(g){return d.sequence([function(c){return e[0]=d.i64.of_float(Date.now()),function(a){d.logger(a).info(a)}("[EncryptedBackups][initializeBackupV2] Beginning execution."),e[1]=d.i64.of_float(Date.now()),d.storedProcedure(b("LSGenerateInitialDeviceSetupPayload"),a[0]).then(function(a){return a=a,e[2]=a[0],e[3]=a[1],a})},function(c){return e[2]!==void 0?d.sequence([function(a){return e[15]=e[2].get("device_public_key"),d.nativeOperation(b("LSBase64Encode.nop"),e[15]).then(function(a){return a=a,e[16]=a[0],a})},function(a){return e[17]=e[2].get("epoch_storage_public_key"),d.nativeOperation(b("LSBase64Encode.nop"),e[17]).then(function(a){return a=a,e[18]=a[0],a})},function(a){return e[19]=e[2].get("epoch_storage_public_key_sig"),d.nativeOperation(b("LSBase64Encode.nop"),e[19]).then(function(a){return a=a,e[20]=a[0],a})},function(a){return e[21]=e[2].get("epoch_auth_public_key"),d.nativeOperation(b("LSBase64Encode.nop"),e[21]).then(function(a){return a=a,e[22]=a[0],a})},function(a){return e[23]=e[2].get("epoch_auth_public_key_sig"),d.nativeOperation(b("LSBase64Encode.nop"),e[23]).then(function(a){return a=a,e[24]=a[0],a})},function(a){return e[25]=e[2].get("ocmf_client_state"),d.nativeOperation(b("LSBase64Encode.nop"),e[25]).then(function(a){return a=a,e[26]=a[0],a})},function(a){return e[27]=e[2].get("mailbox_root_key"),d.nativeOperation(b("LSBase64Encode.nop"),e[27]).then(function(a){return a=a,e[28]=a[0],a})},function(a){return e[29]=e[2].get("device_private_key"),e[30]=d.createArray(),d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,0])).then(function(a){return a=a,e[31]=a[0],a})},function(a){return e[31]?e[44]=(e[30].push(d.i64.cast([0,0])),e[30]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,2])).then(function(a){return a=a,e[32]=a[0],a})},function(a){return e[32]?e[44]=(e[30].push(d.i64.cast([0,2])),e[30]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,3])).then(function(a){return a=a,e[33]=a[0],a})},function(a){return e[33]?e[44]=(e[30].push(d.i64.cast([0,3])),e[30]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,4])).then(function(a){return a=a,e[34]=a[0],a})},function(a){return e[34]?e[44]=(e[30].push(d.i64.cast([0,4])),e[30]):0,e[35]="",e[36]=d.i64.of_int32(e[30].length),d.i64.gt(e[36],d.i64.cast([0,0]))?d.loopAsync(e[36],function(a){return e[44]=a,d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[30],e[44]).then(function(a){return a=a,e[45]=a[0],e[46]=a[1],a})},function(a){return e[35]=[e[35],"_",d.i64.to_string(e[45])].join("")}])}):d.resolve()},function(a){return d.nativeOperation(b("LSGetBlobFromString.nop"),["supported_versions_",e[35],"revision_version_",d.i64.to_string(d.i64.cast([0,1]))].join("")).then(function(a){return a=a,e[37]=a[0],a})},function(a){return d.nativeOperation(b("LSCreateSignature_v2.nop"),e[29],d.blob("Mg=="),e[37]).then(function(a){return a=a,e[38]=a[0],a})},function(a){return d.blobs.neq(e[38],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[38]).then(function(a){return a=a,e[44]=a[0],a})},function(a){return e[39]=e[44]}]):d.resolve(e[39]=void 0)},function(b){return e[40]=e[2].get("optimistic_backup_id"),e[41]=e[2].get("mailbox_partial_id"),e[42]=new d.Map(),e[42].set("supported_encryption_versions",e[30]),e[42].set("client_version",d.i64.cast([0,1])),e[42].set("version_sig",e[39]==null?"":e[39]),e[43]=new d.Map(),e[43].set("device_public_key",e[16]==null?"":e[16]),e[43].set("epoch_storage_public_key",e[18]==null?"":e[18]),e[43].set("epoch_storage_public_key_sig",e[20]==null?"":e[20]),e[43].set("epoch_auth_public_key",e[22]==null?"":e[22]),e[43].set("epoch_auth_public_key_sig",e[24]==null?"":e[24]),e[43].set("device_registration_id",a[0]),e[43].set("ocmf_client_state",e[26]==null?"":e[26]),e[43].set("mailbox_partial_id",e[41]),e[43].set("mailbox_root_key",e[28]==null?"":e[28]),e[43].set("encryption_version_data",e[42]),b=[e[43],e[40],!0,d.i64.cast([0,0])],e[4]=b[0],e[5]=b[1],e[6]=b[2],e[7]=b[3]}]):d.resolve((e[3]!==void 0?(e[19]=e[3].get("error_code"),c=[void 0,d.i64.cast([-1,4294967295]),!1,e[19]],e[15]=c[0],e[16]=c[1],e[17]=c[2],e[18]=c[3]):(c=[void 0,d.i64.cast([-1,4294967295]),!1,d.i64.cast([0,12])],e[15]=c[0],e[16]=c[1],e[17]=c[2],e[18]=c[3],c),c=[e[15],e[16],e[17],e[18]],e[4]=c[0],e[5]=c[1],e[6]=c[2],e[7]=c[3]))},function(f){return e[6]?d.sequence([function(f){return e[4]!==void 0?d.sequence([function(a){return d.islc(d.filter(d.db.table(168).fetch(),function(a){return d.i64.eq(a.authorityLevel,d.i64.cast([0,80]))||!0}),0,d.i64.to_float(d.i64.cast([0,1]))).next().then(function(a,b){var c=a.done;a=a.value;return c?(e[25]=new d.Map(),e[25].set("error_msg","Expected a nonempty query result"),e[25].set("code",d.i64.cast([0,3])),e[25].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),e[26]=d.createArray(),e[27]=(e[26].push(e[25]),e[26]),c=[void 0,e[26]],e[16]=c[0],e[17]=c[1]):(b=a.item,e[25]=new d.Map(),e[25].set("backup_id",b.backupId),e[25].set("device_public_key_blob",b.devicePublicKeyBlob),e[25].set("device_private_key_blob",b.devicePrivateKeyBlob),e[25].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),e[25].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),e[25].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),e[25].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),e[25].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),e[25].set("ocmf_client_state_blob",b.ocmfClientStateBlob),e[25].set("orf_client_state_v2_blob",void 0),e[25].set("orf_v2_authority_level",void 0),e[25].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),e[25].set("device_id",b.deviceId),e[25].set("backup_tenancy",b.backupTenancy),e[25].set("encryption_version",b.encryptionVersion),e[25].set("revision_version",b.revisionVersion),e[25].set("initialize_restore_result",void 0),e[25].set("device_creation_timestamp_sec",void 0),e[25].set("authority_level",b.authorityLevel),c=[e[25],void 0],e[16]=c[0],e[17]=c[1])})},function(a){return e[19]=new d.Map(),e[19].set("value",e[16]),e[19].set("errors",e[17]),e[20]=e[19].get("value"),e[20]!==void 0?d.sequence([function(a){return e[25]=e[20].get("backup_id"),e[26]=e[20].get("device_public_key_blob"),e[27]=e[20].get("device_private_key_blob"),e[28]=e[20].get("epoch_storage_public_key_blob"),e[29]=e[20].get("epoch_storage_private_key_blob"),e[30]=e[20].get("epoch_auth_public_key_blob"),e[31]=e[20].get("epoch_auth_private_key_blob"),e[32]=e[20].get("mailbox_root_key_blob"),e[33]=e[20].get("ocmf_client_state_blob"),e[34]=e[20].get("orf_client_state_v2_blob"),e[35]=e[20].get("orf_v2_authority_level"),e[36]=e[20].get("oblivious_validation_token_blob"),e[37]=e[20].get("device_id"),e[38]=e[20].get("backup_tenancy"),e[39]=e[20].get("encryption_version"),e[40]=e[20].get("revision_version"),e[41]=e[20].get("initialize_restore_result"),e[42]=e[20].get("device_creation_timestamp_sec"),e[43]=e[20].get("authority_level"),d.i64.neq(e[37],void 0)?d.sequence([function(a){return e[47]=void 0,d.i64.neq(e[47],void 0)?d.resolve(e[48]=e[47]):d.sequence([function(a){return e[58]=d.createArray(),d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,0])).then(function(a){return a=a,e[59]=a[0],a})},function(a){return e[59]?e[68]=(e[58].push(d.i64.cast([0,0])),e[58]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,2])).then(function(a){return a=a,e[60]=a[0],a})},function(a){return e[60]?e[68]=(e[58].push(d.i64.cast([0,2])),e[58]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,3])).then(function(a){return a=a,e[61]=a[0],a})},function(a){return e[61]?e[68]=(e[58].push(d.i64.cast([0,3])),e[58]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,4])).then(function(a){return a=a,e[62]=a[0],a})},function(a){return e[62]?e[68]=(e[58].push(d.i64.cast([0,4])),e[58]):0,e[63]=d.createArray(),e[64]=d.i64.of_int32(e[58].length),d.i64.gt(e[64],d.i64.cast([0,0]))?d.loopAsync(e[64],function(a){return e[68]=a,d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[58],e[68]).then(function(a){return a=a,e[69]=a[0],e[70]=a[1],a})},function(a){return e[71]=(e[63].push(e[69]),e[63])}])}):d.resolve()},function(a){return d.sequence([function(a){return e[68]=d.createArray(),e[69]=d.i64.of_int32(e[63].length),d.i64.gt(e[69],d.i64.cast([0,0]))?d.loopAsync(e[69],function(a){return e[71]=a,d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[63],e[71]).then(function(a){return a=a,e[72]=a[0],e[73]=a[1],a})},function(a){return e[74]=(e[68].push(d.i64.to_string(e[72])),e[68])}])}):d.resolve()},function(a){return e[70]=e[68].join(","),e[65]=e[70]}])},function(a){return e[63].some(function(a){return d.i64.eq(e[39],a)})?e[66]=e[39]:e[66]=void 0,d.i64.neq(e[66],void 0)?e[67]=e[66]:e[67]=void 0,e[48]=e[67]}])},function(a){return d.i64.neq(e[48],void 0)?e[49]=e[48]:e[49]=d.i64.cast([0,0]),d.i64.neq(e[38],void 0)?e[50]=e[38]:e[50]=d.i64.cast([0,1]),e[51]=new d.Map(),e[51].set("device_id",e[37]),e[51].set("public_key",e[26]),e[52]=d.createArray(),e[58]=(e[52].push(e[51]),e[52]),d.storedProcedure(b("LSGenerateInitialEpochSetupPayload"),e[25],e[52]).then(function(a){return a=a,e[53]=a[0],e[54]=a[1],a})},function(a){return e[53]!==void 0?d.sequence([function(a){return e[58]=e[53].get("epoch_anon_id"),e[59]=e[53].get("epoch_root_key"),d.blobs.neq(e[59],void 0)?d.sequence([function(a){return e[78]=d.createArray(),e[84]=(e[78].push(d.i64.cast([0,18])),e[78]),d.nativeOperation(b("LSCreateDerivedKeys.nop"),d.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,e[59],e[78]).then(function(a){return a=a,e[79]=a[0],a})},function(a){return e[79]!==void 0?d.sequence([function(a){return e[84]=d.i64.of_int32(e[79].length),d.i64.ge(e[84],d.i64.cast([0,1]))?d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[79],d.i64.cast([0,0])).then(function(a){return a=a,e[86]=a[0],e[87]=a[1],a})},function(a){return e[85]=e[86]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),e[87]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",e[87]].join("")),e[86]=d.createArray(),void 0!==void 0?e[88]=(e[86].push(void 0),e[86]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",e[87],e[86],d.i64.cast([0,3]))},function(a){return e[85]=void 0}])},function(a){return e[80]=e[85]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),e[85]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",e[85]].join("")),e[84]=d.createArray(),void 0!==void 0?e[86]=(e[84].push(void 0),e[84]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",e[85],e[84],d.i64.cast([0,3]))},function(a){return e[80]=void 0}])},function(a){return d.blobs.neq(e[80],void 0)?e[81]=!0:e[81]=!1,e[81]?0:(function(a){d.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),d["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),d.nativeOperation(b("LSBase64Encode.nop"),e[80]).then(function(a){return a=a,e[82]=a[0],a})},function(a){return e[82]!==void 0?e[83]=e[82]:e[83]="encodingfailed",e[60]=e[83]}]):d.resolve(e[60]="null")},function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[52],d.i64.cast([0,0])).then(function(a){return a=a,e[61]=a[0],e[62]=a[1],a})},function(a){return e[63]=e[61].get("public_key"),d.nativeOperation(b("LSBase64Encode.nop"),e[63]).then(function(a){return a=a,e[64]=a[0],a})},function(a){return e[65]=e[61].get("public_key"),e[66]=d.createArray(),e[78]=(e[66].push(d.i64.cast([0,32])),e[66]),d.nativeOperation(b("LSBase64Encode.nop"),e[58]).then(function(a){return a=a,e[67]=a[0],a})},function(a){return e[67]!==void 0?d.sequence([function(a){return d.nativeOperation(b("LSCreateDerivedKeys.nop"),d.blobs.of_string(["epoch_devices","_",e[67]].join("")),void 0,e[59],e[66]).then(function(a){return a=a,e[78]=a[0],a})},function(a){return e[78]?e[79]=!1:e[79]=!0,e[79]?d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),e[82]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",e[82]].join("")),e[81]=d.createArray(),void 0!==void 0?e[84]=(e[81].push(void 0),e[81]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",e[82],e[81],d.i64.cast([0,3]))},function(a){return d.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,e[83]=a[0],a})},function(a){return e[80]=e[83]}]):d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[78],d.i64.cast([0,0])).then(function(a){return a=a,e[81]=a[0],e[82]=a[1],a})},function(a){return e[80]=e[81]}])},function(a){return e[68]=e[80]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),e[79]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",e[79]].join("")),e[78]=d.createArray(),void 0!==void 0?e[81]=(e[78].push(void 0),e[78]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",e[79],e[78],d.i64.cast([0,3]))},function(a){return d.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,e[80]=a[0],a})},function(a){return e[68]=e[80]}])},function(a){return d.nativeOperation(b("LSHmac_v2.nop"),e[68],e[65]).then(function(a){return a=a,e[69]=a[0],a})},function(a){return e[77]=function(a){return a==void 0?void 0:a}(c("qex")._("201")),e[77]!==void 0?e[70]=e[77]:e[70]=!1,c("gkx")("16269")&&e[70]||!1?d.sequence([function(a){return d.nativeOperation(b("LSCreateMinosEpochParams.nop"),e[59],e[58],void 0,void 0,void 0).then(function(a){return a=a,e[78]=a[0],e[79]=a[1],e[80]=a[2],e[81]=a[3],e[82]=a[4],e[83]=a[5],a})},function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[78]).then(function(a){return a=a,e[84]=a[0],a})},function(a){return e[84]!==void 0?e[85]=e[84]:e[85]="",d.nativeOperation(b("LSBase64Encode.nop"),e[80]).then(function(a){return a=a,e[86]=a[0],a})},function(a){return e[86]!==void 0?e[87]=e[86]:e[87]="",d.nativeOperation(b("LSBase64Encode.nop"),e[79]).then(function(a){return a=a,e[88]=a[0],a})},function(a){return e[88]!==void 0?e[89]=e[88]:e[89]="",d.nativeOperation(b("LSBase64Encode.nop"),e[81]).then(function(a){return a=a,e[90]=a[0],a})},function(a){return e[90]!==void 0?e[91]=e[90]:e[91]="",d.blobs.neq(void 0,void 0)?d.sequence([function(a){return d.nativeOperation(b("LSBase64Encode.nop"),void 0).then(function(a){return a=a,e[98]=a[0],a})},function(a){return e[98]!==void 0?e[99]=e[98]:e[99]="",e[92]=e[99]}]):d.resolve(e[92]=void 0)},function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[82]).then(function(a){return a=a,e[93]=a[0],a})},function(a){return e[93]!==void 0?e[94]=e[93]:e[94]="",d.blobs.neq(e[83],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[83]).then(function(a){return a=a,e[98]=a[0],a})},function(a){return e[98]!==void 0?e[99]=e[98]:e[99]="",e[95]=e[99]}]):d.resolve(e[95]=void 0)},function(a){return e[96]=new d.Map(),e[96].set("mailbox_encryption_public_key",e[85]),e[96].set("mailbox_auth_public_key",e[87]),e[96].set("mailbox_signing_public_key",e[89]),e[96].set("epoch_head",e[91]),e[96].set("previous_epoch_head",e[92]),e[96].set("self_signature",e[94]),e[96].set("prev_signature",e[95]),e[96]!==void 0?d.resolve(e[97]=e[96]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBEpochUtils] Missing Native Op for MEBMinosCreateMailboxEncryptionKeyPair"),e[99]="Missing Native Op for MEBMinosCreateMailboxEncryptionKeyPair",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBEpochUtils] ","",e[99]].join("")),e[98]=d.createArray(),void 0!==void 0?e[100]=(e[98].push(void 0),e[98]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBEpochUtils",e[99],e[98],d.i64.cast([0,3]))},function(a){return e[97]=void 0}])},function(a){return e[71]=e[97]}]):d.resolve(e[71]=void 0)},function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[58]).then(function(a){return a=a,e[72]=a[0],a})},function(a){return e[73]=e[53].get("optimistic_epoch_id"),d.blobs.neq(e[69],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[69]).then(function(a){return a=a,e[78]=a[0],a})},function(a){return e[74]=e[78]}]):d.resolve(e[74]=void 0)},function(a){return e[75]=new d.Map(),e[75].set("device_pub",e[64]==null?"":e[64]),e[75].set("hmac",e[74]==null?"":e[74]),e[75].set("encrypted_epoch_key",void 0),e[75].set("epoch_root_key_fingerprint",e[60]),e[76]=new d.Map(),e[76].set("epoch_data",""),e[76].set("epoch_anon_id",e[72]==null?"":e[72]),e[76].set("minos_epoch_creation_params",e[71]),e[76].set("optimistic_epoch_id",e[73]),e[76].set("membership",e[75]),a=[e[76],!0,d.i64.cast([0,0])],e[55]=a[0],e[56]=a[1],e[57]=a[2]}]):d.resolve((e[54]!==void 0?(e[61]=e[54].get("error_code"),a=[void 0,!1,e[61]],e[58]=a[0],e[59]=a[1],e[60]=a[2]):(a=[void 0,!1,d.i64.cast([0,14])],e[58]=a[0],e[59]=a[1],e[60]=a[2],a),a=[e[58],e[59],e[60]],e[55]=a[0],e[56]=a[1],e[57]=a[2]))},function(a){return a=[e[55],e[56],e[57]],e[44]=a[0],e[45]=a[1],e[46]=a[2],a}]):d.resolve((a=[void 0,!1,d.i64.cast([0,9])],e[44]=a[0],e[45]=a[1],e[46]=a[2],a))},function(a){return a=[e[44],e[45],e[46]],e[21]=a[0],e[22]=a[1],e[23]=a[2],a}]):d.resolve((e[25]=e[19].get("errors"),e[26]=e[19].get("errors"),a=[void 0,!1,d.i64.cast([0,9])],e[21]=a[0],e[22]=a[1],e[23]=a[2]))},function(c){return e[22]?d.sequence([function(c){return e[21]!==void 0?d.sequence([function(a){return d.storedProcedure(b("LSGenerateInitialVirtualDeviceSetupPayload"),e[5]).then(function(a){return a=a,e[26]=a[0],e[27]=a[1],a})},function(a){return e[26]!==void 0?d.sequence([function(a){return e[32]=e[26].get("virtual_device_public_key"),d.nativeOperation(b("LSBase64Encode.nop"),e[32]).then(function(a){return a=a,e[33]=a[0],a})},function(a){return e[34]=e[26].get("virtual_device_id"),d.nativeOperation(b("LSBase64Encode.nop"),e[34]).then(function(a){return a=a,e[35]=a[0],a})},function(a){return e[36]=e[26].get("virtual_device_epoch_storage_public_key"),d.nativeOperation(b("LSBase64Encode.nop"),e[36]).then(function(a){return a=a,e[37]=a[0],a})},function(a){return e[38]=e[26].get("virtual_device_epoch_storage_public_key_sig"),d.nativeOperation(b("LSBase64Encode.nop"),e[38]).then(function(a){return a=a,e[39]=a[0],a})},function(a){return e[40]=e[26].get("device_epoch_hmac"),d.nativeOperation(b("LSBase64Encode.nop"),e[40]).then(function(a){return a=a,e[41]=a[0],a})},function(a){return e[42]=e[26].get("epoch_root_key_fingerprint"),d.blobs.neq(e[42],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[42]).then(function(a){return a=a,e[54]=a[0],a})},function(a){return e[43]=e[54]}]):d.resolve(e[43]=void 0)},function(a){return e[44]=e[26].get("ocmf_rotation_token"),d.nativeOperation(b("LSBase64Encode.nop"),e[44]).then(function(a){return a=a,e[45]=a[0],a})},function(a){return e[46]=e[26].get("encrypted_secret_values_payload"),e[47]=e[26].get("virtual_device_type"),e[48]=e[26].get("action_type"),e[49]=e[26].get("cloud_service_account"),e[50]=e[26].get("hsm_pin_normalization_status"),e[51]=e[26].get("security_question_type"),e[52]=e[26].get("trusted_contact_id"),e[53]=new d.Map(),e[53].set("virtual_device_public_key",e[33]==null?"":e[33]),e[53].set("virtual_device_id",e[35]==null?"":e[35]),e[53].set("virtual_device_epoch_storage_public_key",e[37]==null?"":e[37]),e[53].set("virtual_device_epoch_storage_public_key_sig",e[39]==null?"":e[39]),e[53].set("encrypted_secret_values",e[46]),e[53].set("device_epoch_hmac",e[41]==null?"":e[41]),e[53].set("epoch_root_key_fingerprint",e[43]),e[53].set("ocmf_rotation_token",e[45]==null?"":e[45]),e[53].set("virtual_device_type",e[47]),e[53].set("action_type",e[48]),e[53].set("cloud_service_account",e[49]),e[53].set("hsm_pin_normalization_status",e[50]),e[53].set("security_question_type",e[51]),e[53].set("trusted_contact_id",e[52]),a=[e[53],!0,d.i64.cast([0,0])],e[28]=a[0],e[29]=a[1],e[30]=a[2]}]):d.resolve((e[27]!==void 0?(e[35]=e[27].get("error_code"),a=[void 0,!1,e[35]],e[32]=a[0],e[33]=a[1],e[34]=a[2]):(a=[void 0,!1,d.i64.cast([0,16])],e[32]=a[0],e[33]=a[1],e[34]=a[2],a),a=[e[32],e[33],e[34]],e[28]=a[0],e[29]=a[1],e[30]=a[2]))},function(c){return e[29]?d.sequence([function(c){return e[28]!==void 0?d.sequence([function(c){return e[33]=new d.Map(),e[33].set("optimistic_backup_id",e[5]),e[33].set("device_payload",e[4]),e[33].set("epoch_payload",e[21]),e[33].set("virtual_device_payload",e[28]),e[38]=d.i64.cast([0,1e3]),e[34]=e[38],e[35]=new d.Map(),e[35].set("success",e[33]),e[35].set("request_id",a[1]),e[36]=d.toJSON(e[35]),d.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",d.i64.cast([0,50033]),e[36],d.i64.cast([0,0]),d.i64.cast([0,93]),d.i64.cast([0,0]),void 0,e[34]).then(function(a){return a=a,e[37]=a[0],a})},function(a){return e[32]=d.i64.cast([0,0])}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Null virtual device payload"),e[34]="Null virtual device payload",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",e[34]].join("")),e[33]=d.createArray(),void 0!==void 0?e[39]=(e[33].push(void 0),e[33]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",e[34],e[33],d.i64.cast([0,3]))},function(c){return e[35]=new d.Map(),e[35].set("error_code",e[30]),e[35].set("error_message","Null virtual device payload"),e[35].set("stored_procedure","initializeBackupV2"),e[36]=new d.Map(),e[36].set("failure",e[35]),e[36].set("request_id",a[1]),e[37]=d.toJSON(e[36]),d.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",d.i64.cast([0,50033]),e[37],d.i64.cast([0,0]),d.i64.cast([0,93]),d.i64.cast([0,0]),void 0,d.i64.cast([0,0])).then(function(a){return a=a,e[38]=a[0],a})},function(a){return e[32]=d.i64.cast([0,1])}])},function(a){return e[31]=e[32]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Could not create virtual device payload"),e[33]="Could not create virtual device payload",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",e[33]].join("")),e[32]=d.createArray(),void 0!==void 0?e[38]=(e[32].push(void 0),e[32]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",e[33],e[32],d.i64.cast([0,3]))},function(c){return e[34]=new d.Map(),e[34].set("error_code",e[30]),e[34].set("error_message","Could not create virtual device payload"),e[34].set("stored_procedure","initializeBackupV2"),e[35]=new d.Map(),e[35].set("failure",e[34]),e[35].set("request_id",a[1]),e[36]=d.toJSON(e[35]),d.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",d.i64.cast([0,50033]),e[36],d.i64.cast([0,0]),d.i64.cast([0,93]),d.i64.cast([0,0]),void 0,d.i64.cast([0,0])).then(function(a){return a=a,e[37]=a[0],a})},function(a){return e[31]=d.i64.cast([0,1])}])},function(a){return e[25]=e[31]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Null epoch payload"),e[27]="Null epoch payload",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",e[27]].join("")),e[26]=d.createArray(),void 0!==void 0?e[32]=(e[26].push(void 0),e[26]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",e[27],e[26],d.i64.cast([0,3]))},function(c){return e[28]=new d.Map(),e[28].set("error_code",e[23]),e[28].set("error_message","Null epoch payload"),e[28].set("stored_procedure","initializeBackupV2"),e[29]=new d.Map(),e[29].set("failure",e[28]),e[29].set("request_id",a[1]),e[30]=d.toJSON(e[29]),d.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",d.i64.cast([0,50033]),e[30],d.i64.cast([0,0]),d.i64.cast([0,93]),d.i64.cast([0,0]),void 0,d.i64.cast([0,0])).then(function(a){return a=a,e[31]=a[0],a})},function(a){return e[25]=d.i64.cast([0,1])}])},function(a){return e[24]=e[25]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Could not create epoch payload"),e[26]="Could not create epoch payload",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",e[26]].join("")),e[25]=d.createArray(),void 0!==void 0?e[31]=(e[25].push(void 0),e[25]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",e[26],e[25],d.i64.cast([0,3]))},function(c){return e[27]=new d.Map(),e[27].set("error_code",e[23]),e[27].set("error_message","Could not create epoch payload"),e[27].set("stored_procedure","initializeBackupV2"),e[28]=new d.Map(),e[28].set("failure",e[27]),e[28].set("request_id",a[1]),e[29]=d.toJSON(e[28]),d.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",d.i64.cast([0,50033]),e[29],d.i64.cast([0,0]),d.i64.cast([0,93]),d.i64.cast([0,0]),void 0,d.i64.cast([0,0])).then(function(a){return a=a,e[30]=a[0],a})},function(a){return e[24]=d.i64.cast([0,1])}])},function(a){return e[15]=e[24]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Null device payload"),e[17]="Null device payload",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",e[17]].join("")),e[16]=d.createArray(),void 0!==void 0?e[22]=(e[16].push(void 0),e[16]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",e[17],e[16],d.i64.cast([0,3]))},function(c){return e[18]=new d.Map(),e[18].set("error_code",e[7]),e[18].set("error_message","Null device payload"),e[18].set("stored_procedure","initializeBackupV2"),e[19]=new d.Map(),e[19].set("failure",e[18]),e[19].set("request_id",a[1]),e[20]=d.toJSON(e[19]),d.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",d.i64.cast([0,50033]),e[20],d.i64.cast([0,0]),d.i64.cast([0,93]),d.i64.cast([0,0]),void 0,d.i64.cast([0,0])).then(function(a){return a=a,e[21]=a[0],a})},function(a){return e[15]=d.i64.cast([0,1])}])},function(a){return e[8]=e[15]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] Could not create device payload"),e[16]="Could not create device payload",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupV2StoredProcedure] ","",e[16]].join("")),e[15]=d.createArray(),void 0!==void 0?e[21]=(e[15].push(void 0),e[15]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupV2StoredProcedure",e[16],e[15],d.i64.cast([0,3]))},function(c){return e[17]=new d.Map(),e[17].set("error_code",e[7]),e[17].set("error_message","Could not create device payload"),e[17].set("stored_procedure","initializeBackupV2"),e[18]=new d.Map(),e[18].set("failure",e[17]),e[18].set("request_id",a[1]),e[19]=d.toJSON(e[18]),d.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",d.i64.cast([0,50033]),e[19],d.i64.cast([0,0]),d.i64.cast([0,93]),d.i64.cast([0,0]),void 0,d.i64.cast([0,0])).then(function(a){return a=a,e[20]=a[0],a})},function(a){return e[8]=d.i64.cast([0,1])}])},function(a){return e[9]=d.i64.of_float(Date.now()),e[10]=d.i64.random(),e[12]="Finishing execution. Execution time: ",e[13]=d.i64.to_string(d.i64.sub(e[9],e[0])),e[14]=" ms",e[11]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][initializeBackupV2] ",e[11],e[12],e[11],e[13],e[11],e[14]].join("")),d.i64.eq(d.i64.mod_(e[10],d.i64.cast([0,1e3])),d.i64.cast([0,0]))?(e[15]=",",e[16]=d.createArray(),void 0!==void 0?e[17]=(e[16].push(void 0),e[16]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"initializeBackupV2",[e[12],e[15],e[13],e[15],e[14]].join(""),e[16],d.i64.cast([0,4]))):d.resolve()},function(a){return f[0]=e[8]}])},function(a){return d.resolve(f)}])}a.__sproc_name__="LSEncryptedBackupsInitializeBackupV2StoredProcedure";a.__tables__=["secure_encrypted_backups_client_state"];d=a;g["default"]=d}),98);
__d("LSInitializeBackupV2StoredProcedure",["LSInitializeBackupV2","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSInitializeBackupV2"),e.deviceRegistrationId,e.requestId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MWEncryptedBackupsInitializeBackup",["LSFactory","LSInitializeBackupV2StoredProcedure"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,d){return a.runInTransaction(function(a){return c("LSInitializeBackupV2StoredProcedure")(c("LSFactory")(a),{deviceRegistrationId:b,requestId:d!=null?d:""})},"readwrite",void 0,void 0,f.id+":25")}g.initializeBackupStoredProcedure=a}),98);
__d("EBInitializeBackup",["EBAPIQPLPoints","EBMainThreadEBDBApiDeferred","EBSMAPI","I64","LSAuthorityLevel","LSEncryptedBackupsOpStatus","LSIntEnum","MAWTraceUtils","MWEncryptedBackupsDeviceRegistrationId","MWEncryptedBackupsInitializeBackup","ReQL","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h,i;async function a(a){var b=a.db,e=a.qplFlow;a=a.virtualDeviceType;e.addPoint(d("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_START);if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(16))){a=await c("EBSMAPI").generateRecoveryCode({virtualDeviceType:a});if(a.success===!1){e.endFail("generate_recovery_code_failure");return a}}e.addPoint(d("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_SPROC_START);return new Promise(async function(a,f){f=d("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId();if(f===""){e.endFail("device_registration_id_null");a(d("WAResultOrError").makeError("device_registration_id_null"));return}f=await d("MWEncryptedBackupsInitializeBackup").initializeBackupStoredProcedure(b,f,d("MAWTraceUtils").stringToTraceId(e.getQPLAttrs().instanceKey.toString()));f=f[0];if((h||(h=d("I64"))).equal(f,(i||(i=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsOpStatus").FAILURE))){e.addPoint(d("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_SPROC_FAIL);a(d("WAResultOrError").makeError("sproc_failure"));return}e.addPoint(d("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_SPROC_END);var g=b.tables.secure_encrypted_backups_client_state.subscribe(async function(f,j){if(j.operation==="delete")return;f=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(b.tables.secure_encrypted_backups_client_state));if(f!=null){j=f[0];f=j.authorityLevel;j=j.backupId;(h||(h=d("I64"))).equal(f,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))&&(e.addPoint(d("EBAPIQPLPoints").EBBackupInitQPLPoints.INITIALIZE_BACKUP_END),g(),e.addPoint(d("EBAPIQPLPoints").EBBackupInitQPLPoints.FETCH_BACKUP_IDS_START),c("EBSMAPI").fetchBackupIds("EBInitializeBackup").finally(function(){e.addPoint(d("EBAPIQPLPoints").EBBackupInitQPLPoints.FETCH_BACKUP_IDS_END),e.endSuccess(),void d("EBMainThreadEBDBApiDeferred").addNewDevice()}),a(d("WAResultOrError").makeResult(j)));e.addPoint(d("EBAPIQPLPoints").EBBackupInitQPLPoints.OPTIMISTIC_CLIENT_STATE);return}e.endFail("empty_client_state");g();return a(d("WAResultOrError").makeError("empty_client_state"))})})}g.initializeBackup=a}),98);
__d("EBLabyrinthWasmReactorSingleton",["EBGetCryptoWasm","WAWasmReactor","err"],(function(a,b,c,d,e,f,g){"use strict";var h=function(){function a(){if(!a.$2){var b=d("WAWasmReactor").createWasmInstance(d("EBGetCryptoWasm").getCryptoWasm);a.$1=b;return}throw c("err")("EBLabyrinthWasiReactorSingleton is already initialized")}a.getInstance=function(){if(!a.$2){var b=new a();a.$2=b;b=d("WAWasmReactor").createWasmInstance(d("EBGetCryptoWasm").getCryptoWasm);a.$1=b}return a.$2};var b=a.prototype;b.createWasmReactorCommand=async function(b){var d=b.InputSpec,e=b.ResultSpec;b=b.validateResult;var f=await a.$1;if(!f)throw c("err")("wasmReactor is not initialized");return f.createWasmCommand({InputSpec:d,ResultSpec:e,validateResult:b})};return a}();h.$1=null;h.$2=null;a=function(a){var b=h.getInstance();if(!b)throw c("err")("EBLabyrinthWasiReactorSingleton is not initialized");return b.createWasmReactorCommand(a)};g.createLabyrinthReactorCommand=a}),98);
__d("LSFinishAddPeerDevice",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDebugToken.nop","LSCreateDerivedKeys.nop","LSCreateSignature_v2.nop","LSDeleteBackupOnClient","LSGenerateLocalKeys","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSOcmfClientEvolve_v2.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] Beginning execution."),c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,1434]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[8]=a[0],a})},function(a){return d[8]?d[9]=!0:d[9]=!1,d[9]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[11]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[11]].join("")),d[10]=c.createArray(),void 0!==void 0?d[12]=(d[10].push(void 0),d[10]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[11],d[10],c.i64.cast([0,3]))):c.resolve()}])},function(e){return c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}).next().then(function(e,f){f=e.done;e=e.value;return f?c.sequence([function(a){return c.db.table(168).fetch().next().then(function(a,d){var e=a.done;a=a.value;return e?0:(d=a.item,c.storedProcedure(b("LSDeleteBackupOnClient"),d.backupId,void 0,!1,void 0,"null",!0))})},function(e){return d[8]=a[0].get("backup_id"),c.storedProcedure(b("LSGenerateLocalKeys"),!1).then(function(a){return a=a,d[9]=a[0],d[10]=a[1],a})},function(e){return d[9]!==void 0?c.sequence([function(a){return d[11]=d[9].get("device_key"),d[12]=d[9].get("epoch_storage_key"),d[13]=d[9].get("epoch_auth_key"),d[14]=d[11].get("device_private_key"),d[15]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[16]?d[44]=(d[15].push(c.i64.cast([0,0])),d[15]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[17]=a[0],a})},function(a){return d[17]?d[44]=(d[15].push(c.i64.cast([0,2])),d[15]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[18]?d[44]=(d[15].push(c.i64.cast([0,3])),d[15]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[19]=a[0],a})},function(a){return d[19]?d[44]=(d[15].push(c.i64.cast([0,4])),d[15]):0,d[20]="",d[21]=c.i64.of_int32(d[15].length),c.i64.gt(d[21],c.i64.cast([0,0]))?c.loopAsync(d[21],function(a){return d[44]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[15],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return d[20]=[d[20],"_",c.i64.to_string(d[45])].join("")}])}):c.resolve()},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),["supported_versions_",d[20],"revision_version_",c.i64.to_string(c.i64.cast([0,1]))].join("")).then(function(a){return a=a,d[22]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateSignature_v2.nop"),d[14],c.blob("Mg=="),d[22]).then(function(a){return a=a,d[23]=a[0],a})},function(a){return c.blobs.neq(d[23],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[23]).then(function(a){return a=a,d[44]=a[0],a})},function(a){return d[24]=d[44]}]):c.resolve(d[24]=void 0)},function(e){return d[25]=a[0].get("temp_ocmf_client_state"),c.nativeOperation(b("LSOcmfClientEvolve_v2.nop"),d[25]).then(function(a){return a=a,d[26]=a[0],d[27]=a[1],a})},function(a){return c.blobs.neq(void 0,void 0)?c.sequence([function(a){return c.nativeOperation(b("LSOcmfClientEvolve_v2.nop"),void 0).then(function(a){return a=a,d[44]=a[0],d[45]=a[1],a})},function(a){return a=[d[26],d[27],d[44],d[45]],d[28]=a[0],d[29]=a[1],d[30]=a[2],d[31]=a[3],a}]):c.resolve((a=[d[26],d[27],void 0,void 0],d[28]=a[0],d[29]=a[1],d[30]=a[2],d[31]=a[3],a))},function(b){return d[32]=d[11].get("device_public_key"),d[33]=d[11].get("device_private_key"),d[34]=d[12].get("epoch_storage_public_key"),d[35]=d[12].get("epoch_storage_private_key"),d[36]=d[13].get("epoch_auth_public_key"),d[37]=d[13].get("epoch_auth_private_key"),d[38]=a[0].get("mailbox_root_key"),d[39]=a[0].get("oblivious_validation_token"),c.forEach(c.filter(c.db.table(168).fetch([[[d[8]]]]),function(a){return c.i64.eq(a.backupId,d[8])&&c.i64.lt(a.authorityLevel,c.i64.cast([0,20]))}),function(a){return a["delete"]()})},function(a){return c.db.table(168).add({backupId:d[8],devicePublicKeyBlob:d[32],devicePrivateKeyBlob:d[33],epochStoragePublicKeyBlob:d[34],epochStoragePrivateKeyBlob:d[35],epochAuthPublicKeyBlob:d[36],epochAuthPrivateKeyBlob:d[37],mailboxRootKeyBlob:d[38],ocmfClientStateBlob:d[28],obliviousValidationTokenBlob:d[39],authorityLevel:c.i64.cast([0,20]),backupTenancy:c.i64.cast([0,1]),revisionVersion:c.i64.cast([0,1]),encryptionVersion:c.i64.cast([0,0])})},function(e){return d[40]=a[0].get("add_peer_epoch_data"),d[41]=c.i64.of_int32(d[40].length),c.i64.gt(d[41],c.i64.cast([0,0]))?c.loopAsync(d[41],function(a){return d[44]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[40],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return d[47]=d[45].get("epoch_id"),d[48]=d[45].get("epoch_anon_id"),d[49]=d[45].get("epoch_root_key"),d[50]=d[45].get("epoch_status"),d[51]=d[45].get("epoch_head"),c.forEach(c.filter(c.db.table(169).fetch([[[d[47]]]]),function(a){return c.i64.eq(a.epochId,d[47])&&c.i64.lt(a.authorityLevel,c.i64.cast([0,80]))}),function(a){return a["delete"]()})},function(a){return c.db.table(169).add({epochId:d[47],authorityLevel:c.i64.cast([0,80]),backupId:d[8],epochAnonIdBlob:d[48],epochRootKeyBlob:d[49],epochStatus:d[50],epochHead:d[51]})}])}):c.resolve()},function(a){return c.count(c.db.table(169).fetch()).then(function(a){return d[42]=a})},function(a){return c.i64.le(d[42],c.i64.cast([0,1]))?c.sequence([function(a){return c.db.table(169).fetch().next().then(function(a,e){var f=a.done;a=a.value;return f?c.sequence([function(a){return d[46]="No epoch available in epochs table",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ","",d[46]].join("")),d[47]=c.createArray(),void 0!==void 0?d[48]=(d[47].push(void 0),d[47]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",[d[46]].join(""),d[47],c.i64.cast([0,3]))},function(a){return d[44]=void 0}]):(e=a.item,d[46]=new c.Map(),d[46].set("epoch_id",e.epochId),d[46].set("backup_id",e.backupId),d[46].set("epoch_anon_id_blob",e.epochAnonIdBlob),d[46].set("epoch_root_key_blob",e.epochRootKeyBlob),d[46].set("epoch_status",e.epochStatus),d[46].set("epoch_head",e.epochHead),d[46].set("authority_level",e.authorityLevel),d[44]=d[46])})},function(a){return d[43]=d[44]}]):c.sequence([function(a){return d[44]="Multiple epochs available in epochs table",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ","",d[44]].join("")),d[45]=c.createArray(),void 0!==void 0?d[46]=(d[45].push(void 0),d[45]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",[d[44]].join(""),d[45],c.i64.cast([0,3]))},function(a){return d[43]=void 0}])},function(e){return d[43]!==void 0?c.sequence([function(a){return d[44]=d[43].get("epoch_anon_id_blob"),d[45]=d[43].get("epoch_root_key_blob"),d[46]=d[11].get("device_public_key"),d[47]=c.createArray(),d[51]=(d[47].push(c.i64.cast([0,32])),d[47]),c.nativeOperation(b("LSBase64Encode.nop"),d[44]).then(function(a){return a=a,d[48]=a[0],a})},function(a){return d[48]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blobs.of_string(["epoch_devices","_",d[48]].join("")),void 0,d[45],d[47]).then(function(a){return a=a,d[51]=a[0],a})},function(a){return d[51]?d[52]=!1:d[52]=!0,d[52]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),d[55]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",d[55]].join("")),d[54]=c.createArray(),void 0!==void 0?d[57]=(d[54].push(void 0),d[54]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",d[55],d[54],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[56]=a[0],a})},function(a){return d[53]=d[56]}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[51],c.i64.cast([0,0])).then(function(a){return a=a,d[54]=a[0],d[55]=a[1],a})},function(a){return d[53]=d[54]}])},function(a){return d[49]=d[53]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),d[52]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",d[52]].join("")),d[51]=c.createArray(),void 0!==void 0?d[54]=(d[51].push(void 0),d[51]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",d[52],d[51],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[53]=a[0],a})},function(a){return d[49]=d[53]}])},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),d[49],d[46]).then(function(a){return a=a,d[50]=a[0],a})},function(e){return c.blobs.neq(d[50],void 0)?c.sequence([function(a){return d[51]=d[11].get("device_public_key"),c.nativeOperation(b("LSBase64Encode.nop"),d[51]).then(function(a){return a=a,d[52]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[50]).then(function(a){return a=a,d[53]=a[0],a})},function(a){return d[54]=d[43].get("epoch_root_key_blob"),c.blobs.neq(d[54],void 0)?c.sequence([function(a){return d[81]=c.createArray(),d[87]=(d[81].push(c.i64.cast([0,18])),d[81]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[54],d[81]).then(function(a){return a=a,d[82]=a[0],a})},function(a){return d[82]!==void 0?c.sequence([function(a){return d[87]=c.i64.of_int32(d[82].length),c.i64.ge(d[87],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[82],c.i64.cast([0,0])).then(function(a){return a=a,d[89]=a[0],d[90]=a[1],a})},function(a){return d[88]=d[89]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[90]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[90]].join("")),d[89]=c.createArray(),void 0!==void 0?d[91]=(d[89].push(void 0),d[89]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[90],d[89],c.i64.cast([0,3]))},function(a){return d[88]=void 0}])},function(a){return d[83]=d[88]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[88]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[88]].join("")),d[87]=c.createArray(),void 0!==void 0?d[89]=(d[87].push(void 0),d[87]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[88],d[87],c.i64.cast([0,3]))},function(a){return d[83]=void 0}])},function(a){return c.blobs.neq(d[83],void 0)?d[84]=!0:d[84]=!1,d[84]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.nativeOperation(b("LSBase64Encode.nop"),d[83]).then(function(a){return a=a,d[85]=a[0],a})},function(a){return d[85]!==void 0?d[86]=d[85]:d[86]="encodingfailed",d[55]=d[86]}]):c.resolve(d[55]="null")},function(a){return d[56]=d[12].get("epoch_storage_public_key"),c.nativeOperation(b("LSBase64Encode.nop"),d[56]).then(function(a){return a=a,d[57]=a[0],a})},function(a){return d[58]=d[9].get("epoch_storage_public_key_sig"),c.nativeOperation(b("LSBase64Encode.nop"),d[58]).then(function(a){return a=a,d[59]=a[0],a})},function(a){return d[60]=d[13].get("epoch_auth_public_key"),c.nativeOperation(b("LSBase64Encode.nop"),d[60]).then(function(a){return a=a,d[61]=a[0],a})},function(a){return d[62]=d[9].get("epoch_auth_public_key_sig"),c.nativeOperation(b("LSBase64Encode.nop"),d[62]).then(function(a){return a=a,d[63]=a[0],a})},function(e){return d[64]=d[11].get("device_private_key"),d[65]=a[0].get("mailbox_root_key"),d[66]=d[12].get("epoch_storage_private_key"),c.blobs.neq(d[65],void 0)?c.sequence([function(a){return d[81]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[65],"private_key",d[64],c.i64.cast([0,1]),d[81]).then(function(a){return a=a,d[82]=a[0],a})},function(a){return c.blobs.neq(d[82],void 0)?d[83]=d[82]:d[83]=void 0,d[67]=d[83]}]):c.resolve(d[67]=void 0)},function(a){return c.blobs.neq(d[67],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[67]).then(function(a){return a=a,d[81]=a[0],a})},function(a){return d[68]=d[81]}]):c.resolve(d[68]=void 0)},function(a){return c.blobs.neq(d[65],void 0)?c.sequence([function(a){return d[81]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[65],"ocmf_client_state",d[28],c.i64.cast([0,1]),d[81]).then(function(a){return a=a,d[82]=a[0],a})},function(a){return c.blobs.neq(d[82],void 0)?d[83]=d[82]:d[83]=void 0,d[69]=d[83]}]):c.resolve(d[69]=void 0)},function(a){return c.blobs.neq(d[69],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[69]).then(function(a){return a=a,d[81]=a[0],a})},function(a){return d[70]=d[81]}]):c.resolve(d[70]=void 0)},function(a){return c.blobs.neq(d[65],void 0)?c.sequence([function(a){return d[81]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[65],"epoch_storage_private_key",d[66],c.i64.cast([0,1]),d[81]).then(function(a){return a=a,d[82]=a[0],a})},function(a){return c.blobs.neq(d[82],void 0)?d[83]=d[82]:d[83]=void 0,d[71]=d[83]}]):c.resolve(d[71]=void 0)},function(a){return c.blobs.neq(d[71],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[71]).then(function(a){return a=a,d[81]=a[0],a})},function(a){return d[72]=d[81]}]):c.resolve(d[72]=void 0)},function(e){return d[73]=a[0].get("backup_id"),c.nativeOperation(b("LSBase64Encode.nop"),d[29]).then(function(a){return a=a,d[74]=a[0],a})},function(e){return d[75]=a[0].get("server_data_id"),d[76]=d[43].get("epoch_id"),d[77]=new c.Map(),d[77].set("supported_encryption_versions",d[15]),d[77].set("client_version",c.i64.cast([0,1])),d[77].set("version_sig",d[24]==null?"":d[24]),d[78]=new c.Map(),d[78].set("backup_id",d[73]),d[78].set("device_epoch_hmac",d[53]==null?"":d[53]),d[78].set("epoch_root_key_fingerprint",d[55]),d[78].set("device_public_key",d[52]==null?"":d[52]),d[78].set("epoch_auth_pubkey",d[61]==null?"":d[61]),d[78].set("epoch_auth_pubkey_sig",d[63]==null?"":d[63]),d[78].set("epoch_storage_pubkey",d[57]==null?"":d[57]),d[78].set("epoch_storage_pubkey_sig",d[59]==null?"":d[59]),d[78].set("ocmf_rotation_token",d[74]==null?"":d[74]),d[78].set("server_data_id",d[75]),d[78].set("device_registration_id",a[1]),d[78].set("base_epoch_id",d[76]),d[78].set("encryption_version_data",d[77]),d[78].set("private_key_debug_token",d[68]),d[78].set("ocmf_client_state_debug_token",d[70]),d[78].set("epoch_storage_pvtkey_debug_token",d[72]),d[78].set("trace_id",void 0),d[78].set("occam_only_eligible",!0),d[79]=c.toJSON(d[78]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",c.i64.cast([0,50017]),d[79],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[80]=a[0],a})}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] $device_epoch_hmac found to be null"),d[51]=c.createArray(),void 0!==void 0?d[52]=(d[51].push(void 0),d[51]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure","$device_epoch_hmac found to be null",d[51],c.i64.cast([0,3]))},function(a){return c.storedProcedure(b("LSDeleteBackupOnClient"),d[8],"backup_init_flow",!0,void 0,void 0,!1)},function(a){return c.forEach(c.db.table(169).fetch(),function(a){return a["delete"]()})}])}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] Error! There should be exactly one open epoch. Deleting local state and terminating device addition"),d[44]=c.createArray(),void 0!==void 0?d[45]=(d[44].push(void 0),d[44]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure","Error! There should be exactly one open epoch. Deleting local state and terminating device addition",d[44],c.i64.cast([0,3]))},function(a){return c.storedProcedure(b("LSDeleteBackupOnClient"),d[8],"backup_init_flow",!0,void 0,void 0,!1)},function(a){return c.forEach(c.db.table(169).fetch(),function(a){return a["delete"]()})}])}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] Error! Error in generating the keys. Deleting local state and terminating device addition"),d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure","Error! Error in generating the keys. Deleting local state and terminating device addition",d[11],c.i64.cast([0,3]))},function(a){return c.storedProcedure(b("LSDeleteBackupOnClient"),d[8],"backup_init_flow",!0,void 0,void 0,!1)},function(a){return c.forEach(c.db.table(169).fetch(),function(a){return a["delete"]()})}])}]):(e.item,d[8]="An authoritative row already exists, aborting execution of add peer device",d[8]!==void 0?(function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ","",d[8]].join("")),d[9]=c.createArray(),void 0!==void 0?d[10]=(d[9].push(void 0),d[9]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",d[8],d[9],c.i64.cast([0,3]))):c.resolve())})},function(a){return d[2]=c.i64.of_float(Date.now()),d[3]=c.i64.random(),d[5]="Finishing execution. Execution time: ",d[6]=c.i64.to_string(c.i64.sub(d[2],d[0])),d[7]=" ms",d[4]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ",d[4],d[5],d[4],d[6],d[4],d[7]].join("")),c.i64.eq(c.i64.mod_(d[3],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[8]=",",d[9]=c.createArray(),void 0!==void 0?d[10]=(d[9].push(void 0),d[9]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",[d[5],d[8],d[6],d[8],d[7]].join(""),d[9],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSDeserializeSecretsAndAddDevice",["LSArrayGetObjectAt","LSBase64Decode.nop","LSDeserializeFromJsonIntoDictionaryV2.nop","LSFinishAddPeerDevice","LSQplInteractionHelper.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"MEB_DS_DESERIALIZE_SECRETS_NATIVE_OP_START",c.i64.cast([0,0]),void 0)},function(e){return c.nativeOperation(b("LSDeserializeFromJsonIntoDictionaryV2.nop"),a[0]).then(function(a){return a=a,d[0]=a[0],a})},function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"MEB_DS_DESERIALIZE_SECRETS_NATIVE_OP_END",c.i64.cast([0,0]),void 0)},function(a){return d[1]=d[0].get("temp_ocmf_client_state"),c.nativeOperation(b("LSBase64Decode.nop"),d[1]).then(function(a){return a=a,d[2]=a[0],a})},function(a){return d[3]=d[0].get("mailbox_root_key"),c.nativeOperation(b("LSBase64Decode.nop"),d[3]).then(function(a){return a=a,d[4]=a[0],a})},function(a){return d[5]=d[0].get("oblivious_validation_token"),c.nativeOperation(b("LSBase64Decode.nop"),d[5]).then(function(a){return a=a,d[6]=a[0],a})},function(a){return d[7]=c.createArray(),d[8]=d[0].get("add_peer_epoch_data_serializable"),d[9]=c.i64.of_int32(d[8].length),c.i64.gt(d[9],c.i64.cast([0,0]))?c.loopAsync(d[9],function(a){return d[14]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[8],d[14]).then(function(a){return a=a,d[15]=a[0],d[16]=a[1],a})},function(a){return d[17]=d[15].get("epoch_anon_id"),c.nativeOperation(b("LSBase64Decode.nop"),d[17]).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[19]=d[15].get("epoch_root_key"),c.nativeOperation(b("LSBase64Decode.nop"),d[19]).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[21]=d[15].get("epoch_id"),d[22]=d[15].get("epoch_status"),d[23]=new c.Map(),d[23].set("epoch_id",d[21]),d[23].set("epoch_anon_id",d[18]==null?c.blob(""):d[18]),d[23].set("epoch_root_key",d[20]==null?c.blob(""):d[20]),d[23].set("epoch_status",d[22]),d[24]=d[15].get("epoch_head"),d[24]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSBase64Decode.nop"),d[24]).then(function(a){return a=a,d[25]=a[0],a})},function(a){return d[23].set("epoch_head",d[25])}]):c.resolve()},function(a){return d[25]=(d[7].push(d[23]),d[7])}])}):c.resolve()},function(e){return d[10]=d[0].get("backup_id"),d[11]=d[0].get("server_data_id"),d[12]=new c.Map(),d[12].set("backup_id",d[10]),d[12].set("server_data_id",d[11]),d[12].set("temp_ocmf_client_state",d[2]==null?c.blob(""):d[2]),d[12].set("mailbox_root_key",d[4]==null?c.blob(""):d[4]),d[12].set("oblivious_validation_token",d[6]==null?c.blob(""):d[6]),d[12].set("add_peer_epoch_data",d[7]),d[12]!==void 0?c.sequence([function(e){return c.storedProcedure(b("LSFinishAddPeerDevice"),d[12],a[1])},function(a){return d[13]=!0}]):c.resolve(d[13]=!1)},function(a){return e[0]=d[13]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDeserializeSecretsAndAddDeviceStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSDeserializeSecretsAndAddDeviceStoredProcedure",["LSDeserializeSecretsAndAddDevice","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSDeserializeSecretsAndAddDevice"),e.serializedPayload,e.deviceRegistrationId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("EBOtcAddDevice",["EBAPIQPLPoints","EBDeps","EBLogger","EBMainThreadEBDBApiDeferred","I64","LSDeserializeSecretsAndAddDeviceStoredProcedure","LSEncryptedBackupsRecoveryCodeStatus","LSFactory","LSIntEnum","ReQL","WAGetSafeQPLError","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h,i;async function a(a){var b=a.initiatorId,e=a.qplFlow,f=a.secrets,g=function(){};e.addPoint(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_WAIT_FOR_EBLS_START);var k=await d("EBDeps").getDeps().getLSDB();e.addPoint(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.ADD_DEVICE_WAIT_FOR_EBLS_END);e.addPoint(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.OTC_ADD_DEVICE_SPROC_START);return new Promise(function(a,l){return k.runInTransaction(function(a){return c("LSDeserializeSecretsAndAddDeviceStoredProcedure")(c("LSFactory")(a),{deviceRegistrationId:b,serializedPayload:f})},"readwrite").then(function(b){b=b[0];e.addPoint(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.OTC_ADD_DEVICE_SPROC_END);if(!b){e.endFail(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.OTC_ADD_DEVICE_SPROC_FAILURE);return a(j("OTC_ADD_DEVICE_SPROC_FAILURE"))}g=d("ReQL").fromTableAscending(k.tables.secure_encrypted_backups_recovery_code_status).subscribe(function(b,f){if(f.operation==="add"||f.operation==="put"){g();b=f.value.recoveryCodeStatus;if((h||(h=d("I64"))).equal(b,(i||(i=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsRecoveryCodeStatus").VALID)))e.addPoint(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.OTC_ADD_DEVICE_SUCCESS),e.endSuccess(),void d("EBMainThreadEBDBApiDeferred").addNewDevice(),a(j("SUCCESS"));else if((h||(h=d("I64"))).equal(b,(i||(i=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsRecoveryCodeStatus").SYSTEM_ERROR)))e.endFail(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.OTC_ADD_DEVICE_SYSTEM_ERROR),d("EBLogger").EBLogger().mustfix("PAKE: LSEncryptedBackupsFinishAddPeerDeviceTask task failed"),a(j("OTC_ADD_DEVICE_SYSTEM_ERROR"));else{f="PAKE: Unexpected recovery code status: "+(h||(h=d("I64"))).to_int32(b);e.endFail(d("EBAPIQPLPoints").EBAddDeviceQPLPoints.OTC_ADD_DEVICE_UNEXPECTED_RECOVERY_CODE_STATUS,{string:{errorMessage:f}});d("EBLogger").EBLogger("wmi_eb").mustfix(f);a(j("OTC_ADD_DEVICE_UNEXPECTED_RECOVERY_CODE_STATUS",f))}}})}).catch(function(b){g(),a(j("OTC_ADD_DEVICE_SPROC_ERROR",d("WAGetSafeQPLError").getSafeQPLErrorMessage(b)))})})}function j(a,b){if(a==="SUCCESS")return d("WAResultOrError").makeResult();else return d("WAResultOrError").makeError({errorMessage:b,status:a})}g.otcAddDevice=a}),98);
__d("EBParseUploadSerializationPayload",["EBLogger","MAWEBFrontendQPLLogger","WAErrorMessage","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=d("EBLogger").EBLogger().tags(["parseUploadSerializationResponse"]);function a(a){try{a=JSON.parse(a);return d("WAResultOrError").makeResult(a)}catch(b){a=d("WAErrorMessage").maybeGetMessageFromError(b);j.MUSTFIX(h||(h=babelHelpers.taggedTemplateLiteralLoose(["parseUploadSerializationResponse: ",""])),a);return d("WAResultOrError").makeError("parse_exception")}}function b(a,b,c,e){var f=[],g=[];a.forEach(function(a){var d=a.error_code+": "+a.error_message;j.MUSTFIX(i||(i=babelHelpers.taggedTemplateLiteralLoose(["EB upload "," serializer error: "," in ",""])),b,d,c);f.push(a.error_code);g.push(a.error_message)});if(e!=null){d("MAWEBFrontendQPLLogger").addPointEBUploadTracking(e,b+"_upload_task_serialization_failure",{int_array:(a={},a[b+"_serialization_error_codes"]=f,a),string_array:(e={},e[b+"_serialization_errors"]=g,e)})}}g.parseUploadSerializationResponse=a;g.logUploadSerializationErrors=b}),98);
__d("EBUploadMessagesFromWorkerMutation_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="24365010893138670"}),null);
__d("EBUploadMessagesFromWorkerMutation.graphql",["EBUploadMessagesFromWorkerMutation_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"input"}],c=[{alias:null,args:[{kind:"Variable",name:"data",variableName:"input"}],concreteType:"XFBTUploadMessageGQLResponse",kind:"LinkedField",name:"xfb_upload_encrypted_msg_to_backup",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"device_epoch_status",storageKey:null},{alias:null,args:null,concreteType:"XFBTUploadMessageHandlerResponse",kind:"LinkedField",name:"backup_write_result_response",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"is_success",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"delete_mailbox",storageKey:null},{alias:null,args:null,concreteType:"XFBTProtobufParams",kind:"LinkedField",name:"protobuf_params",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"delete_on_success",storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"exception_string",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"EBUploadMessagesFromWorkerMutation",selections:c,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"EBUploadMessagesFromWorkerMutation",selections:c},params:{id:b("EBUploadMessagesFromWorkerMutation_facebookRelayOperation"),metadata:{},name:"EBUploadMessagesFromWorkerMutation",operationKind:"mutation",text:null}}}();e.exports=a}),null);
__d("LSWriteSupplementalMessage",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][writeSupplementalMessage] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.filter(c.db.table(302).fetch(),function(b){return b.threadId===a[1]&&b.toplevelOfflineThreadingId===a[2]&&b.supplementalKey===a[3]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[2]=void 0:(b=a.item,d[2]=b.messageTimestampMs)})},function(b){return c.i64.neq(d[2],void 0)?c.sequence([function(b){return c.i64.gt(d[2],a[5])?c.resolve((b=[!1,c.i64.cast([0,851])],d[12]=b[0],d[13]=b[1],b)):c.sequence([function(b){return c.forEach(c.filter(c.db.table(302).fetch(),function(b){return b.threadId===a[1]&&b.toplevelOfflineThreadingId===a[2]&&b.supplementalKey===a[3]}),function(a){return a["delete"]()})},function(b){return c.db.table(302).add({pk:void 0,messagePayload:a[0],threadId:a[1],toplevelOfflineThreadingId:a[2],supplementalKey:a[3],offlineThreadingId:a[4],messageTimestampMs:a[5]})},function(a){return a=[!0,void 0],d[12]=a[0],d[13]=a[1],a}])},function(a){return a=[d[12],d[13]],d[4]=a[0],d[5]=a[1],a}]):c.sequence([function(b){return c.forEach(c.filter(c.db.table(302).fetch(),function(b){return b.threadId===a[1]&&b.toplevelOfflineThreadingId===a[2]&&b.supplementalKey===a[3]}),function(a){return a["delete"]()})},function(b){return c.db.table(302).add({pk:void 0,messagePayload:a[0],threadId:a[1],toplevelOfflineThreadingId:a[2],supplementalKey:a[3],offlineThreadingId:a[4],messageTimestampMs:a[5]})},function(a){return a=[!0,void 0],d[4]=a[0],d[5]=a[1],a}])},function(a){return d[6]=c.i64.of_float(Date.now()),d[7]=c.i64.random(),d[9]="Finishing execution. Execution time: ",d[10]=c.i64.to_string(c.i64.sub(d[6],d[0])),d[11]=" ms",d[8]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][writeSupplementalMessage] ",d[8],d[9],d[8],d[10],d[8],d[11]].join("")),c.i64.eq(c.i64.mod_(d[7],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[12]=",",d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"writeSupplementalMessage",[d[9],d[12],d[10],d[12],d[11]].join(""),d[13],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[4],d[5]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMPSWriteSupplementalMessageStoredProcedure";a.__tables__=["local_message_persistence_store_supplemental"];e.exports=a}),null);
__d("LSWriteSupplementalMessageStoredProcedure",["LSSynchronousPromise","LSWriteSupplementalMessage","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSWriteSupplementalMessage"),e.messagePayload,e.threadId,e.toplevelOfflineThreadingId,e.supplementalKey,e.offlineThreadingId,e.messageTimestampMs);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSWriteTopLevelMessage",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][writeTopLevelMessage] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.filter(c.db.table(301).fetch(),function(b){return b.threadId===a[1]&&b.offlineThreadingId===a[2]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[2]=void 0:(b=a.item,d[2]=b.messageTimestampMs)})},function(b){return c.i64.neq(d[2],void 0)?c.sequence([function(b){return c.i64.gt(d[2],a[3])?c.resolve((b=[!1,c.i64.cast([0,851])],d[12]=b[0],d[13]=b[1],b)):c.sequence([function(b){return c.filter(c.db.table(303).fetch(),function(b){return b.threadId===a[1]&&b.offlineThreadingId===a[2]}).next().then(function(a,b){b=a.done;a=a.value;return b?d[14]=!1:(a.item,d[14]=!0)})},function(b){return d[14]?c.sequence([function(b){return c.forEach(c.filter(c.db.table(303).fetch(),function(b){return b.threadId===a[1]&&b.offlineThreadingId===a[2]}),function(b){var c=b.update;b.item;return c({deletedMessagePayload:a[0],isLocalOnlyMessage:a[4],messageTimestampMs:a[3]})})},function(b){return c.forEach(c.filter(c.db.table(301).fetch(),function(b){return b.threadId===a[1]&&b.offlineThreadingId===a[2]&&c.i64.eq(b.messageTimestampMs,c.i64.cast([-1,4294967295]))}),function(b){var c=b.update;b.item;return c({messageTimestampMs:a[3]})})},function(a){return a=[!1,c.i64.cast([0,852])],d[16]=a[0],d[17]=a[1],a}]):c.sequence([function(b){return c.forEach(c.filter(c.db.table(301).fetch(),function(b){return b.threadId===a[1]&&b.offlineThreadingId===a[2]}),function(a){return a["delete"]()})},function(b){return c.db.table(301).add({pk:void 0,messagePayload:a[0],threadId:a[1],offlineThreadingId:a[2],messageTimestampMs:a[3],isLocalOnlyMessage:a[4],extraData:a[5]})},function(a){return a=[!0,void 0],d[16]=a[0],d[17]=a[1],a}])},function(a){return a=[d[16],d[17]],d[12]=a[0],d[13]=a[1],a}])},function(a){return a=[d[12],d[13]],d[4]=a[0],d[5]=a[1],a}]):c.sequence([function(b){return c.filter(c.db.table(303).fetch(),function(b){return b.threadId===a[1]&&b.offlineThreadingId===a[2]}).next().then(function(a,b){b=a.done;a=a.value;return b?d[12]=!1:(a.item,d[12]=!0)})},function(b){return d[12]?c.sequence([function(b){return c.forEach(c.filter(c.db.table(303).fetch(),function(b){return b.threadId===a[1]&&b.offlineThreadingId===a[2]}),function(b){var c=b.update;b.item;return c({deletedMessagePayload:a[0],isLocalOnlyMessage:a[4],messageTimestampMs:a[3]})})},function(b){return c.forEach(c.filter(c.db.table(301).fetch(),function(b){return b.threadId===a[1]&&b.offlineThreadingId===a[2]&&c.i64.eq(b.messageTimestampMs,c.i64.cast([-1,4294967295]))}),function(b){var c=b.update;b.item;return c({messageTimestampMs:a[3]})})},function(a){return a=[!1,c.i64.cast([0,852])],d[14]=a[0],d[15]=a[1],a}]):c.sequence([function(b){return c.forEach(c.filter(c.db.table(301).fetch(),function(b){return b.threadId===a[1]&&b.offlineThreadingId===a[2]}),function(a){return a["delete"]()})},function(b){return c.db.table(301).add({pk:void 0,messagePayload:a[0],threadId:a[1],offlineThreadingId:a[2],messageTimestampMs:a[3],isLocalOnlyMessage:a[4],extraData:a[5]})},function(a){return a=[!0,void 0],d[14]=a[0],d[15]=a[1],a}])},function(a){return a=[d[14],d[15]],d[4]=a[0],d[5]=a[1],a}])},function(a){return d[6]=c.i64.of_float(Date.now()),d[7]=c.i64.random(),d[9]="Finishing execution. Execution time: ",d[10]=c.i64.to_string(c.i64.sub(d[6],d[0])),d[11]=" ms",d[8]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][writeTopLevelMessage] ",d[8],d[9],d[8],d[10],d[8],d[11]].join("")),c.i64.eq(c.i64.mod_(d[7],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[12]=",",d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"writeTopLevelMessage",[d[9],d[12],d[10],d[12],d[11]].join(""),d[13],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[4],d[5]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMPSWriteTopLevelMessageStoredProcedure";a.__tables__=["local_message_persistence_store","local_message_persistence_store_deleted_messages"];e.exports=a}),null);
__d("LSWriteTopLevelMessageStoredProcedure",["LSSynchronousPromise","LSWriteTopLevelMessage","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSWriteTopLevelMessage"),e.messagePayload,e.threadId,e.offlineThreadingId,e.messageTimestampMs,e.isLocalOnlyMessage,e.extraData);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MessageBackupTagsDelimiter",[],(function(a,b,c,d,e,f){"use strict";a=":";f.INSTAMADILLO_TAG_DELIMITER=a}),66);
__d("EncryptedBackupsWriteToMPSTables",["EncryptedBackupsUploadEntity","FBLogger","I64","IGDWEBUploadMessageUtils","LSFactory","LSWriteSupplementalMessageStoredProcedure","LSWriteTopLevelMessageStoredProcedure","MessageBackupTagsDelimiter","WAErrorMessage","WAGetSafeQPLError","WAResultOrError","gkx","promiseDone","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("ReverbWriteFailureFalcoEvent").__setRef("EncryptedBackupsWriteToMPSTables"),j=c("requireDeferred")("ReverbWriteSuccessFalcoEvent").__setRef("EncryptedBackupsWriteToMPSTables"),k=c("gkx")("8488");function l(a,b,d,e,f,g){e?c("promiseDone")(j.load(),function(c){return c.log(function(){return{backup_action:d,backup_protocol:f,labyrinth_version:0,message_id:a,thread_id:b}})}):c("promiseDone")(i.load(),function(c){return c.log(function(){return{backup_action:d,backup_protocol:f,failure_reason:g,labyrinth_version:0,message_id:a,thread_id:b}})})}async function a(a,b,e,f,g){var i=b.backupActionType,j=b.instamadilloItemId,m=b.msgId,n=b.originalMsgProtocolId,o=b.protobuf,p=b.serverTs,q=b.sortOrderMs;b=b.supplementalKey;g==null||g.addPoint("mps_tables_write_start");m=m.externalId;n=n==null?void 0:n.externalId;j=j!=null?j:q;if(j==null){g==null||g.addPoint("mps_tables_write_missing_protobuf_ts");return d("WAResultOrError").makeError({errorCode:null,errorMsg:"protobufTimestampMs is null when writing to MPS tables"})}q=(h||(h=d("I64"))).of_float(j);j=!1;var r=k?"protobuf_only":"dual_upload";f&&(r="open_eb_ttlc");f=null;switch(i){case 1:g==null||g.addPoint("mps_top_level_write_start");try{i=await c("LSWriteTopLevelMessageStoredProcedure")(c("LSFactory")(a),{isLocalOnlyMessage:!1,messagePayload:d("EncryptedBackupsUploadEntity").getEbBackupMessageBytesBuffer(o),messageTimestampMs:q,offlineThreadingId:m,threadId:e});var s=i[0];i=i[1];f=i;s&&(j=!0);l(m,e,"upsert_top_level",s,r);g==null||g.addPoint("mps_top_level_write",{bool:{mps_top_level_write_succesful:s}})}catch(a){l(m,e,"upsert_top_level",!1,r,d("WAErrorMessage").maybeGetMessageFromError(a)),g==null||g.addPoint("mps_top_level_write_error",{string:{mps_top_level_write_error:d("WAGetSafeQPLError").getSafeQPLErrorMessage(a)}})}break;case 2:g==null||g.addPoint("mps_supplemental_write_start");if(n==null||b==null)l(m,e,"upsert_supplemental",!1,r),c("FBLogger")("wmi_eb").warn("Missing toplevelOfflineThreadingId or supplementalKey when writing to MPS tables");else try{i=await c("LSWriteSupplementalMessageStoredProcedure")(c("LSFactory")(a),{messagePayload:d("EncryptedBackupsUploadEntity").getEbBackupMessageBytesBuffer(o),messageTimestampMs:q,offlineThreadingId:m,supplementalKey:b,threadId:e,toplevelOfflineThreadingId:n});s=i[0];q=i[1];f=q;s&&(j=!0);l(m,e,"upsert_supplemental",s,r);g==null||g.addPoint("mps_supplemental_write",{bool:{mps_supplemental_write_successful:s}})}catch(a){l(m,e,"upsert_supplemental",!1,r,d("WAErrorMessage").maybeGetMessageFromError(a)),g==null||g.addPoint("mps_supplemental_write_error",{string:{mps_supplemental_write_error:d("WAGetSafeQPLError").getSafeQPLErrorMessage(a)}})}break;case 4:g==null||g.addPoint("mps_delete_top_level_with_placeholder_write_start");if(n==null)break;try{b=await c("LSWriteTopLevelMessageStoredProcedure")(c("LSFactory")(a),{isLocalOnlyMessage:!1,messagePayload:d("EncryptedBackupsUploadEntity").getEbBackupMessageBytesBuffer(o),messageTimestampMs:(h||(h=d("I64"))).of_float(d("IGDWEBUploadMessageUtils").generateProtobufServerTs(n,p)),offlineThreadingId:m,threadId:e});i=b[0];q=b[1];f=q;i&&(j=!0);l(n,e,"delete_top_level",i,r);g==null||g.addPoint("mps_delete_top_level_with_placeholder_write",{bool:{mps_delete_top_level_with_placeholder_write_successful:i}})}catch(a){l(n,e,"delete_top_level_with_placeholder",!1,r,d("WAErrorMessage").maybeGetMessageFromError(a)),g==null||g.addPoint("mps_delete_top_level_with_placeholder_write_error",{string:{mps_delete_top_level_with_placeholder_write_error:d("WAGetSafeQPLError").getSafeQPLErrorMessage(a)}})}break;case 3:j=!0;n!=null&&l(n,e,"delete_top_level",!1,r);break;default:g==null||g.addPoint("mps_write_unsupported_backup_action_type"),c("FBLogger")("wmi_eb").warn("Unsupported backupActionType when writing to MPS tables")}if(j){g==null||g.addPoint("mps_write_successful");return d("WAResultOrError").makeResult(j)}else{g==null||g.addPoint("mps_write_unsuccessful");return d("WAResultOrError").makeError({errorCode:f,errorMsg:"Unsuccessful writing to MPS tables"})}}async function b(a,b,c){var e=b.msgId,f=b.sortOrderMs;b=b.tags;b!=null&&b.length!==0&&f!=null&&await a.local_message_persistence_store_tag_index.put({localMessagePersistenceStoreKey:(h||(h=d("I64"))).of_string(e.externalId),messageTimestampMs:h.of_float(f),offlineThreadingId:e.externalId,tag:b.join(d("MessageBackupTagsDelimiter").INSTAMADILLO_TAG_DELIMITER),threadId:c})}g.writeToMPSTables=a;g.writeTagsToMPSTables=b}),98);
__d("LSHandleBackupWriteCompletion",["EBEnableUnifiedAttachment","LSVec","MAWEBFrontendQPLLogger","cr:847"],(function(a,b,c,d,e,f,g){"use strict";async function a(a,e,f,g){if(g!=null){e=c("LSVec").toArray(g);d("EBEnableUnifiedAttachment").getEbEnableUnifiedAttachment()&&e.forEach(function(a){return d("MAWEBFrontendQPLLogger").endFlowUploadAttachmentBackup(a,f,"unified")})}if(b("cr:847")!=null){e=g!=null?c("LSVec").toArray(g):[];e.length>0&&await b("cr:847")(a,e)}return Promise.resolve()}g.call=a}),98);
__d("LSHandleBackupWriteCompletion.nop",["LSHandleBackupWriteCompletion"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,c,e){return d("LSHandleBackupWriteCompletion").call(a,b,c,e)};a.__nop_name__="LSHandleBackupWriteCompletion";g["default"]=a}),98);
__d("LSMarkBackupAsCompleted.nop",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;a=function(a,c,d,e,f,h,i){return(g||(g=b("Promise"))).resolve()};a.__nop_name__="LSMarkBackupAsCompleted";f["default"]=a}),66);
__d("LSHandleProtobufWriteResult",["LSArrayGetObjectAt","LSMarkBackupAsCompleted.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return a[3]?d[0]=!1:d[0]=!0,d[0]?c.resolve():(d[1]=a[3].get("delete_on_success"),d[1]&&a[0]&&!a[1]?(a[2]?d[2]=!1:d[2]=!0,d[2]?c.resolve():c.sequence([function(e){return d[3]=c.i64.of_float(Date.now()),d[4]=c.i64.of_int32(a[2].length),c.i64.gt(d[4],c.i64.cast([0,0]))?c.loopAsync(d[4],function(e){return d[7]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[2],d[7]).then(function(a){return a=a,d[8]=a[0],d[9]=a[1],a})},function(a){return c.filter(c.db.table(305).fetch(),function(a){return c.i64.eq(a.pendingBackupTaskId,d[8])}).next().then(function(a,d){var e=a.done;a=a.value;return e?0:(d=a.item,c.nativeOperation(b("LSMarkBackupAsCompleted.nop"),d.actThreadId,d.toplevelOfflineThreadingId,d.supplementalKey,d.messageTimestampMs,d.backupAction))})}])}):c.resolve()},function(e){return d[5]=c.i64.of_int32(a[2].length),c.i64.gt(d[5],c.i64.cast([0,0]))?c.loopAsync(d[5],function(e){return d[7]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[2],d[7]).then(function(a){return a=a,d[8]=a[0],d[9]=a[1],a})},function(a){return c.filter(c.db.table(305).fetch(),function(a){return c.i64.eq(a.pendingBackupTaskId,d[8])}).next().then(function(a,b){var e=a.done;a=a.value;return e?0:(b=a.item,d[12]=b.actThreadId,d[13]=b.toplevelOfflineThreadingId,d[11]=b.supplementalKey,d[14]=b.messageTimestampMs,d[11]!==void 0?c.forEach(c.filter(c.db.table(302).fetch(),function(a){return a.threadId===d[12]&&a.toplevelOfflineThreadingId===d[13]&&a.supplementalKey===d[11]&&c.i64.le(a.messageTimestampMs,d[14])}),function(a){return a["delete"]()}):c.forEach(c.filter(c.db.table(301).fetch(),function(a){return a.threadId===d[12]&&a.offlineThreadingId===d[13]&&c.i64.le(a.messageTimestampMs,d[14])}),function(a){return a["delete"]()}))})}])}):c.resolve()},function(e){return d[6]=c.i64.of_int32(a[2].length),c.i64.gt(d[6],c.i64.cast([0,0]))?c.loopAsync(d[6],function(e){return d[7]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[2],d[7]).then(function(a){return a=a,d[8]=a[0],d[9]=a[1],a})},function(a){return c.filter(c.db.table(305).fetch(),function(a){return c.i64.eq(a.pendingBackupTaskId,d[8])}).next().then(function(a,b){var d=a.done;a=a.value;return d?0:(b=a.item,c.forEach(c.db.table(304).fetch([[[b.toplevelOfflineThreadingId,b.actThreadId]],"offlineThreadingId"]),function(a){return a["delete"]()}))})}])}):c.resolve()}])):c.resolve())},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsHandleProtobufWriteResultStoredProcedure";a.__tables__=["pending_protobuf_backups_context","local_message_persistence_store_supplemental","local_message_persistence_store","local_message_persistence_store_tag_index"];e.exports=a}),null);
__d("LSHandleBackupWriteResultV2",["LSArrayGetObjectAt","LSDeleteBackupOnClient","LSHandleBackupWriteCompletion.nop","LSHandleProtobufWriteResult","LSLogMEBUploadSuccessEvent.nop","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsHandleBackupWriteResultV2StoredProcedure] Beginning execution."),d[1]=c.createArray(),d[2]=c.createArray(),a[3]?d[3]=!1:d[3]=!0,d[3]?c.resolve():(d[12]=c.i64.of_int32(a[3].length),c.i64.gt(d[12],c.i64.cast([0,0]))?c.loopAsync(d[12],function(e){return d[13]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[3],d[13]).then(function(a){return a=a,d[14]=a[0],d[15]=a[1],a})},function(e){return c.db.table(177).fetch([[[d[14]]],"fk_pending_tasks"]).next().then(function(e,f){var g=e.done;e=e.value;return g?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsHandleBackupWriteResultV2StoredProcedure] Pending backup task id not found!"),d[18]="Pending backup task id not found!",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsHandleBackupWriteResultV2StoredProcedure] ","",d[18]].join("")),d[17]=c.createArray(),void 0!==void 0?d[19]=(d[17].push(void 0),d[17]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleBackupWriteResultV2StoredProcedure",d[18],d[17],c.i64.cast([0,3]))):(f=e.item,c.sequence([function(d){return c.i64.eq(f.contentType,c.i64.cast([0,1]))?c.nativeOperation(b("LSLogMEBUploadSuccessEvent.nop"),f.uniqueKey,f.lsTraceId,a[1]):c.resolve()},function(a){return d[17]=(d[2].push(f.persistentId),d[2])}]))})}])}):c.resolve())},function(d){return c.storedProcedure(b("LSHandleProtobufWriteResult"),a[1],a[2],a[3],a[4],!1)},function(e){return d[4]=c.i64.of_float(Date.now()),a[3]?d[5]=!1:d[5]=!0,d[5]?c.resolve():(d[12]=c.i64.of_int32(a[3].length),c.i64.gt(d[12],c.i64.cast([0,0]))?c.loopAsync(d[12],function(e){return d[13]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[3],d[13]).then(function(a){return a=a,d[14]=a[0],d[15]=a[1],a})},function(a){return c.forEach(c.filter(c.db.table(305).fetch(),function(a){return c.i64.eq(a.pendingBackupTaskId,d[14])}),function(a){return a["delete"]()})}])}):c.resolve())},function(e){return a[2]?c.sequence([function(e){return d[12]=c.i64.of_int32(a[0].length),c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],c.i64.cast([0,0])).then(function(a){return a=a,d[14]=a[0],d[15]=a[1],a})},function(a){return d[13]=d[14]}])},function(a){return c.storedProcedure(b("LSDeleteBackupOnClient"),void 0,void 0,!0,d[13],void 0,!0)}]):c.resolve()},function(e){return c.nativeOperation(b("LSHandleBackupWriteCompletion.nop"),a[1],a[0],d[2])},function(a){return d[6]=c.i64.of_float(Date.now()),d[7]=c.i64.random(),d[9]="Finishing execution. Execution time: ",d[10]=c.i64.to_string(c.i64.sub(d[6],d[0])),d[11]=" ms",d[8]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsHandleBackupWriteResultV2StoredProcedure] ",d[8],d[9],d[8],d[10],d[8],d[11]].join("")),c.i64.eq(c.i64.mod_(d[7],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[12]=",",d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleBackupWriteResultV2StoredProcedure",[d[9],d[12],d[10],d[12],d[11]].join(""),d[13],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsHandleBackupWriteResultV2StoredProcedure";a.__tables__=["pending_backups_context_v2","pending_protobuf_backups_context"];e.exports=a}),null);
__d("LSHandleBackupWriteResultV2StoredProcedure",["LSHandleBackupWriteResultV2","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSHandleBackupWriteResultV2"),e.traceIds,e.isSuccess,e.deleteMailbox,e.taskIds,e.protobufParams);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSPrepareOpenEpochV2",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(a){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure] Beginning execution."),c.filter(c.db.table(2).fetch(),function(a){return a.context==="50005"}).next().then(function(a,b){b=a.done;a=a.value;return b?d[1]=!1:(a.item,d[1]=!0)})},function(a){return c.filter(c.db.table(2).fetch(),function(a){return a.context==="320"}).next().then(function(a,b){b=a.done;a=a.value;return b?d[3]=!1:(a.item,d[3]=!0)})},function(a){return d[1]||d[3]?c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure] Skipping openEpoch start because there is already an openEpoch flow in progress."),d[5]=c.i64.cast([0,1]))):c.sequence([function(a){return c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,1441]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[18]?d[19]=!0:d[19]=!1,d[19]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[21]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[21]].join("")),d[20]=c.createArray(),void 0!==void 0?d[22]=(d[20].push(void 0),d[20]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[21],d[20],c.i64.cast([0,3]))):c.resolve()}])},function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[18]=new c.Map(),d[18].set("error_msg","Expected a nonempty query result"),d[18].set("code",c.i64.cast([0,3])),d[18].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[19]=c.createArray(),d[20]=(d[19].push(d[18]),d[19]),e=[void 0,d[19]],d[12]=e[0],d[13]=e[1]):(b=a.item,d[18]=new c.Map(),d[18].set("backup_id",b.backupId),d[18].set("device_public_key_blob",b.devicePublicKeyBlob),d[18].set("device_private_key_blob",b.devicePrivateKeyBlob),d[18].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[18].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[18].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[18].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[18].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[18].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[18].set("orf_client_state_v2_blob",void 0),d[18].set("orf_v2_authority_level",void 0),d[18].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[18].set("device_id",b.deviceId),d[18].set("backup_tenancy",b.backupTenancy),d[18].set("encryption_version",b.encryptionVersion),d[18].set("revision_version",b.revisionVersion),d[18].set("initialize_restore_result",void 0),d[18].set("device_creation_timestamp_sec",void 0),d[18].set("authority_level",b.authorityLevel),e=[d[18],void 0],d[12]=e[0],d[13]=e[1])})},function(a){return d[15]=new c.Map(),d[15].set("value",d[12]),d[15].set("errors",d[13]),d[16]=d[15].get("value"),d[16]!==void 0?c.sequence([function(a){return d[18]=d[16].get("backup_id"),d[19]=d[16].get("device_public_key_blob"),d[20]=d[16].get("device_private_key_blob"),d[21]=d[16].get("epoch_storage_public_key_blob"),d[22]=d[16].get("epoch_storage_private_key_blob"),d[23]=d[16].get("epoch_auth_public_key_blob"),d[24]=d[16].get("epoch_auth_private_key_blob"),d[25]=d[16].get("mailbox_root_key_blob"),d[26]=d[16].get("ocmf_client_state_blob"),d[27]=d[16].get("orf_client_state_v2_blob"),d[28]=d[16].get("orf_v2_authority_level"),d[29]=d[16].get("oblivious_validation_token_blob"),d[30]=d[16].get("device_id"),d[31]=d[16].get("backup_tenancy"),d[32]=d[16].get("encryption_version"),d[33]=d[16].get("revision_version"),d[34]=d[16].get("initialize_restore_result"),d[35]=d[16].get("device_creation_timestamp_sec"),d[36]=d[16].get("authority_level"),c.i64.neq(d[30],void 0)?c.sequence([function(a){return d[38]=void 0,c.i64.neq(d[38],void 0)?c.resolve(d[39]=d[38]):c.sequence([function(a){return d[50]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[51]=a[0],a})},function(a){return d[51]?d[60]=(d[50].push(c.i64.cast([0,0])),d[50]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[52]=a[0],a})},function(a){return d[52]?d[60]=(d[50].push(c.i64.cast([0,2])),d[50]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[53]=a[0],a})},function(a){return d[53]?d[60]=(d[50].push(c.i64.cast([0,3])),d[50]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[54]=a[0],a})},function(a){return d[54]?d[60]=(d[50].push(c.i64.cast([0,4])),d[50]):0,d[55]=c.createArray(),d[56]=c.i64.of_int32(d[50].length),c.i64.gt(d[56],c.i64.cast([0,0]))?c.loopAsync(d[56],function(a){return d[60]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[50],d[60]).then(function(a){return a=a,d[61]=a[0],d[62]=a[1],a})},function(a){return d[63]=(d[55].push(d[61]),d[55])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[60]=c.createArray(),d[61]=c.i64.of_int32(d[55].length),c.i64.gt(d[61],c.i64.cast([0,0]))?c.loopAsync(d[61],function(a){return d[63]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[55],d[63]).then(function(a){return a=a,d[64]=a[0],d[65]=a[1],a})},function(a){return d[66]=(d[60].push(c.i64.to_string(d[64])),d[60])}])}):c.resolve()},function(a){return d[62]=d[60].join(","),d[57]=d[62]}])},function(a){return d[55].some(function(a){return c.i64.eq(d[32],a)})?d[58]=d[32]:d[58]=void 0,c.i64.neq(d[58],void 0)?d[59]=d[58]:d[59]=void 0,d[39]=d[59]}])},function(a){return c.i64.neq(d[39],void 0)?d[40]=d[39]:d[40]=c.i64.cast([0,0]),c.i64.neq(d[31],void 0)?d[41]=d[31]:d[41]=c.i64.cast([0,1]),c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,2821]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[50]=a[0],a})},function(a){return d[50]?d[51]=!0:d[51]=!1,d[51]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[53]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[53]].join("")),d[52]=c.createArray(),void 0!==void 0?d[54]=(d[52].push(void 0),d[52]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[53],d[52],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[42]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[50]=(d[42].push(a.epochId),d[42])})},function(a){return d[48]="Queried locally available epochs. Count: ",d[43]=c.i64.of_int32(d[42].length),d[49]=c.i64.to_string(d[43]),d[44]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[44],d[48],d[44],d[49]].join("")),c.resolve()},function(a){return d[45]=new c.Map(),d[45].set("backup_id",d[18]),d[45].set("locally_available_epochs",d[42]),d[45].set("device_id",d[30]),d[45].set("trace_id",void 0),d[46]=c.toJSON(d[45]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"messenger_request_for_asssoc_devices",c.i64.cast([0,50005]),d[46],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[47]=a[0],a})},function(a){return c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,1442]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[50]=a[0],a})},function(a){return d[50]?d[51]=!0:d[51]=!1,d[51]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[53]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[53]].join("")),d[52]=c.createArray(),void 0!==void 0?d[54]=(d[52].push(void 0),d[52]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[53],d[52],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[37]=c.i64.cast([0,0])}]):c.sequence([function(a){return c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,2822]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[39]=a[0],a})},function(a){return d[39]?d[40]=!0:d[40]=!1,d[40]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[42]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[42]].join("")),d[41]=c.createArray(),void 0!==void 0?d[43]=(d[41].push(void 0),d[41]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[42],d[41],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[38]="No backup found.",d[38]!==void 0?(function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure] ","",d[38]].join("")),d[39]=c.createArray(),void 0!==void 0?d[40]=(d[39].push(void 0),d[39]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure",d[38],d[39],c.i64.cast([0,3]))):c.resolve()},function(a){return d[37]=c.i64.cast([0,1])}])},function(a){return d[17]=d[37]}]):c.sequence([function(a){return d[18]=d[15].get("errors"),d[19]=d[15].get("errors"),c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,2822]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[21]=a[0],a})},function(a){return d[21]?d[22]=!0:d[22]=!1,d[22]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[24]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[24]].join("")),d[23]=c.createArray(),void 0!==void 0?d[25]=(d[23].push(void 0),d[23]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[24],d[23],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[20]="No backup found.",d[20]!==void 0?(function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure] ","",d[20]].join("")),d[21]=c.createArray(),void 0!==void 0?d[22]=(d[21].push(void 0),d[21]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure",d[20],d[21],c.i64.cast([0,3]))):c.resolve()},function(a){return d[17]=c.i64.cast([0,1])}])},function(a){return d[5]=d[17]}])},function(a){return d[6]=c.i64.of_float(Date.now()),d[7]=c.i64.random(),d[9]="Finishing execution. Execution time: ",d[10]=c.i64.to_string(c.i64.sub(d[6],d[0])),d[11]=" ms",d[8]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure] ",d[8],d[9],d[8],d[10],d[8],d[11]].join("")),c.i64.eq(c.i64.mod_(d[7],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[12]=",",d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure",[d[9],d[12],d[10],d[12],d[11]].join(""),d[13],c.i64.cast([0,4]))):c.resolve()},function(a){return e[0]=d[5]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure";a.__tables__=["pending_tasks","secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSPrepareOpenEpochV2StoredProcedure",["LSPrepareOpenEpochV2","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){e===void 0&&(e={});a=a.storedProcedure(c("LSPrepareOpenEpochV2"),e.backupId,e.traceId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MAWEBFalcoLoggerUtils",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=(f=c("requireDeferred"))("EncryptedBackupTaskFailureFalcoEvent").__setRef("MAWEBFalcoLoggerUtils"),i=f("EncryptedBackupTaskIssuedFalcoEvent").__setRef("MAWEBFalcoLoggerUtils"),j=f("EncryptedBackupTaskSkippedFalcoEvent").__setRef("MAWEBFalcoLoggerUtils"),k=f("EncryptedBackupUploadSuccessFalcoEvent").__setRef("MAWEBFalcoLoggerUtils"),l={0:"unknown",1:"upsert_top_level",2:"upsert_supplemental",3:"delete_top_level",4:"delete_top_level_with_placeholder"};function a(a,b){m(a,b)}function b(a,b,c){m(a,b,c)}function d(a,b,c){m(a,b,void 0,c)}function m(a,b,c,d){c!=null?void h.onReady(function(d){d.log(function(){var d;return{backup_action:(d=l[(d=(d=a.protoMsg)==null?void 0:d.backupActionType)!=null?d:0])!=null?d:"unknown",backup_protocol:b,failure_reason:c,labyrinth_version:0,message_id:(d=(d=a.protoMsg)==null||(d=d.msgId)==null?void 0:d.externalId)!=null?d:a.messageId,thread_id:a.threadId,trace_id:a.traceId}})}):d!=null?void j.onReady(function(c){c.log(function(){var c;return{backup_action:(c=l[(c=(c=a.protoMsg)==null?void 0:c.backupActionType)!=null?c:0])!=null?c:"unknown",backup_protocol:b,labyrinth_version:0,message_id:(c=(c=a.protoMsg)==null||(c=c.msgId)==null?void 0:c.externalId)!=null?c:a.messageId,skipped_reason:d,thread_id:a.threadId,trace_id:a.traceId}})}):void i.onReady(function(c){c.log(function(){var c;return{backup_action:(c=l[(c=(c=a.protoMsg)==null?void 0:c.backupActionType)!=null?c:0])!=null?c:"unknown",backup_protocol:b,labyrinth_version:0,message_id:(c=(c=a.protoMsg)==null||(c=c.msgId)==null?void 0:c.externalId)!=null?c:a.messageId,thread_id:a.threadId,trace_id:a.traceId}})})}function e(a){void k.onReady(function(b){b.log(function(){var b;return{labyrinth_version:0,message_id:(b=(b=a.protoMsg)==null||(b=b.msgId)==null?void 0:b.externalId)!=null?b:a.messageId,thread_id:a.threadId,trace_id:a.traceId}})})}g.BackupActionMap=l;g.logEBFalcoTaskIssued=a;g.logEBFalcoTaskFailure=b;g.logEBFalcoTaskSkipped=d;g.logEBFalcoEncryptedBackupUploadSuccess=e}),98);
__d("EBWasm.pb",["$InternalEnum","WAProtoConst"],(function(a,b,c,d,e,f,g){c=(a=b("$InternalEnum"))({UPSERT_BACKUP_ITEM:1,REMOVE_BACKUP_ITEM:2});e=a({MESSAGE:1,THREAD:2});f=a({STANDARD:0,VANISH_MODE:1,DUAL_SEND_SHADOW:2,BTV_COMPANION:3,BLEND_DUAL_SEND:4,BLEND_DUAL_SEND_NO_NETWORK:5});b=a({UNKNOWN:0,ENCRYPTIONKDFWITHVERSION:2,ENCRYPTIONKDFWITHNULLSALT:3,ENCRYPTIONKDFWITHNULLSALTDFCANARY:4,TESTVERSION:99});var h=a({UNKNOWN:0,UPSERT_TOPLEVEL:1,UPSERT_SUPPLEMENTAL:2,DELETE_TOPLEVEL:3,DELETE_TOPLEVEL_WITH_PLACEHOLDER:4});a=a({PHOTO:0,PERMANENT:1,EPHEMERAL:2,VIDEO:3,GIF:4,AUDIO:5,FILE:6,RAVEN:7,UNREAD_RAVEN:8,SHARE_IG_MEDIA:9,SHARE_LINK:10,SHARE_IG_CLIPS:11,SHH:12,STORY_REPLY:13,DISAPPEARING_MESSAGE:14,RAVEN_SEEN:15,RAVEN_REPLAYED:16,RAVEN_READ_ONCE:17,RAVEN_REPLAYABLE:18,RAVEN_PERMANENT:19,ACTION_LOG:20});var i={},j={},k={},l={},m={},n={},o={},p={};i.name="SupplementalMessage";i.internalSpec={toplevelOfflineThreadingId:[1,(d=d("WAProtoConst")).FLAGS.REQUIRED|d.TYPES.UINT64],supplementalKey:[2,d.FLAGS.REQUIRED|d.TYPES.STRING],payload:[3,d.FLAGS.REQUIRED|d.TYPES.BYTES],maybeOutOfOrder:[4,d.TYPES.BOOL]};j.name="ToplevelMessage";j.internalSpec={payload:[1,d.FLAGS.REQUIRED|d.TYPES.BYTES]};k.name="Epoch";k.internalSpec={epochId:[1,d.FLAGS.REQUIRED|d.TYPES.UINT64],epochAnonId:[2,d.FLAGS.REQUIRED|d.TYPES.BYTES],epochRootKey:[3,d.FLAGS.REQUIRED|d.TYPES.BYTES]};l.name="MessageUploadSerializerInput";l.internalSpec={threadId:[1,d.FLAGS.REQUIRED|d.TYPES.UINT64],operationType:[2,d.FLAGS.REQUIRED|d.TYPES.ENUM,c],contentType:[3,d.FLAGS.REQUIRED|d.TYPES.ENUM,e],attachmentPayload:[6,d.TYPES.STRING],threadSubtype:[7,d.FLAGS.REQUIRED|d.TYPES.ENUM,f],encryptionVersion:[8,d.FLAGS.REQUIRED|d.TYPES.UINT64],actionType:[9,d.FLAGS.REQUIRED|d.TYPES.ENUM,h],messageTags:[10,d.FLAGS.REPEATED|d.TYPES.ENUM,a],tagsToDelete:[11,d.FLAGS.REPEATED|d.TYPES.ENUM,a],offlineThreadingId:[12,d.FLAGS.REQUIRED|d.TYPES.UINT64],timestamp:[13,d.FLAGS.REQUIRED|d.TYPES.UINT64],deletionOtid:[14,d.TYPES.UINT64],requestId:[15,d.FLAGS.REQUIRED|d.TYPES.STRING],supplementalMessage:[4,d.TYPES.MESSAGE,i],toplevelMessage:[5,d.TYPES.MESSAGE,j],__oneofs__:{message:["supplementalMessage","toplevelMessage"]}};m.name="MessageUploadSerializerBatchInput";m.internalSpec={messages:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,l],mailboxRootKeyBlob:[2,d.FLAGS.REQUIRED|d.TYPES.BYTES],ocmfClientStateBlob:[3,d.FLAGS.REQUIRED|d.TYPES.BYTES],epoch:[4,d.FLAGS.REQUIRED|d.TYPES.MESSAGE,k],deviceId:[5,d.FLAGS.REQUIRED|d.TYPES.UINT64],backupId:[6,d.FLAGS.REQUIRED|d.TYPES.UINT64]};n.name="MessageUploadPayloadOutput";n.internalSpec={offlineThreadingId:[3,d.FLAGS.REQUIRED|d.TYPES.UINT64],timestamp:[4,d.FLAGS.REQUIRED|d.TYPES.UINT64],threadId:[5,d.FLAGS.REQUIRED|d.TYPES.UINT64],payload:[1,d.TYPES.STRING],error:[2,d.TYPES.STRING],__oneofs__:{result:["payload","error"]}};o.name="MessageUploadSerializerBatchOutput";o.internalSpec={payloads:[1,d.FLAGS.REPEATED|d.TYPES.MESSAGE,n]};p.name="LabyrinthCommand";p.internalSpec={messageUploadSerializerBatchInput:[1,d.TYPES.MESSAGE,m],__oneofs__:{commandInput:["messageUploadSerializerBatchInput"]}};g.BackupOperationType=c;g.BackupContentType=e;g.ThreadSubtype=f;g.EncryptionVersion=b;g.EncryptedBackupsKeyValueActionType=h;g.MessageTag=a;g.SupplementalMessageSpec=i;g.ToplevelMessageSpec=j;g.EpochSpec=k;g.MessageUploadSerializerInputSpec=l;g.MessageUploadSerializerBatchInputSpec=m;g.MessageUploadPayloadOutputSpec=n;g.MessageUploadSerializerBatchOutputSpec=o;g.LabyrinthCommandSpec=p}),98);
__d("EBWasmSerializeMessagesPayload",["EBLabyrinthWasmReactorSingleton","EBWasm.pb","WAResultOrError","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";b=d("WATagsLogger").TAGS(["EBSerializeMessagesPayload"]);function a(){function a(a){a=a.payloads;return d("WAResultOrError").makeResult({payloads:a})}return async function(b){b=b.messagesData;var c=await d("EBLabyrinthWasmReactorSingleton").createLabyrinthReactorCommand({InputSpec:d("EBWasm.pb").LabyrinthCommandSpec,ResultSpec:d("EBWasm.pb").MessageUploadSerializerBatchOutputSpec,validateResult:a});return c({messageUploadSerializerBatchInput:b})}}c=a();g.logger=b;g.serializeMessagesPayload=c}),98);
__d("EBWasmSerializeMessagesModule",["EBLogger","EBWasm.pb","EBWasmSerializeMessagesPayload","I64","MAWEBUploadTrackingUtils","MSGDataclassTypes.flow","ReQL","WALongInt","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o=d("EBLogger").EBLogger().tags(["EBWasmSerializeMessagesModule"]);function p(a){return a===d("MSGDataclassTypes.flow").MpsMessageTag.Photo?d("EBWasm.pb").MessageTag.PHOTO:a===d("MSGDataclassTypes.flow").MpsMessageTag.Permanent?d("EBWasm.pb").MessageTag.PERMANENT:a===d("MSGDataclassTypes.flow").MpsMessageTag.Ephemeral?d("EBWasm.pb").MessageTag.EPHEMERAL:a===d("MSGDataclassTypes.flow").MpsMessageTag.Video?d("EBWasm.pb").MessageTag.VIDEO:a===d("MSGDataclassTypes.flow").MpsMessageTag.Gif?d("EBWasm.pb").MessageTag.GIF:a===d("MSGDataclassTypes.flow").MpsMessageTag.Audio?d("EBWasm.pb").MessageTag.AUDIO:a===d("MSGDataclassTypes.flow").MpsMessageTag.File?d("EBWasm.pb").MessageTag.FILE:a===d("MSGDataclassTypes.flow").MpsMessageTag.Raven?d("EBWasm.pb").MessageTag.RAVEN:a===d("MSGDataclassTypes.flow").MpsMessageTag.UnreadRaven?d("EBWasm.pb").MessageTag.UNREAD_RAVEN:a===d("MSGDataclassTypes.flow").MpsMessageTag.ShareIgMedia?d("EBWasm.pb").MessageTag.SHARE_IG_MEDIA:a===d("MSGDataclassTypes.flow").MpsMessageTag.ShareLink?d("EBWasm.pb").MessageTag.SHARE_LINK:a===d("MSGDataclassTypes.flow").MpsMessageTag.ShareIgClips?d("EBWasm.pb").MessageTag.SHARE_IG_CLIPS:a===d("MSGDataclassTypes.flow").MpsMessageTag.Shh?d("EBWasm.pb").MessageTag.SHH:a===d("MSGDataclassTypes.flow").MpsMessageTag.StoryReply?d("EBWasm.pb").MessageTag.STORY_REPLY:a===d("MSGDataclassTypes.flow").MpsMessageTag.DisappearingMessage?d("EBWasm.pb").MessageTag.DISAPPEARING_MESSAGE:a===d("MSGDataclassTypes.flow").MpsMessageTag.RavenSeen?d("EBWasm.pb").MessageTag.RAVEN_SEEN:a===d("MSGDataclassTypes.flow").MpsMessageTag.RavenReplayed?d("EBWasm.pb").MessageTag.RAVEN_REPLAYED:a===d("MSGDataclassTypes.flow").MpsMessageTag.RavenReadOnce?d("EBWasm.pb").MessageTag.RAVEN_READ_ONCE:a===d("MSGDataclassTypes.flow").MpsMessageTag.RavenReplayable?d("EBWasm.pb").MessageTag.RAVEN_REPLAYABLE:a===d("MSGDataclassTypes.flow").MpsMessageTag.RavenPermanent?d("EBWasm.pb").MessageTag.RAVEN_PERMANENT:a===d("MSGDataclassTypes.flow").MpsMessageTag.ActionLog?d("EBWasm.pb").MessageTag.ACTION_LOG:function(){throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+a)}()}function q(a){return function(a){if(a===0)return d("EBWasm.pb").EncryptedBackupsKeyValueActionType.UNKNOWN;if(a===1)return d("EBWasm.pb").EncryptedBackupsKeyValueActionType.UPSERT_TOPLEVEL;if(a===2)return d("EBWasm.pb").EncryptedBackupsKeyValueActionType.UPSERT_SUPPLEMENTAL;if(a===3)return d("EBWasm.pb").EncryptedBackupsKeyValueActionType.DELETE_TOPLEVEL;return a===4?d("EBWasm.pb").EncryptedBackupsKeyValueActionType.DELETE_TOPLEVEL_WITH_PLACEHOLDER:d("EBWasm.pb").EncryptedBackupsKeyValueActionType.UNKNOWN}((a=a.protoMsg)==null?void 0:a.backupActionType)}function r(a,b,c){var d;a=a==null||(d=a.protoMsg)==null?void 0:d.supplementalKey;if(a==null){o.MUSTFIX(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Supplemental key is null - unable to serialize payload"])));return}return{payload:c,supplementalKey:a,toplevelOfflineThreadingId:b}}function s(a,b,c){var e=d("WALongInt").decimalStringToLongInt(a.threadId),f=d("WALongInt").decimalStringToLongInt(a.sortOrderMs.toString()),g=q(a);if(g===d("EBWasm.pb").EncryptedBackupsKeyValueActionType.UNKNOWN){o.MUSTFIX(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Action type is unknown - unable to serialize payload"])));return}var h=a.actionType===2?d("EBWasm.pb").BackupOperationType.REMOVE_BACKUP_ITEM:d("EBWasm.pb").BackupOperationType.UPSERT_BACKUP_ITEM,s=d("EBWasm.pb").ThreadSubtype.STANDARD;b=d("WALongInt").decimalStringToLongInt((n||(n=d("I64"))).to_string(b));var t=a.traceId;c={actionType:g,attachmentPayload:c,contentType:d("EBWasm.pb").BackupContentType.MESSAGE,encryptionVersion:b,operationType:h,requestId:t,threadId:e,threadSubtype:s,timestamp:f};h=(b=a.protoMsg)==null?void 0:b.tags;t=h!=null?h.map(function(a){return p(a)}):[];e=[];f=(s=a.protoMsg)==null||(s=s.originalMsgProtocolId)==null?void 0:s.externalId;if(f==null){o.MUSTFIX(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Original message otid is null - unable to serialize payload"])));return}b=d("WALongInt").decimalStringToLongInt(f);s=(h=a.protoMsg)==null||(h=h.protobuf)==null?void 0:h.buffer;if(s==null){o.MUSTFIX(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Protobuf top level upload payload is null - unable to serialize payload"])));return}if(g===d("EBWasm.pb").EncryptedBackupsKeyValueActionType.UPSERT_TOPLEVEL){f={payload:s};return babelHelpers.extends({},c,{messageTags:t,offlineThreadingId:b,tagsToDelete:e,toplevelMessage:f})}if(g===d("EBWasm.pb").EncryptedBackupsKeyValueActionType.UPSERT_SUPPLEMENTAL){f=(h=a.protoMsg)==null||(h=h.msgId)==null?void 0:h.externalId;if(f==null){o.MUSTFIX(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Supplemental otid is null - unable to serialize payload"])));return}h=d("WALongInt").decimalStringToLongInt(f);f=r(a,b,s);if(f!=null)return babelHelpers.extends({},c,{messageTags:t,offlineThreadingId:h,supplementalMessage:f,tagsToDelete:e})}if(g===d("EBWasm.pb").EncryptedBackupsKeyValueActionType.DELETE_TOPLEVEL||g===d("EBWasm.pb").EncryptedBackupsKeyValueActionType.DELETE_TOPLEVEL_WITH_PLACEHOLDER){f=(h=a.protoMsg)==null||(h=h.msgId)==null?void 0:h.externalId;if(f==null){o.MUSTFIX(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Deletion message otid is null - unable to serialize payload"])));return}a=d("WALongInt").decimalStringToLongInt(f);h={payload:s};f=babelHelpers.extends({},c,{messageTags:t,offlineThreadingId:a,tagsToDelete:e,toplevelMessage:h});return g===d("EBWasm.pb").EncryptedBackupsKeyValueActionType.DELETE_TOPLEVEL_WITH_PLACEHOLDER?babelHelpers.extends({},f,{deletionOtid:b}):f}}async function a(a,b,c){var e=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.secure_encrypted_backups_client_state)),f=e==null?void 0:e.backupId,g=e==null?void 0:e.deviceId,h=e==null?void 0:e.encryptionVersion;a=await d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.secure_encrypted_backups_epochs));var i=a==null?void 0:a.epochId,j=a==null?void 0:a.epochAnonIdBlob;a=a==null?void 0:a.epochRootKeyBlob;var k=e==null?void 0:e.ocmfClientStateBlob;e=e==null?void 0:e.mailboxRootKeyBlob;if(f==null)return b.map(function(a){return d("WAResultOrError").makeError({error:"backup_id_null",instanceKey:a.uploadTrackingInstanceKey})});if(g==null)return b.map(function(a){return d("WAResultOrError").makeError({error:"device_id_null",instanceKey:a.uploadTrackingInstanceKey})});if(i==null)return b.map(function(a){return d("WAResultOrError").makeError({error:"epoch_id_null",instanceKey:a.uploadTrackingInstanceKey})});if(j==null)return b.map(function(a){return d("WAResultOrError").makeError({error:"epoch_anon_id_null",instanceKey:a.uploadTrackingInstanceKey})});if(a==null)return b.map(function(a){return d("WAResultOrError").makeError({error:"epoch_root_key_null",instanceKey:a.uploadTrackingInstanceKey})});if(k==null)return b.map(function(a){return d("WAResultOrError").makeError({error:"ocmf_client_state_blob_null",instanceKey:a.uploadTrackingInstanceKey})});if(e==null)return b.map(function(a){return d("WAResultOrError").makeError({error:"mailbox_root_key_blob_null",instanceKey:a.uploadTrackingInstanceKey})});if(h==null)return b.map(function(a){return d("WAResultOrError").makeError({error:"encryption_version_null",instanceKey:a.uploadTrackingInstanceKey})});f=d("WALongInt").decimalStringToLongInt((n||(n=d("I64"))).to_string(f));g=d("WALongInt").decimalStringToLongInt(n.to_string(g));i=d("WALongInt").decimalStringToLongInt(n.to_string(i));var l=b.map(function(a,b){b=c[b];return s(a,h,b!=null?b:void 0)});f={backupId:f,deviceId:g,epoch:{epochAnonId:j,epochId:i,epochRootKey:a},mailboxRootKeyBlob:e,messages:l.filter(Boolean),ocmfClientStateBlob:k};try{var m=await d("EBWasmSerializeMessagesPayload").serializeMessagesPayload({messagesData:f});if(m.success){g=m.value.payloads;var o=new Map();g.forEach(function(a){var b=d("WALongInt").longIntToDecimalString(a.threadId),c=d("WALongInt").longIntToDecimalString(a.offlineThreadingId);c=c+"_"+b;o.set(c,a)});return b.map(function(a){var b=a.threadId,c=a.messageId;c=c+"_"+b;b=o.get(c);if(b==null)return d("WAResultOrError").makeError({error:"serialized_payload_not_found",instanceKey:a.uploadTrackingInstanceKey});else{c=b.payload;b=b.error;var e=a.uploadTrackingInstanceKey;if(c!=null){if(e!=null){e=d("MAWEBUploadTrackingUtils").makeEBWorkerQplFlowFromInstanceKey(e);e.addPoint("eb_wasm_serialization_success")}return d("WAResultOrError").makeResult({msg:a,payload:c})}return d("WAResultOrError").makeError({error:b!=null?b:"runtime_error_during_serialization",instanceKey:a.uploadTrackingInstanceKey})}})}else return b.map(function(a){return d("WAResultOrError").makeError({error:m.error,instanceKey:a.uploadTrackingInstanceKey})})}catch(a){return b.map(function(a){return d("WAResultOrError").makeError({error:"runtime_error",instanceKey:a.uploadTrackingInstanceKey})})}}g.serializeMessageBatchWasm=a}),98);
__d("LSBackupContentType",[],(function(a,b,c,d,e,f){a=Object.freeze({MESSAGE:1,THREAD:2});f["default"]=a}),66);
__d("LSEncryptedBackupsAttachmentErrorCode",[],(function(a,b,c,d,e,f){a=Object.freeze({NO_ERROR:0,UNKNOWN_ERROR:1,MEDIA_TYPE_MISSING:2,PRODUCT_TYPE_MISSING:3,SERIALIZATION_ERROR:21});f["default"]=a}),66);
__d("LSPendingBackupStatus",[],(function(a,b,c,d,e,f){a=Object.freeze({NEEDS_BACKUP:1,BACKUP_IN_PROGRESS:2,BLOCKED:3});f["default"]=a}),66);
__d("LSSerializeAttachmentBackupPayload",["LSArrayGetObjectAt","LSBase64Encode.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop","LSOcmfClientMap.nop","LSQplAnnotateString.nop","LSQplMarkPoint.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][serializeAttachmentBackupPayload] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[2]=void 0,d[3]=c.i64.of_int32(a[0].length),c.i64.gt(d[3],c.i64.cast([0,0]))?c.loopAsync(d[3],function(e){return d[17]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],d[17]).then(function(a){return a=a,d[18]=a[0],d[19]=a[1],a})},function(a){return d[20]=d[18].get("attachment_trace_id"),d[2]=d[20]}])}):c.resolve()},function(a){return d[2]!==void 0?c.nativeOperation(b("LSQplMarkPoint.nop"),c.i64.cast([0,637746317]),d[2],"LSEncryptedBackupsSerializeAttachmentBackupPayloadStoredProcedure_start"):c.resolve()},function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[17]=new c.Map(),d[17].set("error_msg","Expected a nonempty query result"),d[17].set("code",c.i64.cast([0,3])),d[17].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[18]=c.createArray(),d[19]=(d[18].push(d[17]),d[18]),e=[void 0,d[18]],d[4]=e[0],d[5]=e[1]):(b=a.item,d[17]=new c.Map(),d[17].set("backup_id",b.backupId),d[17].set("device_public_key_blob",b.devicePublicKeyBlob),d[17].set("device_private_key_blob",b.devicePrivateKeyBlob),d[17].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[17].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[17].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[17].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[17].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[17].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[17].set("orf_client_state_v2_blob",void 0),d[17].set("orf_v2_authority_level",void 0),d[17].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[17].set("device_id",b.deviceId),d[17].set("backup_tenancy",b.backupTenancy),d[17].set("encryption_version",b.encryptionVersion),d[17].set("revision_version",b.revisionVersion),d[17].set("initialize_restore_result",void 0),d[17].set("device_creation_timestamp_sec",void 0),d[17].set("authority_level",b.authorityLevel),e=[d[17],void 0],d[4]=e[0],d[5]=e[1])})},function(e){return d[7]=new c.Map(),d[7].set("value",d[4]),d[7].set("errors",d[5]),d[8]=d[7].get("value"),d[8]!==void 0?c.sequence([function(e){return d[17]=d[8].get("backup_id"),d[18]=d[8].get("device_public_key_blob"),d[19]=d[8].get("device_private_key_blob"),d[20]=d[8].get("epoch_storage_public_key_blob"),d[21]=d[8].get("epoch_storage_private_key_blob"),d[22]=d[8].get("epoch_auth_public_key_blob"),d[23]=d[8].get("epoch_auth_private_key_blob"),d[24]=d[8].get("mailbox_root_key_blob"),d[25]=d[8].get("ocmf_client_state_blob"),d[26]=d[8].get("orf_client_state_v2_blob"),d[27]=d[8].get("orf_v2_authority_level"),d[28]=d[8].get("oblivious_validation_token_blob"),d[29]=d[8].get("device_id"),d[30]=d[8].get("backup_tenancy"),d[31]=d[8].get("encryption_version"),d[32]=d[8].get("revision_version"),d[33]=d[8].get("initialize_restore_result"),d[34]=d[8].get("device_creation_timestamp_sec"),d[35]=d[8].get("authority_level"),c.i64.neq(d[29],void 0)?c.sequence([function(a){return d[38]=void 0,c.i64.neq(d[38],void 0)?c.resolve(d[39]=d[38]):c.sequence([function(a){return d[44]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[45]=a[0],a})},function(a){return d[45]?d[54]=(d[44].push(c.i64.cast([0,0])),d[44]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[46]=a[0],a})},function(a){return d[46]?d[54]=(d[44].push(c.i64.cast([0,2])),d[44]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[47]?d[54]=(d[44].push(c.i64.cast([0,3])),d[44]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[48]=a[0],a})},function(a){return d[48]?d[54]=(d[44].push(c.i64.cast([0,4])),d[44]):0,d[49]=c.createArray(),d[50]=c.i64.of_int32(d[44].length),c.i64.gt(d[50],c.i64.cast([0,0]))?c.loopAsync(d[50],function(a){return d[54]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[44],d[54]).then(function(a){return a=a,d[55]=a[0],d[56]=a[1],a})},function(a){return d[57]=(d[49].push(d[55]),d[49])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[54]=c.createArray(),d[55]=c.i64.of_int32(d[49].length),c.i64.gt(d[55],c.i64.cast([0,0]))?c.loopAsync(d[55],function(a){return d[57]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[49],d[57]).then(function(a){return a=a,d[58]=a[0],d[59]=a[1],a})},function(a){return d[60]=(d[54].push(c.i64.to_string(d[58])),d[54])}])}):c.resolve()},function(a){return d[56]=d[54].join(","),d[51]=d[56]}])},function(a){return d[49].some(function(a){return c.i64.eq(d[31],a)})?d[52]=d[31]:d[52]=void 0,c.i64.neq(d[52],void 0)?d[53]=d[52]:d[53]=void 0,d[39]=d[53]}])},function(e){return c.i64.neq(d[39],void 0)?d[40]=d[39]:d[40]=c.i64.cast([0,0]),c.i64.neq(d[30],void 0)?d[41]=d[30]:d[41]=c.i64.cast([0,1]),c.i64.eq(a[4],c.i64.cast([0,0]))?c.sequence([function(e){return d[44]=c.createArray(),d[45]=c.i64.of_int32(a[0].length),c.i64.gt(d[45],c.i64.cast([0,0]))?c.loopAsync(d[45],function(e){return d[61]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],d[61]).then(function(a){return a=a,d[62]=a[0],d[63]=a[1],a})},function(a){return d[64]=d[62].get("media_type"),d[65]=d[62].get("zippy_object_id"),d[66]=d[65],c.like(d[66],"%.%")||c.like(d[66],"%\ufffd%")?(d[86]=["Object ID: ",d[66]].join(""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsSerializeAttachmentBackupPayloadStoredProcedure] ",d[86]].join("")),d[85]=c.createArray(),void 0!==void 0?d[87]=(d[85].push(void 0),d[85]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsSerializeAttachmentBackupPayloadStoredProcedure",d[86],d[85],c.i64.cast([0,4]))):c.resolve()},function(e){return d[67]=d[62].get("attachment_trace_id"),d[68]=c.createArray(),d[85]=(d[68].push(c.i64.to_string(d[17])),d[68]),d[85]=(d[68].push(d[66]),d[68]),d[69]=c.toJSON(d[68]),d[70]=c.createArray(),d[85]=(d[70].push(a[1]),d[70]),d[85]=(d[70].push(d[66]),d[70]),d[71]=c.toJSON(d[70]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[69]).then(function(a){return a=a,d[72]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF9rZXlfc2NvcGU="),d[72]).then(function(a){return a=a,d[73]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[25],d[73]).then(function(a){return a=a,d[74]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[74]).then(function(a){return a=a,d[75]=a[0],a})},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),d[71]).then(function(a){return a=a,d[76]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),d[76]).then(function(a){return a=a,d[77]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[25],d[77]).then(function(a){return a=a,d[78]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[78]).then(function(a){return a=a,d[79]=a[0],a})},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),d[69]).then(function(a){return a=a,d[80]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF9rZXlfc2FsdF9zY29wZQ=="),d[80]).then(function(a){return a=a,d[81]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[25],d[81]).then(function(a){return a=a,d[82]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[82]).then(function(a){return a=a,d[83]=a[0],a})},function(a){return d[84]=new c.Map(),d[84].set("attachment_index_key",d[75]==null?"":d[75]),d[84].set("media_type",d[64]),d[84].set("zippy_object_id",d[66]),d[84].set("attachment_trace_id",d[67]),d[84].set("salt_partial_access_token",d[79]==null?"":d[79]),d[84].set("salt_partial_attachment_index_key",d[83]==null?"":d[83]),d[85]=(d[44].push(d[84]),d[44])}])}):c.resolve()},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[1]).then(function(a){return a=a,d[46]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWVzc2FnZV9pZF9zY29wZQ=="),d[46]).then(function(a){return a=a,d[47]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[25],d[47]).then(function(a){return a=a,d[48]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[48]).then(function(a){return a=a,d[49]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[1]).then(function(a){return a=a,d[50]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),d[50]).then(function(a){return a=a,d[51]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[25],d[51]).then(function(a){return a=a,d[52]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[52]).then(function(a){return a=a,d[53]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[2]).then(function(a){return a=a,d[54]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("dGhyZWFkX2lkX3Njb3Bl"),d[54]).then(function(a){return a=a,d[55]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[25],d[55]).then(function(a){return a=a,d[56]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[56]).then(function(a){return a=a,d[57]=a[0],a})},function(b){return d[58]=new c.Map(),d[58].set("attachment_infos",d[44]),d[58].set("message_partial_id",d[49]==null?"":d[49]),d[58].set("product_type",a[3]),d[58].set("salt_partial_id",d[53]==null?"":d[53]),d[58].set("thread_partial_id",d[57]==null?"":d[57]),d[59]=c.toJSON(d[58]),d[60]=new c.Map(),d[60].set("payload",d[59]),b=[d[60],void 0],d[42]=b[0],d[43]=b[1]}]):c.sequence([function(e){return a[5]!==void 0?d[44]=a[5]:d[44]="",d[45]=".",d[47]=["LSEncryptedBackupsSerializeAttachmentBackupPayloadStoredProcedure",d[45],d[44],d[45],c.i64.to_string(c.i64.cast([-1,4294967295]))].join(""),d[2]!==void 0?d[47]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,637746317]),d[2],"attachment_error",d[47]):c.resolve():c.resolve()},function(a){return d[46]=new c.Map(),d[46].set("error_code",c.i64.cast([-1,4294967295])),d[46].set("stored_procedure","LSEncryptedBackupsSerializeAttachmentBackupPayloadStoredProcedure"),d[46].set("error_message",d[44]),a=[void 0,d[46]],d[42]=a[0],d[43]=a[1]}])},function(a){return a=[d[42],d[43]],d[36]=a[0],d[37]=a[1],a}]):c.sequence([function(a){return d[38]=".",d[40]=["LSEncryptedBackupsSerializeAttachmentBackupPayloadStoredProcedure",d[38],"Error while reading client state",d[38],c.i64.to_string(c.i64.cast([0,24]))].join(""),d[2]!==void 0?d[40]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,637746317]),d[2],"attachment_error",d[40]):c.resolve():c.resolve()},function(a){return d[39]=new c.Map(),d[39].set("error_code",c.i64.cast([0,24])),d[39].set("stored_procedure","LSEncryptedBackupsSerializeAttachmentBackupPayloadStoredProcedure"),d[39].set("error_message",""),a=[void 0,d[39]],d[36]=a[0],d[37]=a[1]}])},function(a){return a=[d[36],d[37]],d[9]=a[0],d[10]=a[1],a}]):c.sequence([function(a){return d[17]=d[7].get("errors"),d[18]=d[7].get("errors"),d[19]=".",d[21]=["LSEncryptedBackupsSerializeAttachmentBackupPayloadStoredProcedure",d[19],"Error while reading client state",d[19],c.i64.to_string(c.i64.cast([0,1]))].join(""),d[2]!==void 0?d[21]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,637746317]),d[2],"attachment_error",d[21]):c.resolve():c.resolve()},function(a){return d[20]=new c.Map(),d[20].set("error_code",c.i64.cast([0,1])),d[20].set("stored_procedure","LSEncryptedBackupsSerializeAttachmentBackupPayloadStoredProcedure"),d[20].set("error_message",""),a=[void 0,d[20]],d[9]=a[0],d[10]=a[1]}])},function(a){return d[11]=c.i64.of_float(Date.now()),d[12]=c.i64.random(),d[14]="Finishing execution. Execution time: ",d[15]=c.i64.to_string(c.i64.sub(d[11],d[0])),d[16]=" ms",d[13]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][serializeAttachmentBackupPayload] ",d[13],d[14],d[13],d[15],d[13],d[16]].join("")),c.i64.eq(c.i64.mod_(d[12],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[17]=",",d[18]=c.createArray(),void 0!==void 0?d[19]=(d[18].push(void 0),d[18]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"serializeAttachmentBackupPayload",[d[14],d[17],d[15],d[17],d[16]].join(""),d[18],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[9],d[10]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsSerializeAttachmentBackupPayloadStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state"];e.exports=a}),null);
__d("LSSerializeAttachmentBackupPayloadStoredProcedure",["LSSerializeAttachmentBackupPayload","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSSerializeAttachmentBackupPayload"),e.attachmentInfos,e.messageId,e.threadId,e.productType,e.error,e.errorMessage);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSWriteToPendingProtobufBackupsContextV2",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(305).add({pk:void 0,pendingBackupTaskId:a[0],actThreadId:a[1],toplevelOfflineThreadingId:a[2],supplementalOfflineThreadingId:a[3],messageTimestampMs:a[6],backupAction:a[7],supplementalKey:a[5],attachmentPayload:a[8],senderId:a[9],deletionOfflineThreadingId:a[4]})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSEncryptedBackupsWriteToPendingProtobufBackupsContextV2StoredProcedure";a.__tables__=["pending_protobuf_backups_context"];e.exports=a}),null);
__d("LSIssueMessageBackup",["LSArrayGetObjectAt","LSIsEncryptionVersionSecure","LSIssueNewTaskAndGetTaskID","LSLogMebClientEvent.nop","LSSerializeAttachmentBackupPayload","LSWriteToPendingProtobufBackupsContextV2"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][issueMessageBackup] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[15]=new c.Map(),d[15].set("error_msg","Expected a nonempty query result"),d[15].set("code",c.i64.cast([0,3])),d[15].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[16]=c.createArray(),d[17]=(d[16].push(d[15]),d[16]),e=[void 0,d[16]],d[2]=e[0],d[3]=e[1]):(b=a.item,d[15]=new c.Map(),d[15].set("backup_id",b.backupId),d[15].set("device_public_key_blob",b.devicePublicKeyBlob),d[15].set("device_private_key_blob",b.devicePrivateKeyBlob),d[15].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[15].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[15].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[15].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[15].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[15].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[15].set("orf_client_state_v2_blob",void 0),d[15].set("orf_v2_authority_level",void 0),d[15].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[15].set("device_id",b.deviceId),d[15].set("backup_tenancy",b.backupTenancy),d[15].set("encryption_version",b.encryptionVersion),d[15].set("revision_version",b.revisionVersion),d[15].set("initialize_restore_result",void 0),d[15].set("device_creation_timestamp_sec",void 0),d[15].set("authority_level",b.authorityLevel),e=[d[15],void 0],d[2]=e[0],d[3]=e[1])})},function(e){return d[5]=new c.Map(),d[5].set("value",d[2]),d[5].set("errors",d[3]),d[6]=d[5].get("value"),d[6]!==void 0?c.sequence([function(e){return d[15]=d[6].get("backup_id"),d[16]=d[6].get("device_public_key_blob"),d[17]=d[6].get("device_private_key_blob"),d[18]=d[6].get("epoch_storage_public_key_blob"),d[19]=d[6].get("epoch_storage_private_key_blob"),d[20]=d[6].get("epoch_auth_public_key_blob"),d[21]=d[6].get("epoch_auth_private_key_blob"),d[22]=d[6].get("mailbox_root_key_blob"),d[23]=d[6].get("ocmf_client_state_blob"),d[24]=d[6].get("orf_client_state_v2_blob"),d[25]=d[6].get("orf_v2_authority_level"),d[26]=d[6].get("oblivious_validation_token_blob"),d[27]=d[6].get("device_id"),d[28]=d[6].get("backup_tenancy"),d[29]=d[6].get("encryption_version"),d[30]=d[6].get("revision_version"),d[31]=d[6].get("initialize_restore_result"),d[32]=d[6].get("device_creation_timestamp_sec"),d[33]=d[6].get("authority_level"),c.i64.neq(d[27],void 0)?c.sequence([function(a){return d[36]=void 0,c.i64.neq(d[36],void 0)?c.resolve(d[37]=d[36]):c.sequence([function(a){return d[48]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[49]=a[0],a})},function(a){return d[49]?d[58]=(d[48].push(c.i64.cast([0,0])),d[48]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[50]=a[0],a})},function(a){return d[50]?d[58]=(d[48].push(c.i64.cast([0,2])),d[48]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[51]=a[0],a})},function(a){return d[51]?d[58]=(d[48].push(c.i64.cast([0,3])),d[48]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[52]=a[0],a})},function(a){return d[52]?d[58]=(d[48].push(c.i64.cast([0,4])),d[48]):0,d[53]=c.createArray(),d[54]=c.i64.of_int32(d[48].length),c.i64.gt(d[54],c.i64.cast([0,0]))?c.loopAsync(d[54],function(a){return d[58]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[48],d[58]).then(function(a){return a=a,d[59]=a[0],d[60]=a[1],a})},function(a){return d[61]=(d[53].push(d[59]),d[53])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[58]=c.createArray(),d[59]=c.i64.of_int32(d[53].length),c.i64.gt(d[59],c.i64.cast([0,0]))?c.loopAsync(d[59],function(a){return d[61]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[53],d[61]).then(function(a){return a=a,d[62]=a[0],d[63]=a[1],a})},function(a){return d[64]=(d[58].push(c.i64.to_string(d[62])),d[58])}])}):c.resolve()},function(a){return d[60]=d[58].join(","),d[55]=d[60]}])},function(a){return d[53].some(function(a){return c.i64.eq(d[29],a)})?d[56]=d[29]:d[56]=void 0,c.i64.neq(d[56],void 0)?d[57]=d[56]:d[57]=void 0,d[37]=d[57]}])},function(e){var f;return c.i64.neq(d[37],void 0)?d[38]=d[37]:d[38]=c.i64.cast([0,0]),c.i64.neq(d[28],void 0)?d[39]=d[28]:d[39]=c.i64.cast([0,1]),c.sequence([function(e){return a[11]!==void 0?c.sequence([function(e){return d[50]=a[11].get("attachment_infos"),d[51]=a[11].get("attachment_infos"),d[52]=a[11].get("product_type"),d[53]=a[11].get("error"),d[54]=a[11].get("error_message"),c.storedProcedure(b("LSSerializeAttachmentBackupPayload"),d[51],a[1],a[0],d[52],d[53],d[54]).then(function(a){return a=a,d[55]=a[0],d[56]=a[1],a})},function(a){return d[55]?d[57]=!1:d[57]=!0,d[57]?c.sequence([function(a){return d[56]?d[63]=!1:d[63]=!0,d[63]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsIssueMessageBackupStoredProcedure] Invalid Attachment payload generated"),d[68]="Invalid Attachment payload generated",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueMessageBackupStoredProcedure] ","",d[68]].join("")),d[67]=c.createArray(),void 0!==void 0?d[69]=(d[67].push(void 0),d[67]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageBackupStoredProcedure",d[68],d[67],c.i64.cast([0,3]))},function(a){return a=[void 0,void 0,d[50]],d[64]=a[0],d[65]=a[1],d[66]=a[2],a}]):c.resolve((a=[void 0,d[56],d[50]],d[64]=a[0],d[65]=a[1],d[66]=a[2],a))},function(a){return a=[d[64],d[65],d[66]],d[58]=a[0],d[59]=a[1],d[60]=a[2],a}]):c.resolve((d[63]=d[55].get("payload"),a=[d[63],void 0,d[50]],d[58]=a[0],d[59]=a[1],d[60]=a[2]))},function(b){return d[63]=new c.Map(),d[64]=d[63].set("success",d[58]),d[65]=d[63].set("failure",d[59]),d[66]=d[63].set("upload_context",d[60]),d[67]=c.toJSON(d[63]),d[61]=d[67],d[62]=a[11].get("error"),b=[d[61],d[62]],d[48]=b[0],d[49]=b[1]}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssueMessageBackupStoredProcedure] Null Attachments for the message"),e=[void 0,void 0],d[48]=e[0],d[49]=e[1]))},function(a){return a=[d[48],d[49]],d[40]=a[0],d[41]=a[1],a}])},function(e){return d[46]=c.i64.add(c.i64.mul(c.i64.div(a[2],c.i64.cast([0,1e3])),c.i64.cast([0,1e3])),c.i64.div(c.i64.mod_(c.i64.and_(c.i64.asr_(c.i64.from_string(a[1]),c.i64.to_int32(c.i64.cast([0,22]))),c.i64.cast([511,4294967295])),c.i64.cast([0,1e5])),c.i64.cast([0,100]))),a[9]!==void 0?(d[48]=a[9].get("backup_action"),c.i64.eq(d[48],c.i64.cast([0,4]))?d[49]=a[2]:d[49]=d[46],d[42]=d[49]):d[42]=d[46],d[47]=["Sort Key (",c.i64.to_string(d[42]),") is not in MS. ","auth_ts (",c.i64.to_string(a[2]),"), otid (",a[1],")"].join(""),c.i64.lt(d[42],c.i64.cast([2,1410065408]))?(function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueMessageBackupStoredProcedure] ","",d[47]].join("")),d[48]=c.createArray(),void 0!==void 0?d[49]=(d[48].push(void 0),d[48]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageBackupStoredProcedure",d[47],d[48],c.i64.cast([0,3]))):c.i64.gt(c.i64.sub(d[42],c.i64.cast([249,3468343296])),c.i64.cast([255,4294967295]))?(function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueMessageBackupStoredProcedure] ","",d[47]].join("")),d[48]=c.createArray(),void 0!==void 0?d[49]=(d[48].push(void 0),d[48]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageBackupStoredProcedure",d[47],d[48],c.i64.cast([0,3]))):c.resolve()},function(e){return d[43]=c.i64.of_float(Date.now()),c.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),["eb_upload",":",a[0]].join(""),c.i64.cast([0,50026]),"",void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),c.i64.cast([0,93]),void 0,c.i64.le(c.i64.cast([0,0]),c.i64.cast([0,0]))?c.i64.cast([0,0]):c.i64.add(d[43],c.i64.sub(c.i64.cast([0,0]),c.i64.mod_(d[43],c.i64.cast([0,0])))),c.i64.cast([0,0])).then(function(a){return a=a,d[44]=a[0],a})},function(b){return c.db.table(177).add({pk:void 0,pendingBackupTaskId:d[44],actionType:c.i64.cast([0,1]),contentType:c.i64.cast([0,1]),backupStatus:c.i64.cast([0,1]),listKey:a[0],uniqueKey:a[1],sortKey:c.i64.to_string(d[42]),persistentId:"",isInstamadillo:a[12],echoContent:a[4],lsTraceId:a[5],error:a[6],echoEncodingLatencyNs:a[7],errorMessage:a[8],attachmentPayload:d[40],attachmentErrorCode:d[41]})},function(b){return c.i64.eq(c.i64.cast([0,1]),c.i64.cast([0,1]))?c.i64.eq(c.i64.cast([0,1]),c.i64.cast([0,1]))?(d[48]=c.createArray(),d[50]=(d[48].push("Successfully issued message backup task. act thread id = "),d[48]),d[50]=(d[48].push(a[0]),d[48]),d[50]=(d[48].push(", otid = "),d[48]),d[50]=(d[48].push(a[1]),d[48]),d[49]=d[48].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueMessageBackup] ","",d[49]].join("")),c.resolve()):(d[48]=c.createArray(),d[50]=(d[48].push("Successfully issued message remove task. act thread id = "),d[48]),d[50]=(d[48].push(a[0]),d[48]),d[50]=(d[48].push(", otid = "),d[48]),d[50]=(d[48].push(a[1]),d[48]),d[49]=d[48].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueMessageBackup] ","",d[49]].join("")),c.resolve()):(d[48]=c.createArray(),d[50]=(d[48].push("Successfully issued thread remove task. act thread id = "),d[48]),d[50]=(d[48].push(a[0]),d[48]),d[49]=d[48].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueMessageBackup] ","",d[49]].join("")),c.resolve())},function(e){return a[9]!==void 0?c.sequence([function(e){return d[48]=a[9].get("act_thread_id"),d[49]=a[9].get("backup_action"),d[50]=a[9].get("toplevel_offline_threading_id"),d[51]=a[9].get("supplemental_offline_threading_id"),d[52]=a[9].get("message_timestamp_ms"),d[53]=a[9].get("supplemental_key"),d[54]=a[9].get("attachment_payload"),d[55]=a[9].get("extra_data_for_eb_upload"),d[56]=a[9].get("message_protobuf"),d[57]=a[9].get("deletion_offline_threading_id"),c.storedProcedure(b("LSWriteToPendingProtobufBackupsContextV2"),d[44],d[48],d[50],d[51],d[57],d[53],d[52],d[49],d[54],void 0,d[56],d[55])},function(e){return d[58]=a[9].get("backup_action"),c.i64.neq(d[42],a[2])?(d[60]=["Sort key (",c.i64.to_string(d[42]),") and authoritative_ts (",c.i64.to_string(a[2]),") are not equal given OTID (",a[1],") for event type: ",c.i64.to_string(d[58])].join(""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueMessageBackupStoredProcedure] ",d[60]].join("")),d[59]=c.createArray(),void 0!==void 0?d[61]=(d[59].push(void 0),d[59]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageBackupStoredProcedure",d[60],d[59],c.i64.cast([0,4]))):c.resolve()}]):c.i64.neq(d[42],a[2])?(d[49]=["Sort key (",c.i64.to_string(d[42]),") and authoritative_ts (",c.i64.to_string(a[2]),") are not equal given OTID (",a[1],") for event type: ",c.i64.to_string(c.i64.cast([-1,4294967295]))].join(""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueMessageBackupStoredProcedure] ",d[49]].join("")),d[48]=c.createArray(),void 0!==void 0?d[50]=(d[48].push(void 0),d[48]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageBackupStoredProcedure",d[49],d[48],c.i64.cast([0,4]))):c.resolve()},function(a){return d[45]=new c.Map(),d[45].set("task_id",d[44]),a=[d[45],void 0],d[34]=a[0],d[35]=a[1]}]):c.sequence([function(b){return d[36]=c.createArray(),d[39]=(d[36].push("Skipping the message upload since EB is disabled. act thread id = "),d[36]),d[39]=(d[36].push(a[0]),d[36]),d[39]=(d[36].push(", otid = "),d[36]),d[39]=(d[36].push(a[1]),d[36]),d[37]=d[36].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueMessageBackup] ","",d[37]].join("")),c.resolve()},function(a){return d[38]=new c.Map(),d[38].set("error_code",c.i64.cast([0,24])),d[38].set("stored_procedure","LSEncryptedBackupsIssueMessageBackupStoredProcedure"),d[38].set("error_message",""),a=[void 0,d[38]],d[34]=a[0],d[35]=a[1]}])},function(a){return a=[d[34],d[35]],d[7]=a[0],d[8]=a[1],a}]):c.sequence([function(b){return d[15]=d[5].get("errors"),d[16]=d[5].get("errors"),d[17]=c.createArray(),d[20]=(d[17].push("Skipping the message upload since EB is disabled. act thread id = "),d[17]),d[20]=(d[17].push(a[0]),d[17]),d[20]=(d[17].push(", otid = "),d[17]),d[20]=(d[17].push(a[1]),d[17]),d[18]=d[17].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueMessageBackup] ","",d[18]].join("")),c.resolve()},function(a){return d[19]=new c.Map(),d[19].set("error_code",c.i64.cast([0,1])),d[19].set("stored_procedure","LSEncryptedBackupsIssueMessageBackupStoredProcedure"),d[19].set("error_message",""),a=[void 0,d[19]],d[7]=a[0],d[8]=a[1]}])},function(a){return d[9]=c.i64.of_float(Date.now()),d[10]=c.i64.random(),d[12]="Finishing execution. Execution time: ",d[13]=c.i64.to_string(c.i64.sub(d[9],d[0])),d[14]=" ms",d[11]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueMessageBackup] ",d[11],d[12],d[11],d[13],d[11],d[14]].join("")),c.i64.eq(c.i64.mod_(d[10],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[15]=",",d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"issueMessageBackup",[d[12],d[15],d[13],d[15],d[14]].join(""),d[16],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[7],d[8]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsIssueMessageBackupStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","pending_backups_context_v2"];e.exports=a}),null);
__d("LSIssueMessageBackupStoredProcedure",["LSIssueMessageBackup","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSIssueMessageBackup"),e.actThreadId,e.otid,e.authoritativeTs,e.source,e.echoDocument,e.traceId,e.error,e.echoEncodingLatencyNs,e.errorMessage,e.protobufBackupContext,e.tamThreadSubtype,e.attachmentBackupContext,e.isInstamadillo);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSIssueMessageRemove",["LSArrayGetObjectAt","LSIsEncryptionVersionSecure","LSIssueNewTaskAndGetTaskID","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][issueMessageRemove] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[15]=new c.Map(),d[15].set("error_msg","Expected a nonempty query result"),d[15].set("code",c.i64.cast([0,3])),d[15].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[16]=c.createArray(),d[17]=(d[16].push(d[15]),d[16]),e=[void 0,d[16]],d[2]=e[0],d[3]=e[1]):(b=a.item,d[15]=new c.Map(),d[15].set("backup_id",b.backupId),d[15].set("device_public_key_blob",b.devicePublicKeyBlob),d[15].set("device_private_key_blob",b.devicePrivateKeyBlob),d[15].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[15].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[15].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[15].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[15].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[15].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[15].set("orf_client_state_v2_blob",void 0),d[15].set("orf_v2_authority_level",void 0),d[15].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[15].set("device_id",b.deviceId),d[15].set("backup_tenancy",b.backupTenancy),d[15].set("encryption_version",b.encryptionVersion),d[15].set("revision_version",b.revisionVersion),d[15].set("initialize_restore_result",void 0),d[15].set("device_creation_timestamp_sec",void 0),d[15].set("authority_level",b.authorityLevel),e=[d[15],void 0],d[2]=e[0],d[3]=e[1])})},function(e){return d[5]=new c.Map(),d[5].set("value",d[2]),d[5].set("errors",d[3]),d[6]=d[5].get("value"),d[6]!==void 0?c.sequence([function(e){return d[15]=d[6].get("backup_id"),d[16]=d[6].get("device_public_key_blob"),d[17]=d[6].get("device_private_key_blob"),d[18]=d[6].get("epoch_storage_public_key_blob"),d[19]=d[6].get("epoch_storage_private_key_blob"),d[20]=d[6].get("epoch_auth_public_key_blob"),d[21]=d[6].get("epoch_auth_private_key_blob"),d[22]=d[6].get("mailbox_root_key_blob"),d[23]=d[6].get("ocmf_client_state_blob"),d[24]=d[6].get("orf_client_state_v2_blob"),d[25]=d[6].get("orf_v2_authority_level"),d[26]=d[6].get("oblivious_validation_token_blob"),d[27]=d[6].get("device_id"),d[28]=d[6].get("backup_tenancy"),d[29]=d[6].get("encryption_version"),d[30]=d[6].get("revision_version"),d[31]=d[6].get("initialize_restore_result"),d[32]=d[6].get("device_creation_timestamp_sec"),d[33]=d[6].get("authority_level"),c.i64.neq(d[27],void 0)?c.sequence([function(a){return d[36]=void 0,c.i64.neq(d[36],void 0)?c.resolve(d[37]=d[36]):c.sequence([function(a){return d[43]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[44]=a[0],a})},function(a){return d[44]?d[53]=(d[43].push(c.i64.cast([0,0])),d[43]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[45]=a[0],a})},function(a){return d[45]?d[53]=(d[43].push(c.i64.cast([0,2])),d[43]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[46]=a[0],a})},function(a){return d[46]?d[53]=(d[43].push(c.i64.cast([0,3])),d[43]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[47]?d[53]=(d[43].push(c.i64.cast([0,4])),d[43]):0,d[48]=c.createArray(),d[49]=c.i64.of_int32(d[43].length),c.i64.gt(d[49],c.i64.cast([0,0]))?c.loopAsync(d[49],function(a){return d[53]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[43],d[53]).then(function(a){return a=a,d[54]=a[0],d[55]=a[1],a})},function(a){return d[56]=(d[48].push(d[54]),d[48])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[53]=c.createArray(),d[54]=c.i64.of_int32(d[48].length),c.i64.gt(d[54],c.i64.cast([0,0]))?c.loopAsync(d[54],function(a){return d[56]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[48],d[56]).then(function(a){return a=a,d[57]=a[0],d[58]=a[1],a})},function(a){return d[59]=(d[53].push(c.i64.to_string(d[57])),d[53])}])}):c.resolve()},function(a){return d[55]=d[53].join(","),d[50]=d[55]}])},function(a){return d[48].some(function(a){return c.i64.eq(d[29],a)})?d[51]=d[29]:d[51]=void 0,c.i64.neq(d[51],void 0)?d[52]=d[51]:d[52]=void 0,d[37]=d[52]}])},function(e){return c.i64.neq(d[37],void 0)?d[38]=d[37]:d[38]=c.i64.cast([0,0]),c.i64.neq(d[28],void 0)?d[39]=d[28]:d[39]=c.i64.cast([0,1]),d[40]=c.i64.of_float(Date.now()),c.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),["eb_upload",":",a[0]].join(""),c.i64.cast([0,50026]),"",void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),c.i64.cast([0,93]),void 0,c.i64.le(c.i64.cast([0,0]),c.i64.cast([0,0]))?c.i64.cast([0,0]):c.i64.add(d[40],c.i64.sub(c.i64.cast([0,0]),c.i64.mod_(d[40],c.i64.cast([0,0])))),c.i64.cast([0,0])).then(function(a){return a=a,d[41]=a[0],a})},function(b){return c.db.table(177).add({pk:void 0,pendingBackupTaskId:d[41],actionType:c.i64.cast([0,2]),contentType:c.i64.cast([0,1]),backupStatus:c.i64.cast([0,1]),listKey:a[0],uniqueKey:a[1],sortKey:c.i64.to_string(c.i64.add(c.i64.mul(c.i64.div(a[2],c.i64.cast([0,1e3])),c.i64.cast([0,1e3])),c.i64.div(c.i64.mod_(c.i64.and_(c.i64.asr_(c.i64.from_string(a[1]),c.i64.to_int32(c.i64.cast([0,22]))),c.i64.cast([511,4294967295])),c.i64.cast([0,1e5])),c.i64.cast([0,100])))),persistentId:"",isInstamadillo:!1,lsTraceId:a[4],error:a[5]})},function(b){return c.i64.eq(c.i64.cast([0,1]),c.i64.cast([0,1]))?c.i64.eq(c.i64.cast([0,2]),c.i64.cast([0,1]))?(d[43]=c.createArray(),d[45]=(d[43].push("Successfully issued message backup task. act thread id = "),d[43]),d[45]=(d[43].push(a[0]),d[43]),d[45]=(d[43].push(", otid = "),d[43]),d[45]=(d[43].push(a[1]),d[43]),d[44]=d[43].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueMessageRemove] ","",d[44]].join("")),c.resolve()):(d[43]=c.createArray(),d[45]=(d[43].push("Successfully issued message remove task. act thread id = "),d[43]),d[45]=(d[43].push(a[0]),d[43]),d[45]=(d[43].push(", otid = "),d[43]),d[45]=(d[43].push(a[1]),d[43]),d[44]=d[43].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueMessageRemove] ","",d[44]].join("")),c.resolve()):(d[43]=c.createArray(),d[45]=(d[43].push("Successfully issued thread remove task. act thread id = "),d[43]),d[45]=(d[43].push(a[0]),d[43]),d[44]=d[43].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueMessageRemove] ","",d[44]].join("")),c.resolve())},function(a){return d[42]=new c.Map(),d[42].set("task_id",d[41]),a=[d[42],void 0],d[34]=a[0],d[35]=a[1]}]):c.sequence([function(b){return d[36]=c.createArray(),d[39]=(d[36].push("Skipping message upload since EB is disabled. act thread id = "),d[36]),d[39]=(d[36].push(a[0]),d[36]),d[39]=(d[36].push(", otid = "),d[36]),d[39]=(d[36].push(a[1]),d[36]),d[37]=d[36].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueMessageRemove] ","",d[37]].join("")),c.resolve()},function(a){return d[38]=new c.Map(),d[38].set("error_code",c.i64.cast([0,24])),d[38].set("stored_procedure","LSEncryptedBackupsIssueMessageRemoveStoredProcedure"),d[38].set("error_message",""),a=[void 0,d[38]],d[34]=a[0],d[35]=a[1]}])},function(a){return a=[d[34],d[35]],d[7]=a[0],d[8]=a[1],a}]):c.sequence([function(b){return d[15]=d[5].get("errors"),d[16]=d[5].get("errors"),d[17]=c.createArray(),d[20]=(d[17].push("Skipping message upload since EB is disabled. act thread id = "),d[17]),d[20]=(d[17].push(a[0]),d[17]),d[20]=(d[17].push(", otid = "),d[17]),d[20]=(d[17].push(a[1]),d[17]),d[18]=d[17].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueMessageRemove] ","",d[18]].join("")),c.resolve()},function(a){return d[19]=new c.Map(),d[19].set("error_code",c.i64.cast([0,1])),d[19].set("stored_procedure","LSEncryptedBackupsIssueMessageRemoveStoredProcedure"),d[19].set("error_message",""),a=[void 0,d[19]],d[7]=a[0],d[8]=a[1]}])},function(a){return d[9]=c.i64.of_float(Date.now()),d[10]=c.i64.random(),d[12]="Finishing execution. Execution time: ",d[13]=c.i64.to_string(c.i64.sub(d[9],d[0])),d[14]=" ms",d[11]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueMessageRemove] ",d[11],d[12],d[11],d[13],d[11],d[14]].join("")),c.i64.eq(c.i64.mod_(d[10],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[15]=",",d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"issueMessageRemove",[d[12],d[15],d[13],d[15],d[14]].join(""),d[16],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[7],d[8]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsIssueMessageRemoveStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","pending_backups_context_v2"];e.exports=a}),null);
__d("LSIssueMessageRemoveStoredProcedure",["LSIssueMessageRemove","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSIssueMessageRemove"),e.actThreadId,e.otid,e.authoritativeTs,e.source,e.traceId,e.error);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSTamThreadSubtype",[],(function(a,b,c,d,e,f){a=Object.freeze({STANDARD:0,VANISH_MODE:1,DUAL_SEND_SHADOW:2,BTV_COMPANION:3,BLEND_DUAL_SEND:4,BLEND_DUAL_SEND_NO_NETWORK:5});f["default"]=a}),66);
__d("MAWBridgeUploadMessageHandler",["EBIsEbEnabled","EncryptedBackupsWriteToMPSTables","FBLogger","I64","LSEncryptedBackupsAttachmentErrorCode","LSFactory","LSIntEnum","LSIssueMessageBackupStoredProcedure","LSIssueMessageRemoveStoredProcedure","LSMEBTaskCreationSource","LSShape","LSTamThreadSubtype","LSVec","MAWCastToMsgrServerMediaType","MAWEBFrontendQPLLogger","MAWMsgType","MWEBODSEntityName.enum","MWEBODSUtils","WATimeUtils","cr:17101","gkx","isInstamadillo","isInstamadilloEB"],(function(a,b,c,d,e,f,g){"use strict";var h,i;async function a(a,e){var f,g;if(c("isInstamadilloEB")())return Promise.resolve();var l=k(e.uploadTrackingInstanceKey);e.uploadTrackingInstanceKey!=null&&d("MAWEBFrontendQPLLogger").addPointEBUploadTracking(e.uploadTrackingInstanceKey,"upload_tracking_bridge_handler");d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload."+((f=e.messageType)!=null?f:"unknown"));f=e.protoMsg;g=((g=e.uploadTrackingInstanceKey)!=null?g:e.traceId).toString();if(!await d("EBIsEbEnabled").isEbEnabledLS(a,l)){if(e.uploadTrackingInstanceKey!=null){var m=e.uploadTrackingInstanceKey;d("MAWEBFrontendQPLLogger").addPointEBUploadTracking(m,"user_device_not_enrolled_invalid_echo_request");d("MAWEBFrontendQPLLogger").endEBUploadTracking(m)}return}m=e.echoDocument;var n=d("WATimeUtils").castMilliSecondsToUnixTime(e.sortOrderMs);if(e.actionType===1){var o=e.echoEncodingLatencyNs,p=e.errorCode,q=e.errorMessage;e.uploadTrackingInstanceKey!=null&&d("MAWEBFrontendQPLLogger").addPointEBUploadTracking(e.uploadTrackingInstanceKey,"issuing_message_backup");var r;if(f!=null)try{var s=f.sortOrderMs;if(s==null)throw c("FBLogger")("messenger_web").mustfixThrow("sort order is null for the protobuf message");await d("EncryptedBackupsWriteToMPSTables").writeToMPSTables(a,f,e.threadId,!1,l);r=d("LSShape").ofRecord({act_thread_id:e.threadId,attachment_payload:null,backup_action:(h||(h=d("LSIntEnum"))).ofNumber(f.backupActionType),message_timestamp_ms:(i||(i=d("I64"))).of_float(s),supplemental_key:f.supplementalKey,toplevel_offline_threading_id:(s=(l=f.originalMsgProtocolId)==null?void 0:l.externalId)!=null?s:f.msgId.externalId})}catch(a){a instanceof Error?c("FBLogger")("wmi_eb").catching(a).mustfix("[labyrinth_web] Error writing to MPSTables for the upload message due to runtime error"):c("FBLogger")("wmi_eb").mustfix("[labyrinth_web] Error writing to MPSTables for the upload message")}var t;if(e.attachmentBackupContext!=null){l=j({bridgeUploadAttachmentBackupContext:e.attachmentBackupContext,messageId:e.messageId,serverThreadKey:null,threadId:e.threadId,traceId:e.traceId});l!=null&&(t=d("LSShape").ofRecord(l))}e.uploadTrackingInstanceKey!=null&&d("MAWEBFrontendQPLLogger").addPointEBUploadTracking(e.uploadTrackingInstanceKey,"upload_handler_echo_protobuf_context",{bool:{attachment_backup_context:t!=null,protobuf_context:r!=null}});if(e.messageType!=null){s=d("MAWMsgType").isMAWSupportedMediaType(e.messageType)?"media":"non-media";d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload."+s)}t!=null&&d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload.attachment_unified_backup");await c("LSIssueMessageBackupStoredProcedure")(c("LSFactory")(a),{actThreadId:e.threadId,attachmentBackupContext:t,authoritativeTs:(i||(i=d("I64"))).of_float(n*1e3),echoDocument:m!=null?m:"",echoEncodingLatencyNs:o!=null?(i||(i=d("I64"))).of_float(o):void 0,error:p!=null?(h||(h=d("LSIntEnum"))).ofNumber(p):void 0,errorMessage:q!=null?q:void 0,isInstamadillo:c("isInstamadillo")(),otid:e.messageId,protobufBackupContext:r,source:(h||(h=d("LSIntEnum"))).ofNumber(c("LSMEBTaskCreationSource").TAM),tamThreadSubtype:h.ofNumber(c("isInstamadillo")()?c("LSTamThreadSubtype").BLEND_DUAL_SEND:c("LSTamThreadSubtype").STANDARD),traceId:g});e.uploadTrackingInstanceKey!=null&&d("MAWEBFrontendQPLLogger").addPointEBUploadTracking(e.uploadTrackingInstanceKey,"upload_tracking_upload_task_issued");void b("cr:17101").log(function(){return{message_id:e.messageId,trace_id:e.traceId}})}else e.actionType===2&&(await c("LSIssueMessageRemoveStoredProcedure")(c("LSFactory")(a),{actThreadId:e.threadId,authoritativeTs:(i||(i=d("I64"))).of_float(n*1e3),otid:e.messageId,source:(h||(h=d("LSIntEnum"))).ofNumber(c("LSMEBTaskCreationSource").TAM),traceId:g}),e.uploadTrackingInstanceKey!=null&&d("MAWEBFrontendQPLLogger").addPointEBUploadTracking(e.uploadTrackingInstanceKey,"upload_tracking_remove_task_issued"))}function j(a){var b;if(!c("gkx")("6956"))return void 0;var e=a.bridgeUploadAttachmentBackupContext,f=a.messageId,g=a.serverThreadKey,i=a.threadId;a=a.traceId;if(e.attachmentInfos.length===0)return;var j=e.attachmentInfos;d("MAWEBFrontendQPLLogger").startFlowUploadAttachmentBackup({deliveryObjectId:j[0].zippyObjectId,flow:"unified",mediaType:(b=d("MAWCastToMsgrServerMediaType").castMediaAttachmentTypeToServerMediaType(j[0].mediaType))!=null?b:"unknown",messageId:f,threadId:i,traceId:a});b=c("LSVec").ofArray(j.map(function(a){return d("LSShape").ofRecord({attachment_trace_id:a.attachmentTraceId,media_type:a.mediaType,zippy_object_id:a.zippyObjectId})}));f=(h||(h=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsAttachmentErrorCode").NO_ERROR);e.error!=null&&(f=(h||(h=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsAttachmentErrorCode").UNKNOWN_ERROR));i={attachment_infos:b,error:f,error_message:null,product_type:e.productType,server_thread_key:g};return i}function k(a){return a==null?null:d("MAWEBFrontendQPLLogger").makeEBFrontendQplFlowFromInstanceKey(a)}g.call=a;g.getMessageUploadAttachmentBackupContext=j}),98);
__d("MAWUploadPayloadGenerator",["EBLogger","EBParseUploadSerializationPayload","EBWasmSerializeMessagesModule","I64","LSBackupContentType","LSEncryptedBackupsAttachmentErrorCode","LSFactory","LSIntEnum","LSPendingBackupStatus","LSSerializeAttachmentBackupPayloadStoredProcedure","LSShape","LSTaskSerializerEncryptedBackupsUpload","LSVec","MAWBridgeUploadMessageHandler","MAWEBFrontendQPLLogger","MAWEBUploadTrackingUtils","MWEBODSUtils","Random","ReQL","WAErrorMessage","WAGetSafeQPLError","WAResultOrError","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=d("EBLogger").EBLogger().tags(["MAWUploadPayloadGenerator"]),m="0",n=new Set();function o(){for(var a=0;a<1e8;a++){var b=d("Random").uint32();if(!n.has(b))return b}throw l.mustfixThrow("Unable to generate a unique task ID after 100 million attempts")}async function a(a,b,e){var f="unknown";c("justknobx")._("4439")&&(f=await t(a)?"available":"unavailable");if(c("gkx")("18428")){var g=await Promise.all(b.map(function(b){var c=b.uploadTrackingInstanceKey;if(c!=null){c=d("MAWEBUploadTrackingUtils").makeEBWorkerQplFlowFromInstanceKey(c);c.addPoint("wasm_upload_serialization_start")}return r(a,b)}));return d("EBWasmSerializeMessagesModule").serializeMessageBatchWasm(a,b,g)}g=b.map(function(b){try{var c=o();n.add(c);return d("WAResultOrError").makeResult({msg:b,taskMetadata:p(a,b,c)})}catch(a){c=d("WAErrorMessage").maybeGetMessageFromError(a);return d("WAResultOrError").makeError({error:c,instanceKey:b.uploadTrackingInstanceKey})}});b=await Promise.all(g.map(function(a){return a.success?a.value:null}).filter(Boolean));g=await Promise.all(b.map(function(b){var g=b.taskMetadata;return g.then(function(g){var i;d("MAWEBFrontendQPLLogger").addPointEBUploadTracking((i=g.uploadTrackingInstanceKey)!=null?i:null,"upload_task_serialization_start",{string:{base_epoch_availability:f,execution_environment:e}});return c("LSTaskSerializerEncryptedBackupsUpload")((j||(j=d("I64"))).of_int32(g.task),c("LSFactory")(a)).then(function(f){if(f.length>0&&f[0]!=null){var h=d("EBParseUploadSerializationPayload").parseUploadSerializationResponse(f[0]);if(h.success){h=h.value;var i=!1;h.failure!=null&&(i=!0,d("EBParseUploadSerializationPayload").logUploadSerializationErrors([h.failure],"echo",e,g.uploadTrackingInstanceKey));if(h.protobuf_failures!=null){h=c("LSVec").toArray(h.protobuf_failures).filter(Boolean);h.length>0&&(i=!0,d("EBParseUploadSerializationPayload").logUploadSerializationErrors(h,"protobuf",e,g.uploadTrackingInstanceKey))}if(!i){d("MAWEBFrontendQPLLogger").addPointEBUploadTracking((h=g.uploadTrackingInstanceKey)!=null?h:null,"upload_task_serialization_success",{string:{execution_environment:e}})}}}i=g.pending_protobuf_backups_context_pk;return Promise.all([a.pending_backups_context_v2.delete(g.pending_backups_context_v2_pk),i!=null?a.pending_protobuf_backups_context.delete(i):Promise.resolve(null)]).then(function(){n.delete(g.task);return d("WAResultOrError").makeResult({msg:b.msg,payload:f[0]})})}).catch(function(a){var c,f=d("WAErrorMessage").maybeGetMessageFromError(a);d("MAWEBFrontendQPLLogger").addPointEBUploadTracking((c=g.uploadTrackingInstanceKey)!=null?c:null,"upload_task_serialization_failure",{string:{serialization_error:d("WAGetSafeQPLError").getSafeQPLErrorMessage(a)}});l.MUSTFIX(h||(h=babelHelpers.taggedTemplateLiteralLoose(["EB upload serializer error: "," in ",""])),d("WAGetSafeQPLError").getSafeQPLErrorMessage(a),e);return d("WAResultOrError").makeError({error:f,instanceKey:b.msg.uploadTrackingInstanceKey})})})}));return g}async function p(a,b,e){var f,g,h=b.sortOrderMs.toString(),m=(j||(j=d("I64"))).of_int32(e),n=j.of_float(b.actionType),o=await r(a,b),p=b.protoMsg,q=p==null||(f=p.originalMsgProtocolId)==null?void 0:f.externalId,t=p==null||(g=p.msgId)==null?void 0:g.externalId,u=p!=null&&(b.actionType===2||c("gkx")("8488"));if(!u&&(b.echoDocument==null||b.echoDocument.length===0)){var v;l.MUSTFIX(i||(i=babelHelpers.taggedTemplateLiteralLoose(["upload message is missing echo document msgType: ",""])),(v=b.messageType)!=null?v:"unknown");d("MWEBODSUtils").markODSForEB("upload","missing_echo_document."+((v=b.messageType)!=null?v:"unknown"))}n=await a.pending_backups_context_v2.add({actionType:n,attachmentErrorCode:s(b),attachmentPayload:o,backupStatus:(k||(k=d("LSIntEnum"))).ofNumber(c("LSPendingBackupStatus").BACKUP_IN_PROGRESS),contentType:k.ofNumber(c("LSBackupContentType").MESSAGE),echoContent:u?"":(v=b.echoDocument)!=null?v:"",listKey:b.threadId,pendingBackupTaskId:j.of_int32(e),persistentId:"",pk:m,sortKey:h,uniqueKey:b.messageId});if(p==null)return{pending_backups_context_v2_pk:n[0],task:e,uploadTrackingInstanceKey:b.uploadTrackingInstanceKey};m={actThreadId:b.threadId,attachmentPayload:o,backupAction:j.of_float(p.backupActionType),messageTimestampMs:j.of_float(b.sortOrderMs),pendingBackupTaskId:j.of_float(e),supplementalKey:p.supplementalKey,toplevelOfflineThreadingId:p.backupActionType===4?p.msgId.externalId:(v=(u=p.originalMsgProtocolId)==null?void 0:u.externalId)!=null?v:p.msgId.externalId};p.backupActionType===2&&q!=null&&t!=null&&q!==t&&(m=babelHelpers.extends({},m,{supplementalOfflineThreadingId:t}));if(p.backupActionType===4){o=(h=p.originalMsgProtocolId)==null?void 0:h.externalId;m=babelHelpers.extends({},m,{deletionOfflineThreadingId:o})}u=await a.pending_protobuf_backups_context.add(m);return{pending_backups_context_v2_pk:n[0],pending_protobuf_backups_context_pk:u[0],task:e,uploadTrackingInstanceKey:b.uploadTrackingInstanceKey}}function q(a){if(a.attachmentInfos.length!==1)return[];a=a.attachmentInfos[0];return[{attachment_trace_id:a.attachmentTraceId,media_type:a.mediaType,zippy_object_id:a.zippyObjectId}]}async function r(a,b){if(!c("gkx")("6956"))return void 0;var e,f,g=b.attachmentBackupContext;if(g!=null){f=d("MAWBridgeUploadMessageHandler").getMessageUploadAttachmentBackupContext({bridgeUploadAttachmentBackupContext:g,messageId:b.messageId,serverThreadKey:null,threadId:b.threadId,traceId:b.traceId});if(f!=null){a=await c("LSSerializeAttachmentBackupPayloadStoredProcedure")(c("LSFactory")(a),{attachmentInfos:f.attachment_infos,error:f.error,errorMessage:f.error_message,messageId:b.messageId,productType:f.product_type,threadId:b.threadId});f=a[0];b=a[1];if(f!=null){a=d("LSShape").toRecord(f);e=JSON.stringify({success:a.payload,upload_context:q(g)})}else if(b!=null){f=d("LSShape").toRecord(b);a=f.error_code;e=JSON.stringify({failure:{error_code:(j||(j=d("I64"))).to_float(a),error_message:f.error_message,stored_procedure:f.stored_procedure},upload_context:q(g)})}}}return e}function s(a){return!c("gkx")("6956")?void 0:(j||(j=d("I64"))).of_float(((a=a.attachmentBackupContext)==null?void 0:a.error)!=null?c("LSEncryptedBackupsAttachmentErrorCode").UNKNOWN_ERROR:c("LSEncryptedBackupsAttachmentErrorCode").NO_ERROR)}function t(a){var b=new TextDecoder();return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.secure_encrypted_backups_epochs).filter(function(a){return b.decode(a.epochAnonIdBlob)===m})).then(function(a){if(a!=null)return!0;else return!1})}g.genUploadPayload=a}),98);
__d("XFBEBDeviceEpochStatus.facebook",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum").Mirrored(["INELIGIBLE_FOR_LABYRINTH_11","NO_OPEN_EPOCH","OK","OUTDATED","RATE_LIMITED"]);c=a;f["default"]=c}),66);
__d("EBUploadMessagesFromWorkerMutation",["EBBucketUtils","EBDeps","EBIsEbEnabled","EBLS","EBMessageProbe","EBUploadMessagesFromWorkerMutation.graphql","EncryptedBackupsWriteToMPSTables","FBLogger","I64","LSEBPayloadSerializerError","LSFactory","LSHandleBackupWriteResultV2StoredProcedure","LSPrepareOpenEpochV2StoredProcedure","LSShape","LSVec","MAWCurrentUser","MAWEBFalcoLoggerUtils","MAWEBUploadTrackingUtils","MAWODSProxy","MAWUploadPayloadGenerator","MWEBODSEntityName.enum","MpsTypes","ODS","WAErrorMessage","WALogger","WAOdsEnums","WAResultOrError","createWorkerMutation","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o=h!==void 0?h:h=b("EBUploadMessagesFromWorkerMutation.graphql");function p(a,b){a.forEach(function(a){a.uploadTrackingInstanceKey!=null&&d("MAWEBUploadTrackingUtils").addPointWorkerOnly(a.uploadTrackingInstanceKey,b)})}function q(a,b){a.forEach(function(a){a.uploadTrackingInstanceKey!=null&&d("MAWEBUploadTrackingUtils").addAnnotationsForEBWorkerQplFlow(a.uploadTrackingInstanceKey,b)})}function r(a,b,c){a.forEach(function(a){a.uploadTrackingInstanceKey!=null&&d("MAWEBUploadTrackingUtils").endFailWorkerOnly(a.uploadTrackingInstanceKey,b,c)})}async function s(a){var b=a.backupWriteResult,e=a.deviceEpochStatus,g=a.exception_string,h=a.inputMessages;if(b==null){r(h,"ebls_upload_failed_backup_write_result_null",{string:{error:"backupWriteResult is null"}});d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] backupWriteResult is null"])));return d("WAResultOrError").makeError("backup_write_result_null")}a=await d("EBLS").getLSStorage();var j=b.is_success,k=b.delete_mailbox,l=(b=b.protobuf_params)==null?void 0:b.delete_on_success;if(j!=null&&k!=null){if(!j){r(h,"ebls_upload_failed",{string:{error:g}});var m=d("EBMessageProbe").getEBMessageProbeInstance();h.forEach(function(a){m.addMarkerToItem(d("MpsTypes").toMessageId(a.messageId),"graphql_upload_failed",{error:g!=null?g:"unknown_error",is_success:!1})});return d("WAResultOrError").makeError("gql_upload_failed")}else{c("FBLogger")("wmi_eb").info("Worker successfully completed GQL upload batch of size %s",h.length);p(h,"ebls_upload_success");var n=d("EBMessageProbe").getEBMessageProbeInstance();h.forEach(function(a){n.addMarkerToItem(d("MpsTypes").toMessageId(a.messageId),"graphql_upload_success",{batch_size:h.length,is_success:!0})})}await a.runInTransaction(function(a){return c("LSHandleBackupWriteResultV2StoredProcedure")(c("LSFactory")(a),{deleteMailbox:k,isSuccess:j,protobufParams:l!=null?d("LSShape").ofRecord({delete_on_success:l}):void 0,traceIds:c("LSVec").ofArray(h.map(function(a){return a.traceId}))})},"readwrite",void 0,void 0,f.id+":204")}if(e==null)return d("WAResultOrError").makeError("device_epoch_status_null");$$gen$m0:{if(e==="NO_OPEN_EPOCH"){p(h,"prepare_open_epoch_v2_start");d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.EB_UPLOAD,key:"prepare_open_epoch"});await a.runInTransaction(function(a){return c("LSPrepareOpenEpochV2StoredProcedure")(c("LSFactory")(a),{backupId:void 0})},"readwrite",void 0,void 0,f.id+":232");p(h,"prepare_open_epoch_v2_end");break $$gen$m0}if(e==="OUTDATED"){p(h,"sync_epochs_start");b=await d("EBDeps").getDeps().getEBSMAPI();a=await b.syncEpochs();d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.EB_UPLOAD,key:"outdated_epoch"});if(a.success===!1){p(h,"sync_epochs_failure");d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.EB_UPLOAD,key:"sync_epochs_failure"});r(h,"sync_epochs_failed",{string:{error:(a=a.error)!=null?a:"unknown sync epochs error"}});p(h,"fetch_backup_ids_start");await b.fetchBackupIds("sync_epochs_failure");p(h,"fetch_backup_ids_end")}else d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.EB_UPLOAD,key:"sync_epochs_success"}),p(h,"sync_epochs_end");break $$gen$m0}if(e==="OK"){p(h,"epoch_status_ok");break $$gen$m0}if(e==="INELIGIBLE_FOR_LABYRINTH_11"){p(h,"ineligible_for_labyrinth_1_1");d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.EB_UPLOAD,key:"ineligible_for_labyrinth_1_1"});r(h,"ineligible_for_labyrinth_1_1",{string:{error:"ineligible for labyrinth 1.1"}});break $$gen$m0}if(e==="RATE_LIMITED"){p(h,"rate_limited");r(h,"rate_limited",{string:{error:"rate limited"}});d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.EB_UPLOAD,key:"rate_limited"});break $$gen$m0}d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.EB_UPLOAD,key:"unknown_epoch_status"});p(h,"unknown_epoch_status");break $$gen$m0}return d("WAResultOrError").makeResult()}async function a(a){var b=d("EBMessageProbe").getEBMessageProbeInstance();try{(m||(m=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"worker_thread");p(a,"ebls_init_start");await d("EBLS").init();var e=await d("EBLS").getLSStorage();p(a,"ebls_backup_tenancy_start");var g={bool:{is_main_thread:!1},int:{batch_size:a.length},string:{batch_bucket:d("EBBucketUtils").getBucketName(a.length,100,10)}};q(a,g);if(!await d("EBIsEbEnabled").isEbEnabledLS(e.tables)){for(g of a)if(g.uploadTrackingInstanceKey!=null){var h=g.uploadTrackingInstanceKey;d("MAWEBUploadTrackingUtils").addPointWorkerOnly(h,"user_device_not_enrolled_invalid_gql_request");var i=g.echoDocument!=null?"dual_upload":"protobuf_only";d("MAWEBFalcoLoggerUtils").logEBFalcoTaskSkipped(g,i,"user_device_not_enrolled");d("MAWEBUploadTrackingUtils").endSuccessWorkerOnly(h,"upload_tracking_completed")}return d("WAResultOrError").makeError("ebls_not_initialized")}p(a,"ebls_upload_start");var u;try{u=await e.runInTransaction(async function(b){!c("gkx")("18428")?p(a,"ebls_lsdb_write_start"):p(a,"ebls_lsdb_write_skipped");var e=await Promise.all(a.map(function(e){var f=e.protoMsg,g=e.threadId,h=e.uploadTrackingInstanceKey;if(f==null)return null;h=h!=null?d("MAWEBUploadTrackingUtils").makeEBWorkerQplFlowFromInstanceKey(h):null;if(!c("gkx")("18428")){p(a,"ebls_mps_write_start");f=f.backupActionType===1?Promise.all([d("EncryptedBackupsWriteToMPSTables").writeToMPSTables(b,f,g,!1,h),d("EncryptedBackupsWriteToMPSTables").writeTagsToMPSTables(b,f,g)]).then(function(a){var b=a[0];a[1];return b}):d("EncryptedBackupsWriteToMPSTables").writeToMPSTables(b,f,g,!1,h);return f.then(function(b){if(!b.success){var f=e.uploadTrackingInstanceKey;b=b.error;var g=b.errorCode;b=b.errorMsg;f!=null&&(t(g)?d("MAWEBUploadTrackingUtils").endCancelWorkerOnly(f,{int:{errorCode:g!=null?(n||(n=d("I64"))).to_float(g):c("LSEBPayloadSerializerError").UNKNOWN},string:{error:b}}):d("MAWEBUploadTrackingUtils").endFailWorkerOnly(f,"mps_write_failed",{string:{error:b}}));return null}p(a,"ebls_mps_write_success");return e})}else p(a,"ebls_mps_write_skipped");return e})).then(function(a){return a.filter(Boolean)});return d("MAWUploadPayloadGenerator").genUploadPayload(b,e,"worker").then(function(a){return a.map(function(a){if(!a.success){var b=a.error,c=b.error;b=b.instanceKey;b!=null&&d("MAWEBUploadTrackingUtils").endFailWorkerOnly(b,"ebls_payload_generation_failed",{string:{error:c}});return null}return a.value}).filter(Boolean)})},"readwrite",void 0,void 0,f.id+":357"),p(a,"ebls_upload_payload_generated")}catch(b){i=d("WAErrorMessage").maybeGetMessageFromError(b);r(a,"ebls_upload_failed_payload",{string:{error:i}});d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to generate payload: ",""])),i);return d("WAResultOrError").makeError("upload_serialization_failure")}if(u.length===0){r(a,"ebls_upload_payload_empty");return d("WAResultOrError").makeResult()}h=u.map(function(a){return a.msg});h.forEach(function(b){var a=b.echoDocument!=null?"dual_upload":"protobuf_only";d("MAWEBFalcoLoggerUtils").logEBFalcoTaskIssued(b,a)});g=c("createWorkerMutation")(o);e=g[0];h.forEach(function(a){b.addMarkerToItem(d("MpsTypes").toMessageId(a.messageId),"graphql_upload_start")});i=await e({input:{app_id_str:d("MAWCurrentUser").getAppID(),payload:{msg_payloads:u.map(function(a){return a.payload}).filter(Boolean)}}});p(h,"ebls_received_gql_upload_response");if(i==null){r(h,"ebls_upload_failed_response_null");d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] graphqlResponse is null"])));h.forEach(function(c){var a=c.echoDocument!=null?"dual_upload":"protobuf_only";d("MAWEBFalcoLoggerUtils").logEBFalcoTaskFailure(c,a,"ebls_not_initialized");b.addMarkerToItem(d("MpsTypes").toMessageId(c.messageId),"graphql_upload_failed_null_response")});return d("WAResultOrError").makeError("gql_upload_null_response")}e=(g=i.xfb_upload_encrypted_msg_to_backup)!=null?g:{};i=e.backup_write_result_response;g=e.device_epoch_status;e=e.exception_string;var v=await s({backupWriteResult:i,deviceEpochStatus:g,exception_string:e,inputMessages:h});!v.success?h.forEach(function(b){var a=b.echoDocument!=null?"dual_upload":"protobuf_only";d("MAWEBFalcoLoggerUtils").logEBFalcoTaskFailure(b,a,v.error)}):h.forEach(function(a){d("MAWEBFalcoLoggerUtils").logEBFalcoEncryptedBackupUploadSuccess(a)});return v}catch(c){i=d("WAErrorMessage").maybeGetMessageFromError(c);r(a,"ebls_upload_failed_response",{string:{error:i}});a.forEach(function(c){var a=c.echoDocument!=null?"dual_upload":"protobuf_only";d("MAWEBFalcoLoggerUtils").logEBFalcoTaskFailure(c,a,"ebls_not_initialized");b.addMarkerToItem(d("MpsTypes").toMessageId(c.messageId),"graphql_upload_exception")});d("WALogger").ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to upload with EBLS: ",""])),c);return d("WAResultOrError").makeError("gql_upload_runtime_error")}}function t(a){switch(a){case c("LSEBPayloadSerializerError").SKIP_MPS_WRITE_DUE_TO_HIGHER_TIMESTAMP_AVAILABILITY:case c("LSEBPayloadSerializerError").MESSAGE_ALREADY_DELETED:return!0;default:return!1}return!1}g.uploadMessagesFromWorker=a}),98);
__d("EchoSerializationFailureFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5722");b=d("FalcoLoggerInternal").create("echo_serialization_failure",a);e=b;g["default"]=e}),98);
__d("EchoSerializationSuccessFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5723");b=d("FalcoLoggerInternal").create("echo_serialization_success",a);e=b;g["default"]=e}),98);
__d("EncryptedBackupTaskSkippedFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5727");b=d("FalcoLoggerInternal").create("encrypted_backup_task_skipped",a);e=b;g["default"]=e}),98);
__d("ReverbWriteFailureFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5829");b=d("FalcoLoggerInternal").create("reverb_write_failure",a);e=b;g["default"]=e}),98);
__d("ReverbWriteSuccessFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5831");b=d("FalcoLoggerInternal").create("reverb_write_success",a);e=b;g["default"]=e}),98);
__d("WASmaxInPreKeysRotateSignedResponseRequestError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysRequestErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysRequestErrors").parseRequestErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRequestErrors:b.value}))}g.parseRotateSignedResponseRequestError=a}),98);
__d("WASmaxInPreKeysRotateSignedResponseServerError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysServerErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInPreKeysServerErrors").parseServerErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorServerErrors:b.value}))}g.parseRotateSignedResponseServerError=a}),98);
__d("WASmaxInPreKeysRotateSignedResponseSuccess",["WASmaxInPreKeysIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInPreKeysIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!c.success?c:c}g.parseRotateSignedResponseSuccess=a}),98);
__d("WASmaxInPreKeysRotateSignedResponseValidationError",["WAResultOrError","WASmaxInPreKeysIQErrorResponseMixin","WASmaxInPreKeysIdentityKeyMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;var e=d("WASmaxParseUtils").attrString(c.value,"text");if(!e.success)return e;var f=d("WASmaxParseUtils").attrIntRange(c.value,"code",400,499);if(!f.success)return f;c=d("WASmaxInPreKeysIdentityKeyMixin").parseIdentityKeyMixin(c.value);if(!c.success)return c;a=d("WASmaxInPreKeysIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({errorText:e.value,errorCode:f.value,errorIdentityKeyMixin:c.value},a.value))}g.parseRotateSignedResponseValidationError=a}),98);
__d("WASmaxOutPreKeysRotateSignedRequest",["WASmaxJsx","WASmaxOutPreKeysClientRequestMixin","WASmaxOutPreKeysSignedPreKeyMixin"],(function(a,b,c,d,e,f,g){function a(a){a=a.signedPreKeyMixinArgs;a=d("WASmaxOutPreKeysClientRequestMixin").mergeClientRequestMixin(d("WASmaxJsx").smax("iq",{type:"set"},d("WASmaxOutPreKeysSignedPreKeyMixin").mergeSignedPreKeyMixin(d("WASmaxJsx").smax("rotate",null),a)));return a}g.makeRotateSignedRequest=a}),98);
__d("WASmaxPreKeysRotateSignedRPC",["WAComms","WASmaxInPreKeysRotateSignedResponseRequestError","WASmaxInPreKeysRotateSignedResponseServerError","WASmaxInPreKeysRotateSignedResponseSuccess","WASmaxInPreKeysRotateSignedResponseValidationError","WASmaxOutPreKeysRotateSignedRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){async function a(a,b){a=d("WASmaxOutPreKeysRotateSignedRequest").makeRotateSignedRequest(a);b=await d("WAComms").sendSmaxStanza(a,b);var c=d("WASmaxInPreKeysRotateSignedResponseSuccess").parseRotateSignedResponseSuccess(b,a);if(c.success)return{name:"RotateSignedResponseSuccess",value:c.value};var e=d("WASmaxInPreKeysRotateSignedResponseValidationError").parseRotateSignedResponseValidationError(b,a);if(e.success)return{name:"RotateSignedResponseValidationError",value:e.value};var f=d("WASmaxInPreKeysRotateSignedResponseRequestError").parseRotateSignedResponseRequestError(b,a);if(f.success)return{name:"RotateSignedResponseRequestError",value:f.value};b=d("WASmaxInPreKeysRotateSignedResponseServerError").parseRotateSignedResponseServerError(b,a);if(b.success)return{name:"RotateSignedResponseServerError",value:b.value};throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("RotateSigned",{Success:c,ValidationError:e,RequestError:f,ServerError:b}))}g.sendRotateSignedRPC=a}),98);
__d("WARotateSignedPreKeyProtocol",["WACryptoManager","WAErrorMessage","WAGlobals","WAHandleFailureUtils","WAMakeSignedPreKeyMixin","WAResultOrError","WASmaxPreKeysRotateSignedRPC","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n=d("WATagsLogger").TAGS(["rotateSignedPreKeyProtocol"]);async function a(){n.LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["start generating skey..."])));try{var a=await d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return d("WACryptoManager").generateSignedPreKey(a)},{operationType:"generate_signed_prekey",flush:!0,afterInit:!0});n.LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["generated skey. Start rotating skey..."])));a=await d("WASmaxPreKeysRotateSignedRPC").sendRotateSignedRPC({signedPreKeyMixinArgs:d("WAMakeSignedPreKeyMixin").makeSignedPreKeyMixin(a)});switch(a.name){case"RotateSignedResponseValidationError":var b=a.value,c=b.errorCode,e=b.errorText;b=b.errorIdentityKeyMixin;n.ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["ValidationError: "," ",""])),c,e);return d("WAResultOrError").makeError({type:"validation-error",identity:b.elementValue});case"RotateSignedResponseRequestError":c=a.value.errorRequestErrors.value.code;e=a.value.errorRequestErrors.name;n.ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["RequestError: "," ",""])),c,e);return d("WAResultOrError").makeError({type:"request-error"});case"RotateSignedResponseServerError":b=a.value.errorServerErrors.value.code;c=a.value.errorServerErrors.name;n.ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["ServerError: "," ",""])),b,c);return d("WAResultOrError").makeError({type:"server-error"});default:a.name;n.LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["successfully rotated new skey"])));return d("WAResultOrError").makeResult()}}catch(a){e=d("WAErrorMessage").maybeGetMessageFromError(a);if(e.includes("No lastSignedPrekeyId and registration")){await d("WAHandleFailureUtils").reregisterPhone();return d("WAResultOrError").makeError({type:"no-prekey-reregistered"})}throw a}}g.rotateSignedPreKeyProtocol=a}),98);
__d("WARotateSignedPreKey",["WAGenerateAndUploadPreKeys","WALoggerTag","WARotateSignedPreKeyProtocol","WATagsLogger","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=d("WATagsLogger").TAGS([c("WALoggerTag").SignedPrekeyRotation,c("WALoggerTag").SignedPrekey]);async function a(a){a=await d("WARotateSignedPreKeyProtocol").rotateSignedPreKeyProtocol();if(a.success||a.error.type==="no-prekey-reregistered")return;if(a.error.type==="validation-error"){k.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Signed prekey failed server validation. need to upload all keys."])));d("WAGenerateAndUploadPreKeys").generateAndUploadPreKeys(null,{reason:"signed prekey failed server validation"}).catch(function(a){k.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Error while generating and uploading prekeys: ",""])),a)});return Promise.resolve()}k.ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["rotateSignedPreKey failed."])));throw c("err")("rotateSignedPreKey RPC failed: "+a.error.type)}g.rotateSignedPreKey=a}),98);/*FB_PKG_DELIM*/
__d("AsyncStorage",["Promise","WebAsyncStorage"],(function(a,b,c,d,e,f,g){"use strict";var h;a={getItem:function(a,d){return new(h||(h=b("Promise")))(function(b,e){c("WebAsyncStorage").getItem(a,function(a,c){d&&d(a,c),a!=null?e(a):b(c)})})},removeItem:function(a,d){return new(h||(h=b("Promise")))(function(b,e){c("WebAsyncStorage").removeItem(a,function(a){d&&d(a),a!=null?e(a):b()})})},setItem:function(a,d,e){return new(h||(h=b("Promise")))(function(b,f){c("WebAsyncStorage").setItem(a,d,function(a){e&&e(a),a!=null?f(a):b()})})}};d=a;g["default"]=d}),98);
__d("useBaseTypeaheadSubscriptionDataSourceFetchResolverNetwork",["react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");b.useCallback;var i=b.useEffect,j=b.useRef,k=b.useState;function a(a,b){var c=d("react-compiler-runtime").c(9),e=a.dataSource;a=b===void 0?!1:b;b=k(a);a=b[0];var f=b[1],g=j(null);c[0]!==e?(b=function(a){var b,c=a.onResolvePayload;a=a.requestParams;(b=g.current)==null||b.unsubscribe();g.current=e.fetchNetwork(a).subscribe({complete:function(){f(!1)},error:function(a){f(!1)},next:function(a){return c(a)},start:function(a){f(!0)},unsubscribe:function(){f(!1)}})},c[0]=e,c[1]=b):b=c[1];b=b;var h,l;c[2]===Symbol["for"]("react.memo_cache_sentinel")?(h=function(){return function(){var a;(a=g.current)==null||a.unsubscribe()}},l=[],c[2]=h,c[3]=l):(h=c[2],l=c[3]);i(h,l);c[4]!==a?(h={isLoading:a},c[4]=a,c[5]=h):h=c[5];c[6]!==b||c[7]!==h?(l=[h,b],c[6]=b,c[7]=h,c[8]=l):l=c[8];return l}g["default"]=a}),98);
__d("useBaseTypeaheadSubscriptionDataSourceFetchResolver",["FBLogger","cometTypeaheadODSLogFetchNetworkEvent","react","react-compiler-runtime","useBaseTypeaheadSubscriptionDataSourceFetchResolverNetwork","useDebouncedComet"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");b.useCallback;var i=b.useEffect,j=b.useRef;function a(a,b){var e=d("react-compiler-runtime").c(17),f=a.dataSource,g=a.dataSourceFetchConfigParams,h=a.onResolvePayload;e[0]!==g?(a=g===void 0?{}:g,e[0]=g,e[1]=a):a=e[1];g=a;a=g.requestFlow;g=g.shouldDebounceNetwork;var k=g===void 0?!0:g;e[2]!==f?(g={dataSource:f},e[2]=f,e[3]=g):g=e[3];f=c("useBaseTypeaheadSubscriptionDataSourceFetchResolverNetwork")(g);g=f[0];var l=f[1];f=g.isLoading;var m=c("useDebouncedComet")(l);e[4]!==h?(g=function(a,b){var d=b.isTraceComplete;b=b.source;try{h(a,{isTraceComplete:d,source:b})}catch(a){c("FBLogger")("search").mustfix("Failed to resolve fetched payload")}return b},e[4]=h,e[5]=g):g=e[5];var n=g,o=j(a);e[6]!==n?(g=function(a){n(a,{isTraceComplete:!0,source:a.entries.length>0?"network":"network-no-results"}),c("cometTypeaheadODSLogFetchNetworkEvent")&&c("cometTypeaheadODSLogFetchNetworkEvent")("comet.ta.fetch",!0,1)},e[6]=n,e[7]=g):g=e[7];var p=g;e[8]!==l||e[9]!==m||e[10]!==b||e[11]!==p||e[12]!==k?(a=function(){var a=function(a){a=a.requestParams;var b=a.requestFlow;b!=null&&(o.current=b);b={onResolvePayload:p,requestParams:babelHelpers["extends"]({},a,{requestFlow:o.current})};Boolean(k)?m(b):l(b)};b!=null&&a(b)},g=[l,m,b,p,k],e[8]=l,e[9]=m,e[10]=b,e[11]=p,e[12]=k,e[13]=a,e[14]=g):(a=e[13],g=e[14]);i(a,g);e[15]!==f?(a=[{isLoading:f}],e[15]=f,e[16]=a):a=e[16];return a}g["default"]=a}),98);
__d("useBaseTypeaheadSubscriptionDataSourceFetch",["react","react-compiler-runtime","recoverableViolation","useBaseTypeaheadSubscriptionDataSourceFetchResolver"],(function(a,b,c,d,e,f,g){"use strict";var h=["loggingEventTrace"],i;b=i||d("react");b.useCallback;var j=b.useState;function a(a){var b,e=d("react-compiler-runtime").c(9),f=j(null),g=f[0],i=f[1];f=c("useBaseTypeaheadSubscriptionDataSourceFetchResolver")(a,g);a=f[0];f=a.isLoading;e[0]===Symbol["for"]("react.memo_cache_sentinel")?(a=function(a,b){b=b===void 0?"all":b;i({requestParams:a,source:b})},e[0]=a):a=e[0];var k=a;e[1]!==g?(a=function(a){a=a||{};var b=a.requestFlow;a=a.source;if(g==null){c("recoverableViolation")("Refetch cannot be called with undefined `fetchParams`","search");return}var d=g.requestParams,e=d.loggingEventTrace;d=babelHelpers.objectWithoutPropertiesLoose(d,h);e=babelHelpers["extends"]({loggingEventTrace:babelHelpers["extends"]({},e,{sequenceID:String(Date.now())}),requestFlow:b},d);k(e,a)},e[1]=g,e[2]=a):a=e[2];a=a;b=(b=g==null?void 0:g.source)!=null?b:"all";var l;e[3]!==f||e[4]!==b?(l={isLoading:f,source:b},e[3]=f,e[4]=b,e[5]=l):l=e[5];e[6]!==a||e[7]!==l?(f=[l,k,a],e[6]=a,e[7]=l,e[8]=f):f=e[8];return f}g["default"]=a}),98);
__d("TypeaheadLoggingFetchRequestFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1880031");b=d("FalcoLoggerInternal").create("typeahead_logging_fetch_request",a);e=b;g["default"]=e}),98);
__d("CometTypeaheadVolumeLoggingProvider",["FBLogger","TypeaheadLoggingFetchRequestFalcoEvent"],(function(a,b,c,d,e,f,g){"use strict";var h=function(){return Math.random().toString()};a=function(){function a(a){this.$2=null,this.$1=a,this.$2=h()}var b=a.prototype;b.getContext=function(){return this.$1};b.getSessionID=function(){this.$2==null&&c("FBLogger")("search").mustfix("Logging sessionID requested from %s surface does not exist.",this.getContext());return this.$2};b.logRequest=function(a){var b={context:this.getContext(),requestType:a,sessionID:this.getSessionID()};c("TypeaheadLoggingFetchRequestFalcoEvent").log(function(){return{fetchRequest:b}})};return a}();g["default"]=a}),98);
__d("useCometTypeaheadVolumeLoggingProvider",["CometTypeaheadVolumeLoggingProvider","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h;(h||d("react")).useMemo;function a(a){var b=d("react-compiler-runtime").c(2);a=a===void 0?"UNKNOWN":a;var e;b[0]!==a?(e=new(c("CometTypeaheadVolumeLoggingProvider"))(a),b[0]=a,b[1]=e):e=b[1];a=e;return a}g["default"]=a}),98);
__d("CometInternalTypeaheadSubscriptionProvider",["CometInternalTypeaheadEmptyFetchProvider","CometInternalTypeaheadFetchContext","react","useBaseTypeaheadSubscriptionDataSourceFetch","useCometInternalTypeaheadStateDispatcher","useCometTypeaheadVolumeLoggingProvider","vulture"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));b=h;var j=b.useCallback,k=b.useMemo;function a(a){var b=a.children,d=a.dataSource,e=a.dataSourceFetchConfigParams,f=a.loggingContext,g=a.onFetchEntries_DO_NOT_USE,h=a.traceProvider;c("vulture")("SNeJuoEfVBbkA-25BBPuZ9aStXE=");a=c("useCometInternalTypeaheadStateDispatcher")();var l=a.dispatchActiveEntries,m=c("useCometTypeaheadVolumeLoggingProvider")(f);a=c("useBaseTypeaheadSubscriptionDataSourceFetch")({dataSource:d,dataSourceFetchConfigParams:e,onResolvePayload:j(function(a,b){a=a.entries;var c=b.isTraceComplete;b=b.source;l(a!=null?a:[]);m.logRequest(o);g&&g(a);h&&!h.isResolved()&&(c&&(b==="cache"&&a.length>=h.getEntriesCountForVisualComplete()?h.setEndReason("max_suggestions_reached"):b==="network"?h.setEndReason("all_queries_completed"):b==="network-no-results"&&h.setEndReason("all_queries_completed_no_network_results"),h.resolve()))},[l,g,h])});f=a[0];var n=f.isLoading,o=f.source,p=a[1],q=a[2];d=k(function(){return{fetch:p,isLoading:n,refetch:q,source:o}},[p,n,q,o]);return i.jsx(c("CometInternalTypeaheadFetchContext").Provider,{value:d,children:i.jsx(c("CometInternalTypeaheadEmptyFetchProvider"),{isLoading:n,source:o,children:b})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("BaseSubscriptionTypeahead.react",["CometHeroInteractionContextPassthrough.react","CometInternalTypeahead.react","CometInternalTypeaheadStateProvider","CometInternalTypeaheadSubscriptionProvider","emptyFunction","react","withCometTypeaheadInputStrategyShouldQueryStringFollowHighlightedEntry"],(function(a,b,c,d,e,f,g){"use strict";var h=["autoOpen","autoFocus","isDisabled","errorMessage","inputStrategyRenderer","dataSource","dataSourceFetchConfigParams","decorators","emptyEntries_DO_NOT_USE","id","label","loggingContext","onBackspace","onBlur","onChange","onClose","onEnter","onEscape","onFetchEntries_DO_NOT_USE","onFocus","onOpen","onPressEntry","placeholder","shouldQueryStringFollowHighlightedEntry","shouldQueryStringUpdateFromSelectedEntryOnClick","testid","traceProvider","inputRef","viewRole","viewStrategyRenderer"],i,j=i||(i=d("react"));b=i;var k=b.useCallback,l=b.useId,m=b.useMemo;function a(a){var b=a.autoOpen;b=b===void 0?!1:b;var d=a.autoFocus;d=d===void 0?!1:d;var e=a.isDisabled;e=e===void 0?!1:e;var f=a.errorMessage;f=f===void 0?null:f;var g=a.inputStrategyRenderer,i=a.dataSource,n=a.dataSourceFetchConfigParams,o=a.decorators,p=o===void 0?[]:o;o=a.emptyEntries_DO_NOT_USE;var q=a.id,r=a.label;r=r===void 0?"":r;var s=a.loggingContext,t=a.onBackspace;t=t===void 0?c("emptyFunction"):t;var u=a.onBlur;u=u===void 0?c("emptyFunction"):u;var v=a.onChange,w=a.onClose;w=w===void 0?c("emptyFunction"):w;var x=a.onEnter;x=x===void 0?c("emptyFunction"):x;var y=a.onEscape;y=y===void 0?c("emptyFunction"):y;var z=a.onFetchEntries_DO_NOT_USE,A=a.onFocus;A=A===void 0?c("emptyFunction"):A;var B=a.onOpen;B=B===void 0?c("emptyFunction"):B;var C=a.onPressEntry,D=a.placeholder;D=D===void 0?"":D;var E=a.shouldQueryStringFollowHighlightedEntry,F=E===void 0?!0:E;E=a.shouldQueryStringUpdateFromSelectedEntryOnClick;var G=E===void 0?!0:E;E=a.testid;E=E===void 0?"":E;E=a.traceProvider;var H=a.inputRef,I=a.viewRole;I=I===void 0?"listbox":I;var J=a.viewStrategyRenderer;a=babelHelpers.objectWithoutPropertiesLoose(a,h);var K=l(),L=m(function(){var a=c("CometInternalTypeahead.react");p.forEach(function(b){var c=b.decorate;b=b.params;a=c(a,b)});return a},[p]),M=k(function(a){G&&v(a.label),C&&C(a)},[v,C,G]),N=m(function(){return c("withCometTypeaheadInputStrategyShouldQueryStringFollowHighlightedEntry")(g,{shouldQueryStringFollowHighlightedEntry:F})},[g,F]);r=r||D;return j.jsx(c("CometHeroInteractionContextPassthrough.react"),{clear:!0,children:j.jsx(c("CometInternalTypeaheadStateProvider"),{autoOpen:b,emptyEntries_DO_NOT_USE:o,onClose:w,onOpen:B,children:j.jsx(c("CometInternalTypeaheadSubscriptionProvider"),{dataSource:i,dataSourceFetchConfigParams:n,loggingContext:s,onFetchEntries_DO_NOT_USE:z,traceProvider:E,children:j.jsx(L,babelHelpers["extends"]({},a,{autoFocus:d,errorMessage:f,id:q!=null?q:K,inputRef:H,inputStrategyRenderer:N,isDisabled:e,label:r,onBackspace:t,onBlur:u,onChange:v,onDownArrow:c("emptyFunction"),onEnter:x,onEscape:y,onFocus:A,onHighlightEntry:c("emptyFunction"),onPressEntry:M,onShiftTab:c("emptyFunction"),onTab:c("emptyFunction"),onUpArrow:c("emptyFunction"),placeholder:D,testid:void 0,viewRole:I,viewStrategyRenderer:J}))})})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("CancellablePromise",["Promise","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i="CancellationToken.TokenCancelled";function a(a,d,e){return e.then(function(e){return a.isCancelled()?(h||(h=b("Promise"))).reject(c("err")(i)):d(e)})}function d(a,d){return d["catch"](function(d){return d instanceof Error&&d.message===i?(h||(h=b("Promise"))).resolve(a):(h||(h=b("Promise"))).reject(c("err"))})}g.then_=a;g.ignoreFailed=d}),98);
__d("CancellationToken",[],(function(a,b,c,d,e,f){"use strict";function a(){var a={contents:!1};return{cancel:function(){a.contents=!0},isCancelled:function(){return a.contents}}}f["default"]=a}),66);
__d("MWTopNavListDropdownTitle.react",["fbt","BaseHeading.react","Locale","MWXCircleButton.react","MWXIconArrowLeft","MWXIconArrowRight","MWXRow.react","MWXRowItem.react","MWXText.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react"),k=[];function a(a){var b=d("react-compiler-runtime").c(16),e=a.actions,f=a.onReturn,g=a.testid;a=a.title;e=e===void 0?k:e;var i;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(i={className:"x6s0dn4 x78zum5 x2lah0s x1qughib x21xpn4 x1whwgri x1hndj7l xdwfu72 xnx504b"},b[0]=i):i=b[0];var m;b[1]!==f?(m=f!=null?j.jsx(c("MWXRowItem.react"),{children:j.jsx(c("MWXCircleButton.react"),{icon:d("Locale").isRTL()?c("MWXIconArrowRight"):c("MWXIconArrowLeft"),iconRatio:"large",label:h._(/*BTDS*/"Back"),onPress:f,size:32,type:"deemphasized"})}):null,b[1]=f,b[2]=m):m=b[2];b[3]!==a?(f=j.jsx(c("MWXRowItem.react"),{verticalAlign:"center",children:j.jsx(c("BaseHeading.react"),{isPrimaryHeading:!0,children:j.jsx(c("MWXText.react"),{type:"headlineEmphasized1",children:a})})}),b[3]=a,b[4]=f):f=b[4];b[5]!==m||b[6]!==f?(a=j.jsxs(c("MWXRow.react"),{paddingHorizontal:0,paddingTop:0,spacingHorizontal:8,children:[m,f]}),b[5]=m,b[6]=f,b[7]=a):a=b[7];b[8]!==e?(m=e.map(l),b[8]=e,b[9]=m):m=b[9];b[10]!==m?(f=j.jsx(c("MWXRow.react"),{paddingHorizontal:0,paddingTop:0,spacingHorizontal:8,children:m}),b[10]=m,b[11]=f):f=b[11];b[12]!==a||b[13]!==f||b[14]!==g?(e=j.jsxs("header",babelHelpers["extends"]({},i,{"data-testid":void 0,children:[a,f]})),b[12]=a,b[13]=f,b[14]=g,b[15]=e):e=b[15];return e}function l(a,b){return j.jsx(c("MWXRowItem.react"),{children:a},b)}l.displayName=l.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("CometMessagingJewelDropdownContentGlimmer.react",["FDSListCellGlimmer.react","MWTopNavListDropdownTitle.react","emptyFunction","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=d("react-compiler-runtime").c(9),e=a.isFullHeight,f=a.title;a=a.withBackButton;e=e===void 0?!1:e;a=a===void 0?!1:a;var g;b[0]!==e?(g={0:{},1:{className:"x9f619 x20eyyc xvv7f4i x1cvmir6"}}[!!e<<0],b[0]=e,b[1]=g):g=b[1];b[2]!==f||b[3]!==a?(e=f!=null&&i.jsx(c("MWTopNavListDropdownTitle.react"),{onReturn:a?c("emptyFunction"):void 0,title:f}),b[2]=f,b[3]=a,b[4]=e):e=b[4];b[5]===Symbol["for"]("react.memo_cache_sentinel")?(f=i.jsx(c("FDSListCellGlimmer.react"),{imageSize:56,imageStyle:"circle",numberOfItems:Math.max(Math.ceil((window.innerHeight-72-45)/76),1)}),b[5]=f):f=b[5];b[6]!==g||b[7]!==e?(a=i.jsxs("div",babelHelpers["extends"]({},g,{children:[e,f]})),b[6]=g,b[7]=e,b[8]=a):a=b[8];return a}g["default"]=a}),98);
__d("CometMessagingJewelDropdownEBUpsellContainerQuery.graphql",["CometMessagingJewelDropdownEBUpsellContainerQuery_facebookRelayOperation","MWEBNewUserOnboardingShouldLoadUpsells.relayprovider","relay-runtime"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},d={alias:null,args:null,concreteType:"MessengerDefaultEncryptedBackup",kind:"LinkedField",name:"messenger_default_encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"VestaGetUserInfoResponse",kind:"LinkedField",name:"vesta_user_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"attempts_remaining",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_registered",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"login_timeout_remaining_secs",storageKey:null}],storageKey:null}],storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"CometMessagingJewelDropdownEBUpsellContainerQuery",selections:[{args:null,kind:"FragmentSpread",name:"MWEncryptedBackupsJewelNuxWrapper_query"},{kind:"RequiredField",field:{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"CometMessagingJewelDropdownQPBannerContainer_viewer"}],storageKey:null},action:"THROW",path:"viewer"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[{defaultValue:null,kind:"LocalArgument",name:"__relay_internal__pv__MWEBNewUserOnboardingShouldLoadUpsellsrelayprovider"}],kind:"Operation",name:"CometMessagingJewelDropdownEBUpsellContainerQuery",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"client_generated_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null},a],storageKey:null},{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'},a,c],storageKey:null},{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[d,{condition:"__relay_internal__pv__MWEBNewUserOnboardingShouldLoadUpsellsrelayprovider",kind:"Condition",passingValue:!0,selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"if_viewer_can_see_messenger_eb_new_user_onboarding_upsells",plural:!1,selections:[{args:null,documentName:"MWEncryptedBackupsJewelNuxWrapper_query",fragmentName:"MWEBNewUserOnboardingThreadListUpsellWrapper_viewer",fragmentPropName:"viewer",kind:"ModuleImport"}],storageKey:null}]},{kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"backup_state",storageKey:null}]},{alias:"jewel_qp",args:[{kind:"Literal",name:"surface_nux_id",value:8439},{kind:"Literal",name:"trigger",value:"MESSAGING_JEWEL_OPEN"}],concreteType:"ViewerEligibleQuickPromotionsConnection",kind:"LinkedField",name:"eligible_promotions",plural:!1,selections:[{alias:null,args:null,concreteType:"QuickPromotion",kind:"LinkedField",name:"nodes",plural:!0,selections:[{alias:null,args:null,concreteType:"CometQuickPromotionSections",kind:"LinkedField",name:"comet_qp_sections",plural:!1,selections:[{alias:null,args:[{kind:"Literal",name:"supported",value:"7v0g"}],concreteType:null,kind:"LinkedField",name:"renderer_strategy",plural:!1,selections:[c,{kind:"InlineFragment",selections:[{args:null,documentName:"CometMessagingJewelDropdownQPBannerContainer_viewer",fragmentName:"CometQuickPromotionMessengerDesktopDownloadBannerRendererStrategy_cometQuickPromotionBaseStrategy",fragmentPropName:"cometQuickPromotionBaseStrategy",kind:"ModuleImport"}],type:"CometQuickPromotionMessengerDesktopDownloadBannerRendererStrategy",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometMessagingJewelDropdownQPBannerContainer_viewer",fragmentName:"CometQuickPromotionMWXCardRendererStrategy_strategy",fragmentPropName:"strategy",kind:"ModuleImport"}],type:"CometQuickPromotionMWXCardRendererStrategy",abstractKey:null}],storageKey:'renderer_strategy(supported:"7v0g")'}],storageKey:null},a],storageKey:null}],storageKey:'eligible_promotions(surface_nux_id:8439,trigger:"MESSAGING_JEWEL_OPEN")'}],storageKey:null},{"if":null,kind:"Defer",label:"MWEncryptedBackupsJewelNuxWrapper_query$defer$MWEncryptedBackupsThreadListRestoreQPWrapperDeferred_query",selections:[{"if":null,kind:"Defer",label:"MWEncryptedBackupsThreadListRestoreQPWrapperDeferred_query$defer$MWEncryptedBackupsThreadListRestoreQPWrapper_query",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[d,{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"has_seen_eb_auto_restore_notice",storageKey:null},a],storageKey:null},{kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"qp_with_pin_state",storageKey:null}]}],storageKey:null}]}]}]},params:{id:b("CometMessagingJewelDropdownEBUpsellContainerQuery_facebookRelayOperation"),metadata:{},name:"CometMessagingJewelDropdownEBUpsellContainerQuery",operationKind:"query",text:null,providedVariables:{__relay_internal__pv__MWEBNewUserOnboardingShouldLoadUpsellsrelayprovider:b("MWEBNewUserOnboardingShouldLoadUpsells.relayprovider")}}}}();b("relay-runtime").PreloadableQueryRegistry.set(a.params.id,a);e.exports=a}),null);
__d("CometMessagingJewelDropdownQPBannerContainer_viewer.graphql",[],(function(a,b,c,d,e,f){"use strict";a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"CometMessagingJewelDropdownQPBannerContainer_viewer",selections:[{alias:"jewel_qp",args:[{kind:"Literal",name:"surface_nux_id",value:8439},{kind:"Literal",name:"trigger",value:"MESSAGING_JEWEL_OPEN"}],concreteType:"ViewerEligibleQuickPromotionsConnection",kind:"LinkedField",name:"eligible_promotions",plural:!1,selections:[{alias:null,args:null,concreteType:"QuickPromotion",kind:"LinkedField",name:"nodes",plural:!0,selections:[{alias:null,args:null,concreteType:"CometQuickPromotionSections",kind:"LinkedField",name:"comet_qp_sections",plural:!1,selections:[{alias:null,args:[{kind:"Literal",name:"supported",value:"7v0g"}],concreteType:null,kind:"LinkedField",name:"renderer_strategy",plural:!1,selections:[{kind:"InlineFragment",selections:[{args:null,documentName:"CometMessagingJewelDropdownQPBannerContainer_viewer",fragmentName:"CometQuickPromotionMessengerDesktopDownloadBannerRendererStrategy_cometQuickPromotionBaseStrategy",fragmentPropName:"cometQuickPromotionBaseStrategy",kind:"ModuleImport"}],type:"CometQuickPromotionMessengerDesktopDownloadBannerRendererStrategy",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometMessagingJewelDropdownQPBannerContainer_viewer",fragmentName:"CometQuickPromotionMWXCardRendererStrategy_strategy",fragmentPropName:"strategy",kind:"ModuleImport"}],type:"CometQuickPromotionMWXCardRendererStrategy",abstractKey:null}],storageKey:'renderer_strategy(supported:"7v0g")'}],storageKey:null}],storageKey:null}],storageKey:'eligible_promotions(surface_nux_id:8439,trigger:"MESSAGING_JEWEL_OPEN")'}],type:"Viewer",abstractKey:null};e.exports=a}),null);
__d("CometMessagingJewelDropdownQPBannerContainer.react",["CometMessagingJewelDropdownQPBannerContainer_viewer.graphql","CometMessagingJewelDropdownQPBannerPlaceholder.react","CometPageletWithDiv.react","CometQuickPromotionLoggerContext.react","CometRelay","react","react-compiler-runtime","useQuickPromotionFalcoEvent"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=i||d("react");function a(a){var e,f,g=d("react-compiler-runtime").c(9);a=a.viewer;a=d("CometRelay").useFragment(h!==void 0?h:h=b("CometMessagingJewelDropdownQPBannerContainer_viewer.graphql"),a);var i;g[0]===Symbol["for"]("react.memo_cache_sentinel")?(i={context_surface_id:8439,context_trigger:"messaging_jewel_open"},g[0]=i):i=g[0];i=c("useQuickPromotionFalcoEvent")(i);var l;if(g[1]!==(a==null||(e=a.jewel_qp)==null?void 0:e.nodes)){var m,n;l=a==null||(m=a.jewel_qp)==null||(m=m.nodes)==null?void 0:m.find(k);g[1]=a==null||(n=a.jewel_qp)==null?void 0:n.nodes;g[2]=l}else l=g[2];a=l;l=a==null||(f=a.comet_qp_sections)==null?void 0:f.renderer_strategy;if(l==null)return null;g[3]===Symbol["for"]("react.memo_cache_sentinel")?(a=j.jsx(c("CometMessagingJewelDropdownQPBannerPlaceholder.react"),{}),g[3]=a):a=g[3];var o;g[4]!==l?(o=j.jsx(d("CometRelay").MatchContainer,{match:l}),g[4]=l,g[5]=o):o=g[5];g[6]!==i||g[7]!==o?(l=j.jsx(d("CometPageletWithDiv.react").Placeholder,{fallback:a,name:"CometMessagingJewelDropdownQPBannerContainer",children:j.jsx(c("CometQuickPromotionLoggerContext.react").Provider,{value:i,children:o})}),g[6]=i,g[7]=o,g[8]=l):l=g[8];return l}function k(a){return((a=a.comet_qp_sections)==null?void 0:a.renderer_strategy)!=null}g["default"]=a}),98);
__d("MWEncryptedBackupsJewelNuxWrapperDeferred.react",["deferredLoadComponent","react","requireDeferredForDisplay"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j=c("deferredLoadComponent")(c("requireDeferredForDisplay")("MWEncryptedBackupsJewelNuxWrapper.react").__setRef("MWEncryptedBackupsJewelNuxWrapperDeferred.react"));function a(a){return i.jsx(j,babelHelpers["extends"]({},a))}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWInboxQuickPromotionWrapper.react",["CometErrorBoundary.react","CometPageletWithDiv.react","deferredLoadComponent","react","react-compiler-runtime","requireDeferredForDisplay"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j=c("deferredLoadComponent")(c("requireDeferredForDisplay")("MAWUserVisibleErrorsNuxWrapper.react").__setRef("MWInboxQuickPromotionWrapper.react"));function a(a){var b=d("react-compiler-runtime").c(5),e=a.children;a=a.onError;var f;b[0]!==e?(f=i.jsx(d("CometPageletWithDiv.react").Placeholder,{fallback:null,name:"MWInboxQuickPromotionWrapper",children:i.jsx(j,{children:e})}),b[0]=e,b[1]=f):f=b[1];b[2]!==a||b[3]!==f?(e=i.jsx(c("CometErrorBoundary.react"),{onError:a,children:f}),b[2]=a,b[3]=f,b[4]=e):e=b[4];return e}g["default"]=a}),98);
__d("CometMessagingJewelDropdownEBUpsellContainer.react",["CometMessagingJewelDropdownEBUpsellContainerQuery.graphql","CometMessagingJewelDropdownQPBannerContainer.react","CometRelay","FBLogger","MWEncryptedBackupsJewelNuxWrapperDeferred.react","MWInboxContextSwitcherUtils","MWInboxQuickPromotionWrapper.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=i||d("react");function a(a){var b=d("react-compiler-runtime").c(4),e=a.ebSoftblockUpsell,f=a.ebUpsellContainerQueryRef;a=a.selectedFilterTab;var g;b[0]!==e||b[1]!==f||b[2]!==a?(g=d("MWInboxContextSwitcherUtils").shouldShowEBUpsellFromFilter(a)&&e==null?j.jsx(c("MWInboxQuickPromotionWrapper.react"),{onError:k,children:j.jsx(l,{ebUpsellContainerQueryRef:f})}):null,b[0]=e,b[1]=f,b[2]=a,b[3]=g):g=b[3];return g}function k(a){c("FBLogger")("messenger_web_entrypoints").catching(a).mustfix("CometMessagingJewelDropdownQPBannerContainer failed to render")}function l(a){var e=d("react-compiler-runtime").c(5);a=a.ebUpsellContainerQueryRef;a=d("CometRelay").usePreloadedQuery(h!==void 0?h:h=b("CometMessagingJewelDropdownEBUpsellContainerQuery.graphql"),a);var f;e[0]!==a.viewer?(f=j.jsx(c("CometMessagingJewelDropdownQPBannerContainer.react"),{viewer:a.viewer}),e[0]=a.viewer,e[1]=f):f=e[1];var g;e[2]!==a||e[3]!==f?(g=j.jsx(c("MWEncryptedBackupsJewelNuxWrapperDeferred.react"),{query:a,children:f}),e[2]=a,e[3]=f,e[4]=g):g=e[4];return g}g["default"]=a}),98);
__d("MWInboxContextSwitcherDeferred.react",["deferredLoadComponent","react","react-compiler-runtime","requireDeferredForDisplay"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j=c("deferredLoadComponent")(c("requireDeferredForDisplay")("MWInboxContextSwitcher.react").__setRef("MWInboxContextSwitcherDeferred.react"));function a(a){var b=d("react-compiler-runtime").c(2),c;b[0]!==a?(c=i.jsx(j,babelHelpers["extends"]({},a)),b[0]=a,b[1]=c):c=b[1];return c}g["default"]=a}),98);
__d("MWInboxContextSwitcherGlimmer.react",["MDSGlimmer.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j={tabPlaceholder:{borderStartStartRadius:"x1xn7y0n",borderStartEndRadius:"x1uxb8k9",borderEndEndRadius:"x1vmbcc8",borderEndStartRadius:"x16xm01d",display:"x78zum5",flexDirection:"xdt5ytf",flexGrow:"x1iyjqo2",justifyContent:"xl56j7k",$$css:!0}};function a(){var a=d("react-compiler-runtime").c(1),b;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b=i.jsx("div",{className:"x78zum5 xu0aao5 x1y1aw1k xwib8y2 xf7dkkf xv54qhq x3bhodz",children:i.jsx(c("MDSGlimmer.react"),{index:0,xstyle:j.tabPlaceholder})}),a[0]=b):b=a[0];return b}g["default"]=a}),98);
__d("MWInboxTrayContainer.react",["MWInboxTrayGating","cr:17196","react","react-compiler-runtime","useMatchViewport"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j=512;function a(a){var c=d("react-compiler-runtime").c(3),e=a.mwInboxTrayContainerQuery;a=a.onClose;var f=k();if(e==null)return null;if(!d("MWInboxTrayGating").isInboxTrayEnabled())return null;if(f)return null;c[0]!==e||c[1]!==a?(f=b("cr:17196")!=null?i.jsx(b("cr:17196"),{mwInboxTrayContainerQuery:e,onClose:a}):null,c[0]=e,c[1]=a,c[2]=f):f=c[2];return f}e=i.memo(a);function k(){var a=c("useMatchViewport")("max","height",j);return a}g["default"]=e}),98);
__d("FDSResizeFreeFilled20Icon",["cr:15603"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=b("cr:15603")}),98);
__d("MWJewelDropdownHeaderSeeAllButton.react",["fbt","FDSCircleButton.react","FDSResizeFreeFilled20Icon","FDSTooltip.react","MWFacebookUserWithoutMessengerAccess","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react");function a(a){var b=d("react-compiler-runtime").c(12),e=a.onClose,f=a.testid;a=a.url;var g=d("MWFacebookUserWithoutMessengerAccess").useIsFacebookUserWithoutMessengerAccess(),i;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(i=h._(/*BTDS*/"See all in Messenger"),b[0]=i):i=b[0];i=i;var k;b[1]===Symbol["for"]("react.memo_cache_sentinel")?(k=h._(/*BTDS*/"See all messages"),b[1]=k):k=b[1];k=k;g=g?k:i;b[2]!==a?(k={url:a},b[2]=a,b[3]=k):k=b[3];b[4]!==g||b[5]!==e||b[6]!==k||b[7]!==f?(i=j.jsx(c("FDSCircleButton.react"),{color_DEPRECATED:"secondary",icon:c("FDSResizeFreeFilled20Icon"),label:g,linkProps:k,onPress:e,size:32,testid:void 0,type_DEPRECATED:"deemphasized"}),b[4]=g,b[5]=e,b[6]=k,b[7]=f,b[8]=i):i=b[8];b[9]!==g||b[10]!==i?(a=j.jsx(c("FDSTooltip.react"),{align:"end",tooltip:g,children:i}),b[9]=g,b[10]=i,b[11]=a):a=b[11];return a}g["default"]=a}),226);
__d("useMWJewelSettingsButtonBadge",["cr:4042","react"],(function(a,b,c,d,e,f,g){"use strict";var h;h||d("react");function a(){var a;a=(a=b("cr:4042")==null?void 0:b("cr:4042")())!=null?a:{};a=a.badge;a=a===void 0?null:a;return{badge:a,onButtonPress:function(){}}}g["default"]=a}),98);
__d("MWJewelDropdownHeader.react",["fbt","CometHomeChatSettings.entrypoint","FDSCircleButton.react","FDSComposeFilled16Icon","FDSDots3HorizontalFilled20Icon","FDSEntryPointPopoverTrigger.react","FDSTooltip.react","LSThreadAttributionStore","MWJewelDropdownHeaderSeeAllButton.react","MWJewelPopoverDialogContext.react","MWPSearchSystem","MWTopNavListDropdownTitle.react","MessengerWebUXLogger","emptyFunction","qex","react","react-compiler-runtime","useCometPreloader","useMWChatOpenNewTab","useMWJewelSettingsButtonBadge","useMWNewChatTabContainerPreload","useReStore","useShouldShowMessagingEntrypointInCometRoot"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=j||(j=d("react"));b=j;b.useCallback;var l=b.useContext;function m(a){var b=d("react-compiler-runtime").c(13),e=a.onOpenArchivedChats,f=a.onOpenMessageRequests;a=a.onOpenRestrictedAccountsList;var g;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(g=h._(/*BTDS*/"Options"),b[0]=g):g=b[0];var i=g;g=l(c("MWJewelPopoverDialogContext.react"));var j=g.setIsOpenForDialog;g=c("useMWJewelSettingsButtonBadge")();var m=g.badge,n=g.onButtonPress;g=c("qex")._("760")?"button_aggressive":"button";var o;b[1]===Symbol["for"]("react.memo_cache_sentinel")?(o={},b[1]=o):o=b[1];e=e!=null?e:void 0;f=f!=null?f:void 0;a=a!=null?a:void 0;var p;b[2]!==e||b[3]!==f||b[4]!==a?(p={onOpenArchivedChats:e,onOpenMessageRequests:f,onOpenRestrictedAccountsList:a},b[2]=e,b[3]=f,b[4]=a,b[5]=p):p=b[5];b[6]!==m||b[7]!==n||b[8]!==j?(e=function(a,b,d,e,f,g){return k.jsxs(c("FDSTooltip.react"),{align:"end",tooltip:i,children:[m,k.jsx(c("FDSCircleButton.react"),{color_DEPRECATED:"secondary",icon:c("FDSDots3HorizontalFilled20Icon"),label:i,onHoverIn:e,onHoverOut:f,onPress:function(){j(!1),b(),n()},onPressIn:g,ref:a,size:32,testid:void 0,type_DEPRECATED:"deemphasized"})]})},b[6]=m,b[7]=n,b[8]=j,b[9]=e):e=b[9];b[10]!==p||b[11]!==e?(f=k.jsx(c("FDSEntryPointPopoverTrigger.react"),{align:"end",entryPointParams:o,otherProps:p,popoverEntryPoint:c("CometHomeChatSettings.entrypoint"),position:"below",preloadTrigger:g,children:e}),b[10]=p,b[11]=e,b[12]=f):f=b[12];return f}function a(a){var b=d("react-compiler-runtime").c(35),e=a.inboxUrl,f=a.onClose,g=a.onOpenArchivedChats,j=a.onOpenMessageRequests,l=a.onOpenRestrictedAccountsList,n=a.onReturn;a=a.title;var o=c("useShouldShowMessagingEntrypointInCometRoot")("CHAT"),p=c("useMWChatOpenNewTab")("jewelNewMessage"),q=c("MessengerWebUXLogger").useInteractionLogger(),r;b[0]!==o||b[1]!==q||b[2]!==f||b[3]!==p?(r=function(){d("LSThreadAttributionStore").setSourceForNewThread("jewelNewMessage"),o&&(p(!1),f()),q==null||q({eventName:"create_thread"})},b[0]=o,b[1]=q,b[2]=f,b[3]=p,b[4]=r):r=b[4];r=r;var s=c("useMWNewChatTabContainerPreload")(),t=s[0],u=s[1],v=(i||(i=c("useReStore")))();b[5]!==v?(s=function(){return d("MWPSearchSystem").makeAll(v)},b[5]=v,b[6]=s):s=b[6];s=s;var w=c("useCometPreloader")("button_aggressive",c("emptyFunction"),s),x=w.onHoverInPreloader,y=w.onHoverMovePreloader,z=w.onHoverOutPreloader;b[7]===Symbol["for"]("react.memo_cache_sentinel")?(w=h._(/*BTDS*/"New message"),b[7]=w):w=b[7];w=w;var A;b[8]!==g||b[9]!==j||b[10]!==l?(A=k.jsx(m,{onOpenArchivedChats:g,onOpenMessageRequests:j,onOpenRestrictedAccountsList:l},"mw-jewel-settings"),b[8]=g,b[9]=j,b[10]=l,b[11]=A):A=b[11];b[12]!==e||b[13]!==f?(g=k.jsx(c("MWJewelDropdownHeaderSeeAllButton.react"),{onClose:f,testid:void 0,url:e},"mw-jewel-see-all-button"),b[12]=e,b[13]=f,b[14]=g):g=b[14];b[15]!==t||b[16]!==x?(j=function(a){t(a),x(a)},b[15]=t,b[16]=x,b[17]=j):j=b[17];b[18]!==u||b[19]!==z?(l=function(){u(),z()},b[18]=u,b[19]=z,b[20]=l):l=b[20];b[21]!==r||b[22]!==s||b[23]!==y||b[24]!==j||b[25]!==l?(e=k.jsx(c("FDSTooltip.react"),{align:"end",tooltip:w,children:k.jsx(c("FDSCircleButton.react"),{color_DEPRECATED:"secondary",icon:c("FDSComposeFilled16Icon"),label:w,onFocusIn:s,onHoverIn:j,onHoverMove:y,onHoverOut:l,onPress:r,role:"button",size:32,testid:void 0,type_DEPRECATED:"deemphasized"})},"mw-jewel-new-message"),b[21]=r,b[22]=s,b[23]=y,b[24]=j,b[25]=l,b[26]=e):e=b[26];b[27]!==A||b[28]!==g||b[29]!==e?(w=[A,g,e].filter(Boolean),b[27]=A,b[28]=g,b[29]=e,b[30]=w):w=b[30];b[31]!==n||b[32]!==w||b[33]!==a?(r=k.jsx(c("MWTopNavListDropdownTitle.react"),{actions:w,onReturn:n,title:a}),b[31]=n,b[32]=w,b[33]=a,b[34]=r):r=b[34];return r}g["default"]=a}),226);
__d("MWJewelMessengerLink.react",["fbt","MWFacebookUserWithoutMessengerAccess","MWXLink.react","MWXText.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react");function a(a){var b=d("react-compiler-runtime").c(8),e=a.onClick;a=a.url;var f=d("MWFacebookUserWithoutMessengerAccess").useIsFacebookUserWithoutMessengerAccess(),g;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(g=h._(/*BTDS*/"See all in Messenger"),b[0]=g):g=b[0];g=g;var i;b[1]===Symbol["for"]("react.memo_cache_sentinel")?(i=h._(/*BTDS*/"See all messages"),b[1]=i):i=b[1];i=i;f=f?i:g;b[2]===Symbol["for"]("react.memo_cache_sentinel")?(i={className:"xlsxne2 x1l90r2v x1i80of2"},b[2]=i):i=b[2];b[3]===Symbol["for"]("react.memo_cache_sentinel")?(g={inboxEntrypoint:"jewelLink"},b[3]=g):g=b[3];b[4]!==f||b[5]!==e||b[6]!==a?(i=j.jsx("div",babelHelpers["extends"]({},i,{"data-testid":void 0,children:j.jsx(c("MWXText.react"),{align:"center",color:"blueLink",type:"bodyLink3",children:j.jsx(c("MWXLink.react"),{href:a,onClick:e,traceParams:g,children:f})})})),b[4]=f,b[5]=e,b[6]=a,b[7]=i):i=b[7];return i}g["default"]=a}),226);
__d("MWJewelNestedFolderThreadListHeader.react",["MWTopNavListDropdownTitle.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=d("react-compiler-runtime").c(3),e=a.onReturn;a=a.title;var f;b[0]!==e||b[1]!==a?(f=i.jsx(c("MWTopNavListDropdownTitle.react"),{onReturn:e,title:a}),b[0]=e,b[1]=a,b[2]=f):f=b[2];return f}g["default"]=a}),98);
__d("MWXListCellStrict.react",["cr:1357","cr:2004","cr:321","cr:3296","cr:6221","cr:842","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h=["ref"],i,j=i||d("react");function a(a){var c=d("react-compiler-runtime").c(22),e,f;c[0]!==a?(f=a.ref,e=babelHelpers.objectWithoutPropertiesLoose(a,h),c[0]=a,c[1]=e,c[2]=f):(e=c[1],f=c[2]);if(b("cr:1357")!=null){c[3]!==e||c[4]!==f?(a=j.jsx(b("cr:1357"),babelHelpers["extends"]({},e,{ref:f})),c[3]=e,c[4]=f,c[5]=a):a=c[5];return a}if(b("cr:321")!=null&&b("cr:6221")!=null&&b("cr:3296")!=null&&b("cr:842")!=null&&b("cr:2004")!=null){a=e;e=a.addOnStart;var g=a.disabled,i=a.headline,k=a.linkProps,l=a.onHoverIn,m=a.onHoverOut,n=a.onPress,o=a.onPressIn,p=a.selected;a=a.testid;var q;c[6]!==e||c[7]!==g?(q=e!=null?j.jsx(b("cr:3296"),{addOnStart:e,disabled:g!=null?g:!1}):void 0,c[6]=e,c[7]=g,c[8]=q):q=c[8];e=q;c[9]!==i?(g=j.jsx(b("cr:6221"),{type:"headline4",children:i}),c[9]=i,c[10]=g):g=c[10];c[11]!==k||c[12]!==l||c[13]!==m||c[14]!==n||c[15]!==o||c[16]!==f||c[17]!==p||c[18]!==g||c[19]!==a||c[20]!==e?(q=j.jsx(b("cr:842"),{paddingHorizontal:8,paddingVertical:0,children:j.jsx(b("cr:2004"),{children:j.jsx(b("cr:321"),{addOnStart:e,content:g,linkProps:k,onHoverIn:l,onHoverOut:m,onPress:n,onPressIn:o,ref:f,selected:p,size:"medium",testid:void 0})})}),c[11]=k,c[12]=l,c[13]=m,c[14]=n,c[15]=o,c[16]=f,c[17]=p,c[18]=g,c[19]=a,c[20]=e,c[21]=q):q=c[21];return q}return null}g["default"]=a}),98);
__d("MWJewelMessageRequestsThread.react",["fbt","FDSChevronLeftFilled16Icon","FDSChevronRightFilled16Icon","FDSIcon.react","FDSMessagesFilled24Icon","I64","LSIntEnum","Locale","MWJewelThreadSnippet.react","MWXListCellStrict.react","ReQL","ReQLSuspense","react","react-compiler-runtime","useReStore"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l,m=l||d("react");function n(){var a=d("react-compiler-runtime").c(5),b=(i||(i=c("useReStore")))(),e;a[0]!==b.tables.contacts||a[1]!==b.tables.threads?(e=function(){return d("ReQL").fromTableDescending(b.tables.threads.index("parentThreadKeyLastActivityTimestampMs")).getKeyRange((j||(j=d("LSIntEnum"))).ofNumber(-1)).filter(o).map(function(a){a=a.snippetSenderContactId;if(a!=null){a=d("ReQLSuspense").first(d("ReQL").fromTableAscending(b.tables.contacts).getKeyRange(a),f.id+":51");return a?a.name:void 0}})},a[0]=b.tables.contacts,a[1]=b.tables.threads,a[2]=e):e=a[2];var g;a[3]!==b?(g=[b],a[3]=b,a[4]=g):g=a[4];return d("ReQLSuspense").useFirst(e,g,f.id+":36")}function o(a){return(k||(k=d("I64"))).gt(a.lastActivityTimestampMs,a.lastReadWatermarkTimestampMs)}function a(a){var b=d("react-compiler-runtime").c(17),e=a.onOpenMessageRequests;a=a.unreadRequestsCount;var f;b[0]!==a?(f=h._(/*BTDS*/"_j{\"*\":\"New message requests\",\"_1\":\"New message request\"}",[h._plural(a)]),b[0]=a,b[1]=f):f=b[1];f=f;var g;b[2]!==a?(g=h._(/*BTDS*/"_j{\"someone\":\"From someone you may know\",\"people\":\"From people you may know\"}",[h._enum(a===1?"someone":"people",{someone:"someone",people:"people"})]),b[2]=a,b[3]=g):g=b[3];g=g;var i=n();if(i!=null)if(a===1){var j;b[4]!==i?(j=h._(/*BTDS*/"From {name}",[h._param("name",i)]),b[4]=i,b[5]=j):j=b[5];g=j}else{b[6]!==i||b[7]!==a?(j=h._(/*BTDS*/"From {name} and {count} more",[h._param("name",i),h._param("count",a-1)]),b[6]=i,b[7]=a,b[8]=j):j=b[8];g=j}b[9]===Symbol["for"]("react.memo_cache_sentinel")?(i={addOn:m.jsx(c("FDSIcon.react"),{color:"secondary",icon:d("Locale").isRTL()?c("FDSChevronLeftFilled16Icon"):c("FDSChevronRightFilled16Icon")}),type:"body"},a={icon:c("FDSMessagesFilled24Icon"),size:56,type:"contained-icon"},b[9]=i,b[10]=a):(i=b[9],a=b[10]);b[11]!==g?(j=m.jsx(c("MWJewelThreadSnippet.react"),{isUnread:!0,text:g}),b[11]=g,b[12]=j):j=b[12];b[13]!==e||b[14]!==j||b[15]!==f?(g=m.jsx(c("MWXListCellStrict.react"),{addOnEnd:i,addOnStart:a,body:j,headline:f,level:4,onPress:e}),b[13]=e,b[14]=j,b[15]=f,b[16]=g):g=b[16];return g}g["default"]=a}),226);
__d("useMWLSJewelLoadMoreThreads",["Int64Hooks","loadMoreLSThreads","promiseDone","react-compiler-runtime","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var b=d("react-compiler-runtime").c(4),e=(h||(h=c("useReStore")))(),g,i;b[0]!==a||b[1]!==e?(g=function(){return function(){var b=e.runInTransaction(function(b){return c("loadMoreLSThreads")(b,a)},"readwrite",void 0,void 0,f.id+":26");c("promiseDone")(b)}},i=[e,a],b[0]=a,b[1]=e,b[2]=g,b[3]=i):(g=b[2],i=b[3]);return d("Int64Hooks").useMemoInt64(g,i)}g["default"]=a}),98);
__d("useMWLSLoadThreadFolderIfNotPresent",["CancellablePromise","CancellationToken","I64","Int64Hooks","ReQL","promiseDone","react-compiler-runtime","useMWLSJewelLoadMoreThreads","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){var b=d("react-compiler-runtime").c(8),e=(i||(i=c("useReStore")))(),f=c("useMWLSJewelLoadMoreThreads")(a),g;b[0]!==e.tables.threads_ranges_v2__generated||b[1]!==f||b[2]!==a?(g=function(){var b=c("CancellationToken")();c("promiseDone")(d("CancellablePromise").ignoreFailed(void 0,d("CancellablePromise").then_(b,function(a){a==null&&f()},d("ReQL").firstAsync(d("ReQL").fromTableAscending(e.tables.threads_ranges_v2__generated).filter(function(b){return(h||(h=d("I64"))).equal(b.parentThreadKey,a)})))));return b.cancel},b[0]=e.tables.threads_ranges_v2__generated,b[1]=f,b[2]=a,b[3]=g):g=b[3];var j;b[4]!==e||b[5]!==f||b[6]!==a?(j=[f,e,a],b[4]=e,b[5]=f,b[6]=a,b[7]=j):j=b[7];d("Int64Hooks").useEffectInt64(g,j)}g["default"]=a}),98);
__d("MWLSJewelMessageRequestsThreadContainer.react",["I64","LSIntEnum","MWJewelMessageRequestsThread.react","ReQL","ReQLSuspense","gkx","react","react-compiler-runtime","useMWLSLoadThreadFolderIfNotPresent","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=k||d("react");function m(){var a=d("react-compiler-runtime").c(4),b=(h||(h=c("useReStore")))(),e;a[0]!==b.tables.threads?(e=function(){return d("ReQL").fromTableDescending(b.tables.threads.index("parentThreadKeyLastActivityTimestampMs")).getKeyRange((i||(i=d("LSIntEnum"))).ofNumber(-1)).filter(n)},a[0]=b.tables.threads,a[1]=e):e=a[1];var g;a[2]!==b?(g=[b],a[2]=b,a[3]=g):g=a[3];a=d("ReQLSuspense").useArray(e,g,f.id+":27");return a.length}function n(a){return(j||(j=d("I64"))).gt(a.lastActivityTimestampMs,a.lastReadWatermarkTimestampMs)}function a(a){var b=d("react-compiler-runtime").c(4);a=a.onOpenMessageRequests;var e;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(e=(i||(i=d("LSIntEnum"))).ofNumber(-1),b[0]=e):e=b[0];c("useMWLSLoadThreadFolderIfNotPresent")(e);e=m();if(a==null||e===0||c("gkx")("17132"))return null;var f;b[1]!==a||b[2]!==e?(f=l.jsx(c("MWJewelMessageRequestsThread.react"),{onOpenMessageRequests:a,unreadRequestsCount:e}),b[1]=a,b[2]=e,b[3]=f):f=b[3];return f}g["default"]=a}),98);
__d("LSFilteredThreadsRangesQuery",["LSGetCursor","LSIssueNewTaskAndGetTaskID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.i64.neq(a[10],void 0)?d[0]=a[10]:d[0]=c.i64.cast([0,0]),a[11]!==void 0?d[1]=a[11]:d[1]="",(a[2]&&c.i64.neq(a[7],void 0)&&c.i64.neq(a[4],void 0)||a[3]&&c.i64.neq(a[6],void 0)&&c.i64.neq(a[5],void 0))&&!(a[2]&&c.i64.neq(a[7],void 0)&&c.i64.neq(a[4],void 0)&&a[3]&&c.i64.neq(a[6],void 0)&&c.i64.neq(a[5],void 0))?c.sequence([function(e){return d[3]=a[4]==null?c.i64.cast([-2147483648,0]):a[4],d[4]=a[7]==null?c.i64.cast([0,1]):a[7],d[10]=c.i64.gt(d[4],c.i64.cast([0,1]))&&c.i64.gt(d[3],c.i64.cast([-2147483648,0])),c.storedProcedure(b("LSGetCursor"),c.i64.cast([0,1])).then(function(a){return a=a,d[2]=a[0],a})},function(e){return d[5]=new c.Map(),d[5].set("cursor",d[2]),d[5].set("filter",a[1]),d[5].set("is_after",a[3]),d[5].set("parent_thread_key",a[0]),d[5].set("reference_activity_timestamp",a[3]?a[6]:a[7]),d[5].set("reference_thread_key",a[3]?a[5]:a[4]),d[5].set("secondary_filter",d[0]),d[5].set("filter_value",d[1]),d[5].set("sync_group",c.i64.cast([0,1])),c.i64.gt(c.i64.cast([0,0]),c.i64.cast([0,0]))?(d[11]=c.i64.of_float(Date.now()),d[6]=c.i64.add(d[11],c.i64.cast([0,0]))):d[6]=c.i64.cast([0,0]),d[7]=c.toJSON(d[5]),c.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),"trq",c.i64.cast([0,313]),d[7],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,d[6],c.i64.cast([0,0])).then(function(a){return a=a,d[8]=a[0],a})},function(b){return c.filter(c.db.table(247).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.parentThreadKey,a[0])&&c.i64.eq(b.threadRangeFilter,a[1])&&c.i64.eq(b.secondaryThreadRangeFilter,d[0])&&b.threadRangeFilterValue===d[1]}).next().then(function(b,e){e=b.done;b=b.value;return e?c.db.table(247).add({folderName:"",parentThreadKey:a[0],minThreadKey:d[3]==null?c.i64.cast([-2147483648,0]):d[3],minLastActivityTimestampMs:d[4]==null?c.i64.cast([0,1]):d[4],threadRangeFilter:a[1],secondaryThreadRangeFilter:d[0],threadRangeFilterValue:d[1],maxLastActivityTimestampMs:c.i64.cast([0,1]),maxThreadKey:c.i64.cast([-2147483648,0]),isLoadingBefore:!0,isLoadingAfter:!1,hasMoreBefore:d[10],hasMoreAfter:!1,syncGroup:c.i64.cast([0,1])}):(b.item,c.forEach(c.filter(c.db.table(247).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.parentThreadKey,a[0])&&c.i64.eq(b.threadRangeFilter,a[1])&&c.i64.eq(b.secondaryThreadRangeFilter,d[0])&&b.threadRangeFilterValue===d[1]}),function(a){var b=a.update;a.item;return b({isLoadingBefore:!0,isLoadingAfter:!1,hasMoreBefore:d[10],hasMoreAfter:!1})}))})}]):c.resolve()},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxFilteredThreadsRangesQueryStoredProcedure";a.__tables__=["filtered_threads_ranges_v3__generated"];e.exports=a}),null);
__d("LSFilteredThreadsRangesQueryStoredProcedure",["LSFilteredThreadsRangesQuery","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSFilteredThreadsRangesQuery"),e.parentThreadKey,e.filter,e.isLoadingBefore,e.isLoadingAfter,e.minThreadKey,e.maxThreadKey,e.maxLastActivityTimestampMs,e.minLastActivityTimestampMs,e.numThreads,e.numMessages,e.secondaryFilter,e.filterValue);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MWPBaseThreadListUtils",["I64","LSFactory","LSFilteredThreadsRangesQueryStoredProcedure","LSIntEnum","LSThreadRangeFilter","LSThreadsRangesQueryStoredProcedure","ReQL","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,e,g,j,k){k===void 0&&(k=!1);var l=(h||(h=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSThreadRangeFilter").NONE));c("promiseDone")(async function(){var m=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.sync_groups).getKeyRange((i||(i=d("LSIntEnum"))).ofNumber(1)));m!=null&&(h||(h=d("I64"))).equal(m.syncStatus,(i||(i=d("LSIntEnum"))).ofNumber(2))&&await a.runInTransaction(function(a){j==null||j();if(l)return c("LSThreadsRangesQueryStoredProcedure")(c("LSFactory")(a),{additionalPagesToFetch:(h||(h=d("I64"))).zero,isLoadingAfter:!1,isLoadingBefore:!0,maxLastActivityTimestampMs:h.max_int,maxThreadKey:h.max_int,minLastActivityTimestampMs:h.max_int,minThreadKey:h.max_int,parentThreadKey:b,shouldSkipE2eeThreadsRanges:k});else return c("LSFilteredThreadsRangesQueryStoredProcedure")(c("LSFactory")(a),{filter:e,isLoadingAfter:!1,isLoadingBefore:!0,maxLastActivityTimestampMs:(h||(h=d("I64"))).max_int,maxThreadKey:h.max_int,minLastActivityTimestampMs:h.max_int,minThreadKey:h.max_int,parentThreadKey:b,secondaryFilter:g})},"readwrite","ui",void 0,f.id+":56")}())}g.loadMoreThreadsForEmptyRangeDefault=a}),98);
__d("ReQLScrollAnchored.react",["BaseScrollableAreaContext","BaseThemeProvider.react","CometPlaceholder.react","CometSSRSuspendOnServer.react","MWXScrollableAreaStyles","intersectionObserverEntryIsIntersecting","react","stylex","useResizeObserver"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=i||(i=d("react"));b=i;var k=b.useCallback,l=b.useContext,aa=b.useEffect,ba=b.useImperativeHandle,ca=b.useLayoutEffect,m=b.useMemo,n=b.useRef,da=b.useState,o=function(a){function b(){var b;for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return(b=a.call.apply(a,[this].concat(d))||this,b.render=function(){return b.props.children},babelHelpers.assertThisInitialized(b))||babelHelpers.assertThisInitialized(b)}babelHelpers.inheritsLoose(b,a);var c=b.prototype;c.componentDidUpdate=function(a,b,c){b=a.children;this.props.componentDidUpdate(b,c)};c.getSnapshotBeforeUpdate=function(a){a=a.children;return this.props.getSnapshotBeforeUpdate(a)};return b}(j.PureComponent),p={hideScrollbar:{MsOverflowStyle:"x1pq812k",scrollbarWidth:"x1rohswg","::-webkit-scrollbar_height":"x1yqm8si","::-webkit-scrollbar_width":"xjx87ck",$$css:!0},overscrollBehaviorContain:{overscrollBehavior:"xish69e",$$css:!0},scrollArea:{display:"x78zum5",flexDirection:"xdt5ytf",flexGrow:"x1iyjqo2",flexShrink:"xs83m0k",overflowAnchor:"x1xzczws",overflowX:"x6ikm8r",overflowY:"x1odjw0f",position:"x1n2onr6",width:"xh8yej3",$$css:!0}},q=typeof ResizeObserver!=="undefined";function ea(a){var b=a.clientHeight;a=a.scrollTop;return a>b*2}function fa(a,b){return a-b.scrollTop>b.clientHeight*2}var ga=5;function a(a){var b=a.ref,d=a.hasReachedBottom,e=d===void 0?!0:d;d=a.hasReachedTop;var f=d===void 0?!0:d;d=a.setScrollTopInResetForBottomAnchor;var g=d===void 0?!0:d,i=a.initialAnchor,r=a.initialRenderComplete,s=a.onReachingBottom,t=a.onReachingTop,u=a.onScroll,v=a.onUserScroll,w=a.renderEmptyContent,x=a.renderFooter,y=a.renderHeader,z=a.renderHeaderContentSpacer,A=a.renderLoadingAnimation;d=a.isSufficientContentLoadedAbove;var B=d===void 0?ea:d;d=a.isSufficientContentLoadedBelow;var C=d===void 0?fa:d,ha=a.headerStyle,ia=a.hideScrollbar;d=a.snapThreshold;var D=d===void 0?5:d;d=a.xstyle;var ja=a.shouldOverscrollBehaviourContain,E=a.elements,F=l(c("BaseScrollableAreaContext")),G=n();a=m(function(){return[].concat(F,[{getDOMNode:function(){return G==null?void 0:G.current}}])},[F]);var H=n(),I=n(),J=da(i),ka=J[0],K=J[1],L=n(i),M=n(null),N=k(function(){var a=G.current,b=I.current;if(a==null||b==null||a.offsetParent===null||b.offsetParent===null)return;b=C(b.clientHeight,a);M.current=a.scrollTop;if(!b&&!e&&s!=null){s();return}b=B(a);M.current=a.scrollTop;!b&&!f&&t!=null&&t()},[e,f,B,C,s,t]);aa(N,[N,E.length]);var O=k(function(a){if(a.scrollHeight===a.clientHeight)return;var b=a.scrollHeight-a.clientHeight-a.scrollTop<D&&e?"bottom":"top";K(L.current=b);M.current=a.scrollTop},[e,D]),P=k(function(){var a=G.current,b=M.current;if(b==null||a==null)return;a.scrollTop!==b&&(a.scrollTop=b,u&&u(a))},[u]),Q=k(function(){var a=G.current,b=I.current;if(a==null||b==null)return;i==="bottom"?(g&&(a.scrollTop=a.scrollHeight),u&&u(a)):f||(a.scrollTop=b.offsetTop,u&&u(a));e&&a.scrollHeight-a.clientHeight-a.scrollTop<D?K(L.current="bottom"):K(L.current=i);M.current=a.scrollTop},[e,f,i,u,D,g]),R=n(!1);ca(function(){if(R.current)return;Q();R.current=!0},[Q]);var S=k(function(){var a=G.current;if(a==null)return;r&&a.scrollHeight>a.clientHeight&&r();L.current==="bottom"&&(a.scrollTop=a.scrollHeight,u&&u(a));M.current=a.scrollTop},[r,u]),la=k(function(){var a=G.current;if(a==null)return;u&&u(a);if(a.scrollTop===M.current)return;M.current=null;N();O(a);v&&v()},[N,u,v,O]),T=k(function(){S(),N()},[S,N]);J=k(function(){return S()},[S]);var U=c("useResizeObserver")(J),V=c("useResizeObserver")(T),ma=k(function(a){U(a),I.current=a},[U]),na=k(function(a){V(a),G.current=a},[V]),W=k(function(a,b){if(b!=null){a=b.element;var c=b.height;b=b.scrollAreaElement;a=a.clientHeight;M.current=b.scrollTop;a!==c&&!(a<=c&&L.current==="bottom")&&(b.scrollTop+=a-c,M.current=b.scrollTop,u&&u(b))}},[u]),X=k(function(){if(G.current!=null){var a=G.current;a.scrollTop=a.scrollHeight;M.current=a.scrollTop;u&&u(a)}K(L.current=e?"bottom":"top")},[e,u]);function oa(){if(G.current!=null){var a=G.current,b=a.scrollHeight-a.scrollTop-a.clientHeight<ga;M.current=a.scrollTop;return b}else return!1}var Y=n(null),Z=k(function(a,b){var d=Y.current,e=G.current;if(d!=null&&e!=null){var f=new IntersectionObserver(function(a){a=a[0];(a.boundingClientRect.height!==0||a.boundingClientRect.width!==0)&&b(c("intersectionObserverEntryIsIntersecting")(a))},{root:e,rootMargin:a+"px"});f.observe(d);return function(){return f.disconnect()}}},[]),$=k(function(){var a=G.current;if(a!=null){var b=a.scrollHeight-a.clientHeight>0;M.current=a.scrollTop;return b}return!1},[]);function pa(){var a=G.current;if(a==null)return null;var b={clientHeight:a.clientHeight,scrollHeight:a.scrollHeight,scrollTop:a.scrollTop};M.current=a.scrollTop;return b}ba(b,function(){return{doesContentFillScroll:$,getScrollAreaElement:function(){return G.current},getScrollerMeasurements:pa,isAtBottom:oa,onCloseToBottom:Z,resetScrollPosition:Q,restoreScrollPosition:P,scrollToBottom:X}},[$,Z,Q,P,X]);var qa=m(function(){return j.jsx(o,{componentDidUpdate:W,getSnapshotBeforeUpdate:function(a){var b=I.current,c=G.current;if(b!=null&&c!=null&&!(f&&c.scrollTop===0)&&(!a.length||E.length&&a[0].key!==E[0].key&&a.length!==E.length)){a=b.clientHeight;M.current=c.scrollTop;return{element:b,height:a,scrollAreaElement:c}}return null},children:E})},[E,W,f]);return j.jsx(c("BaseScrollableAreaContext").Provider,{value:a,children:j.jsx("div",babelHelpers.extends({},(h||(h=c("stylex"))).props(d),{children:j.jsx("div",babelHelpers.extends({},{0:{className:"x78zum5 xdt5ytf x1iyjqo2 x6ikm8r x10wlt62 x1n2onr6"},1:{className:"x78zum5 xdt5ytf x1iyjqo2 x6ikm8r x10wlt62 x1n2onr6 x1xzczws"}}[!!(ka==="bottom")<<0],{children:j.jsx(c("BaseThemeProvider.react"),{children:function(a,b){return j.jsxs("div",{className:(h||(h=c("stylex")))(p.scrollArea,ja===!0&&p.overscrollBehaviorContain,ia===!0&&p.hideScrollbar,c("MWXScrollableAreaStyles").themed,a),"data-testid":void 0,onScroll:la,ref:na,style:b,children:[j.jsx(c("CometPlaceholder.react"),{fallback:null,name:"ReQLScrollAnchored.ScrollArea",children:j.jsx(c("CometSSRSuspendOnServer.react"),{children:!q&&j.jsx("iframe",{className:"x76ihet xtmcdsl x112ta8 x4gj9lk x5yr21d x1o0tod x1ty9z65 xg01cxk x47corl x10l6tqk x1yhy09f xh8yej3",ref:function(a){a!=null&&(a.contentWindow.onresize=T)}})})}),j.jsxs(o,{componentDidUpdate:W,getSnapshotBeforeUpdate:function(){var a=H.current,b=G.current;if(a!=null&&b!=null){M.current=b.scrollTop;if(M.current!==0){var c=a.clientHeight;return{element:a,height:c,scrollAreaElement:b}}}return null},children:[j.jsx("div",babelHelpers.extends({},h.props(ha),{ref:H,children:f?y&&y():A&&A("onTop",E.length)})),w!=null?w():null]}),z!=null&&z(),j.jsx("div",babelHelpers.extends({},{0:{},1:{className:"x1us19tq"}}[!!(E.length!==0&&!f&&!e)<<0],{children:j.jsxs("div",{className:"x1n2onr6",ref:ma,children:[j.jsx(c("CometPlaceholder.react"),{fallback:null,name:"ReQLScrollAnchored.elementsHOC",children:j.jsx(c("CometSSRSuspendOnServer.react"),{children:!q&&j.jsx("iframe",{className:"x76ihet xtmcdsl x112ta8 x4gj9lk x5yr21d x1o0tod x1ty9z65 xg01cxk x47corl x10l6tqk x1yhy09f xh8yej3",ref:function(a){a!=null&&(a.contentWindow.onresize=S)}})})}),qa,j.jsx("div",{className:"x1ey2m1c xjm9jq1 x1y332i5 x47corl x10l6tqk",ref:Y}),e?x&&x():A&&A("onBottom",E.length)]})}))]})}})}))}))})}a.displayName=a.name+" [from "+f.id+"]";g.default=a}),98);
__d("useStableValue",["I64","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(h||d("react")).useRef;function a(a){return k(a,(i||(i=d("I64"))).equal)}function k(a,b){var c=j(a);b(c.current,a)||(c.current=a);return c.current}g.useStableI64=a;g.useStableValue=k}),98);
__d("useStableBounds",["deepEquals","useStableValue"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("useStableValue").useStableValue(a,c("deepEquals"))}g["default"]=a}),98);
__d("ReQLPaginatedList.react",["FBLogger","I64","PromiseOrValue","ReQL","ReQLScrollAnchored.react","ReQLSuspense","SortedAsyncIterable","deepEquals","gkx","promiseDone","react","useMergeRefs","useStableBounds","useStableValue"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=h||(h=d("react"));b=h;var l=b.useCallback,m=b.useEffect,aa=b.useLayoutEffect,n=b.useMemo,o=b.useRef,p=b.useState,q=b.useTransition;function r(a,b){return b==null?a:a.bounds(b)}function s(a){if(a instanceof Promise)throw a;return a}function t(a){return{direction:a.direction,iterator:function(b,c){var e=a.iterator(b,c);return{next:function(a){return(i||(i=d("PromiseOrValue"))).map(e.next(a),function(a){return a.done?a:{done:!1,value:[a.value[0],a.value]}})}}},keyLength:a.keyLength,subscribe:function(b,c){return a.subscribe(async function(a,c,d){c.operation==="delete"?await b(a,c,d):c.operation==="add"?await b(a,{operation:"add",value:[a,c.value]},d):c.operation==="put"&&await b(a,{operation:"put",value:[a,c.value]},d)},c)}}}function ba(a){var b=a.clientHeight;a=a.scrollTop;return a>b*2}function a(a){var b=a.bounds,e=a.direction,g=e===void 0?"asc":e;e=a.hasReachedBottom;var h=e===void 0?!0:e;e=a.hasReachedTop;var i=e===void 0?!0:e;e=a.imperativeRef;var j=a.initialAnchor,da=a.initialRenderComplete,u=a.onDataLoaded,v=a.onPageLoaded,w=a.onReachingBottom,x=a.onReachingTop,ea=a.onScroll,fa=a.onUserScroll,y=a.pageSize,z=y===void 0?15:y;y=a.renderEmptyContent;var A=a.renderFooter,ga=a.renderHeader,ha=a.renderHeaderContentSpacer,B=a.renderItem,ia=a.renderLoadingAnimation,ja=a.headerStyle,C=a.isSufficientContentLoadedAbove;C=C===void 0?ba:C;var ka=a.isSufficientContentLoadedBelow,D=a.snapThreshold;D=D===void 0?5:D;var E=a.setScrollTopInResetForBottomAnchor;E=E===void 0?!0:E;var F=a.data,G=F.ascending,H=F.descending;F=a.xstyle;var I=a.isLogDuplicatedItemEnabled;I=I===void 0?!1:I;a=a.shouldOverscrollBehaviourContain;var J=q();J[0];var K=J[1],L=c("useStableBounds")(b);if(j!=null&&j!=="top"&&j!=="bottom"){J=r(H,L).bounds({lt:j}).iterator(new WeakMap()).next();if(J instanceof Promise)throw J;j=J.done?"top":J.value[0]}var M=d("useStableValue").useStableValue(j,c("deepEquals")),N=n(function(){var a,b;M==="top"||M==null?(a=d("ReQL").empty(),b=g==="asc"?G:H):M==="bottom"?(a=g==="asc"?H:G,b=d("ReQL").empty()):(a=g==="asc"?H.bounds({lt:M}):G.bounds({gt:M}),b=g==="asc"?G.bounds({gte:M}):H.bounds({lte:M}));return{after:b,before:a}},[M,G,H,g]),O=o(!1),P=n(function(){var a=s(d("SortedAsyncIterable").toArray(r(N.before,L).take(M==="bottom"?z:0),f.id+":204")).reverse(),b=s(d("SortedAsyncIterable").toArray(r(N.after,L).take(z),f.id+":211")),c=M==="bottom"?!0:b.length<z,e=M==="top"||M==null?!0:M==="bottom"?a.length<z:!1;return{firstKey:e?void 0:M==="bottom"?(e=a[0])==null?void 0:e[0]:(a=b[0])==null?void 0:a[0],lastKey:c?void 0:(e=b[b.length-1])==null?void 0:e[0]}},[M,L,N.after,N.before,z]);b=p(function(){return{anchor:M,iterables:N,values:P}});J=b[0];var Q=b[1];j=J.iterables===N&&J.anchor===M;b=j?J.values:P;var R=b.firstKey,S=b.lastKey,T=d("ReQLSuspense").useArray(function(){return t(R==null?r(N.before,L).take(z):r(N.before,L).bounds(g==="asc"?{gte:R}:{lte:R}))},[L,g,R,N.before,z],f.id+":246"),U=n(function(){return[].concat(T).reverse()},[T]);m(function(){U.length===z&&R==null&&K(function(){return Q({anchor:M,iterables:N,values:{firstKey:U[0][0],lastKey:S}})})},[U,R,M,N,S,z]);var V=d("ReQLSuspense").useArray(function(){return t(S==null?r(N.after,L).take(z):r(N.after,L).bounds(g==="asc"?{lte:S}:{gte:S}))},[L,g,N.after,S,z],f.id+":273");m(function(){V.length===z&&S==null&&K(function(){return Q({anchor:M,iterables:N,values:{firstKey:R,lastKey:V[V.length-1][0]}})})},[V,R,M,N,S,z]);var W=n(function(){return[].concat(U,V)},[U,V]);m(function(){u==null||u(W)},[W,u]);var X=d("ReQLSuspense").useFirst(function(){return W.length===0?d("ReQL").empty():r(N.before,L).bounds(g==="asc"?{lt:W[0][0]}:{gt:W[0][0]})},[W,L,g,N.before],f.id+":305")==null,Y=d("ReQLSuspense").useFirst(function(){return W.length===0?d("ReQL").empty():r(N.after,L).bounds(g==="asc"?{gt:W[W.length-1][0]}:{lt:W[W.length-1][0]})},[W,L,g,N.after],f.id+":315")==null;j=q();var la=j[0],ma=j[1];J=l(function(){if(O.current||la)return;if(Y){if(!h&&w!=null)return w()}else{O.current=!0;c("promiseDone")(Promise.resolve(d("SortedAsyncIterable").toArray(r(g==="asc"?G:H,L).bounds(g==="asc"?{gt:W[W.length-1][0]}:{lt:W[W.length-1][0]}).take(z),f.id+":342")),function(a){O.current=!1,v!=null&&v("bottom",W[W.length-1][1],a.map(function(a){return a[1]})),ma(function(){var b;return Q({anchor:M,iterables:N,values:{firstKey:R,lastKey:(b=(b=a[a.length-1])==null?void 0:b[0])!=null?b:W[W.length-1][0]}})})});return}},[la,Y,h,w,g,G,H,L,W,z,v,R,N,M]);b=q();var na=b[0],oa=b[1],pa=o(!0);j=l(function(){if(O.current||na)return;if(X){if(!i)return x==null?void 0:x();return}O.current=!0;c("promiseDone")(Promise.resolve(d("SortedAsyncIterable").toArray(r(g==="asc"?H:G,L).bounds(g==="asc"?{lt:W[0][0]}:{gt:W[0][0]}).take(z),f.id+":414")),function(a){O.current=!1,v!=null&&(pa.current?(pa.current=!1,v("top",null,W.slice(0,z).map(function(a){return a[1]}).reverse())):v("top",W[0][1],a.map(function(a){return a[1]}))),a.reverse(),oa(function(){var b;return Q({anchor:M,iterables:N,values:{firstKey:(b=(b=a[0])==null?void 0:b[0])!=null?b:W[0][0],lastKey:S}})})})},[na,X,i,x,g,H,G,L,W,z,v,S,N,M]);var Z=X&&i?0:1,$=W.length-(Y&&h?0:1);b=n(function(){var a=new Array($>Z?$-Z:0);for(var b=Z;b<$;b++){var d;a[b-Z]=B(W[b][1],{nextItem:(d=W[b+1])==null?void 0:d[1],previousItem:(d=W[b-1])==null?void 0:d[1]},c("gkx")("7810")?$-Z-b:0)}return a},[W,Z,B,$]);var qa=o(null);e=c("useMergeRefs")(qa,e);aa(function(){var a;(a=qa.current)==null||a.resetScrollPosition()},[M]);var ra=l(function(){return A==null?void 0:A(W.length>0?W[W.length-1][1]:void 0)},[W,A]);ca(I,W);return k.jsx(c("ReQLScrollAnchored.react"),{elements:b,hasReachedBottom:Y&&h,hasReachedTop:X&&i,headerStyle:ja,initialAnchor:M==="bottom"?"bottom":"top",initialRenderComplete:da,isSufficientContentLoadedAbove:C,isSufficientContentLoadedBelow:ka,onReachingBottom:J,onReachingTop:j,onScroll:ea,onUserScroll:fa,pageSize:z,ref:e,renderEmptyContent:y,renderFooter:ra,renderHeader:ga,renderHeaderContentSpacer:ha,renderLoadingAnimation:ia,setScrollTopInResetForBottomAnchor:E,shouldOverscrollBehaviourContain:a,snapThreshold:D,xstyle:F})}a.displayName=a.name+" [from "+f.id+"]";function ca(a,b){var e=p(!1),f=e[0],g=e[1];m(function(){try{if(a&&!f){var e=new Set(),h=[];for(var i of b){var k=i[1];if(typeof k==="object"&&(k==null?void 0:k.threadKey)!=null&&(j||(j=d("I64"))).isI64(k==null?void 0:k.threadKey)){k=(j||(j=d("I64"))).to_string(k==null?void 0:k.threadKey);e.has(k)&&h.push(k);e.add(k)}}e.size!==b.length&&(g(!0),c("FBLogger")("messenger_web").warn("Duplicated thread item detected in ReQLPaginatedList %s",h.join(",")))}}catch(a){c("FBLogger")("messenger_web").warn("Duplicated thread item error",a)}},[b,f,a])}g.default=a}),98);
__d("useMWCMMarkBumpedThreadsSeen",["Int64Hooks","react-compiler-runtime","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("MWCMMarkBumpedThreadsSeen").__setRef("useMWCMMarkBumpedThreadsSeen");function a(a){var b=d("react-compiler-runtime").c(3),c,e;b[0]!==a?(c=function(){return{load:async function(){var b=await h.load();return function(c){return b.MWCMMarkBumpedThreadsSeen(a,c)}}}},e=[a],b[0]=a,b[1]=c,b[2]=e):(c=b[1],e=b[2]);return d("Int64Hooks").useMemoInt64(c,e)}g.default=a}),98);
__d("useMarkSeenWhenVisible",["CometDebounce","Int64Hooks","ReQL","UserActivity","promiseDone","react","useMWCMMarkBumpedThreadsSeen","useMWPMarkSeen","useMWPWatchFolderFocusChanges","useReStore","useSimpleImpression","useVisibilityObserver"],(function(a,b,c,d,e,f,g){"use strict";var h,i;b=i||d("react");var j=b.useCallback,k=b.useRef;function a(a){var b=(h||(h=c("useReStore")))(),e=k(!1),g=c("useMWCMMarkBumpedThreadsSeen")(a),i=c("useVisibilityObserver")({onHidden:function(){e.current=!1},onVisible:function(){e.current=!0}}),l=c("useMWPMarkSeen")(a),m=c("CometDebounce")(j(function(){c("promiseDone")(async function(){var a=await Promise.all([l.load(),g.load()]),c=a[0],d=a[1];await b.runInTransaction(async function(a){await c(a),await d(a)},"readwrite",void 0,void 0,f.id+":56")}())},[l,g,b]),{leading:!0,wait:500});c("useMWPWatchFolderFocusChanges")(m,e);c("useSimpleImpression")(m);d("Int64Hooks").useEffectInt64(function(){return d("ReQL").fromTableDescending(b.tables.threads.index("parentThreadKeyLastActivityTimestampMs"),[]).getKeyRange(a).take(1).subscribe(function(){c("UserActivity").isOnTab()&&e.current===!0&&m()})},[b,a,m]);return i}g.default=a}),98);
__d("MWPBaseThreadList.react",["Box.react","FBLogger","I64","Int64Hooks","LSFactory","LSFilteredThreadsRangesQueryStoredProcedure","LSIntEnum","LSThreadRangeFilter","LSThreadsRangesQueryStoredProcedure","MAWMaybeWithTimeout","MWPBaseThreadListHooks","MWPBaseThreadListUtils","MWThreadListFocusableTable.react","ReQL","ReQLPaginatedList.react","ReQLSuspense","react","react-compiler-runtime","useMarkSeenWhenVisible","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=i||(i=d("react"));b=i;b.useCallback;var m=b.useEffect,n={container:{display:"x78zum5",flexDirection:"xdt5ytf",flexGrow:"x1iyjqo2",flexShrink:"xs83m0k",overflowX:"x6ikm8r",overflowY:"x10wlt62",$$css:!0},emptyContentContainer:{alignItems:"x6s0dn4",display:"x78zum5",flexGrow:"x1iyjqo2",justifyContent:"xl56j7k",$$css:!0},list:{display:"x78zum5",flexDirection:"xdt5ytf",flexGrow:"x1iyjqo2",overflowX:"x6ikm8r",overflowY:"x10wlt62",$$css:!0}},o=1e4;function p(a,b,e,g){g===void 0&&(g=!1),void d("MAWMaybeWithTimeout").maybeWithTimeout(a.runInTransaction(async function(a){var f;f=await (f=a.threads_ranges_v2__generated).get.apply(f,b);if(f==null||f.isLoadingBefore)return;e&&e();return c("LSThreadsRangesQueryStoredProcedure")(c("LSFactory")(a),{additionalPagesToFetch:(j||(j=d("I64"))).zero,isLoadingAfter:!1,isLoadingBefore:!0,maxLastActivityTimestampMs:f.maxLastActivityTimestampMs,maxThreadKey:f.maxThreadKey,minLastActivityTimestampMs:f.minLastActivityTimestampMs,minThreadKey:f.minThreadKey,parentThreadKey:f.parentThreadKey,shouldSkipE2eeThreadsRanges:g})},"readwrite","ui",void 0,f.id+":91"),o,function(){c("FBLogger")("messenger_web").warn("Paginated threads load took longer than "+o/1e3+" seconds.\n        parent_thread_key: "+(j||(j=d("I64"))).to_string(b[0])+"\n        min_thread_key: "+j.to_string(b[1])+"\n        min_last_activity_timestamp_ms: "+j.to_string(b[2]))})}function q(a,b,e,g,h){g===void 0&&(g=(k||(k=d("LSIntEnum"))).ofNumber(c("LSThreadRangeFilter").NONE)),void d("MAWMaybeWithTimeout").maybeWithTimeout(a.runInTransaction(async function(a){var d;d=await (d=a.filtered_threads_ranges_v3__generated).get.apply(d,b);if(d==null||d.isLoadingBefore)return;h&&h();return c("LSFilteredThreadsRangesQueryStoredProcedure")(c("LSFactory")(a),{filter:e,isLoadingAfter:!1,isLoadingBefore:!0,maxLastActivityTimestampMs:d.maxLastActivityTimestampMs,maxThreadKey:d.maxThreadKey,minLastActivityTimestampMs:d.minLastActivityTimestampMs,minThreadKey:d.minThreadKey,parentThreadKey:d.parentThreadKey,secondaryFilter:g})},"readwrite","ui",void 0,f.id+":150"),o,function(){c("FBLogger")("messenger_web").warn("Filtered paginated threads load took longer than "+o/1e3+" seconds.\n        parent_thread_key: "+(j||(j=d("I64"))).to_string(b[0])+"\n        min_thread_key: "+j.to_string(b[1])+"\n        min_last_activity_timestamp_ms: "+j.to_string(b[2])+"\n        thread_range_filter: "+j.to_string(b[3])+"\n        secondary_thread_range_filter: "+j.to_string(b[5]))})}function r(a,b,e,f,g,h){f===void 0&&(f=(k||(k=d("LSIntEnum"))).ofNumber(c("LSThreadRangeFilter").NONE));h===void 0&&(h=!1);if(b==null)return;if(!b.threadRangeFilter){var i=[b.parentThreadKey,b.minThreadKey,b.minLastActivityTimestampMs];p(a,i,g,h)}else{i=[b.parentThreadKey,b.minThreadKey,b.minLastActivityTimestampMs,b.threadRangeFilter,b.folderName,b.secondaryThreadRangeFilter,b.threadRangeFilterValue];q(a,i,e,f,g)}}function s(a,b,e,g){var h=d("react-compiler-runtime").c(14),i;h[0]!==e?(i=(j||(j=d("I64"))).equal(e,(k||(k=d("LSIntEnum"))).ofNumber(c("LSThreadRangeFilter").NONE)),h[0]=e,h[1]=i):i=h[1];var l=i,m;h[2]!==a||h[3]!==l||h[4]!==b?(i=function(){return l?d("ReQL").fromTableDescending(a.tables.threads_ranges_v2__generated).getKeyRange(b):d("ReQL").empty()},m=[a,b,l],h[2]=a,h[3]=l,h[4]=b,h[5]=i,h[6]=m):(i=h[5],m=h[6]);i=d("ReQLSuspense").useFirst(i,m,f.id+":250");var n;h[7]!==a||h[8]!==e||h[9]!==l||h[10]!==b||h[11]!==g?(m=function(){return l?d("ReQL").empty():d("ReQL").fromTableDescending(a.tables.filtered_threads_ranges_v3__generated).getKeyRange(b).filter(function(a){return(j||(j=d("I64"))).equal(a.threadRangeFilter,e)&&(g==null||(j||(j=d("I64"))).equal(a.secondaryThreadRangeFilter,g))})},n=[a,e,b,g,l],h[7]=a,h[8]=e,h[9]=l,h[10]=b,h[11]=g,h[12]=m,h[13]=n):(m=h[12],n=h[13]);h=d("ReQLSuspense").useFirst(m,n,f.id+":257");return l?i:h}function a(a){var b=d("react-compiler-runtime").c(71),e=a.afterContent,g=a.beforeContent,i=a.containerStyle,o=a.customThreadFilter,p=a.emptyContent,q=a.filter,t=a.gridLabel,u=a.imperativeRef,v=a.isSufficientContentLoadedBelow,w=a.loadMoreThreads,x=a.loadMoreThreadsForEmptyRange,y=a.onDataLoaded,z=a.onLoadMoreThreads,A=a.onReachingTop,B=a.onScroll,C=a.onThreadsLoaded,D=a.pageSize,E=a.parentThreadKey,F=a.renderItem,G=a.renderLoadingAnimation,H=a.role,I=a.secondaryFilter,J=a.setIsEmptyInbox;a=a.shouldSkipE2eeThreadsRanges;var K;b[0]!==q?(K=q===void 0?(k||(k=d("LSIntEnum"))).ofNumber(c("LSThreadRangeFilter").NONE):q,b[0]=q,b[1]=K):K=b[1];var L=K,M=w===void 0?r:w,N=x===void 0?d("MWPBaseThreadListUtils").loadMoreThreadsForEmptyRangeDefault:x;q=H===void 0?"grid":H;var O=a===void 0?!1:a,P=(h||(h=c("useReStore")))(),Q=s(P,E,L,I);Q!=null&&!Q.isLoadingBefore&&(C&&C());var R=d("MWPBaseThreadListHooks").useMWPBaseThreadListBounds(Q);b[2]!==o||b[3]!==P||b[4]!==E?(K={customThreadFilter:o,db:P,parentThreadKey:E},b[2]=o,b[3]=P,b[4]=E,b[5]=K):K=b[5];var S=d("MWPBaseThreadListHooks").useMWPBaseThreadListFilteredData(K);b[6]!==R||b[7]!==S.descending?(w=function(){return S.descending.bounds(R)},b[6]=R,b[7]=S.descending,b[8]=w):w=b[8];b[9]!==R||b[10]!==S?(x=[R,S],b[9]=R,b[10]=S,b[11]=x):x=b[11];var T=d("ReQLSuspense").useFirst(w,x,f.id+":345")==null;b[12]!==T||b[13]!==J?(H=function(){J&&J(T)},a=[T,J],b[12]=T,b[13]=J,b[14]=H,b[15]=a):(H=b[14],a=b[15]);m(H,a);b[16]!==P||b[17]!==Q||b[18]!==L||b[19]!==N||b[20]!==z||b[21]!==E||b[22]!==I?(C=function(){Q==null&&N(P,E,L,I,z)},o=[E,Q,P,L,I,z,N],b[16]=P,b[17]=Q,b[18]=L,b[19]=N,b[20]=z,b[21]=E,b[22]=I,b[23]=C,b[24]=o):(C=b[23],o=b[24]);d("Int64Hooks").useEffectInt64(C,o);K=c("useMarkSeenWhenVisible")(E);b[25]!==P||b[26]!==Q||b[27]!==L||b[28]!==M||b[29]!==z||b[30]!==I||b[31]!==O?(w=function(){M(P,Q,L,I,z,O)},b[25]=P,b[26]=Q,b[27]=L,b[28]=M,b[29]=z,b[30]=I,b[31]=O,b[32]=w):w=b[32];x=w;b[33]!==F?(H=function(a){return l.jsx(l.Fragment,{children:F(a)},(j||(j=d("I64"))).to_string(a.threadKey))},b[33]=F,b[34]=H):H=b[34];a=H;if(Q==null){b[35]!==G?(C=G!=null?G("nullState",0):null,b[35]=G,b[36]=C):C=b[36];o=C}else{w=!Q.hasMoreBefore;H=!Q.hasMoreAfter;b[37]!==Q.isLoadingAfter||b[38]!==Q.isLoadingBefore||b[39]!==p||b[40]!==T?(C=function(){return T&&!Q.isLoadingAfter&&!Q.isLoadingBefore?l.jsx(c("Box.react"),{xstyle:n.emptyContentContainer,children:p}):null},b[37]=Q.isLoadingAfter,b[38]=Q.isLoadingBefore,b[39]=p,b[40]=T,b[41]=C):C=b[41];var U;b[42]!==e?(U=function(){return e},b[42]=e,b[43]=U):U=b[43];var V;b[44]!==g?(V=function(){return g},b[44]=g,b[45]=V):V=b[45];var W;b[46]!==R||b[47]!==S||b[48]!==u||b[49]!==v||b[50]!==y||b[51]!==x||b[52]!==A||b[53]!==B||b[54]!==D||b[55]!==a||b[56]!==G||b[57]!==w||b[58]!==H||b[59]!==C||b[60]!==U||b[61]!==V?(W=l.jsx(d("MWThreadListFocusableTable.react").MWThreadListFocusableTable,{children:l.jsx(c("ReQLPaginatedList.react"),{bounds:R,data:S,direction:"desc",hasReachedBottom:w,hasReachedTop:H,imperativeRef:u,isLogDuplicatedItemEnabled:!0,isSufficientContentLoadedBelow:v,onDataLoaded:y,onReachingBottom:x,onReachingTop:A,onScroll:B,pageSize:D,renderEmptyContent:C,renderFooter:U,renderHeader:V,renderItem:a,renderLoadingAnimation:G,shouldOverscrollBehaviourContain:!0,xstyle:n.list})}),b[46]=R,b[47]=S,b[48]=u,b[49]=v,b[50]=y,b[51]=x,b[52]=A,b[53]=B,b[54]=D,b[55]=a,b[56]=G,b[57]=w,b[58]=H,b[59]=C,b[60]=U,b[61]=V,b[62]=W):W=b[62];o=W}b[63]!==i?(u=[n.container,i],b[63]=i,b[64]=u):u=b[64];b[65]!==o||b[66]!==t||b[67]!==q||b[68]!==u||b[69]!==K?(v=l.jsx(c("Box.react"),{"aria-label":t,"data-testid":void 0,ref:K,role:q,xstyle:u,children:o}),b[65]=o,b[66]=t,b[67]=q,b[68]=u,b[69]=K,b[70]=v):v=b[70];return v}g.default=a}),98);
__d("MWPParentThreadKeyContext",["react"],(function(a,b,c,d,e,f,g){"use strict";var h;a=h||d("react");b=a.createContext(null);g["default"]=b}),98);
__d("MWThreadListFolderItem.react",["BaseView.react","CometTextWithEntities.react","I64","MAWVault","MWAddOnCircleContainer.react","MWCMThreadTypes.react","MWChatTextTransform","MWPIsThreadUnread","MWThreadListFocusableTable.react","MWThreadListLastMessage.react","MWXListCellPressable.react","MWXTextPairing.react","react","react-compiler-runtime","useMatchMedia"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h||(h=d("react"));b=h;b.useCallback;b.useMemo;function a(a){var b=d("react-compiler-runtime").c(28),e=a.icon,f=a.onClick,g=a.responsive,h=a.selected,k=a.size,l=a.thread;a=a.threadName;g=c("useMatchMedia")("(min-width: 900px)")||!g;var m;b[0]!==l.snippet?(m=l.snippet!=null?d("MAWVault").unvault(l.snippet):null,b[0]=l.snippet,b[1]=m):m=b[1];m=m;m=m;var n;b[2]!==l.lastActivityTimestampMs?(n=(i||(i=d("I64"))).to_float(l.lastActivityTimestampMs),b[2]=l.lastActivityTimestampMs,b[3]=n):n=b[3];n=n;var o=d("MWPIsThreadUnread").useIsThreadUnread(l.threadKey),p;b[4]!==e||b[5]!==k?(p=j.jsx(c("MWAddOnCircleContainer.react"),{size:k,children:e}),b[4]=e,b[5]=k,b[6]=p):p=b[6];e=p;k=e;p=a!=null?a:l.threadName;e=p;b[7]!==f?(a=function(){return f()},b[7]=f,b[8]=a):a=b[8];p=a;b[9]===Symbol["for"]("react.memo_cache_sentinel")?(a={className:"xmzvs34 xf159sx"},b[9]=a):a=b[9];var q;b[10]!==g||b[11]!==o||b[12]!==n||b[13]!==m||b[14]!==l.threadType?(q=g?j.jsx(c("MWThreadListLastMessage.react"),{hasOngoingCall:!1,isUnread:o,lastMessageCtaType:null,lastMessageTimestamp:n,showTimestamp:!d("MWCMThreadTypes.react").isUnjoinedCMThread(l.threadType),snippet:m}):null,b[10]=g,b[11]=o,b[12]=n,b[13]=m,b[14]=l.threadType,b[15]=q):q=b[15];b[16]!==e||b[17]!==g?(n=g?j.jsx(c("CometTextWithEntities.react"),{text:e.toString(),transforms:d("MWChatTextTransform").textTransforms}):null,b[16]=e,b[17]=g,b[18]=n):n=b[18];m=!o;b[19]!==n||b[20]!==m||b[21]!==q?(l=j.jsx(c("MWXTextPairing.react"),{body:q,bodyLineLimit:1,headline:n,headlineLineLimit:1,level:4,reduceEmphasis:m}),b[19]=n,b[20]=m,b[21]=q,b[22]=l):l=b[22];b[23]!==k||b[24]!==p||b[25]!==h||b[26]!==l?(e=j.jsx(c("BaseView.react"),{testid:void 0,children:j.jsx(d("MWThreadListFocusableTable.react").MWThreadListFocusableTableRow,{children:j.jsx("div",{role:"row",children:j.jsx(d("MWThreadListFocusableTable.react").MWThreadListFocusableTableCell,{children:j.jsx("div",babelHelpers["extends"]({},a,{role:"gridcell",children:j.jsx(c("MWXListCellPressable.react"),{addOnStart:k,content:l,onPress:p,selected:h,size:"large"})}))})})})}),b[23]=k,b[24]=p,b[25]=h,b[26]=l,b[27]=e):e=b[27];return e}g["default"]=a}),98);
__d("MWThreadListJobsItem.react",["fbt","ix","LSIntEnum","MWThreadListFolderItem.react","MWXIcon_DEPRECATED.react","fbicon","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k,l=j||d("react");function a(a){var b=d("react-compiler-runtime").c(11),e=a.onClick,f=a.responsive,g=a.selected,j=a.size;a=a.thread;var m;b[0]!==e?(m=function(){return e((k||(k=d("LSIntEnum"))).ofNumber(-13))},b[0]=e,b[1]=m):m=b[1];m=m;var n;b[2]===Symbol["for"]("react.memo_cache_sentinel")?(n=l.jsx(c("MWXIcon_DEPRECATED.react"),{color:"primary",icon:d("fbicon")._(i("512668"),32),size:48}),b[2]=n):n=b[2];var o;b[3]===Symbol["for"]("react.memo_cache_sentinel")?(o=(k||(k=d("LSIntEnum"))).ofNumber(-13),b[3]=o):o=b[3];var p;b[4]===Symbol["for"]("react.memo_cache_sentinel")?(p=h._(/*BTDS*/"Jobs").toString(),b[4]=p):p=b[4];b[5]!==m||b[6]!==f||b[7]!==g||b[8]!==j||b[9]!==a?(n=l.jsx(c("MWThreadListFolderItem.react"),{icon:n,onClick:m,responsive:f,selected:g,size:j,systemFolder:o,thread:a,threadName:p}),b[5]=m,b[6]=f,b[7]=g,b[8]=j,b[9]=a,b[10]=n):n=b[10];return n}g["default"]=a}),226);
__d("MAWThreadAPI",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.tables.threads.subscribe(function(a,c){c.operation==="delete"&&b(c.prevValue)})}f.subscribeToThreadsDeletion=a}),66);
__d("useClearDraftOnThreadDelete",["MAWMiActMappingTableAPI","MAWThreadAPI","MAWUIPersistedDataServices","Promise","gkx","promiseDone","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(i||d("react")).useEffect;function k(a,c){return d("MAWMiActMappingTableAPI").getChatJidForThreadKey(a.tables,c.threadKey,c.threadType).then(function(a){return a!=null?d("MAWUIPersistedDataServices").getMAWUIPersistedDataServices().sendUpdateFor("messageComposerDrafts",[{key:a,timestamp:0,value:{draftText:""}}]):(h||(h=b("Promise"))).resolve()})}function a(a){var b=d("react-compiler-runtime").c(3),e,f;b[0]!==a?(e=function(){c("gkx")("16991")&&d("MAWThreadAPI").subscribeToThreadsDeletion(a,function(b){return c("promiseDone")(k(a,b))})},f=[a],b[0]=a,b[1]=e,b[2]=f):(e=b[1],f=b[2]);j(e,f)}g["default"]=a}),98);
__d("MWThreadList.react",["CometHeroHoldTrigger.react","CometHideableComponentExperiment.react","CometPageletWithDiv.react","CometRouterFocusRegion.react","CometTransientDialogProvider.react","CometVisualCompletion","CurrentEnvironment","FBLogger","FocusRegion.react","FocusRegionType","GroupsCometChatsEngagementLogger","I64","Int64Hooks","LSAuthorityLevel","LSIntEnum","LSThreadBitOffset","MWCMGetValidId","MWCreatorMessagingUtils","MWJewelPopoverThreadlistContext.react","MWLSJewelMessageRequestsThreadContainer.react","MWPBaseThreadList.react","MWPBumpEntityKey","MWPParentThreadKeyContext","MWPThreadIsPage.react","MWPThreadsForThreadList","MWResponsiveLayoutConstants","MWResponsiveLayoutContext.react","MWThreadKey.react","MWThreadListEmptyContainer.react","MWThreadListGlimmer.react","MWThreadListItem.react","MWThreadListJobsItem.react","MWThreadListSupportedThreadTypes","MWXacGating","MessagingFolderTag","MessengerWebUXLogger","QPLUserFlow","ReQL","ReQLSuspense","VirtualizationContainerContext","cr:12043","cr:13568","cr:21161","cr:21162","cr:2261","cr:6055","emptyFunction","focusScopeQueries","gkx","isMWXacGroupThread","mwCMIsThreadBumped","qpl","react","react-compiler-runtime","useClearDraftOnThreadDelete","useCommunityFolder","useEmptyFunction","useGroupsCometIsInCCNegativeTest","useMWGetInboxFocusTargetFromRoute","useMWResponsiveLogExtraData","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=i||(i=d("react")),m=i,n=m.useCallback,o=m.useContext,p=m.useId,q=m.useMemo,r=m.useRef;function a(){var a=d("react-compiler-runtime").c(1),b;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b={computeInboxFollowUps:s,reminders:[]},a[0]=b):b=a[0];return b}function s(){}var t=(m=b("cr:12043"))!=null?m:{useInboxFollowUps:a},u=(a=(m=b("cr:21162"))==null?void 0:m.useFilterPinnedThreads)!=null?a:c("useEmptyFunction"),v=b("cr:6055")||c("useEmptyFunction");function w(a){return(j||(j=d("I64"))).equal(a.threadType,(k||(k=d("LSIntEnum"))).ofNumber(15))&&(j||(j=d("I64"))).equal(a.authorityLevel,(k||(k=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))&&(j||(j=d("I64"))).equal(a.lastReadWatermarkTimestampMs,(j||(j=d("I64"))).of_int32(-1))&&(j||(j=d("I64"))).equal(a.lastActivityTimestampMs,(j||(j=d("I64"))).of_int32(-1))}var x=5;function e(a){var e=a.lsEntryPoint,f=a.lsSubEntryPoint,g=a.messagingEntrypoint,h=a.onClickNestedFolderThread,i=a.onClose,m=a.responsive,n=a.selected,p=a.showFollowUpReminder,q=a.thread,s=o(c("MWJewelPopoverThreadlistContext.react")),t=c("useCommunityFolder")({parentThreadKey:(j||(j=d("I64"))).equal(q.threadType,(k||(k=d("LSIntEnum"))).ofNumber(17))?q.threadKey:q.parentThreadKey});a=o(c("MWResponsiveLayoutContext.react"));var u=a.pushCard,v=q.threadKey;d("Int64Hooks").useEffectInt64(function(){if(b("cr:2261")==null)return;s==null||s.add(v);return function(){s==null||s["delete"](v)}},[s,v]);var x=r({loggingTimeout:null,threadKey:(j||(j=d("I64"))).of_int32(-1)}),y=r(j.of_int32(-1)),z=o(c("MWPParentThreadKeyContext"));d("Int64Hooks").useEffectInt64(function(){if(z!=null){var a=(j||(j=d("I64"))).to_string(q.parentThreadKey),b=j.to_string(z);!(j||(j=d("I64"))).equal(y.current,v)&&q.folderName!==c("MessagingFolderTag").COMMUNITY&&a!==b&&c("FBLogger")("messenger_threadlist_folder_inconsistency").mustfix("Render thread item expected folder %s but receive %s",b,a)}w(q)?(j||(j=d("I64"))).equal(x.current.threadKey,v)||(x.current.threadKey=v,x.current.loggingTimeout=window.setTimeout(function(){c("FBLogger")("messenger_web").mustfix("Thread ID %s showing up as ghost",(j||(j=d("I64"))).to_string(v)),x.current.loggingTimeout=null},5e3)):(j||(j=d("I64"))).equal(x.current.threadKey,v)&&x.current.loggingTimeout!=null&&window.clearTimeout(x.current.loggingTimeout)},[z,q,v]);a=d("Int64Hooks").useCallbackInt64(function(){d("MWCreatorMessagingUtils").isAPPlusMessageRequest(q)&&c("QPLUserFlow").start(c("qpl")._(421070823,"2981"),{annotations:{string:{entrypoint:d("MWCreatorMessagingUtils").fetchQPLEntrypoint(q)}},instanceKey:(j||(j=d("I64"))).to_int32(q.threadKey)}),c("mwCMIsThreadBumped")({secondaryParentThreadKey:q.secondaryParentThreadKey,threadType:q.threadType})&&d("GroupsCometChatsEngagementLogger").log({action:"tap",client_extras:{is_bumped:"true"},community_id:t?(j||(j=d("I64"))).to_string(t.folderId):(j||(j=d("I64"))).to_string(q.parentThreadKey),event:"thread_open",group_id:d("MWCMGetValidId").MWCMHasValidFbGroupId(t==null?void 0:t.fbGroupId)?(j||(j=d("I64"))).to_string(t.fbGroupId):null,source:"chat_row",surface:e==="jewel"?"jewel_tray":"messenger_inbox",thread_id:(j||(j=d("I64"))).to_string(v)}),c("gkx")("24056")&&n&&u(d("MWResponsiveLayoutConstants").MWLayoutPanel.MESSAGE_LIST_PANEL)},[q.secondaryParentThreadKey,q.threadType,q.parentThreadKey,t,e,v,n,u]);if((j||(j=d("I64"))).equal(q.threadType,(k||(k=d("LSIntEnum"))).ofNumber(6))){if((j||(j=d("I64"))).equal(v,(k||(k=d("LSIntEnum"))).ofNumber(-13)))return l.jsx(c("MWThreadListJobsItem.react"),{onClick:h,responsive:m,selected:n,size:56,thread:q});else if(b("cr:2261")!=null&&(j||(j=d("I64"))).equal(v,(k||(k=d("LSIntEnum"))).ofNumber(-12))&&!c("gkx")("17132"))return l.jsx(b("cr:2261"),{onClick:h,responsive:m,selected:n,size:56,thread:q});else if(b("cr:13568")!=null&&(j||(j=d("I64"))).equal(v,(k||(k=d("LSIntEnum"))).ofNumber(-18)))return l.jsx(b("cr:13568"),{onClick:h,responsive:m,selected:n,size:56,thread:q});return null}return l.jsx(d("CometPageletWithDiv.react").Placeholder,{fallback:l.jsx(c("MWThreadListGlimmer.react"),{parentComponentForDebug:"MWThreadListItem"}),name:"MWThreadListThreadListRow",children:l.jsx(d("MWPThreadIsPage.react").Provider,{threadKey:q.threadKey,children:l.jsx(d("MWThreadKey.react").MWThreadKeyProvider,{id:q.threadKey,children:l.jsx(c("CometTransientDialogProvider.react"),{children:l.jsx(c("MWThreadListItem.react"),{lsEntryPoint:e,lsSubEntryPoint:f,messagingEntrypoint:g,onClose:i,onThreadSelected:a,responsive:m,selected:n,showFollowUpReminder:p,size:56,thread:q})})})})})}e.displayName=e.name+" [from "+f.id+"]";var y=l.memo(e);function z(a){var e=a.gridLabel,g=a.filter,i=a.customThreadFilter,m=a.header,o=a.lsEntryPoint,s=a.onOpenMessageRequests,w=a.lsSubEntryPoint,z=a.parentThreadKey,B=a.responsive,C=a.selectedThreadKey,D=a.setHasScrolled,E=a.setIsEmptyInbox,F=a.threadListMessagingEntrypoint,G=a.onClose,H=G===void 0?c("emptyFunction"):G;G=a.onClickNestedFolderThread;var I=G===void 0?c("emptyFunction"):G;G=a.preamble;var J=(h||(h=c("useReStore")))(),K=d("ReQLSuspense").useFirst(function(){return d("ReQL").fromTableAscending(J.tables.threads_ranges_v2__generated).getKeyRange(z)},[J,z],f.id+":387");c("useClearDraftOnThreadDelete")(J);var L=d("ReQLSuspense").useArray(function(){return d("MWPThreadsForThreadList").createIterable(J,z,K,["lastActivityTimestampMs","threadType"].concat(d("LSThreadBitOffset").threadCapabilityFields)).filter(function(a){if(!c("MWThreadListSupportedThreadTypes").some(function(b){return(j||(j=d("I64"))).equal(a.threadType,b)}))return!1;return d("MWXacGating").isGroupsEnabled()?!0:!c("isMWXacGroupThread")(a)}).take(5)},[J,z,K],f.id+":402").pop();a=p();var M=d("ReQLSuspense").useFirst(function(){return C!=null?d("ReQL").fromTableAscending(J.tables.threads,["parentThreadKey"]).getKeyRange(C):d("ReQL").empty()},[J,C],f.id+":428");v(a);var N=d("useGroupsCometIsInCCNegativeTest").useShouldDisableBumpToInboxForNegativeTest(),O=t.useInboxFollowUps(),P=O.computeInboxFollowUps,Q=O.reminders;O=n(function(a){if(a==null)return l.jsx("div",{});if(d("CurrentEnvironment").facebookdotcom&&c("mwCMIsThreadBumped")({secondaryParentThreadKey:a.secondaryParentThreadKey,threadType:a.threadType})&&N)return l.jsx("div",{});var b;(j||(j=d("I64"))).equal(a.threadKey,(k||(k=d("LSIntEnum"))).ofNumber(-13))||(j||(j=d("I64"))).equal(a.threadKey,(k||(k=d("LSIntEnum"))).ofNumber(-12))||(j||(j=d("I64"))).equal(a.threadKey,(k||(k=d("LSIntEnum"))).ofNumber(-18))?b=M!=null&&(j||(j=d("I64"))).equal(a.threadKey,M.parentThreadKey):b=C!=null&&(j||(j=d("I64"))).equal(C,a.threadKey);return a!=null?l.jsx(c("CometHideableComponentExperiment.react"),{callingSurface:"thread_list",disableHiding:!0,children:l.jsx(y,{lsEntryPoint:o==="inboxThreadList"?L!=null&&(j||(j=d("I64"))).le(a.lastActivityTimestampMs,L.lastActivityTimestampMs)?"inboxRecentThreads":"inboxRemainingThreads":o,lsSubEntryPoint:w,messagingEntrypoint:F!=null?F:"jewel",onClickNestedFolderThread:I,onClose:H,responsive:B,selected:b,showFollowUpReminder:Q.find(function(b){return(j||(j=d("I64"))).equal(b,a.threadKey)})!=null,thread:a})}):l.jsx("div",{})},[o,L,F,I,H,B,M,C,N,Q]);var R=n(function(a){D&&D(function(b){return a.scrollTop>0})},[D]),S=c("useMWResponsiveLogExtraData")();S=c("MessengerWebUXLogger").useImpressionLoggerRef({eventName:"threadlist_impression",extraData:S});var T=r(null),U=q(function(){return{rootElementRef:T}},[T]),V=n(function(a){T.current=(a=a==null?void 0:a.getScrollAreaElement())!=null?a:null},[]),W=u(),X=n(function(a){return(W!=null?W(a):!0)&&(i!=null?i(a):!0)},[W,i]),Y=c("useMWGetInboxFocusTargetFromRoute")();Y=Y===1;U=l.jsx(d("CometPageletWithDiv.react").Placeholder,{className:"x78zum5 xmz0i5r x6ikm8r x10wlt62",fallback:null,name:"MWThreadList",children:l.jsx(c("MWPParentThreadKeyContext").Provider,{value:z,children:l.jsx(c("VirtualizationContainerContext").Provider,{value:U,children:l.jsx(c("MWPBaseThreadList.react"),{beforeContent:l.jsxs(l.Fragment,{children:[l.jsx(c("MWLSJewelMessageRequestsThreadContainer.react"),{onOpenMessageRequests:s}),G,b("cr:21161")&&l.jsx(d("CometPageletWithDiv.react").Placeholder,{fallback:null,name:"MWPinnedThreadsList",children:l.jsx(b("cr:21161"),{customThreadFilter:i,parentThreadKey:z,renderItem:O})})]}),customThreadFilter:X,emptyContent:l.jsx(c("MWThreadListEmptyContainer.react"),{filter:g,parentThreadKey:z}),filter:g,gridLabel:e,imperativeRef:V,onDataLoaded:P,onLoadMoreThreads:function(){d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.threadlist","load_more_threads"),c("CometVisualCompletion").addFirstMarkerPoint("threadListLoadMoreThreads")},onScroll:R,pageSize:15,parentThreadKey:z,renderItem:O,renderLoadingAnimation:function(a,b){b=a==="onBottom"&&b>x;return l.jsxs("div",{children:[l.jsx(c("MWThreadListGlimmer.react"),{numberOfItems:2,parentComponentForDebug:"MWThreadListLoadingAnimation",vcIgnore:b}),l.jsx(c("CometHeroHoldTrigger.react"),{description:"ThreadListLoadingMoreItems."+a,hold:!b})]})},setIsEmptyInbox:E})})})});return l.jsxs("div",{className:"x78zum5 xdt5ytf x1iyjqo2 x6ikm8r x10wlt62",id:a,ref:S,children:[m!=null?l.jsx(d("FocusRegion.react").FocusRegion,{children:m}):null,l.jsx(A,{autoFocusQuery:d("focusScopeQueries").tabbableScopeQuery,enabled:Y,children:l.jsx(d("FocusRegion.react").FocusRegion,{autoFocusQuery:Y?d("focusScopeQueries").tabbableScopeQuery:void 0,recoverFocusQuery:d("focusScopeQueries").tabbableScopeQuery,recoverFocusStrategy:d("FocusRegionType").RecoverFocusStrategy.Nearest,children:U})})]})}z.displayName=z.name+" [from "+f.id+"]";function A(a){var b=d("react-compiler-runtime").c(3),e=a.autoFocusQuery,f=a.children;a=a.enabled;if(!a)return f;b[0]!==e||b[1]!==f?(a=l.jsx(c("CometRouterFocusRegion.react"),{autoFocusQuery:e,children:f}),b[0]=e,b[1]=f,b[2]=a):a=b[2];return a}g["default"]=z}),98);
__d("MWJewelNestedFolderThreadList.react",["CometScrollView.react","CometTopNavListDropdownCard.react","MWJewelNestedFolderThreadListHeader.react","MWThreadList.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=d("react-compiler-runtime").c(13),e=a.folder,f=a.onClose,g=a.onReturn;a=a.title;var h;b[0]!==g||b[1]!==a?(h=i.jsx(c("MWJewelNestedFolderThreadListHeader.react"),{onReturn:g,title:a}),b[0]=g,b[1]=a,b[2]=h):h=b[2];b[3]!==a?(g=typeof a==="string"?a:a.toString(),b[3]=a,b[4]=g):g=b[4];b[5]!==e||b[6]!==f||b[7]!==g?(a=i.jsx(c("MWThreadList.react"),{gridLabel:g,lsEntryPoint:"jewelNestedFolder",onClose:f,parentThreadKey:e,responsive:!1}),b[5]=e,b[6]=f,b[7]=g,b[8]=a):a=b[8];b[9]===Symbol["for"]("react.memo_cache_sentinel")?(e=i.jsx("div",{className:"x1qx5ct2"}),b[9]=e):e=b[9];b[10]!==h||b[11]!==a?(f=i.jsx(c("CometTopNavListDropdownCard.react"),{useMaxHeight:!0,children:i.jsxs(c("CometScrollView.react"),{showsHorizontalScrollIndicator:!1,showsVerticalScrollIndicator:!0,children:[h,a,e]})}),b[10]=h,b[11]=a,b[12]=f):f=b[12];return f}g["default"]=a}),98);
__d("MWSearchLoggingTypes",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({Jewel:"jewel",Inbox:"inbox"});f.SearchSurface=a}),66);
__d("UniversalSearchQueryChangedFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("843");b=d("FalcoLoggerInternal").create("universal_search_query_changed",a);e=b;g["default"]=e}),98);
__d("UniversalSearchStartFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("840");b=d("FalcoLoggerInternal").create("universal_search_start",a);e=b;g["default"]=e}),98);
__d("MWJewelLightspeedSearchTypeaheadViewList.react",["CometScrollView.react","MWChatSearchLightspeedTypeaheadViewList.react","react","react-compiler-runtime","vulture"],(function(a,b,c,d,e,f,g){"use strict";var h=["xstyle"],i,j=i||d("react"),k={scroll:{maxHeight:"x1wxkln1",$$css:!0}};function a(a){var b=d("react-compiler-runtime").c(10),e,f;b[0]!==a?(f=a.xstyle,e=babelHelpers.objectWithoutPropertiesLoose(a,h),b[0]=a,b[1]=e,b[2]=f):(e=b[1],f=b[2]);c("vulture")("Dlyexjj6K4WOvAciw1xN9UR4a7E=");b[3]!==f?(a=[k.scroll,f],b[3]=f,b[4]=a):a=b[4];b[5]!==e?(f=j.jsx(c("MWChatSearchLightspeedTypeaheadViewList.react"),babelHelpers["extends"]({showActionItems:!1},e)),b[5]=e,b[6]=f):f=b[6];b[7]!==a||b[8]!==f?(e=j.jsx(c("CometScrollView.react"),{showsHorizontalScrollIndicator:!1,xstyle:a,children:f}),b[7]=a,b[8]=f,b[9]=e):e=b[9];return e}g["default"]=a}),98);
__d("MWJewelSearchEmptyState.react",["fbt","MWXText.react","react","react-compiler-runtime","useCometTypeaheadEmptyState"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react");function a(a){var b=d("react-compiler-runtime").c(3);a=a.queryString;var e=c("useCometTypeaheadEmptyState")(),f;b[0]!==e||b[1]!==a?(f=e?j.jsxs("div",{className:"xz9dl7a xpdmqnj xsag5q8 x1g0dm76",children:[j.jsx(c("MWXText.react"),{align:"center",type:"body2",children:h._(/*BTDS*/"Nothing found")}),j.jsx("br",{}),j.jsx(c("MWXText.react"),{align:"center",color:"tertiary",type:"body3",children:h._(/*BTDS*/"We couldn't find any matches for \"{query}.\" Try checking for typos or using complete words.",[h._param("query",a)])})]}):null,b[0]=e,b[1]=a,b[2]=f):f=b[2];return f}g["default"]=a}),226);
__d("createMWJewelSearchTypeaheadViewStrategy.react",["CometTypeaheadProgressGlimmer.react","MWJewelLightspeedSearchTypeaheadViewList.react","MWJewelSearchEmptyState.react","MWJewelSearchTypeaheadViewItem.react","gkx","react"],(function(a,b,c,d,e,f,g){"use strict";var h=["ariaProps","entries","extraViewProps","highlightedEntry","isLoading","onAbandonTypeahead_DO_NOT_USE"],i,j=i||d("react");function a(a,b){return function(d){var e=d.ariaProps,f=d.entries;d.extraViewProps;var g=d.highlightedEntry,i=d.isLoading;d.onAbandonTypeahead_DO_NOT_USE;var k=babelHelpers.objectWithoutPropertiesLoose(d,h);d=f.length===0&&k.queryString.length>0;var l=f.length>0&&i;i=f.length===0&&i&&k.queryString.length===0&&c("gkx")("15587");return i?j.jsx(c("CometTypeaheadProgressGlimmer.react"),{}):d?j.jsx(c("MWJewelSearchEmptyState.react"),{queryString:k.queryString}):j.jsxs(j.Fragment,{children:[j.jsx(c("MWJewelLightspeedSearchTypeaheadViewList.react"),{ariaProps:e,entries:f,highlightedEntry:g,xstyle:a,children:function(a){var d=a.entry,e=a.isActive;a=a.itemRole;return j.createElement(c("MWJewelSearchTypeaheadViewItem.react"),babelHelpers["extends"]({},k,{entry:d,extraViewItemProps:{loggingSessionId:b},isActive:e,key:d.key,role:a}))}}),l&&j.jsx(c("CometTypeaheadProgressGlimmer.react"),{})]})}}g["default"]=a}),98);
__d("MWJewelSearchSubscriptionTypeahead.react",["fbt","BaseSubscriptionTypeahead.react","CometTypeaheadBackButton.react","CometTypeaheadInputRoundedStrategy.react","CometTypeaheadLayoutContextualStrategy.react","MWChatSearchResultType","MWChatSearchSurfaces","MWChatSearchTypeaheadLightspeedSubscriptionDataSource","MWFacebookUserWithoutMessengerAccess","MWInboxRouteBuilder","MWLSSearchIssueSearchQuerySupportedTypes","MWLSThreadDisplayContext","MWPConversationSearchLogger","MWSearchLogging","MWSearchLoggingTypes","MWSearchQPLLogger","UniversalSearchEndFalcoEvent","UniversalSearchQueryChangedFalcoEvent","UniversalSearchStartFalcoEvent","cr:2012305","cr:8414","createMWJewelSearchTypeaheadViewStrategy.react","gkx","isArmadillo","react","useCometRouterDispatcher","useReStore","uuidv4","xplatToDOMRef"],(function(a,b,c,d,e,f,g,h){"use strict";var i=["onChange","onFocus","onPressEntry","onSelectFreeformQuery"],j,k,l=k||(k=d("react"));e=k;var m=e.useCallback,n=e.useEffect,o=e.useMemo,p=e.useRef,q=e.useState,r={searchInput:{marginTop:"x1xmf6yo",marginInlineEnd:"x14z9mp",marginBottom:"x1e56ztr",marginInlineStart:"x1lziwak",paddingTop:"xexx8yu",paddingInlineEnd:"xv54qhq",paddingBottom:"x18d9i69",paddingInlineStart:"xf7dkkf",$$css:!0},searchView:{borderStartStartRadius:"x1obq294",borderStartEndRadius:"x5a5i1n",borderEndEndRadius:"xde0f50",borderEndStartRadius:"x15x8krk",boxShadow:"x1gnnqk1",display:"x78zum5",minHeight:"xphu8jj",$$css:!0}},s=function(a){return c("createMWJewelSearchTypeaheadViewStrategy.react")(null,a)},t=c("gkx")("23390");function a(a){var e=a.onChange,f=a.onFocus,g=a.onPressEntry,k=a.onSelectFreeformQuery,u=babelHelpers.objectWithoutPropertiesLoose(a,i);a=q(null);var v=a[0],w=a[1],x=p(null),y=(j||(j=c("useReStore")))(),z=p(!1),A=b("cr:8414")();n(function(){var a=x.current;b("cr:2012305")!==null&&a!=null&&b("cr:2012305").trackTypingPerf(a,"MWJewelSearchTypeahead");return function(){b("cr:2012305")!==null&&a!=null&&b("cr:2012305").unregisterTypingPerf(a)}},[x]);var B=d("MWLSThreadDisplayContext").useMWLSThreadDisplayContext();a=o(function(){return new(c("MWChatSearchTypeaheadLightspeedSubscriptionDataSource"))({database:y,excludedIDs:[],includeGroupSearch:B!=="ChatTab",includeMessageSearchEntry:c("gkx")("5801"),includeRecommendations:!0,lightspeedSupportedTypes:d("MWLSSearchIssueSearchQuerySupportedTypes").allSupportedTypes,source:c("MWChatSearchSurfaces").universal})},[y,B]);var C=m(function(){w(null),v!=null&&(z.current||(c("UniversalSearchEndFalcoEvent").log(function(){return{end_action:8,is_epd:t,session_id:v,transport_type:null}}),z.current=!0)),d("MWSearchQPLLogger")==null||d("MWSearchQPLLogger").qplCancel("abandon"),e("")},[e,v]),D=c("useCometRouterDispatcher")(),E=m(function(a){var b=a.rawData.resultType;if(b===c("MWChatSearchResultType").MESSAGE&&a.rawData.query!=null&&c("gkx")("5801")){b=d("MWInboxRouteBuilder").buildMultiThreadMesageSearchURL({search:a.rawData.query});D!=null&&b!=null&&(c("MWPConversationSearchLogger").logUniversalMessageSearch(),D.go(b,{}))}else A==null||A(a);b=function(){g!=null&&g(a)};if(v==null){b();return}d("MWSearchLogging").logResultSelected(v,u.queryString,a,z);b()},[g,v,u.queryString,D,A]);n(function(){return function(){d("MWSearchQPLLogger")==null||d("MWSearchQPLLogger").qplCancel("abandon")}},[]);var F=m(function(){var a=c("uuidv4")();w(a);d("MWSearchQPLLogger")==null||d("MWSearchQPLLogger").qplStart({queryString:"",sessionInstanceId:a,surface:d("MWSearchLoggingTypes").SearchSurface.Jewel});z.current=!1;c("UniversalSearchStartFalcoEvent").log(function(){return{is_epd:t,search_surface:0,session_id:a}});c("UniversalSearchQueryChangedFalcoEvent").log(function(){return{query_length:"0",query_string:null,session_id:a}})},[y]),G=m(function(a){v!=null&&(c("UniversalSearchQueryChangedFalcoEvent").log(function(){return{query_length:a.length.toString(),query_string:a,session_id:v}}),d("MWSearchQPLLogger")==null||d("MWSearchQPLLogger").qplStart({queryString:a,sessionInstanceId:v,surface:d("MWSearchLoggingTypes").SearchSurface.Jewel})),e(a)},[e,v]),H=function(){f()},I=d("MWFacebookUserWithoutMessengerAccess").useIsFacebookUserWithoutMessengerAccess(),J=h._(/*BTDS*/"Search Messenger"),K=h._(/*BTDS*/"Search messages");I=I?K:J;return l.jsx(c("BaseSubscriptionTypeahead.react"),{dataSource:a,dataSourceFetchConfigParams:c("isArmadillo")()?{requestFlow:"network-upon-approve"}:void 0,inputExtraProps:{hideIconAnimation:!0,hideIconOnFocus:!0},inputRef:d("xplatToDOMRef").xplatToInputRef(x),inputStartContent:v!=null?l.jsx(c("CometTypeaheadBackButton.react"),{testid:void 0}):null,inputStrategyRenderer:c("CometTypeaheadInputRoundedStrategy.react"),layoutStrategyRenderer:c("CometTypeaheadLayoutContextualStrategy.react"),loggingContext:"messenger_jewel",onChange:G,onClose:C,onFocus:H,onOpen:F,onPressEntry:E,onSelectFreeformQuery:k,placeholder:I,queryString:u.queryString,shouldCloseOnEnter:!1,shouldHandleCloseAfterHandlePressEntry:!0,shouldQueryStringUpdateFromSelectedEntryOnClick:!1,viewStrategyRenderer:s(v),xstyles:{inputXStyle:r.searchInput,viewXStyle_DO_NOT_USE:r.searchView}})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("MWJewelThreadListSearchTypeahead.react",["CometRelay","FBLogger","I64","MWChatSearchFilteringUtils","MWChatSearchResultType","MWJewelSearchSubscriptionTypeahead.react","MWLogInboxFiltersInteraction","MWLogInteraction","MWPSearchSystem","MWThreadCreationUtil","QPLUserFlow","emptyFunction","qpl","react","react-compiler-runtime","setTimeoutCometSpeculative","useCometPreloader","useMWChatOpenTabForGroup","useMWChatOpenTabForPage","useMWChatOpenTabForUser","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=j||(j=d("react"));b=j;b.useCallback;var l=b.useEffect,m=b.useState;function a(a){var b=d("react-compiler-runtime").c(25),e=a.onClose;a=m("");var f=a[0];a=a[1];var g=c("useMWChatOpenTabForGroup")("jewelSearch"),j=g[0],o=c("useMWChatOpenTabForPage")("jewelSearch");g=c("useMWChatOpenTabForUser")("jewelSearch");var p=g.openTabByThreadKey,q=g.openTabForUserWithoutPreloadedNavigationData,r=(h||(h=c("useReStore")))(),s=d("CometRelay").useRelayEnvironment();b[0]!==r?(g=function(){return d("MWPSearchSystem").makeAll(r)},b[0]=r,b[1]=g):g=b[1];var t=g;b[2]!==t?(g=function(){c("setTimeoutCometSpeculative")(t,1e4)},b[2]=t,b[3]=g):g=b[3];l(g,void 0);b[4]!==r||b[5]!==s||b[6]!==p||b[7]!==q?(g=function(a,b){var c=d("MWChatSearchFilteringUtils").getIsE2ee(b.rawData);if(c)return p(a,!0);d("MWThreadCreationUtil").getIsSecureBasedOnContactCapabilitiesForOneToOneThreadV2(b,s,r).then(async function(c){var e=c.isSecureThread;c=c.reason;if(c==="default_e2ee")q({unpreloadedReason:"jewelsearch_not_support_gql",userId:a});else{var f=await r.tables.threads.get((i||(i=d("I64"))).of_string(a));q({isSecureThread:e,reason:"MWJewelThreadListSearchTypeahead, FBID: "+a+", reason: "+(c!=null?c:"")+", searchSource: "+((e=b.rawData.searchSource)!=null?e:"")+", otherUserId: "+((c=b.rawData.otherUserId)!=null?c:"")+", hasCutoverThread: "+((c=(e=b.rawData.hasCutoverThread)==null?void 0:e.toString())!=null?c:"false")+", threadAuthorityLevel: "+(f!=null?(i||(i=d("I64"))).to_string(f.authorityLevel):"null"),unpreloadedReason:"jewelsearch_not_support_gql",userId:a})}}).catch(n)},b[4]=r,b[5]=s,b[6]=p,b[7]=q,b[8]=g):g=b[8];var u=g;b[9]!==e||b[10]!==j||b[11]!==o||b[12]!==u?(g=function(a){var b=a.rawData,d=b.id;b=b.resultType;bb41:switch(b){case c("MWChatSearchResultType").MESSAGE:break bb41;case c("MWChatSearchResultType").GROUP:j(d);break bb41;case c("MWChatSearchResultType").USER:case c("MWChatSearchResultType").AI_BOT:u(d,a);break bb41;case c("MWChatSearchResultType").PAGE:o(d)}e()},b[9]=e,b[10]=j,b[11]=o,b[12]=u,b[13]=g):g=b[13];g=g;var v=c("useCometPreloader")("button_aggressive",c("emptyFunction"),t),w=v.onHoverInPreloader,x=v.onHoverMovePreloader;v=v.onHoverOutPreloader;var y;b[14]!==t?(y=function(){d("MWLogInteraction").logPopoverOpenCancel("initiate_search"),d("MWLogInboxFiltersInteraction").logInboxFiltersNavigationCancel("initiate_search"),t(),c("QPLUserFlow").start(c("qpl")._(25312244,"1683"))},b[14]=t,b[15]=y):y=b[15];b[16]!==g||b[17]!==f||b[18]!==y?(a=k.jsx(c("MWJewelSearchSubscriptionTypeahead.react"),{onChange:a,onFocus:y,onPressEntry:g,queryString:f}),b[16]=g,b[17]=f,b[18]=y,b[19]=a):a=b[19];b[20]!==w||b[21]!==x||b[22]!==v||b[23]!==a?(g=k.jsx("div",{onMouseEnter:w,onMouseLeave:v,onMouseMove:x,children:a}),b[20]=w,b[21]=x,b[22]=v,b[23]=a,b[24]=g):g=b[24];return g}function n(a){c("FBLogger")("messenger_search").mustfix("Error fetching contact capabilities: %s",a)}e=k.memo(a);g.default=e}),98);
__d("CometMessagingJewelDropdownContent.react",["fbt","CometErrorBoundary.react","CometHeroInteractionWithDiv.react","CometMessagingJewelDropdownContentGlimmer.react","CometMessagingJewelDropdownEBUpsellContainer.react","CometPageletWithDiv.react","CometPlaceholder.react","CometRelay","CometTopNavListDropdownCard.react","FBLogger","I64","InteractionTracing","JSResourceForInteraction","LSContactBitOffset","LSIntEnum","LSPlatformErrorsCatcher.react","LSThreadRangeFilter","MAWUnrecoverableErrorBoundary.react","MWCMJewelContext","MWInboxContextSwitcherDeferred.react","MWInboxContextSwitcherGlimmer.react","MWInboxContextSwitcherUtils","MWInboxTrayContainer.react","MWInboxTrayGating","MWJewelDropdownHeader.react","MWJewelMessengerLink.react","MWJewelNestedFolderThreadList.react","MWJewelPopoverDialogContext.react","MWJewelThreadListSearchTypeahead.react","MWResponsiveLayoutContext.react","MWThreadList.react","ODS","ReQL","ReQLSuspense","WebUXLoggingEntryPointContextProvider","XCometMessengerControllerRouteBuilder","gkx","lazyLoadComponent","qpl","react","react-compiler-runtime","useCometInteractionTracing","useMWChatSearchClearSearchResults","useReStore"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l,m,n=m||(m=d("react"));b=m;e=b.memo;b.useCallback;var o=b.useContext,p=b.useEffect,q=b.useState,r=c("lazyLoadComponent")(c("JSResourceForInteraction")("MAWJewelMessageRequestsAndSpamDropdownWithTab.react").__setRef("CometMessagingJewelDropdownContent.react")),s=c("lazyLoadComponent")(c("JSResourceForInteraction")("MWRestrictedAccountsList.react").__setRef("CometMessagingJewelDropdownContent.react")),t=c("lazyLoadComponent")(c("JSResourceForInteraction")("MWJewelArchivedChatsDropdown.react").__setRef("CometMessagingJewelDropdownContent.react")),u=c("lazyLoadComponent")(c("JSResourceForInteraction")("CometMessagingJewelDropdownErrorState.react").__setRef("CometMessagingJewelDropdownContent.react")),v=h._(/*BTDS*/"Chats");function w(a){c("FBLogger")("messenger_web_entrypoints").catching(a).mustfix("CometMessagingJewelDropdownQPBannerContainer failed to render")}var x=c("gkx")("22839")===!0;function y(a){var b=d("react-compiler-runtime").c(101),e=a.ebSoftblockUpsell,g=a.ebUpsellContainerQueryRef,m=a.mwInboxTrayContainerQuery,u=a.onClose,y=a.pushPage;a=o(c("MWResponsiveLayoutContext.react"));a=a.isDenseMode;var A=o(c("MWJewelPopoverDialogContext.react")),B=A.setIsOpenForDialog,C=c("useMWChatSearchClearSearchResults")();b[0]!==C||b[1]!==u?(A=function(){C(),u()},b[0]=C,b[1]=u,b[2]=A):A=b[2];var D=A,E;b[3]!==C?(A=function(){return C},E=[C],b[3]=C,b[4]=A,b[5]=E):(A=b[4],E=b[5]);p(A,E);b[6]===Symbol["for"]("react.memo_cache_sentinel")?(A=c("XCometMessengerControllerRouteBuilder").buildURL({}),b[6]=A):A=b[6];E=A;A=o(c("MWCMJewelContext"));var F=A.MWCMBlendedThreadListEntrypointRef,G=A.selectedFilterTab,H=A.setSelectedFilterTab;A=q();var I=A[0],J=A[1];b[7]===Symbol["for"]("react.memo_cache_sentinel")?(A=c("qpl")._(30610001,"3003"),b[7]=A):A=b[7];var K=c("useCometInteractionTracing")(A,"fast","INTERACTION"),L=(i||(i=c("useReStore")))();b[8]!==L.tables._user_info?(A=function(){return d("ReQL").fromTableAscending(L.tables._user_info).map(z)},b[8]=L.tables._user_info,b[9]=A):A=b[9];var M;b[10]!==L?(M=[L],b[10]=L,b[11]=M):M=b[11];var N=d("ReQLSuspense").useFirst(A,M,f.id+":155");b[12]!==L.tables.contacts||b[13]!==N?(A=function(){return N!=null?d("ReQL").fromTableAscending(L.tables.contacts,["capabilities","capabilities2"]).getKeyRange(N):d("ReQL").empty()},b[12]=L.tables.contacts,b[13]=N,b[14]=A):A=b[14];b[15]!==L||b[16]!==N?(M=[L,N],b[15]=L,b[16]=N,b[17]=M):M=b[17];var O=d("ReQLSuspense").useFirst(A,M,f.id+":159");b[18]!==D||b[19]!==y?(A=function(){var a=c("InteractionTracing").startInteraction({interactionClass:"fast",qplEvent:c("qpl")._(30607516,"756"),tracePolicy:"comet.jewel.message_requests",traceType:"INTERACTION"});y(function(b){b=b.onReturn;return n.jsx(d("CometPageletWithDiv.react").Placeholder,{fallback:n.jsx(c("CometMessagingJewelDropdownContentGlimmer.react"),{isFullHeight:!1,title:v,withBackButton:!0}),name:"MAWJewelMessageRequestsAndSpamDropdownWithTab",children:n.jsx(r,{interactionID:a,onClose:D,onReturn:b})})})},b[18]=D,b[19]=y,b[20]=A):A=b[20];M=A;b[21]!==M||b[22]!==G?(A=d("MWInboxContextSwitcherUtils").shouldShowMessageRequestsFromFilter(G)?M:void 0,b[21]=M,b[22]=G,b[23]=A):A=b[23];A=A;var P;b[24]!==D||b[25]!==y?(P=function(){y(function(a){a=a.onReturn;return n.jsx(s,{hidePage:a,onClose:D})})},b[24]=D,b[25]=y,b[26]=P):P=b[26];P=P;var Q;b[27]!==D||b[28]!==y?(Q=function(){(j||(j=d("ODS"))).bumpEntityKey(3185,"mw_jewel","archived_chats"),y(function(a){a=a.onReturn;return n.jsx(t,{onClose:D,onReturn:a})})},b[27]=D,b[28]=y,b[29]=Q):Q=b[29];Q=Q;var R;b[30]!==D||b[31]!==y||b[32]!==O?(R=function(a){y(function(b){b=b.onReturn;switch((k||(k=d("I64"))).to_int32(a)){case-13:return n.jsx(c("MWJewelNestedFolderThreadList.react"),{folder:a,onClose:D,onReturn:b,title:h._(/*BTDS*/"Jobs")});case-12:var e=O!=null&&d("LSContactBitOffset").has(86,O),f=h._(/*BTDS*/"Marketplace");e&&(f=h._(/*BTDS*/"_j[\"Buy and sell groups\",\"6a9a0529abd169ff91b49b4022dbf5a5\",1]"));return n.jsx(c("MWJewelNestedFolderThreadList.react"),{folder:a,onClose:D,onReturn:b,title:f});default:c("FBLogger")("messenger_web_entrypoints").mustfix("Attempted to show an unimplemented nested system folder");return null}})},b[30]=D,b[31]=y,b[32]=O,b[33]=R):R=b[33];R=R;var S;b[34]!==e||b[35]!==a||b[36]!==m||b[37]!==D?(S=!a&&e==null?n.jsx(c("MWInboxTrayContainer.react"),{mwInboxTrayContainerQuery:m,onClose:D}):null,b[34]=e,b[35]=a,b[36]=m,b[37]=D,b[38]=S):S=b[38];a=S;b[39]!==e||b[40]!==g||b[41]!==G?(m=n.jsx(c("CometMessagingJewelDropdownEBUpsellContainer.react"),{ebSoftblockUpsell:e,ebUpsellContainerQueryRef:g,selectedFilterTab:G}),b[39]=e,b[40]=g,b[41]=G,b[42]=m):m=b[42];S=m;g=d("MWInboxTrayGating").isInboxTrayEnabled();b[43]!==G?(m=d("MWInboxContextSwitcherUtils").getCustomThreadFilter(G),b[43]=G,b[44]=m):m=b[44];m=m;var T;b[45]!==G?(T=d("MWInboxContextSwitcherUtils").getParentThreadKeyFromFilter(G),b[45]=G,b[46]=T):T=b[46];T=T;var U;b[47]!==D||b[48]!==Q||b[49]!==M||b[50]!==P?(U=n.jsx(d("CometPageletWithDiv.react").Placeholder,{fallback:null,name:"MWJewelDropdownHeader",children:n.jsx(c("MWJewelDropdownHeader.react"),{inboxUrl:E,onClose:D,onOpenArchivedChats:Q,onOpenMessageRequests:M,onOpenRestrictedAccountsList:P,title:v})}),b[47]=D,b[48]=Q,b[49]=M,b[50]=P,b[51]=U):U=b[51];b[52]===Symbol["for"]("react.memo_cache_sentinel")?(Q={className:"x1c4vz4f"},b[52]=Q):Q=b[52];b[53]!==D||b[54]!==y?(P=n.jsx(d("CometPageletWithDiv.react").Placeholder,{fallback:null,name:"MWJewelThreadListSearchTypeahead",children:n.jsx(c("MWJewelThreadListSearchTypeahead.react"),{onClose:D,pushPage:y})}),b[53]=D,b[54]=y,b[55]=P):P=b[55];var V=g?S:null,W;b[56]===Symbol["for"]("react.memo_cache_sentinel")?(W=n.jsx(c("MWInboxContextSwitcherGlimmer.react"),{}),b[56]=W):W=b[56];var X;b[57]!==K||b[58]!==B||b[59]!==H?(X=function(a){K(function(a){J(a.getTraceId())},void 0,void 0,"comet.jewel.messenger."+d("MWInboxContextSwitcherUtils").getTracePolicyFromFilter(a)),B(!1),H==null||H(a)},b[57]=K,b[58]=B,b[59]=H,b[60]=X):X=b[60];b[61]!==R||b[62]!==M||b[63]!==T||b[64]!==G||b[65]!==X?(W=n.jsx(d("CometPageletWithDiv.react").Placeholder,{fallback:W,name:"MWInboxContextSwitcher",children:n.jsx(c("MWInboxContextSwitcherDeferred.react"),{entryPoint:"jewel",onTabChange:X,parentThreadKey:T,selectedFilterTab:G,showMessageRequests:M,showNestedFolderThreads:R})}),b[61]=R,b[62]=M,b[63]=T,b[64]=G,b[65]=X,b[66]=W):W=b[66];b[67]!==a||b[68]!==P||b[69]!==V||b[70]!==W?(M=n.jsxs("div",babelHelpers["extends"]({},Q,{children:[P,V,a,W]})),b[67]=a,b[68]=P,b[69]=V,b[70]=W,b[71]=M):M=b[71];X=g?null:S;b[72]!==U||b[73]!==M||b[74]!==X?(Q=n.jsxs(n.Fragment,{children:[U,M,X]}),b[72]=U,b[73]=M,b[74]=X,b[75]=Q):Q=b[75];a=Q;b[76]!==G?(P=d("MWInboxContextSwitcherUtils").getJewelEntryPointFromFilter(G),b[76]=G,b[77]=P):P=b[77];V=P;b[78]!==G?(W=d("MWInboxContextSwitcherUtils").getJewelLsSubEntryPointFromFilter(G),b[78]=G,b[79]=W):W=b[79];g=W;b[80]!==F||b[81]!==m||b[82]!==e||b[83]!==g||b[84]!==R||b[85]!==D||b[86]!==A||b[87]!==T||b[88]!==G?(S=e!=null&&d("MWInboxContextSwitcherUtils").shouldShowEBUpsellFromFilter(G)?n.jsx(n.Fragment,{children:e}):n.jsxs(n.Fragment,{children:[x&&(k||(k=d("I64"))).equal(G,(l||(l=d("LSIntEnum"))).ofNumber(c("LSThreadRangeFilter").COMMUNITIES))?n.jsx(c("CometPlaceholder.react"),{fallback:n.jsx(c("CometMessagingJewelDropdownContentGlimmer.react"),{isFullHeight:!0}),name:"CometMessagingJewelDropdownContent.MWCMBlendedThreadList",children:F!=null?n.jsx(d("CometRelay").EntryPointContainer,{entryPointReference:F,props:{filter:G,gridLabel:v.toString(),header:null,lsEntryPoint:"jewel",lsSubEntryPoint:g,onDropdownClose:D,onError:w,parentThreadKey:T}}):null}):n.jsx(c("MWThreadList.react"),{customThreadFilter:m,filter:G,gridLabel:v.toString(),lsEntryPoint:"jewel",lsSubEntryPoint:g,onClickNestedFolderThread:R,onClose:D,onOpenMessageRequests:A,parentThreadKey:T,responsive:!1},(k||(k=d("I64"))).to_string(G)),n.jsx(c("MWJewelMessengerLink.react"),{onClick:D,url:E})]}),b[80]=F,b[81]=m,b[82]=e,b[83]=g,b[84]=R,b[85]=D,b[86]=A,b[87]=T,b[88]=G,b[89]=S):S=b[89];b[90]!==a||b[91]!==S?(U=n.jsxs(c("CometTopNavListDropdownCard.react"),{testid:void 0,useFullHeight:!0,useMaxHeight:!0,children:[a,S]}),b[90]=a,b[91]=S,b[92]=U):U=b[92];M=U;b[93]===Symbol["for"]("react.memo_cache_sentinel")?(X=n.jsx(c("CometMessagingJewelDropdownContentGlimmer.react"),{isFullHeight:!0,title:v}),b[93]=X):X=b[93];b[94]!==I||b[95]!==G||b[96]!==M?(Q=I!=null?n.jsx(c("CometHeroInteractionWithDiv.react"),{interactionDesc:"JewelThreadList."+d("MWInboxContextSwitcherUtils").getInteractionDescFromFilter(G),interactionUUID:I,children:M}):M,b[94]=I,b[95]=G,b[96]=M,b[97]=Q):Q=b[97];b[98]!==Q||b[99]!==V?(P=n.jsx(d("CometPageletWithDiv.react").Placeholder,{fallback:X,name:"MWJewelDropdownContent",children:n.jsx(d("WebUXLoggingEntryPointContextProvider").WebUXLoggingEntryPointContextProvider,{value:V,children:Q})}),b[98]=Q,b[99]=V,b[100]=P):P=b[100];return P}function z(a){return a.facebookUserId}function a(a){var b=d("react-compiler-runtime").c(2),e=A;b[0]!==a?(e=n.jsx(c("MAWUnrecoverableErrorBoundary.react"),{fallback:e,children:n.jsx(c("CometErrorBoundary.react"),{fallback:e,children:n.jsx(c("LSPlatformErrorsCatcher.react"),{fallback:e,children:n.jsx(y,babelHelpers["extends"]({},a))})})}),b[0]=a,b[1]=e):e=b[1];return e}function A(a){return n.jsx(u,{error:a})}A.displayName=A.name+" [from "+f.id+"]";b=e(a);g["default"]=b}),226);
__d("CometMessagingJewelDropdown.react",["fbt","BaseMultiStepContainer.react","BasePopoverReflowSheetContext","CometMessagingJewelDropdownContent.react","CometTopNavListDropdown.react","MWLogInboxFiltersInteraction","MWLogInteraction","cr:6188","justknobx","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react"));e=i;e.useCallback;var k=e.useContext;function a(a){var e=d("react-compiler-runtime").c(12),f=a.props;a=a.queries;var g=f.onClose,i=a.ebUpsellContainerQueryRef,m=a.mwInboxTrayContainerQuery;f=d("MWLogInteraction").getPopoverTrace();f==null||f.addAnnotation("PopoverEntrypoint","CometMessagingJewelDropdown");a=k(c("BasePopoverReflowSheetContext"));f=a.isReflowSheet;a=l;var n;e[0]===Symbol["for"]("react.memo_cache_sentinel")?(n=h._(/*BTDS*/"Messenger"),e[0]=n):n=e[0];var o;e[1]!==f?(o={0:{className:"x1cvmir6"},1:{className:"x14atkfc"}}[!!f<<0],e[1]=f,e[2]=o):o=e[2];e[3]!==i||e[4]!==m||e[5]!==g?(f=j.jsx(c("BaseMultiStepContainer.react"),{fitContentWidth:!0,onPageChange:a,children:function(a){return j.jsx(c("CometMessagingJewelDropdownContent.react"),{ebUpsellContainerQueryRef:i,mwInboxTrayContainerQuery:m,onClose:g,pushPage:a})}}),e[3]=i,e[4]=m,e[5]=g,e[6]=f):f=e[6];e[7]!==o||e[8]!==f?(a=j.jsx(c("CometTopNavListDropdown.react"),{label:n,name:"MWJewelDropdown",children:j.jsx("div",babelHelpers["extends"]({},o,{children:f}))}),e[7]=o,e[8]=f,e[9]=a):a=e[9];n=a;e[10]!==n?(o=b("cr:6188")!=null?j.jsx(b("cr:6188"),{children:n}):n,e[10]=n,e[11]=o):o=e[11];return o}function l(a){a>0&&c("justknobx")._("3802")&&(d("MWLogInteraction").logPopoverOpenCancel("popover_page_change"),d("MWLogInboxFiltersInteraction").logInboxFiltersNavigationCancel("popover_page_change"))}g["default"]=a}),226);
__d("FBIconQuestionChatFilled12.svg.react",["XPlatReactSVG","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){return i.jsxs(d("XPlatReactSVG").Svg,babelHelpers["extends"]({viewBox:"0 0 12 13",width:"1em",height:"1em",fill:"currentColor",title:a.title},a,{children:[a.children!=null&&i.jsx(d("XPlatReactSVG").Defs,{children:a.children}),i.jsx(d("XPlatReactSVG").G,{fillRule:"evenodd",transform:"translate(-450 -1073)",children:i.jsx(d("XPlatReactSVG").Path,{d:"M456.743 1080.355v.312a.75.75 0 0 1-1.5 0v-.95a.75.75 0 0 1 .75-.75c.555 0 1.007-.428 1.007-.955 0-.535-.449-.97-1-.97-.551 0-1 .435-1 .97a.75.75 0 1 1-1.5 0c0-1.362 1.122-2.47 2.5-2.47 1.379 0 2.5 1.108 2.5 2.47 0 1.099-.74 2.03-1.757 2.343m-.743 3.103a.897.897 0 1 1 .002-1.793.897.897 0 0 1-.002 1.793m0-9.958a6 6 0 0 0-5.144 9.09l-.856 2.91 3.064-.766A6 6 0 1 0 456 1073.5"})})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;b=a;g["default"]=b}),98);
__d("FDSResizeFreeFilled20PNGIcon.react",["ix","fbicon"],(function(a,b,c,d,e,f,g,h){"use strict";a=d("fbicon")._(h("580260"),20);b=a;g["default"]=b}),98);
__d("LSVerifyThreadsActivityStatus",["LSIssueNewTaskWithExtraOperations"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return d[0]=new c.Map(),d[0].set("server_mode",a[1]),d[0].set("from_timestamp_ms",a[2]),d[0].set("threads",a[3]),d[0].set("session_id",a[0]),d[1]=c.toJSON(d[0]),c.storedProcedure(b("LSIssueNewTaskWithExtraOperations"),"verify_threads_activity_status",c.i64.cast([0,648]),d[1],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),void 0,c.i64.cast([0,0]))},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxVerifyThreadsActivityStatusStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSVerifyThreadsActivityStatusStoredProcedure",["LSSynchronousPromise","LSVerifyThreadsActivityStatus","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSVerifyThreadsActivityStatus"),e.sessionId,e.serverMode,e.fromTimestampMs,e.threads);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MAWUnsupportedIndexedDBNuxKey",["WebStorage"],(function(a,b,c,d,e,f,g){"use strict";var h,i="maw_unsupported_browser_nux_dismissed",j="dismissed";a=function(){var a;return((a=(h||(h=c("WebStorage"))).getLocalStorageForRead())==null?void 0:a.getItem(i))===j};b=function(){var a;(a=(h||(h=c("WebStorage"))).getLocalStorage())==null||a.setItem(i,j)};g.getIsDismissed=a;g.setIsDismissed=b}),98);
__d("MAWUserVisibleErrorsNux.react",["ix","MAWLoggerUtils","MWXIconCautionTriangle","MWXQPCard.react","QPLUserFlow","gkx","qpl","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react")),k=i.useEffect,l={hasNoMargin:{marginTop:"xdj266r",marginInlineEnd:"x14z9mp",marginBottom:"xat24cr",marginInlineStart:"x1lziwak",$$css:!0}};function a(a){var b=d("react-compiler-runtime").c(17),e=a.hasNoMargin,f=a.icon,g=a.nuxBodyText,i=a.nuxButtonProps,m=a.nuxTitleText,n=a.onCloseButtonClick,o=a.ref;a=a.secondaryButtonProps;var p;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(p=d("MAWLoggerUtils").getInstanceKey(),b[0]=p):p=b[0];var q=p,r;b[1]!==m?(p=function(){c("QPLUserFlow").start(c("qpl")._(1056846286,"652"),{annotations:{string:{nuxTitleText:m.toString()}},instanceKey:q});return function(){return c("QPLUserFlow").endSuccess(c("qpl")._(1056846286,"652"),{instanceKey:q})}},r=[q,m],b[1]=m,b[2]=p,b[3]=r):(p=b[2],r=b[3]);k(p,r);b[4]===Symbol["for"]("react.memo_cache_sentinel")?(p=c("gkx")("4425")?h("428841"):h("212797"),b[4]=p):p=b[4];r=p;b[5]===Symbol["for"]("react.memo_cache_sentinel")?(p=c("gkx")("4425")?{props:{src:h("1745665")},type:"image"}:{props:{color:"negative",icon:c("MWXIconCautionTriangle"),size:24},type:"icon"},b[5]=p):p=b[5];p=p;b[6]!==f?(r=f!=null?f:c("gkx")("23219")?{props:{src:r},type:"image"}:p,b[6]=f,b[7]=r):r=b[7];p=e===!0?l.hasNoMargin:void 0;b[8]!==g||b[9]!==i||b[10]!==m||b[11]!==n||b[12]!==o||b[13]!==a||b[14]!==r||b[15]!==p?(f=j.jsx("div",{"data-testid":void 0,children:j.jsx(c("MWXQPCard.react"),{addOnPrimary:i,addOnSecondary:a,body:g,headline:m,icon:r,onClose:n,ref:o,xstyle:p})}),b[8]=g,b[9]=i,b[10]=m,b[11]=n,b[12]=o,b[13]=a,b[14]=r,b[15]=p,b[16]=f):f=b[16];return f}g["default"]=a}),98);
__d("MAWUserVisibleErrorsNuxWrapper.react",["fbt","CometPlaceholder.react","MAWIssueNewUserVisibleErrors","MAWUnsupportedIndexedDBNuxKey","cr:4216","cr:9767","promiseDone","react","react-compiler-runtime","requireDeferred","useMAWGetUserVisibleErrors","useMAWUnsupportedBrowserNUX"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react"));e=i;e.useCallback;var k=e.useState,l=c("requireDeferred")("MAWEncryptionErrorHandler").__setRef("MAWUserVisibleErrorsNuxWrapper.react");function a(a){var e=d("react-compiler-runtime").c(23),f=a.children;a=a.hasNoMargin;var g;e[0]===Symbol.for("react.memo_cache_sentinel")?(g=d("MAWUnsupportedIndexedDBNuxKey").getIsDismissed(),e[0]=g):g=e[0];g=k(g);var i=g[0],n=g[1];if(e[1]===Symbol.for("react.memo_cache_sentinel")){g=(g=b("cr:4216").buildUri({cms_id:"597429858389632"}).setDomain("www.facebook.com"))==null||(g=g.setProtocol("https"))==null?void 0:g.toString();e[1]=g}else g=e[1];g=g;e[2]===Symbol.for("react.memo_cache_sentinel")?(g={label:h._(/*BTDS*/"Learn more"),linkProps:{target:"_blank",url:g}},e[2]=g):g=e[2];g=g;var o=d("useMAWUnsupportedBrowserNUX").useMAWUnsupportedBrowserNUX();o=o.shouldShowQP;var p=k(!1),q=p[0],r=p[1];p=c("useMAWGetUserVisibleErrors")();var s=p[0],t=p[1];e[3]!==t||e[4]!==(s==null?void 0:s.errorExtraData)?(p=function(){c("promiseDone")(async function(){r(!0);if((s==null?void 0:s.errorExtraData)==="MAWEARKeychainDecryptionError"){var a=await l.load();await a.handleEARKeychainError()}return t()}(),m,function(){r(!1)})},e[3]=t,e[4]=s==null?void 0:s.errorExtraData,e[5]=p):p=e[5];p=p;var u;e[6]!==(s==null?void 0:s.errorBodyText)?(u=d("MAWIssueNewUserVisibleErrors").errorMsgBodyToFbtMap.get(s==null?void 0:s.errorBodyText),e[6]=s==null?void 0:s.errorBodyText,e[7]=u):u=e[7];u=u;var v;e[8]!==(s==null?void 0:s.errorTitleText)?(v=d("MAWIssueNewUserVisibleErrors").errorMsgTitleToFbtMap.get(s==null?void 0:s.errorTitleText),e[8]=s==null?void 0:s.errorTitleText,e[9]=v):v=e[9];v=v;e[10]!==f||e[11]!==t||e[12]!==i||e[13]!==u||e[14]!==v||e[15]!==s||e[16]!==a||e[17]!==q||e[18]!==p||e[19]!==o?(g=b("cr:9767")&&o&&!i?j.jsx(b("cr:9767"),{hasNoMargin:a,nuxBodyText:d("MAWIssueNewUserVisibleErrors").MAWUnsupportedIndexedDBErrorMsg,nuxButtonProps:g,nuxTitleText:d("MAWIssueNewUserVisibleErrors").MAWUnsupportedIndexedDBErrorMsgTitle,onCloseButtonClick:function(){n(!0),d("MAWUnsupportedIndexedDBNuxKey").setIsDismissed()}}):s&&b("cr:9767")&&v!=null&&u!=null?j.jsx(b("cr:9767"),{nuxBodyText:u,nuxButtonProps:{disabled:q,label:h._(/*BTDS*/"Refresh"),loading:q,onPress:p},nuxTitleText:v,onCloseButtonClick:function(){c("promiseDone")(t())}}):f,e[10]=f,e[11]=t,e[12]=i,e[13]=u,e[14]=v,e[15]=s,e[16]=a,e[17]=q,e[18]=p,e[19]=o,e[20]=g):g=e[20];e[21]!==g?(f=j.jsx(c("CometPlaceholder.react"),{fallback:null,name:"MAWUserVisibleErrorsNuxWrapper",children:g}),e[21]=g,e[22]=f):f=e[22];return f}function m(){window.location.reload(!0)}g.default=a}),226);
__d("MWEBRestoreJewelSoftblockPersistentBannerWrapperDeferred.withSegmentationCheck.react",["cr:1266"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=b("cr:1266")}),98);
__d("useMWEBIsUpsellDeferred",["MWEncryptedBackupsDeferLocalStorageUpsell","ReQL","ReQLSuspense","react","react-compiler-runtime","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i;(i||d("react")).useMemo;function a(a){var b=d("react-compiler-runtime").c(18);a=a.upsellType;var e=(h||(h=c("useReStore")))(),g;b[0]!==a?(g=d("MWEncryptedBackupsDeferLocalStorageUpsell").getLocalStorageKeys(a),b[0]=a,b[1]=g):g=b[1];a=g;g=a;var i=g.countdownInMS,j=g.impressionsCountKey,k=g.lastImpressionTimeKey,l=g.maxImpressionLimit;b[2]!==i||b[3]!==e.tables.experiences_shared_state||b[4]!==k?(a=function(){return d("ReQL").fromTableAscending(e.tables.experiences_shared_state).getKeyRange(k).map(function(a){a=a.stateValue;return a!=null&&+a+i>Date.now()?!0:!1})},b[2]=i,b[3]=e.tables.experiences_shared_state,b[4]=k,b[5]=a):a=b[5];b[6]!==i||b[7]!==e||b[8]!==k?(g=[i,e,k],b[6]=i,b[7]=e,b[8]=k,b[9]=g):g=b[9];a=d("ReQLSuspense").useFirst(a,g,f.id+":41");b[10]!==e.tables.experiences_shared_state||b[11]!==j||b[12]!==l?(g=function(){return d("ReQL").fromTableAscending(e.tables.experiences_shared_state).getKeyRange(j).map(function(a){a=a.stateValue;return l===d("MWEncryptedBackupsDeferLocalStorageUpsell").INFINITE_IMPRESSIONS_LIMIT||+a<l?!1:!0})},b[10]=e.tables.experiences_shared_state,b[11]=j,b[12]=l,b[13]=g):g=b[13];var m;b[14]!==e||b[15]!==j||b[16]!==l?(m=[e,j,l],b[14]=e,b[15]=j,b[16]=l,b[17]=m):m=b[17];b=d("ReQLSuspense").useFirst(g,m,f.id+":56");return a===!0||b===!0}g["default"]=a}),98);
__d("MWEBThreadListPersistentBannerWrapperDeferred.react",["MWEncryptedBackupsDeferLocalStorageUpsell","deferredLoadComponent","react","react-compiler-runtime","requireDeferred","useMWEBGetUpsellState","useMWEBIsUpsellDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react")),j=h.useState,k=c("deferredLoadComponent")(c("requireDeferred")("MWEBThreadListPersistentBannerWrapper.react").__setRef("MWEBThreadListPersistentBannerWrapperDeferred.react"));function a(a){var b=d("react-compiler-runtime").c(6),e=a.children;a=a.trigger;var f;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(f={upsellType:d("MWEncryptedBackupsDeferLocalStorageUpsell").MWEncryptedBackupsDeferableUpsellType.PERSISTENT_BANNER_JEWEL},b[0]=f):f=b[0];f=c("useMWEBIsUpsellDeferred")(f);f=j(f);var g=f[0];f=f[1];var h=c("useMWEBGetUpsellState")();h=h.isRestoreUpsellsDismissed;b[1]!==e||b[2]!==g||b[3]!==h||b[4]!==a?(f=!h&&!g?i.jsx(k,{setHasDismissedBanner:f,trigger:a}):e,b[1]=e,b[2]=g,b[3]=h,b[4]=a,b[5]=f):f=b[5];return f}g["default"]=a}),98);
__d("MWEncryptedBackupsJewelNuxWrapper_query.graphql",[],(function(a,b,c,d,e,f){"use strict";a={argumentDefinitions:[{kind:"RootArgument",name:"__relay_internal__pv__MWEBNewUserOnboardingShouldLoadUpsellsrelayprovider"}],kind:"Fragment",metadata:null,name:"MWEncryptedBackupsJewelNuxWrapper_query",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"useMWEncryptedBackupsGetVirtualDevicesPreloaded_xfbEncryptedBackup"},{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'}],storageKey:null},{kind:"RequiredField",field:{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"useMWChatEncryptedBackupsVestaUserInfo_viewer"},{condition:"__relay_internal__pv__MWEBNewUserOnboardingShouldLoadUpsellsrelayprovider",kind:"Condition",passingValue:!0,selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"if_viewer_can_see_messenger_eb_new_user_onboarding_upsells",plural:!1,selections:[{args:null,documentName:"MWEncryptedBackupsJewelNuxWrapper_query",fragmentName:"MWEBNewUserOnboardingThreadListUpsellWrapper_viewer",fragmentPropName:"viewer",kind:"ModuleImport"}],storageKey:null}]}],storageKey:null},action:"THROW",path:"viewer"},{kind:"Defer",selections:[{args:null,kind:"FragmentSpread",name:"MWEncryptedBackupsThreadListRestoreQPWrapperDeferred_query"}]},{args:null,kind:"FragmentSpread",name:"useEncryptedBackupsProcessStatePreLoaded_query"}],type:"Query",abstractKey:null};e.exports=a}),null);
__d("MWEncryptedBackupsJewelNuxWrapper.react",["CometErrorBoundary.react","CometPlaceholder.react","CometRelay","HeroInteractionIgnoreWithDiv.react","JSResourceForInteraction","MWChatEncryptedBackupsQPLSource.enum","MWEBEntrypointsKillswitch.enum","MWEBMobileOnboardingEligibility","MWEBRestoreJewelSoftblockPersistentBannerWrapperDeferred.withSegmentationCheck.react","MWEBVestaUserInfoContext.react","MWEBVirtualDevicesContextProvider.react","MWEBWebOnboardingUpsellUtils","MWEncryptedBackupsJewelNuxWrapper_query.graphql","MWEncryptedBackupsThreadListQPWrapper.react","cr:10269","cr:20045","cr:2046","react","react-compiler-runtime","useEncryptedBackupsProcessStatePreLoaded","useMWChatEncryptedBackupsVestaUserInfo","useMWEncryptedBackupsGetVirtualDevicesPreloaded"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=i||(i=d("react"));i.useMemo;var k=d("MWEBMobileOnboardingEligibility").requireMobileOnboardingIfEligible(c("JSResourceForInteraction")("MWEBMobileOnboardingQPBannerWrapper.react").__setRef("MWEncryptedBackupsJewelNuxWrapper.react"));function a(a){var e,f,g=d("react-compiler-runtime").c(24),i=a.children;a=a.query;a=d("CometRelay").useFragment(h!==void 0?h:h=b("MWEncryptedBackupsJewelNuxWrapper_query.graphql"),a);var k;g[0]!==a?(k={entrypoint:c("MWEBEntrypointsKillswitch.enum").JEWEL_THREADLIST,query:a},g[0]=a,g[1]=k):k=g[1];k=c("useEncryptedBackupsProcessStatePreLoaded")(k);var m;g[2]!==a.viewer?(m={viewer$key:a.viewer},g[2]=a.viewer,g[3]=m):m=g[3];m=c("useMWChatEncryptedBackupsVestaUserInfo")(m);var n;g[4]!==m.attemptsRemaining||g[5]!==m.loginTimeoutRemainingSecs||g[6]!==m.refetchVestaClientInfo?(n={attemptsRemaining:m.attemptsRemaining,loginTimeoutRemainingSecs:m.loginTimeoutRemainingSecs,refetchVestaClientInfo:m.refetchVestaClientInfo,vestaClientID:null},g[4]=m.attemptsRemaining,g[5]=m.loginTimeoutRemainingSecs,g[6]=m.refetchVestaClientInfo,g[7]=n):n=g[7];m=n;n=m;m=a==null?void 0:a.xfb_backup;var o;g[8]!==m?(o={encryptedBackup:m},g[8]=m,g[9]=o):o=g[9];m=c("useMWEncryptedBackupsGetVirtualDevicesPreloaded")(o);o=m.getVirtualDevices;g[10]!==o?(m=o(),g[10]=o,g[11]=m):m=g[11];o=m;m=o.offlineDevicesCount;o=o.vestaClientID;e=(e=a==null||(f=a.xfb_backup)==null?void 0:f.has_otc_eligible_devices)!=null?e:void 0;var p;g[12]!==k||g[13]!==i||g[14]!==a?(p=j.jsx(l,{backupState:k,children:i,fragment:a}),g[12]=k,g[13]=i,g[14]=a,g[15]=p):p=g[15];g[16]!==p||g[17]!==n?(k=j.jsx(d("MWEBVestaUserInfoContext.react").MWEBVestaUserInfoContext.Provider,{value:n,children:p}),g[16]=p,g[17]=n,g[18]=k):k=g[18];g[19]!==m||g[20]!==k||g[21]!==e||g[22]!==o?(i=j.jsx(c("MWEBVirtualDevicesContextProvider.react"),{hasOtcEligibleDevicesInitialValue:e,offlineDevicesCountInitialValue:m,vestaClientIDInitialValue:o,children:k}),g[19]=m,g[20]=k,g[21]=e,g[22]=o,g[23]=i):i=g[23];return i}function l(a){var e=d("react-compiler-runtime").c(13),f=a.backupState,g=a.children;a=a.fragment;switch(f){case 4:e[0]!==g||e[1]!==a?(f=b("cr:2046")||c("MWEBRestoreJewelSoftblockPersistentBannerWrapperDeferred.withSegmentationCheck.react")?j.jsx(c("HeroInteractionIgnoreWithDiv.react"),{children:j.jsx(c("CometErrorBoundary.react"),{fallback:function(){return g},children:c("MWEBRestoreJewelSoftblockPersistentBannerWrapperDeferred.withSegmentationCheck.react")!=null?j.jsx(c("MWEBRestoreJewelSoftblockPersistentBannerWrapperDeferred.withSegmentationCheck.react"),{trigger:d("MWEncryptedBackupsThreadListQPWrapper.react").MWEncryptedBackupsQPTrigger.JEWEL,children:g}):b("cr:2046")!=null&&j.jsx(b("cr:2046"),{fragmentKey:a,trigger:d("MWEncryptedBackupsThreadListQPWrapper.react").MWEncryptedBackupsQPTrigger.JEWEL,children:g})})}):g,e[0]=g,e[1]=a,e[2]=f):f=e[2];return f;case 2:if(d("MWEBWebOnboardingUpsellUtils").IS_E2E_TEST_UNRELATED_TO_ENCRYPTED_BACKUPS)return g;e[3]!==g?(f=b("cr:20045")?j.jsx(b("cr:20045"),{source:c("MWChatEncryptedBackupsQPLSource.enum").JEWEL_THREADLIST_QP,children:g}):g,e[3]=g,e[4]=f):f=e[4];var h=f;e[5]!==h?(f=function(){return h},e[5]=h,e[6]=f):f=e[6];var i;e[7]!==h||e[8]!==a.viewer.if_viewer_can_see_messenger_eb_new_user_onboarding_upsells?(i=a.viewer.if_viewer_can_see_messenger_eb_new_user_onboarding_upsells!=null?j.jsx(c("CometPlaceholder.react"),{fallback:null,name:"MWEncryptedBackupsJewelNuxWrapper.OnboardingThreadListQP",children:j.jsx(d("CometRelay").MatchContainer,{match:a.viewer.if_viewer_can_see_messenger_eb_new_user_onboarding_upsells,props:{bannerSource:c("MWChatEncryptedBackupsQPLSource.enum").JEWEL_THREADLIST_PERSISTENT_BANNER,children:h,qpSource:c("MWChatEncryptedBackupsQPLSource.enum").JEWEL_THREADLIST_ONBOARDING_QP}})}):b("cr:10269")?j.jsx(c("CometPlaceholder.react"),{fallback:null,name:"MWEncryptedBackupsJewelNuxWrapper.OnboardingThreadListQP",children:j.jsx(b("cr:10269"),{source:c("MWChatEncryptedBackupsQPLSource.enum").JEWEL_THREADLIST_QP,children:h})}):j.jsx(k,{fallback:h,props:{children:h,source:c("MWChatEncryptedBackupsQPLSource.enum").JEWEL_THREADLIST_ONBOARDING_QP,trigger:d("MWEncryptedBackupsThreadListQPWrapper.react").MWEncryptedBackupsQPTrigger.JEWEL}}),e[7]=h,e[8]=a.viewer.if_viewer_can_see_messenger_eb_new_user_onboarding_upsells,e[9]=i):i=e[9];e[10]!==f||e[11]!==i?(a=j.jsx(c("HeroInteractionIgnoreWithDiv.react"),{children:j.jsx(c("CometErrorBoundary.react"),{fallback:f,children:i})}),e[10]=f,e[11]=i,e[12]=a):a=e[12];return a;default:return g}}g["default"]=a}),98);
__d("MWEncryptedBackupsQPWithPinPlaceholder.react",["MWXColumn.react","MWXGlimmer.react","MWXRow.react","MWXRowItem.react","gkx","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j=c("gkx")("23433"),k={logoGlimmer:{borderStartStartRadius:"x1c9tyrk",borderStartEndRadius:"xeusxvb",borderEndEndRadius:"x1pahc9y",borderEndStartRadius:"x1ertn4p",height:"xxk0z11",width:"xvy4d1p",$$css:!0},pinInputGlimmer:{borderStartStartRadius:"x1i5p2am",borderStartEndRadius:"x1whfx0g",borderEndEndRadius:"xr2y4jy",borderEndStartRadius:"x1ihp6rs",height:"xc9qbxq",$$css:!0},root:{backgroundColor:"xlhe6ec",borderStartStartRadius:"x1obq294",borderStartEndRadius:"x5a5i1n",borderEndEndRadius:"xde0f50",borderEndStartRadius:"x15x8krk",borderTopStyle:"x13fuv20",borderInlineEndStyle:"x18b5jzi",borderBottomStyle:"x1q0q8m5",borderInlineStartStyle:"x1t7ytsu",borderTopWidth:"x972fbf",borderInlineEndWidth:"x10w94by",borderBottomWidth:"x1qhh985",borderInlineStartWidth:"x14e42zd",boxShadow:"xjf5wm9",boxSizing:"x9f619",minWidth:"xeuugli",overflowX:"x6ikm8r",overflowY:"x10wlt62",paddingTop:"x1iorvi4",paddingInlineEnd:"x11lfxj5",paddingBottom:"xjkvuk6",paddingInlineStart:"x135b78x",$$css:!0},textGlimmer:{borderStartStartRadius:"x1i5p2am",borderStartEndRadius:"x1whfx0g",borderEndEndRadius:"xr2y4jy",borderEndStartRadius:"x1ihp6rs",height:"x1qx5ct2",$$css:!0}};function a(){var a=d("react-compiler-runtime").c(6),b;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b={0:{className:"xlhe6ec x1obq294 x5a5i1n xde0f50 x15x8krk x13fuv20 x18b5jzi x1q0q8m5 x1t7ytsu x972fbf x10w94by x1qhh985 x14e42zd xjf5wm9 x9f619 xeuugli x6ikm8r x10wlt62 x11lfxj5 x135b78x xw7yly9 x1ys307a x1yztbdb xyqm7xq x1l90r2v xyamay9"},1:{className:"xlhe6ec x1obq294 x5a5i1n xde0f50 x15x8krk x13fuv20 x18b5jzi x1q0q8m5 x1t7ytsu x972fbf x10w94by x1qhh985 x14e42zd xjf5wm9 x9f619 xeuugli x6ikm8r x10wlt62 x11lfxj5 x135b78x xw7yly9 x1ys307a x1yztbdb xyqm7xq x2lwn1j xsag5q8 xz9dl7a"}}[!!j<<0],a[0]=b):b=a[0];var e;a[1]===Symbol["for"]("react.memo_cache_sentinel")?(e=i.jsx(c("MWXRowItem.react"),{verticalAlign:"center",children:i.jsx(c("MWXGlimmer.react"),{index:0,xstyle:k.logoGlimmer})}),a[1]=e):e=a[1];a[2]===Symbol["for"]("react.memo_cache_sentinel")?(e=i.jsxs(c("MWXRow.react"),{spacingVertical:0,verticalAlign:"center",children:[e,i.jsx(c("MWXRowItem.react"),{expanding:!0,children:i.jsx(c("MWXGlimmer.react"),{index:0,xstyle:k.textGlimmer})})]}),a[2]=e):e=a[2];var f;a[3]===Symbol["for"]("react.memo_cache_sentinel")?(f=i.jsx(c("MWXRow.react"),{wrap:"none",children:i.jsx(c("MWXRowItem.react"),{expanding:!0,children:i.jsx("div",{className:"x16ngw23 xwib8y2",children:i.jsx(c("MWXGlimmer.react"),{index:0,xstyle:k.textGlimmer})})})}),a[3]=f):f=a[3];var g;a[4]===Symbol["for"]("react.memo_cache_sentinel")?(g=i.jsx(c("MWXRow.react"),{direction:"forward",wrap:"none",children:i.jsx(c("MWXRowItem.react"),{expanding:!0,children:i.jsx(c("MWXGlimmer.react"),{index:1,xstyle:k.pinInputGlimmer})})}),a[4]=g):g=a[4];a[5]===Symbol["for"]("react.memo_cache_sentinel")?(b=i.jsx("div",babelHelpers["extends"]({},b,{children:i.jsxs(c("MWXColumn.react"),{spacing:8,style:k.root,children:[e,f,g,i.jsx(c("MWXRow.react"),{wrap:"none",children:i.jsx(c("MWXRowItem.react"),{expanding:!0,children:i.jsx("div",{className:"x18xe386 xpdvgm7 x1y1aw1k",children:i.jsx(c("MWXGlimmer.react"),{index:0,xstyle:k.textGlimmer})})})})]})})),a[5]=b):b=a[5];return b}g["default"]=a}),98);
__d("MWEncryptedBackupsThreadListRestoreQPWrapperDeferred_query.graphql",[],(function(a,b,c,d,e,f){"use strict";a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"MWEncryptedBackupsThreadListRestoreQPWrapperDeferred_query",selections:[{kind:"Defer",selections:[{args:null,kind:"FragmentSpread",name:"MWEncryptedBackupsThreadListRestoreQPWrapper_query"}]}],type:"Query",abstractKey:null};e.exports=a}),null);
__d("useMWEncryptedBackupsIsUpsellDismissed",["MWEBVestaUserInfoContext.react","MWEBVirtualDevicesContext.react","MWEncryptedBackupsDeferLocalStorageUpsell","react","react-compiler-runtime","useMWEBIsUpsellDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||d("react")).useState;function a(a){var b=d("react-compiler-runtime").c(5);a=a.upsellType;var e=d("MWEBVestaUserInfoContext.react").useMWEBIsCooldownOrLockOutState(),f=i(!1),g=f[0];f=f[1];var h;b[0]!==a?(h={upsellType:a},b[0]=a,b[1]=h):h=b[1];h=c("useMWEBIsUpsellDeferred")(h);var j=d("MWEBVirtualDevicesContext.react").useMWEBVirtualDevices();j=j.virtualDeviceInfo;j=j.doesUserHaveOtcEligibleDevices;if(e&&a===d("MWEncryptedBackupsDeferLocalStorageUpsell").MWEncryptedBackupsDeferableUpsellType.QP_WITH_PIN_JEWEL&&!j){b[2]===Symbol["for"]("react.memo_cache_sentinel")?(e=[!0,f],b[2]=e):e=b[2];return e}a=h===!0||g;b[3]!==a?(j=[a,f],b[3]=a,b[4]=j):j=b[4];return j}g["default"]=a}),98);
__d("MWEncryptedBackupsThreadListRestoreQPWrapperDeferred.react",["CometPlaceholder.react","CometRelay","EncryptedBackupsSupportedPlatformUtils","MWEBVestaUserInfoContext.react","MWEncryptedBackupsDeferLocalStorageUpsell","MWEncryptedBackupsQPWithPinPlaceholder.react","MWEncryptedBackupsThreadListRestoreQPWrapperDeferred_query.graphql","deferredLoadComponent","gkx","react","react-compiler-runtime","requireDeferred","useHasRestoreInterstitialSoftblockBeenDismissed","useMWEBGetUpsellState","useMWEncryptedBackupsIsUpsellDismissed"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=i||d("react"),k=c("deferredLoadComponent")(c("requireDeferred")("MWEncryptedBackupsThreadListRestoreQPWrapper.react").__setRef("MWEncryptedBackupsThreadListRestoreQPWrapperDeferred.react")),l=c("gkx")("3952");function a(a){var e=d("react-compiler-runtime").c(15),f=a.children,g=a.fragmentKey;a=a.trigger;g=d("CometRelay").useFragment(h!==void 0?h:h=b("MWEncryptedBackupsThreadListRestoreQPWrapperDeferred_query.graphql"),g);var i=d("MWEBVestaUserInfoContext.react").useMWEBIsCooldownOrLockOutState(),m=c("useMWEBGetUpsellState")();m=m.isRestoreUpsellsDismissed;var n;e[0]===Symbol["for"]("react.memo_cache_sentinel")?(n={upsellType:d("MWEncryptedBackupsDeferLocalStorageUpsell").MWEncryptedBackupsDeferableUpsellType.QP_JEWEL},e[0]=n):n=e[0];n=c("useMWEncryptedBackupsIsUpsellDismissed")(n);var o=n[0];n=n[1];var p;e[1]===Symbol["for"]("react.memo_cache_sentinel")?(p={upsellType:d("MWEncryptedBackupsDeferLocalStorageUpsell").MWEncryptedBackupsDeferableUpsellType.QP_WITH_PIN_JEWEL},e[1]=p):p=e[1];p=c("useMWEncryptedBackupsIsUpsellDismissed")(p);var q=p[0];p=p[1];var r;e[2]===Symbol["for"]("react.memo_cache_sentinel")?(r={upsellType:d("MWEncryptedBackupsDeferLocalStorageUpsell").MWEncryptedBackupsDeferableUpsellType.PERSISTENT_BANNER_JEWEL},e[2]=r):r=e[2];r=c("useMWEncryptedBackupsIsUpsellDismissed")(r);var s=r[0];r=r[1];var t;e[3]!==i?(t={backupState:4,isCooldownOrLockOutState:i},e[3]=i,e[4]=t):t=e[4];i=c("useHasRestoreInterstitialSoftblockBeenDismissed")(t);t=d("EncryptedBackupsSupportedPlatformUtils").useMWEncryptedBackupsGetCurrentSupportedPlatform();o=o||q;if(m||o&&!l||o&&l&&s)return f;e[5]===Symbol["for"]("react.memo_cache_sentinel")?(q=j.jsx(c("MWEncryptedBackupsQPWithPinPlaceholder.react"),{}),e[5]=q):q=e[5];e[6]!==f||e[7]!==t||e[8]!==g||e[9]!==o||e[10]!==r||e[11]!==n||e[12]!==p||e[13]!==a?(m=j.jsx(c("CometPlaceholder.react"),{fallback:q,name:"MWEncryptedBackupsThreadListRestoreQPWrapperDeferred",children:j.jsx(k,{children:f,currentSupportedPlatform:t,fragmentKey:g,hasDismissedQps:o,setHasDismissedBanner:r,setHasDismissedQp:n,setHasDismissedQpWithPin:p,trigger:a})}),e[6]=f,e[7]=t,e[8]=g,e[9]=o,e[10]=r,e[11]=n,e[12]=p,e[13]=a,e[14]=m):m=e[14];s=m;switch(t){case d("EncryptedBackupsSupportedPlatformUtils").EncryptedBackupsSupportedPlatform.INSTAGRAM_DIRECT_INBOX:return f;case d("EncryptedBackupsSupportedPlatformUtils").EncryptedBackupsSupportedPlatform.MESSENGER_DOT_COM:case d("EncryptedBackupsSupportedPlatformUtils").EncryptedBackupsSupportedPlatform.FACEBOOK_INBOX:return i?s:f;case d("EncryptedBackupsSupportedPlatformUtils").EncryptedBackupsSupportedPlatform.FACEBOOK_DOT_COM:return s}}g["default"]=a}),98);
__d("MWEncryptedBackupsThreadListRestoreQPWrapperDeferredWithEBCheck.react",["cr:9938"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=b("cr:9938")}),98);
__d("MWFDSMarketplace.svg.react",["cr:21707"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=b("cr:21707")}),98);
__d("MWFDSQuestionChat.svg.react",["FBIconQuestionChatFilled12.svg.react"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=c("FBIconQuestionChatFilled12.svg.react")}),98);
__d("useHasUnjoinedCMThreads",["LSIntEnum","ReQL","ReQLSuspense","react-compiler-runtime","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(){var a=d("react-compiler-runtime").c(4),b=(i||(i=c("useReStore")))(),e;a[0]!==b.tables.threads?(e=function(){return d("ReQL").union(d("ReQL").fromTableDescending(b.tables.threads.index("threadTypeLastActivityTimestampMs")).getKeyRange((h||(h=d("LSIntEnum"))).ofNumber(24)),d("ReQL").fromTableDescending(b.tables.threads.index("threadTypeLastActivityTimestampMs")).getKeyRange(h.ofNumber(19)))},a[0]=b.tables.threads,a[1]=e):e=a[1];var g;a[2]!==b?(g=[b],a[2]=b,a[3]=g):g=a[3];return!!d("ReQLSuspense").useFirst(e,g,f.id+":22")}g["default"]=a}),98);
__d("MessengerAsyncStorage",["AsyncStorage"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=c("AsyncStorage")}),98);
__d("useMWCMVerifyActivityStatusOnMountAndFocus",["FBLogger","I64","LSDict","LSFactory","LSVec","LSVerifyThreadsActivityStatusStoredProcedure","MessengerAsyncStorage","MetaConfig","ServerTime","VisibilityAPI","clearInterval","promiseDone","react","react-compiler-runtime","setInterval","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;b=i||d("react");b.useCallback;var k=b.useEffect;b.useMemo;var l=b.useRef,m=b.useState,n=1e3*60*60,o=n*3;function p(a){return(j||(j=d("I64"))).add(j.lsl_(j.of_float(a[0]),32),j.of_float(a[1]))}function q(a){return[(j||(j=d("I64"))).to_float(j.lsr_(a,32)),j.to_float(j.and_(a,j.of_int32(4294967295)))]}function a(a,b){var e=d("react-compiler-runtime").c(32),g=(h||(h=c("useReStore")))(),i=l(null),s="__"+a+".fromTimestampMs__",t;e[0]===Symbol["for"]("react.memo_cache_sentinel")?(t=q((j||(j=d("I64"))).of_float(d("ServerTime").getMillis()-o)),e[0]=t):t=e[0];t=t;t=m(t);var u=t[0],v=t[1],w=l(u),x;e[1]!==u?(t=function(){w.current=u},x=[u],e[1]=u,e[2]=t,e[3]=x):(t=e[2],x=e[3]);k(t,x);var y=l(!1);e[4]===Symbol["for"]("react.memo_cache_sentinel")?(t=c("MetaConfig")._("55")?["JOINED_PUBLIC_CHANNELS"]:[],e[4]=t):t=e[4];x=t;e[5]!==a?(t=c("MetaConfig")._("95")||a==="ContextSwitcher"?["JOINED_COMMUNITY_CHANNELS"]:[],e[5]=a,e[6]=t):t=e[6];a=t;e[7]!==a?(t=[].concat(x,a),e[7]=a,e[8]=t):t=e[8];x=t;var z=x;e[9]!==g||e[10]!==s||e[11]!==z?(a=function(){z.length>0&&c("promiseDone")(c("MessengerAsyncStorage").getItem(s).then(function(a){if(a!=null){var b=JSON.parse(a);b!=null&&c("promiseDone")(g.runInTransaction(function(a){return c("LSVerifyThreadsActivityStatusStoredProcedure")(c("LSFactory")(a),{fromTimestampMs:p(b),serverMode:c("LSVec").ofArray(z),threads:new(c("LSDict"))([])})},"readwrite",void 0,void 0,f.id+":98"))}})["catch"](r),function(){y.current=!0;var a=q((j||(j=d("I64"))).of_float(d("ServerTime").getMillis()));c("promiseDone")(c("MessengerAsyncStorage").setItem(s,JSON.stringify(a)),function(){v(a)})})},e[9]=g,e[10]=s,e[11]=z,e[12]=a):a=e[12];var A=a;e[13]===Symbol["for"]("react.memo_cache_sentinel")?(t=function(){i.current!=null&&(c("clearInterval")(i.current),i.current=null)},e[13]=t):t=e[13];var B=t;e[14]!==A?(x=function(){if(i.current!=null)return;if(c("MetaConfig")._("96")){var a;i.current=c("setInterval")(A,(a=c("MetaConfig")._("43"))!=null?a:n)}},e[14]=A,e[15]=x):x=e[15];var C=x;e[16]!==C||e[17]!==A?(a=function(){var a=d("ServerTime").getMillis()-(j||(j=d("I64"))).to_float(p(w.current));i.current==null&&C();a>=((a=c("MetaConfig")._("43"))!=null?a:n)&&A()},e[16]=C,e[17]=A,e[18]=a):a=e[18];var D=a;e[19]!==D||e[20]!==b?(t=function(){d("VisibilityAPI").isVisibilityHidden()?B():b&&c("MetaConfig")._("97")&&D()},e[19]=D,e[20]=b,e[21]=t):t=e[21];var E=t;e[22]!==C||e[23]!==A||e[24]!==E?(x=function(){var a=null;y.current||(A(),d("VisibilityAPI").canUseVisibilityAPI&&(a=d("VisibilityAPI").onVisibilityChange(E)),C());return function(){a!=null&&d("VisibilityAPI").removeVisibiltyChangeListener(a),i.current!=null&&(c("clearInterval")(i.current),i.current=null)}},e[22]=C,e[23]=A,e[24]=E,e[25]=x):x=e[25];e[26]!==D||e[27]!==C||e[28]!==b||e[29]!==A||e[30]!==E?(a=[B,D,C,b,A,E],e[26]=D,e[27]=C,e[28]=b,e[29]=A,e[30]=E,e[31]=a):a=e[31];k(x,a)}function r(a){c("FBLogger")("messenger_web").catching(a).mustfix("Failed to set timestamp for thread activity status")}g["default"]=a}),98);
__d("useMWInboxContextSwitcherFilterPreloaderCond",["cr:4651","emptyFunction","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e){a=d("react-compiler-runtime").c(1);a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b={onHoverIn:c("emptyFunction"),onHoverOut:c("emptyFunction"),onPressIn:c("emptyFunction")},a[0]=b):b=a[0];return b}f=(e=b("cr:4651"))!=null?e:a;b=f;g["default"]=b}),98);
__d("MWInboxContextSwitcher.react",["fbt","C4GFalcoLoggerDeferred","FDSPivotLinkTabs.react","I64","LSIntEnum","LSThreadRangeFilter","MWChatBadgeCountUpdates.react","MWInboxPersistedUIState","MWPBumpEntityKey","MWVerticalRhythm","Promise","gkx","promiseDone","react","react-compiler-runtime","useHasUnjoinedCMThreads","useMWCMVerifyActivityStatusOnMountAndFocus","useMWInboxContextSwitcherFilterPreloaderCond","useReStore","useSinglePartialViewImpression"],(function(a,b,c,d,e,f,g,h){"use strict";var i=["filter","hasNewContentBadge","isShown","logClick","odsAction","overrideTabChange","ref"],j,k,l,m,n,o=n||(n=d("react")),p=n.useEffect,q={tabContainerWithFilters:{paddingTop:"x1y1aw1k",paddingBottom:"xwib8y2",paddingInlineStart:"xwn43p0",paddingInlineEnd:"x1x5flf6",paddingLeft:null,paddingRight:null,$$css:!0},tabWithFilters:{paddingInlineStart:"xyiysdx",paddingInlineEnd:"x14vy60q",paddingLeft:null,paddingRight:null,$$css:!0}};function a(a){var b=d("react-compiler-runtime").c(29),e=a.entryPoint,g=a.onTabChange,j=a.parentThreadKey,n=a.selectedFilterTab,t=a.showMessageRequests,u=a.showNestedFolderThreads,v=(k||(k=c("useReStore")))();c("useMWCMVerifyActivityStatusOnMountAndFocus")("ContextSwitcher",e==="inbox");var w;b[0]!==v?(a=function(){c("promiseDone")(v.runInTransaction(s,"readwrite",void 0,void 0,f.id+":83"))},w=[v],b[0]=v,b[1]=a,b[2]=w):(a=b[1],w=b[2]);p(a,w);var x=c("useHasUnjoinedCMThreads")();a=d("MWInboxPersistedUIState").usePersistedUIState(x,"__MWInboxContextSwitcher.hasViewedSuggestedChats__");var y=a[0],z=a[1];b[3]===Symbol["for"]("react.memo_cache_sentinel")?(w=(l||(l=d("LSIntEnum"))).ofNumber(0),b[3]=w):w=b[3];a=d("MWChatBadgeCountUpdates.react").useUnseenThreadCount(w);w=a!=null&&a>0;a=d("MWChatBadgeCountUpdates.react").useHasUnseenCommunityThreads();var A=x&&!y,B=e==="jewel"?"jewel_tray":"messenger_inbox",C=e==="inbox"?"jewel_inbox":"chats_inbox",D;b[4]!==C||b[5]!==B?(D={onImpressionStart:function(){d("C4GFalcoLoggerDeferred").logC4GEngagementFalcoEvent({action:"impression",event:"blended_threadlist_community_tab_rendered",parent_surface:C,source:"blended_threadlist_community_tab",surface:B})}},b[4]=C,b[5]=B,b[6]=D):D=b[6];D=c("useSinglePartialViewImpression")(D);var E;b[7]===Symbol["for"]("react.memo_cache_sentinel")?(E=(l||(l=d("LSIntEnum"))).ofNumber(c("LSThreadRangeFilter").GROUPS_ONLY),b[7]=E):E=b[7];E=c("useMWInboxContextSwitcherFilterPreloaderCond")(v,j,E);E=E.onPressIn;var F;b[8]===Symbol["for"]("react.memo_cache_sentinel")?(F=(l||(l=d("LSIntEnum"))).ofNumber(c("LSThreadRangeFilter").UNREAD_ONLY),b[8]=F):F=b[8];j=c("useMWInboxContextSwitcherFilterPreloaderCond")(v,j,F);F=j.onPressIn;if(b[9]!==e||b[10]!==x||b[11]!==A||b[12]!==a||b[13]!==w||b[14]!==y||b[15]!==D||b[16]!==E||b[17]!==F||b[18]!==g||b[19]!==C||b[20]!==n||b[21]!==z||b[22]!==t||b[23]!==u||b[24]!==B){j=[{filter:(l||(l=d("LSIntEnum"))).ofNumber(c("LSThreadRangeFilter").NONE),hasNewContentBadge:w,isShown:!0,label:h._(/*BTDS*/"All"),odsAction:"inbox_tab_click"},{filter:l.ofNumber(c("LSThreadRangeFilter").UNREAD_ONLY),hasNewContentBadge:!1,isShown:!0,label:h._(/*BTDS*/"Unread"),odsAction:"unread_tab_click",onPressIn:F},{filter:l.ofNumber(c("LSThreadRangeFilter").GROUPS_ONLY),hasNewContentBadge:!1,isShown:!0,label:h._(/*BTDS*/"Groups"),odsAction:"groups_tab_click",onPressIn:E}].concat(c("gkx")("2165")?[{filter:(l||(l=d("LSIntEnum"))).ofNumber(c("LSThreadRangeFilter").COMMUNITIES),hasNewContentBadge:a||A,isShown:!0,label:h._(/*BTDS*/"Communities"),logClick:function(){d("C4GFalcoLoggerDeferred").logC4GEngagementFalcoEvent({action:"tap",event:"blended_threadlist_community_tab_clicked",parent_surface:C,source:"blended_threadlist_community_tab",surface:B})},odsAction:"communities_tab_click",ref:D}]:[],c("gkx")("6437")?[{filter:(l||(l=d("LSIntEnum"))).ofNumber(c("LSThreadRangeFilter").DRAFTS),hasNewContentBadge:!1,isShown:!0,label:h._(/*BTDS*/"Drafts"),odsAction:"drafts_tab_click"}]:[],c("gkx")("17132")?[{filter:(l||(l=d("LSIntEnum"))).ofNumber(c("LSThreadRangeFilter").MARKETPLACE),hasNewContentBadge:!1,isShown:!0,label:h._(/*BTDS*/"Marketplace"),odsAction:"marketplace_tab_click",overrideTabChange:function(){u!=null&&u((l||(l=d("LSIntEnum"))).ofNumber(-12))}},{filter:(l||(l=d("LSIntEnum"))).ofNumber(c("LSThreadRangeFilter").MESSAGE_REQUESTS),hasNewContentBadge:!1,isShown:!0,label:h._(/*BTDS*/"Message requests"),odsAction:"message_request_tab_click",overrideTabChange:function(){t==null||t()}}]:[]);j=j.filter(r).map(function(a,b){var f=a.filter;b=a.hasNewContentBadge;a.isShown;var h=a.logClick,j=a.odsAction,k=a.overrideTabChange,o=a.ref;a=babelHelpers.objectWithoutPropertiesLoose(a,i);return babelHelpers["extends"]({},a,{hasNewContentBadge:b,onPress:function(){(m||(m=d("I64"))).equal(f,(l||(l=d("LSIntEnum"))).ofNumber(c("LSThreadRangeFilter").COMMUNITIES))&&x&&!y&&z(!0);d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.contextswitcher."+e,j);h==null||h();if(k!=null){k();return}g(f)},ref:o,selected:(m||(m=d("I64"))).equal(f,n),testid:(m||(m=d("I64"))).equal(f,(l||(l=d("LSIntEnum"))).ofNumber(c("LSThreadRangeFilter").COMMUNITIES))?"communities_tab":void 0,xstyle:q.tabWithFilters})});b[9]=e;b[10]=x;b[11]=A;b[12]=a;b[13]=w;b[14]=y;b[15]=D;b[16]=E;b[17]=F;b[18]=g;b[19]=C;b[20]=n;b[21]=z;b[22]=t;b[23]=u;b[24]=B;b[25]=j}else j=b[25];A=j;if(A.length<=1){b[26]===Symbol["for"]("react.memo_cache_sentinel")?(a=o.jsx(c("MWVerticalRhythm"),{height:8}),b[26]=a):a=b[26];return a}b[27]!==A?(w=o.jsx(c("FDSPivotLinkTabs.react"),{linkType:"deemphasized",tabs:A,tabsContainerStyle:q.tabContainerWithFilters}),b[27]=A,b[28]=w):w=b[28];return w}function r(a){return a.isShown}function s(a){return(j||(j=b("Promise"))).resolve()}g["default"]=a}),226);
__d("MWXIconMarketplace",["MWXSvgIcon","SVGIcon","cr:22393","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgIcon(d("SVGIcon").svgIcon(b("cr:22393")),c("gkx")("23219"));g["default"]=a}),98);
__d("MWThreadListMarketplaceItem.react",["fbt","CometMarketplaceLogger","LSContactBitOffset","LSIntEnum","MWPBumpEntityKey","MWThreadListFolderItem.react","MWXIconGroup","MWXIconMarketplace","MWXIconStrict.react","ReQL","ReQLSuspense","react","react-compiler-runtime","useLogMarketplaceClick","useReStore"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l=k||(k=d("react")),m=k.useEffect;function a(a){var b=d("react-compiler-runtime").c(27),e=a.onClick,g=a.responsive,k=a.selected,p=a.size;a=a.thread;var q=c("useLogMarketplaceClick")("marketplace_inbox_folder"),r=(i||(i=c("useReStore")))(),s;b[0]!==r.tables._user_info?(s=function(){return d("ReQL").fromTableAscending(r.tables._user_info).map(o)},b[0]=r.tables._user_info,b[1]=s):s=b[1];var t;b[2]!==r?(t=[r],b[2]=r,b[3]=t):t=b[3];var u=d("ReQLSuspense").useFirst(s,t,f.id+":51");b[4]!==r.tables.contacts||b[5]!==u?(s=function(){return u!=null?d("ReQL").fromTableAscending(r.tables.contacts,[].concat(d("LSContactBitOffset").contactCapabilityFields)).getKeyRange(u):d("ReQL").empty()},b[4]=r.tables.contacts,b[5]=u,b[6]=s):s=b[6];b[7]!==r||b[8]!==u?(t=[r,u],b[7]=r,b[8]=u,b[9]=t):t=b[9];s=d("ReQLSuspense").useFirst(s,t,f.id+":56");t=s!=null&&d("LSContactBitOffset").has(86,s);b[10]===Symbol["for"]("react.memo_cache_sentinel")?(s=[],b[10]=s):s=b[10];m(n,s);b[11]===Symbol["for"]("react.memo_cache_sentinel")?(s=h._(/*BTDS*/"Marketplace").toString(),b[11]=s):s=b[11];s=s;var v=c("MWXIconMarketplace");if(t===!0){b[12]===Symbol["for"]("react.memo_cache_sentinel")?(t=h._(/*BTDS*/"_j[\"Buy and sell groups\",\"3a9a1e192465754ec4427995fe1cffb4\",1]").toString(),b[12]=t):t=b[12];s=t;v=c("MWXIconGroup")}b[13]!==v?(t=l.jsx(c("MWXIconStrict.react"),{color:"primary",icon:v,size:36}),b[13]=v,b[14]=t):t=b[14];b[15]!==q||b[16]!==e?(v=function(){q();e((j||(j=d("LSIntEnum"))).ofNumber(-12));return d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","marketplace_threads")},b[15]=q,b[16]=e,b[17]=v):v=b[17];var w;b[18]===Symbol["for"]("react.memo_cache_sentinel")?(w=(j||(j=d("LSIntEnum"))).ofNumber(-12),b[18]=w):w=b[18];b[19]!==g||b[20]!==k||b[21]!==p||b[22]!==t||b[23]!==v||b[24]!==a||b[25]!==s?(w=l.jsx(c("MWThreadListFolderItem.react"),{icon:t,onClick:v,responsive:g,selected:k,size:p,systemFolder:w,thread:a,threadName:s}),b[19]=g,b[20]=k,b[21]=p,b[22]=t,b[23]=v,b[24]=a,b[25]=s,b[26]=w):w=b[26];return w}function n(){return d("CometMarketplaceLogger").logImpression("marketplace_inbox_folder")}function o(a){return a.facebookUserId}g["default"]=a}),226);
__d("useMWInboxContextSwitcherFilterPreloader",["MWPBaseThreadListHooks","MWPBaseThreadListUtils","react","react-compiler-runtime","useCometPreloader"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");b.useCallback;b.useMemo;function a(a,b,e){var f=d("react-compiler-runtime").c(12),g=d("MWPBaseThreadListHooks").useMWPBaseThreadListDefaultThreadsRange(a,b,e),h;f[0]!==a||f[1]!==g||f[2]!==e||f[3]!==b?(h=function(){g==null&&d("MWPBaseThreadListUtils").loadMoreThreadsForEmptyRangeDefault(a,b,e)},f[0]=a,f[1]=g,f[2]=e,f[3]=b,f[4]=h):h=f[4];h=h;h=c("useCometPreloader")("button",h,h);var i=h.onHighIntentPreloader,j=h.onHoverInPreloader,k=h.onHoverOutPreloader;h=h.onPressInPreloader;var l;f[5]!==i||f[6]!==j?(l=function(a){j(a),i(!0)},f[5]=i,f[6]=j,f[7]=l):l=f[7];var m;f[8]!==k||f[9]!==h||f[10]!==l?(m={onHoverIn:l,onHoverOut:k,onPressIn:h},f[8]=k,f[9]=h,f[10]=l,f[11]=m):m=f[11];k=m;return k}g["default"]=a}),98);
__d("useMWJewelSettingsButtonSecurityAlertsBadge",["FDSBadge.react","react","react-compiler-runtime","useDeviceAlertCount","useMAWSecurityAlertsPreferences"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));h.useMemo;function a(){var a=d("react-compiler-runtime").c(5),b=c("useMAWSecurityAlertsPreferences")();b=b.securityAlertsPreferences;var e=d("useDeviceAlertCount").useDeviceAlertCount();b==null||b.allowSecurityAlertForSelf;var f;a[0]!==(b==null?void 0:b.allowSecurityAlertForSelf)||a[1]!==e?(f=b!=null&&b.allowSecurityAlertForSelf&&e>0?i.jsx("div",{className:"x12u5thl x10l6tqk x12ibf10",children:i.jsx(c("FDSBadge.react"),{testid:void 0})}):null,a[0]=b==null?void 0:b.allowSecurityAlertForSelf,a[1]=e,a[2]=f):f=a[2];a[3]!==f?(b={badge:f},a[3]=f,a[4]=b):b=a[4];e=b;return e}g["default"]=a}),98);/*FB_PKG_DELIM*/
__d("ACSCipherSuiteModule",[],(function(a,b,c,d,e,f){"use strict";b={hash:"SHA-512",name:"HMAC"};c={curveName:"RISTRETTO",macAlgorithm:b,value:1};var g=new Map([[c.value,c]]);function a(a){return g.has(a)?g.get(a):null}f.VOPRF_RISTRETTO_HMACSHA512=c;f.getACSCipherSuiteByValue=a}),66);
__d("ACSTokenHmacUtil",["XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return h(a,b).then(function(a){return j(a,c)})}function h(a,b){return d("XPlatReactCrypto").subtleImportKey("raw",b,a,!1,["sign"]).then(function(b){return{algo:a,key:b}})}function i(a){return typeof a.hash==="string"?a.hash:a.hash.name}function j(a,b){var c=a.algo;a=a.key;c={hash:i(c),name:"HMAC"};return d("XPlatReactCrypto").subtleSign(c,a,b).then(function(a){return new Uint8Array(a)})}g.hmac=a}),98);
__d("EBSMWorkerThreadAPI",["EBDeps","MAWQplProxy","MAWWaitForBackendSetup","MWEncryptedBackupsFirstRestoreUpsellTime","Promise","QPLFlow","WAResultOrError","WebSession","justknobx","qpl","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(a=c("requireDeferred"))("EBAddDeviceWithKeys").__setRef("EBSMWorkerThreadAPI"),j=a("EBAddDeviceWithRecoveryCode").__setRef("EBSMWorkerThreadAPI"),k=a("EBDeleteMailbox").__setRef("EBSMWorkerThreadAPI"),l=a("EBFetchBackupIds").__setRef("EBSMWorkerThreadAPI"),m=a("EBGenerateRecoveryCode").__setRef("EBSMWorkerThreadAPI"),n=a("EBGetEBState").__setRef("EBSMWorkerThreadAPI"),o=a("EBGetLSVirtualDevices").__setRef("EBSMWorkerThreadAPI"),p=a("EBInitializeBackup").__setRef("EBSMWorkerThreadAPI"),q=a("EBIsEbEnabled").__setRef("EBSMWorkerThreadAPI"),r=a("EBOtcAddDevice").__setRef("EBSMWorkerThreadAPI");e={addDeviceWithEBKeys:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return i.load().then(function(a){return a.addDeviceWithEBKeys.apply(a,b)})},addDeviceWithRecoveryCode:function(){for(var a=arguments.length,e=new Array(a),g=0;g<a;g++)e[g]=arguments[g];if(e.length===0||e[0]==null)return(h||(h=b("Promise"))).reject("Missing args");var i=e[0].qplInstanceKeyMainthread!=null?d("MAWQplProxy").continueQplAsCrossBridgeQplFlow(c("qpl")._(521473756,"2768"),{instanceKey:e[0].qplInstanceKeyMainthread,timeoutInMs:c("justknobx")._("2444")}):d("QPLFlow").startQPLFlow(c("qpl")._(521473756,"2768"),{annotations:{bool:{isBackendSetupOnStart:d("EBDeps").getDeps().isBackendSetupSuccessful(),isEBAddDeviceWithKeys:!1}},timeoutInMs:c("justknobx")._("2444")});return j.load().then(function(a){return a.addDeviceWithRecoveryCode(babelHelpers["extends"]({},e[0],{qplFlow:i}))})},deleteMailbox:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return k.load().then(function(a){return a.deleteMailbox.apply(a,b)})},fetchBackupIds:function(a,b){var e=b!=null?d("MAWQplProxy").continueQplAsCrossBridgeQplFlow(c("qpl")._(521471024,"2275"),{instanceKey:b}):d("QPLFlow").startQPLFlow(c("qpl")._(521471024,"2275"),{annotations:{string:{ebSessionIdentifier:d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime(),fetchBackupIdsVersion:"msys",sessionTabId:d("WebSession").getId()}}});return l.load().then(function(b){return b.fetchBackupIds(a,e)})},generateRecoveryCode:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return m.load().then(function(a){return a.generateRecoveryCode.apply(a,b)})},getEBState:function(){return n.load().then(function(a){return a.GetEbState()})},getLSVirtualDevices:function(a){return o.load().then(function(b){return b.getLSVirtualDevices(a)})},initializeBackup:function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return p.load().then(function(a){return a.initializeBackup.apply(a,b)})},isEbEnabled:function(){return q.load().then(function(a){return a.isEbEnabledEbSwitch()})},optOutOfBackup:function(){return(h||(h=b("Promise"))).resolve()},otcAddDevice:function(){for(var a=arguments.length,b=new Array(a),e=0;e<a;e++)b[e]=arguments[e];var g=b[0].qplInstanceKeyMainthread!=null?d("MAWQplProxy").continueQplAsCrossBridgeQplFlow(c("qpl")._(521473756,"2768"),{instanceKey:b[0].qplInstanceKeyMainthread}):d("QPLFlow").startQPLFlow(c("qpl")._(521473756,"2768"),{annotations:{bool:{isBackendSetupOnStart:d("MAWWaitForBackendSetup").isBackendSetupSuccessful(),isEBAddDeviceWithKeys:!1,isInWorker:!1,isOTC:!0}},timeoutInMs:c("justknobx")._("2444")});return r.load().then(function(a){return a.otcAddDevice(babelHelpers["extends"]({},b[0],{qplFlow:g}))})},syncEpochs:function(){return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult())}};f=e;g["default"]=f}),98);
__d("GetBlobFromInt64BE",["I64","LSResult","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){var e=new Uint8Array(8);e.reduceRight(function(a,b,c){b=(i||(i=d("I64"))).to_int32(i.mod_(a,i.of_string("256")));e[c]=b;return i.div(a,i.of_string("256"))},a);return(h||(h=b("Promise"))).resolve(c("LSResult")(e.buffer))}g.GetBlobFromInt64BE=a}),98);
__d("LSACSExperimentCapability",[],(function(a,b,c,d,e,f){a=Object.freeze({RETRY_AFTER_TASK_SERIALIZATION_FAILURE_EXPONENTIAL_BACKOFF:0,BUMP_TOKEN_SYNC_TASK_AT_TASK_SERIALIZATION:1,INSERT_PENDING_TASK_PARENT_ROW_WHEN_NO_ACS_TOKENS_AT_TASK_INSERTION:2});f["default"]=a}),66);
__d("LSBeginHandlingFireForgetTasksForQueue",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(e){return b.sequence([function(d){return c[0]=b.createArray(),b.forEach(b.filter(b.db.table(5).fetch(),function(b){return b.queueName===a[0]}),function(a){a=a.item;return c[3]=new b.Map(),c[3].set("label",a.context),c[3].set("payload",a.taskValue),c[3].set("queue_name",a.queueName),c[3].set("task_id",a.taskId),c[3].set("failure_count",b.i64.eq(b.i64.cast([0,0]),b.i64.cast([0,0]))?void 0:b.i64.cast([0,0])),c[4]=(c[0].push(c[3]),c[0])})},function(e){return c[1]=new b.Map(),c[1].set("tasks",c[0]),c[1].set("epoch_id",void 0),c[2]=new b.Map(),c[2].set("queue_name",a[0]),c[2].set("next_sync_ms",void 0),c[2].set("work_item_type",b.i64.cast([0,5])),c[2].set("network_payload",c[1]),c[2].set("http_url_override",void 0),c[2].set("skip_realtime_gateway",!1),d[0]=c[2]}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSCoreBeginHandlingFireForgetTasksForQueueStoredProcedure";a.__tables__=["pending_fire_and_forget_tasks"];e.exports=a}),null);
__d("LSBeginHandlingFireForgetTasksForQueueStoredProcedure",["LSBeginHandlingFireForgetTasksForQueue","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSBeginHandlingFireForgetTasksForQueue"),e.queueName);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSForceTaskExecutionImmediately",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return b.db.table(2).fetch([[[a[0]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?0:(e=d.item,c[1]=b.i64.of_float(Date.now()),b.i64.lt(c[1],e.minTimeToSyncTimestampMs)?b.forEach(b.db.table(2).fetch([[[a[0]]]]),function(a){var c=a.update;a=a.item;return c({minTimeToSyncTimestampMs:b.i64.cast([0,0]),failureCount:b.i64.add(a.failureCount,b.i64.cast([0,1]))})}):b.resolve())})},function(a){return b.resolve(d)}])}a.__sproc_name__="LSCoreForceTaskExecutionImmediatelyStoredProcedure";a.__tables__=["pending_tasks"];e.exports=a}),null);
__d("LSRemoveUsedTokens",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(a){return b.forEach(b.filter(b.db.table(309).fetch(),function(a){return b.i64.le(a.redeemLimit,b.i64.cast([0,0]))}),function(a){return a["delete"]()})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSAnonymousCredentialsRemoveUsedTokensStoredProcedure";a.__tables__=["secure_acs_tokens"];e.exports=a}),null);
__d("LSGetCurrentTokenPoolState",["LSArrayGetObjectAt","LSRemoveBlindedTokens","LSRemoveUsedTokens"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),d[1]=c.createArray(),c.count(c.filter(c.db.table(307).fetch(),function(b){return b.projectName===a[0]})).then(function(a){return d[2]=a})},function(b){return c.forEach(c.filter(c.db.table(307).fetch(),function(b){return b.projectName===a[0]}),function(a){a=a.item;return d[7]=a.configId,c.i64.gt(d[0],a.expirationTimestampMs)?c.forEach(c.db.table(307).fetch([[[d[7]]]]),function(a){return a["delete"]()}):c.resolve(d[8]=(d[1].push(d[7]),d[1]))})},function(a){return c.storedProcedure(b("LSRemoveUsedTokens"))},function(a){return d[3]=c.i64.cast([0,0]),d[4]=c.i64.of_int32(d[1].length),c.i64.gt(d[4],c.i64.cast([0,0]))?c.loopAsync(d[4],function(a){return d[7]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[1],d[7]).then(function(a){return a=a,d[8]=a[0],d[9]=a[1],a})},function(a){return c.count(c.filter(c.db.table(309).fetch(),function(a){return a.configId===d[8]})).then(function(a){return d[10]=a})},function(a){return d[3]=c.i64.add(d[10],d[3]),c.storedProcedure(b("LSRemoveBlindedTokens"),d[8])}])}):c.resolve()},function(a){return c.i64.gt(d[2],c.i64.cast([0,0]))?(d[7]=c.i64.of_int32(d[1].length),d[5]=c.i64.ge(d[7],c.i64.cast([0,1]))):d[5]=void 0,d[5]!==void 0?(d[5]?(c.i64.gt(d[3],c.i64.cast([0,0]))?d[8]=c.i64.cast([0,3]):d[8]=c.i64.cast([0,2]),d[7]=d[8]):d[7]=c.i64.cast([0,1]),d[6]=d[7]):d[6]=c.i64.cast([0,0]),a=[d[6],d[3]],e[0]=a[0],e[1]=a[1]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSAnonymousCredentialsGetCurrentTokenPoolStateStoredProcedure";a.__tables__=["secure_acs_configurations","secure_acs_tokens"];e.exports=a}),null);
__d("LSVoprfBlind.nop",["XPlatReactVoprf"],(function(a,b,c,d,e,f,g){"use strict";a=async function(a,b,c){a=await d("XPlatReactVoprf").loadXPlatReactVoprf();b=a.voprfInstance;a=b.voprfInfo;var e=b.voprfWasm;try{e=e.blind(a,new Uint8Array(c));return[e.blindedElement.buffer,e.blindingFactor.buffer]}catch(a){throw a}finally{d("XPlatReactVoprf").freeVoprfInstance(b)}};a.__nop_name__="LSVoprfBlind";g.default=a}),98);
__d("LSVoprfCreateNonce.nop",["LSSynchronousPromise","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";var h=32;a=function(a,b){a=h;b=new Uint8Array(a);d("XPlatReactCrypto").getRandomValues(b);return d("LSSynchronousPromise").makeSynchronousPromise([b.buffer])};a.__nop_name__="LSVoprfCreateNonce";g["default"]=a}),98);
__d("LSTaskSerializerAcsIssueNextSync",["LSBase64Encode.nop","LSGetCurrentTokenPoolState","LSIssueNextSync","LSVoprfBlind.nop","LSVoprfCreateNonce.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return c.db.table(310).fetch([[[a[0]]]]).next().then(function(a,e){var f=a.done;a=a.value;return f?(function(a){c.logger(a).mustfix(a)}("Request context for the passed task_id was not found"),f=[void 0,void 0,void 0],d[0]=f[0],d[1]=f[1],d[2]=f[2]):(e=a.item,c.sequence([function(a){return d[9]=e.projectName,d[10]=e.maxClientTokenPoolSize,c.storedProcedure(b("LSGetCurrentTokenPoolState"),d[9]).then(function(a){return a=a,d[4]=a[0],d[5]=a[1],a})},function(a){return c.i64.eq(d[4],c.i64.cast([0,0]))||c.i64.eq(d[4],c.i64.cast([0,1]))?c.resolve((d[11]=new c.Map(),d[11].set("project_name",d[9]),d[12]=c.toJSON(d[11]),a=[d[12],c.i64.cast([0,351]),void 0],d[6]=a[0],d[7]=a[1],d[8]=a[2])):c.sequence([function(a){return d[11]=c.i64.of_float(Date.now()),c.islc(c.sortBy(c.filter(c.db.table(307).fetch(),function(a){return a.projectName===d[9]&&c.i64.gt(a.expirationTimestampMs,d[11])}),[["expirationTimestampMs","DESC"]]),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(e,f){var a=e.done;e=e.value;return a?(function(a){c.logger(a).mustfix(a)}("A config for the passed project name was not found"),d[16]=new c.Map(),d[16].set("project_name",d[9]),d[16].set("max_client_token_pool_size",d[10]),d[17]=c.toJSON(d[16]),a=[d[17],c.i64.cast([0,362]),void 0],d[12]=a[0],d[13]=a[1],d[14]=a[2]):(f=e.item,c.sequence([function(a){return d[24]=f.configId,d[16]=f.maxEvals,d[26]=f.tokenPollFrequencyMs,d[25]=f.maxClientTokenPoolSize,d[17]=c.i64.sub(d[10],d[5]),d[23]=c.i64.lt(d[16],d[17])?d[16]:d[17],d[18]=c.createArray(),c.i64.gt(d[23],c.i64.cast([0,0]))?c.loopAsync(d[23],function(a){return d[27]=a,c.sequence([function(a){return c.nativeOperation(b("LSVoprfCreateNonce.nop")).then(function(a){return a=a,d[28]=a[0],a})},function(a){return c.blobs.neq(d[28],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSVoprfBlind.nop"),d[28]).then(function(a){return a=a,d[29]=a[0],d[30]=a[1],a})},function(a){return c.blobs.neq(d[29],void 0)?c.blobs.neq(d[30],void 0)?c.sequence([function(a){return d[31]=c.i64.cast([-1,4294967295]),c.db.table(308).peekNextAutoIncrementId().then(function(a){return d[31]=a})},function(a){return c.db.table(308).add({tokenId:void 0,blindedNonce:d[29],blindingFactor:d[30],nonce:d[28],configId:d[24]})},function(a){return c.db.table(308).fetch([[[d[31]]]]).next().then(function(b,e){var a=b.done;b=b.value;return a?d[32]=c.i64.cast([-1,4294967295]):(e=b.item,d[32]=e.tokenId)})},function(a){return c.i64.eq(d[32],c.i64.cast([-1,4294967295]))?c.sequence([function(a){return c.islc(c.db.table(308).fetchDesc([[[{gt:c.i64.cast([0,0])}]]]),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,e){var a=b.done;b=b.value;return a?d[37]=c.i64.cast([-1,4294967295]):(e=b.item,d[37]=e.tokenId)})},function(a){return d[34]=d[37]}]):c.resolve(d[34]=d[32])},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[29]).then(function(a){return a=a,d[35]=a[0],a})},function(a){return d[36]=new c.Map(),d[36].set("id",d[34]),d[36].set("data",d[35]==null?"":d[35]),d[37]=(d[18].push(d[36]),d[18])}]):c.resolve():c.resolve()}]):c.resolve()}])}):c.resolve()},function(a){return d[19]=c.i64.of_int32(d[18].length),c.i64.gt(d[19],c.i64.cast([0,0]))?c.resolve((d[27]=new c.Map(),d[27].set("project_name",d[9]),d[27].set("config_id",d[24]),d[27].set("blinded_nonces",d[18]),d[28]=c.toJSON(d[27]),a=[d[28],c.i64.cast([0,354]),void 0],d[20]=a[0],d[21]=a[1],d[22]=a[2])):c.sequence([function(a){return c.i64.neq(d[26],void 0)?c.sequence([function(a){return c.i64.neq(d[25],void 0)?c.sequence([function(a){return function(a){c.logger(a).info(a)}(["Already have the max number of tokens. Scheduling next ACS token sync locally for project: ",d[9]].join("")),c.storedProcedure(b("LSIssueNextSync"),d[25],d[9],d[26],!1)},function(a){return a=[void 0,void 0,void 0],d[30]=a[0],d[31]=a[1],d[32]=a[2],a}]):c.resolve((function(a){c.logger(a).info(a)}(["token_poll_frequency is nonnull but max_client_token_pool_size is null. Already have the max number of tokens. Scheduling the next ACS token sync for project: ",d[9]].join("")),d[33]=new c.Map(),d[33].set("project_name",d[9]),d[33].set("max_client_token_pool_size",d[10]),d[34]=c.toJSON(d[33]),a=[d[34],c.i64.cast([0,362]),void 0],d[30]=a[0],d[31]=a[1],d[32]=a[2]))},function(a){return a=[d[30],d[31],d[32]],d[27]=a[0],d[28]=a[1],d[29]=a[2],a}]):c.resolve((function(a){c.logger(a).info(a)}(["Already have the max number of tokens. Scheduling the next ACS token sync for project: ",d[9]].join("")),d[30]=new c.Map(),d[30].set("project_name",d[9]),d[30].set("max_client_token_pool_size",d[10]),d[31]=c.toJSON(d[30]),a=[d[31],c.i64.cast([0,362]),void 0],d[27]=a[0],d[28]=a[1],d[29]=a[2]))},function(a){return a=[d[27],d[28],d[29]],d[20]=a[0],d[21]=a[1],d[22]=a[2],a}])},function(a){return a=[d[20],d[21],d[22]],d[12]=a[0],d[13]=a[1],d[14]=a[2],a}]))})},function(a){return a=[d[12],d[13],d[14]],d[6]=a[0],d[7]=a[1],d[8]=a[2],a}])},function(a){return a=[d[6],d[7],d[8]],d[0]=a[0],d[1]=a[1],d[2]=a[2],a}]))})},function(a){return a=[d[0],d[1],d[2]],e[0]=a[0],e[1]=a[1],e[2]=a[2],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSAnonymousCredentialsTaskSerializerAcsIssueNextSyncStoredProcedure";a.__tables__=["acs_request_context","secure_acs_configurations","secure_acs_blinded_tokens"];e.exports=a}),null);
__d("LSTaskSerializerDeleteChatHistory",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(e){return b.sequence([function(d){return b.db.table(32).fetch([[[a[0]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?(c[4]=b.createArray(),c[5]=(c[4].push("taskSerializerDeleteChatHistory: Task ID not found"),c[4]),c[6]=(c[4].push(a[0]),c[4]),c[7]=b.toJSON(c[4]),function(a){b.logger(a).mustfix(a)}(c[7]),f=[void 0,void 0,void 0],c[0]=f[0],c[1]=f[1],c[2]=f[2]):(e=d.item,b.sequence([function(a){return c[8]=e.threadKey,b.db.table(9).fetch([[[c[8]]]]).next().then(function(a,d){d=a.done;a=a.value;return d?(c[9]=b.createArray(),c[10]=(c[9].push("taskSerializerDeleteChatHistory: Thread not found"),c[9]),c[11]=(c[9].push(c[8]),c[9]),c[12]=b.toJSON(c[9]),function(a){b.logger(a).mustfix(a)}(c[12]),d=[void 0,void 0,void 0],c[4]=d[0],c[5]=d[1],c[6]=d[2]):(a.item,b.sequence([function(a){return b.db.table(9).fetch([[[c[8]]]]).next().then(function(d,e){var a=d.done;d=d.value;return a?c[9]=b.i64.cast([0,1]):(e=d.item,c[14]=e.syncGroup,b.i64.neq(c[14],void 0)?c[13]=c[14]:c[13]=b.i64.cast([0,1]),c[9]=c[13])})},function(a){return c[11]=new b.Map(),c[11].set("thread_key",c[8]),c[11].set("sync_group",c[9]),c[12]=b.toJSON(c[11]),a=[c[12],b.i64.cast([0,903]),void 0],c[4]=a[0],c[5]=a[1],c[6]=a[2]}]))})},function(a){return a=[c[4],c[5],c[6]],c[0]=a[0],c[1]=a[1],c[2]=a[2],a}]))})},function(a){return a=[c[0],c[1],c[2]],d[0]=a[0],d[1]=a[1],d[2]=a[2],a}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxTaskSerializerDeleteChatHistoryStoredProcedure";a.__tables__=["threads_optimistic_context","threads"];e.exports=a}),null);
__d("LSTaskSerializerE2eeMessageIntegrityCheckV2",[],(function(a,b,c,d,e,f){function a(){var a,b=arguments,c=b[b.length-1],d=[];return a=[void 0,c.i64.cast([0,705]),void 0],d[0]=a[0],d[1]=a[1],d[2]=a[2],c.resolve(d)}a.__sproc_name__="LSEncryptedBackupsTaskSerializerE2eeMessageIntegrityCheckV2StoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSTaskSerializerE2eeMetadataThreadIntegrityCheck",[],(function(a,b,c,d,e,f){function a(){var a,b=arguments,c=b[b.length-1],d=[];return a=[void 0,c.i64.cast([0,700]),void 0],d[0]=a[0],d[1]=a[1],d[2]=a[2],c.resolve(d)}a.__sproc_name__="LSE2EEMessagingMetadataMailboxTaskSerializerE2eeMetadataThreadIntegrityCheckStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSTaskSerializerEncryptedBackupAction",[],(function(a,b,c,d,e,f){function a(){var a,b=arguments,c=b[b.length-1],d=[];return a=[void 0,c.i64.cast([0,319]),void 0],d[0]=a[0],d[1]=a[1],d[2]=a[2],c.resolve(d)}a.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupActionStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSTaskSerializerEncryptedBackupsLoopingUpload",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(a){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][taskSerializerEncryptedBackupsLoopingUpload] Beginning execution."),d[1]=c.i64.of_float(Date.now()),function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsLoopingUploadStoredProcedure] LSEncryptedBackupsLoopingUploadPayloadsTable table not found"),d[3]="LSEncryptedBackupsLoopingUploadPayloadsTable table not found",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsLoopingUploadStoredProcedure] ","",d[3]].join("")),d[2]=c.createArray(),void 0!==void 0?d[10]=(d[2].push(void 0),d[2]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsTaskSerializerEncryptedBackupsLoopingUploadStoredProcedure",d[3],d[2],c.i64.cast([0,3]))},function(a){return d[4]=c.i64.of_float(Date.now()),d[5]=c.i64.random(),d[7]="Finishing execution. Execution time: ",d[8]=c.i64.to_string(c.i64.sub(d[4],d[0])),d[9]=" ms",d[6]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][taskSerializerEncryptedBackupsLoopingUpload] ",d[6],d[7],d[6],d[8],d[6],d[9]].join("")),c.i64.eq(c.i64.mod_(d[5],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[10]=",",d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"taskSerializerEncryptedBackupsLoopingUpload",[d[7],d[10],d[8],d[10],d[9]].join(""),d[11],c.i64.cast([0,4]))):c.resolve()},function(a){return a=['{"request_id":"unknown","upload_type":"FBN","payload":{"error_code":2,"operation":"","error_message":"","__typename":"MPSUploadFailurePayload"}}',c.i64.cast([0,50043]),void 0],e[0]=a[0],e[1]=a[1],e[2]=a[2],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsLoopingUploadStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSQueryLocalPersistenceStoreForBackup.nop",["ReQL"],(function(a,b,c,d,e,f,g){"use strict";a=async function(a,b,c,e){b=await d("ReQL").toArrayAsync(d("ReQL").fromTableDescending(a.local_message_persistence_store).filter(function(a){var b=a.offlineThreadingId;a=a.threadId;return a===c&&e===b}));if(b.length===0)return Promise.resolve([void 0,void 0,!1]);a=b[0];return Promise.resolve([a.messagePayload,a.messageTimestampMs,!1])};a.__nop_name__="LSQueryLocalPersistenceStoreForBackup";g.default=a}),98);
__d("LSQueryLocalPersistenceStoreSupplementalForBackup.nop",["ReQL"],(function(a,b,c,d,e,f,g){"use strict";a=async function(a,b,c,e,f){b=await d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.local_message_persistence_store_supplemental).filter(function(a){var b=a.supplementalKey,d=a.threadId;a=a.toplevelOfflineThreadingId;return d===c&&a===e&&b===f}));return b==null?Promise.resolve([void 0,void 0]):Promise.resolve([b.messagePayload,b.messageTimestampMs])};a.__nop_name__="LSQueryLocalPersistenceStoreSupplementalForBackup";g.default=a}),98);
__d("LSQueryLocalPersistenceStoreTagsForBackup.nop",["LSVec","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h=":";a=async function(a,b,e,f){b=await d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.local_message_persistence_store_tag_index.index("offlineThreadingId")).getKeyRange(f,e));if(b==null)return Promise.resolve([c("LSVec").ofArray([])]);a=b.tag;return Promise.resolve([c("LSVec").ofArray(a.split(h))])};a.__nop_name__="LSQueryLocalPersistenceStoreTagsForBackup";g.default=a}),98);
__d("LSLoadUnencryptedProtobufWithInputs",["LSBase64Encode.nop","LSGetBlobFromString.nop","LSLogMebClientEvent.nop","LSQueryLocalPersistenceStoreForBackup.nop","LSQueryLocalPersistenceStoreSupplementalForBackup.nop","LSQueryLocalPersistenceStoreTagsForBackup.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][loadUnencryptedProtobufWithInputs] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.i64.eq(a[0],c.i64.cast([0,1]))?c.sequence([function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreForBackup.nop"),a[1],a[2]).then(function(a){return a=a,d[10]=a[0],d[11]=a[1],d[12]=a[2],a})},function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreTagsForBackup.nop"),a[1],a[2]).then(function(a){return a=a,d[13]=a[0],a})},function(e){return c.blobs.neq(d[10],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[10]).then(function(a){return a=a,d[16]=a[0],a})},function(b){return d[16]!==void 0?(d[13]!==void 0?(d[21]=new c.Map(),d[21].set("message_tags",d[13]),d[22]=c.toJSON(d[21]),d[19]=d[22]):d[19]=void 0,d[20]=new c.Map(),d[20].set("backup_action",a[0]),d[20].set("protobuf_encrypted",d[16]),d[20].set("supplemental_data_encrypted",void 0),d[20].set("timestamp_ms",a[4]),d[20].set("message_tags",d[19]),b=[d[20],void 0],d[17]=b[0],d[18]=b[1]):(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error PROTOBUF_FORMATTING_FAILED"),d[19]=new c.Map(),d[19].set("error_code",c.i64.cast([0,68])),d[19].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),d[19].set("error_message",""),b=[void 0,d[19]],d[17]=b[0],d[18]=b[1]),b=[d[17],d[18]],d[14]=b[0],d[15]=b[1]}]):c.resolve((d[12]?(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error PROTOBUF_ALREADY_DELETED"),d[18]=new c.Map(),d[18].set("error_code",c.i64.cast([0,70])),d[18].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),d[18].set("error_message",""),e=[void 0,d[18]],d[16]=e[0],d[17]=e[1]):(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error PROTOBUF_NOT_FOUND_IN_TOPLEVEL_TABLE"),d[18]=new c.Map(),d[18].set("error_code",c.i64.cast([0,63])),d[18].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),d[18].set("error_message",""),e=[void 0,d[18]],d[16]=e[0],d[17]=e[1]),e=[d[16],d[17]],d[14]=e[0],d[15]=e[1]))},function(a){return a=[d[14],d[15]],d[2]=a[0],d[3]=a[1],a}]):c.sequence([function(e){return c.i64.eq(a[0],c.i64.cast([0,2]))?c.sequence([function(e){return a[3]!==void 0?c.sequence([function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreSupplementalForBackup.nop"),a[1],a[2],a[3]).then(function(a){return a=a,d[14]=a[0],d[15]=a[1],a})},function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreTagsForBackup.nop"),a[1],a[2]).then(function(a){return a=a,d[16]=a[0],a})},function(e){return c.blobs.neq(d[14],void 0)?c.sequence([function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[3]).then(function(a){return a=a,d[19]=a[0],a})},function(e){return c.blobs.neq(d[19],void 0)?c.sequence([function(a){return d[22]=new c.Map(),d[22].set("sk_ciphertext",d[19]),d[22].set("sk_hash",d[19]),c.nativeOperation(b("LSBase64Encode.nop"),d[14]).then(function(a){return a=a,d[23]=a[0],a})},function(b){return d[23]!==void 0?(d[16]!==void 0?(d[28]=new c.Map(),d[28].set("message_tags",d[16]),d[29]=c.toJSON(d[28]),d[26]=d[29]):d[26]=void 0,d[27]=new c.Map(),d[27].set("backup_action",a[0]),d[27].set("protobuf_encrypted",d[23]),d[27].set("supplemental_data_encrypted",d[22]),d[27].set("timestamp_ms",a[4]),d[27].set("message_tags",d[26]),b=[d[27],void 0],d[24]=b[0],d[25]=b[1]):(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error PROTOBUF_FORMATTING_FAILED"),d[26]=new c.Map(),d[26].set("error_code",c.i64.cast([0,68])),d[26].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),d[26].set("error_message",""),b=[void 0,d[26]],d[24]=b[0],d[25]=b[1]),b=[d[24],d[25]],d[20]=b[0],d[21]=b[1]}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error SUPPLEMENTAL_FORMATTING_FAILED"),d[22]=new c.Map(),d[22].set("error_code",c.i64.cast([0,69])),d[22].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),d[22].set("error_message",""),e=[void 0,d[22]],d[20]=e[0],d[21]=e[1]))},function(a){return a=[d[20],d[21]],d[17]=a[0],d[18]=a[1],a}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error PROTOBUF_NOT_FOUND_IN_SUPPLEMENTAL_TABLE"),d[19]=new c.Map(),d[19].set("error_code",c.i64.cast([0,64])),d[19].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),d[19].set("error_message",""),e=[void 0,d[19]],d[17]=e[0],d[18]=e[1]))},function(a){return a=[d[17],d[18]],d[12]=a[0],d[13]=a[1],a}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error SUPPLEMENTAL_KEY_NOT_SET_IN_CONTEXT_TABLE"),d[14]=new c.Map(),d[14].set("error_code",c.i64.cast([0,65])),d[14].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),d[14].set("error_message",""),e=[void 0,d[14]],d[12]=e[0],d[13]=e[1]))},function(a){return a=[d[12],d[13]],d[10]=a[0],d[11]=a[1],a}]):c.resolve((c.i64.eq(a[0],c.i64.cast([0,3]))?(d[14]=new c.Map(),d[14].set("backup_action",a[0]),d[14].set("protobuf_encrypted",void 0),d[14].set("supplemental_data_encrypted",void 0),d[14].set("timestamp_ms",a[4]),d[14].set("message_tags",void 0),e=[d[14],void 0],d[12]=e[0],d[13]=e[1]):(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error INVALID_BACKUP_OPERATION"),d[14]=new c.Map(),d[14].set("error_code",c.i64.cast([-1,4294967289])),d[14].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),d[14].set("error_message",""),e=[void 0,d[14]],d[12]=e[0],d[13]=e[1]),e=[d[12],d[13]],d[10]=e[0],d[11]=e[1]))},function(a){return a=[d[10],d[11]],d[2]=a[0],d[3]=a[1],a}])},function(a){return d[4]=c.i64.of_float(Date.now()),d[5]=c.i64.random(),d[7]="Finishing execution. Execution time: ",d[8]=c.i64.to_string(c.i64.sub(d[4],d[0])),d[9]=" ms",d[6]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][loadUnencryptedProtobufWithInputs] ",d[6],d[7],d[6],d[8],d[6],d[9]].join("")),c.i64.eq(c.i64.mod_(d[5],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[10]=",",d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"loadUnencryptedProtobufWithInputs",[d[7],d[10],d[8],d[10],d[9]].join(""),d[11],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[2],d[3]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSLoadUnencryptedProtobufBackupSerializedPayloadData",["LSLoadUnencryptedProtobufWithInputs","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){var e;return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][loadUnencryptedProtobufBackupSerializedPayloadData] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[18]=c.i64.mul(d[1],c.i64.cast([0,1e6])),c.sequence([function(b){return c.db.table(2).fetch([[[a[0]]]]).next().then(function(b,e){var f=b.done;b=b.value;return f?(d[30]=c.i64.of_float(Date.now()),f=[a[0],void 0,void 0,void 0,void 0,c.i64.sub(c.i64.mul(d[30],c.i64.cast([0,1e6])),d[18]),void 0],d[22]=f[0],d[23]=f[1],d[24]=f[2],d[25]=f[3],d[26]=f[4],d[27]=f[5],d[28]=f[6]):(e=b.item,d[30]=c.i64.of_float(Date.now()),f=[a[0],e.queueName,e.enqueueTimestampMs,e.priority,e.firstExecutedTimestampMs,c.i64.sub(c.i64.mul(d[30],c.i64.cast([0,1e6])),d[18]),void 0],d[22]=f[0],d[23]=f[1],d[24]=f[2],d[25]=f[3],d[26]=f[4],d[27]=f[5],d[28]=f[6])})},function(a){return a=[d[22],d[23],d[24],d[25],d[26],d[27],d[28]],d[2]=a[0],d[3]=a[1],d[4]=a[2],d[5]=a[3],d[6]=a[4],d[7]=a[5],d[8]=a[6],a}])},function(e){return d[9]=new c.Map(),d[9].set("task_id",d[2]),d[9].set("queue_name",d[3]),d[9].set("enqueue_timestamp_ms",d[4]),d[9].set("priority",d[5]),d[9].set("first_executed_timestamp_ms",d[6]),d[9].set("execution_time_ns",d[7]),d[9].set("echo_encoding_execution_time_ns",d[8]),d[10]=new c.Map(),d[10].set("task_metadata",d[9]),d[10].set("action_type",void 0),d[10].set("content_type",void 0),d[10].set("identifiers",void 0),d[10].set("identifiers_v2",void 0),d[10].set("task_creation_source",void 0),d[10].set("message_payload_source",c.i64.cast([0,2])),c.filter(c.db.table(305).fetch(),function(b){return c.i64.eq(b.pendingBackupTaskId,a[0])}).next().then(function(e,f){var g=e.done;e=e.value;return g?(d[22]=new c.Map(),d[22].set("error_code",c.i64.cast([0,5])),d[22].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufBackupSerializedPayloadDataStoredProcedure"),d[22].set("error_message",""),g=[void 0,d[22],d[10]],d[11]=g[0],d[12]=g[1],d[13]=g[2]):(f=e.item,c.sequence([function(b){var e;return d[39]=f.actThreadId,d[40]=f.toplevelOfflineThreadingId,d[23]=f.messageTimestampMs,d[22]=new c.Map(),d[22].set("backup_id","openEbUploadGenericBackupId"),d[22].set("act_thread_id",d[39]),d[22].set("server_thread_id",d[39]),d[22].set("timestamp",c.i64.to_string(d[23])),d[22].set("otid",d[40]),d[24]=new c.Map(),d[24].set("backup_id","openEbUploadGenericBackupId"),d[24].set("act_thread_id",d[39]),d[24].set("timestamp",c.i64.to_string(d[23])),d[24].set("otid",d[40]),c.sequence([function(b){return c.db.table(2).fetch([[[a[0]]]]).next().then(function(e,f){var b=e.done;e=e.value;return b?(d[49]=c.i64.of_float(Date.now()),b=[a[0],void 0,void 0,void 0,void 0,c.i64.sub(c.i64.mul(d[49],c.i64.cast([0,1e6])),d[18]),void 0],d[41]=b[0],d[42]=b[1],d[43]=b[2],d[44]=b[3],d[45]=b[4],d[46]=b[5],d[47]=b[6]):(f=e.item,d[49]=c.i64.of_float(Date.now()),b=[a[0],f.queueName,f.enqueueTimestampMs,f.priority,f.firstExecutedTimestampMs,c.i64.sub(c.i64.mul(d[49],c.i64.cast([0,1e6])),d[18]),void 0],d[41]=b[0],d[42]=b[1],d[43]=b[2],d[44]=b[3],d[45]=b[4],d[46]=b[5],d[47]=b[6])})},function(a){return a=[d[41],d[42],d[43],d[44],d[45],d[46],d[47]],d[25]=a[0],d[26]=a[1],d[27]=a[2],d[28]=a[3],d[29]=a[4],d[30]=a[5],d[31]=a[6],a}])},function(a){return d[32]=new c.Map(),d[32].set("task_id",d[25]),d[32].set("queue_name",d[26]),d[32].set("enqueue_timestamp_ms",d[27]),d[32].set("priority",d[28]),d[32].set("first_executed_timestamp_ms",d[29]),d[32].set("execution_time_ns",d[30]),d[32].set("echo_encoding_execution_time_ns",d[31]),d[33]=new c.Map(),d[33].set("task_metadata",d[32]),d[33].set("action_type",void 0),d[33].set("content_type",void 0),d[33].set("identifiers",void 0),d[33].set("identifiers_v2",d[24]),d[33].set("task_creation_source",void 0),d[33].set("message_payload_source",c.i64.cast([0,2])),c.storedProcedure(b("LSLoadUnencryptedProtobufWithInputs"),f.backupAction,d[39],d[40],f.supplementalKey,d[23],d[22]).then(function(a){return a=a,d[34]=a[0],d[35]=a[1],a})},function(a){return d[34]!==void 0?(d[41]=new c.Map(),d[41].set("unencrypted_protobuf_backup_payload",d[34]),d[41].set("message_identifiers",d[22]),d[41].set("attachment_backup_payload",f.attachmentPayload),d[41].set("sender_id",f.senderId),d[41].set("extra_data_for_eb_upload",void 0),a=[d[41],void 0,d[33]],d[36]=a[0],d[37]=a[1],d[38]=a[2]):(a=[void 0,d[35],d[33]],d[36]=a[0],d[37]=a[1],d[38]=a[2],a),a=[d[36],d[37],d[38]],d[11]=a[0],d[12]=a[1],d[13]=a[2]}]))})},function(a){return d[15]=c.i64.of_float(Date.now()),d[16]=c.i64.random(),d[19]="Finishing execution. Execution time: ",d[20]=c.i64.to_string(c.i64.sub(d[15],d[0])),d[21]=" ms",d[17]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][loadUnencryptedProtobufBackupSerializedPayloadData] ",d[17],d[19],d[17],d[20],d[17],d[21]].join("")),c.i64.eq(c.i64.mod_(d[16],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[22]=",",d[23]=c.createArray(),void 0!==void 0?d[24]=(d[23].push(void 0),d[23]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"loadUnencryptedProtobufBackupSerializedPayloadData",[d[19],d[22],d[20],d[22],d[21]].join(""),d[23],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[11],d[12],d[13]],e[0]=a[0],e[1]=a[1],e[2]=a[2],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsLoadUnencryptedProtobufBackupSerializedPayloadDataStoredProcedure";a.__tables__=["pending_tasks","pending_protobuf_backups_context"];e.exports=a}),null);
__d("LSTaskSerializerEncryptedBackupsOpenUpload",["LSArrayGetObjectAt","LSBase64Encode.nop","LSDeserializeFromJsonIntoDictionaryV2.nop","LSLoadUnencryptedProtobufBackupSerializedPayloadData","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][taskSerializerEncryptedBackupsOpenUpload] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.storedProcedure(b("LSLoadUnencryptedProtobufBackupSerializedPayloadData"),a[0]).then(function(a){return a=a,d[2]=a[0],d[3]=a[1],d[4]=a[2],a})},function(a){return d[2]!==void 0?c.sequence([function(a){return d[15]=d[2].get("message_identifiers"),d[16]=d[2].get("unencrypted_protobuf_backup_payload"),d[17]=d[15].get("server_thread_id"),d[18]=d[15].get("timestamp"),d[19]=d[15].get("otid"),d[20]=d[15].get("act_thread_id"),d[21]=new c.Map(),d[21].set("server_thread_key",d[17]),d[21].set("timestamp",d[18]),d[21].set("otid",d[19]),d[21].set("wa_thread_id",c.i64.from_string(d[20])),d[22]=new c.Map(),d[22].set("message_identifiers",d[21]),d[23]=d[2].get("extra_data_for_eb_upload"),d[23]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSDeserializeFromJsonIntoDictionaryV2.nop"),d[23]).then(function(a){return a=a,d[32]=a[0],a})},function(a){return d[33]=new c.Map(),d[34]=d[32].keys(),d[35]=c.i64.of_int32(d[34].length),c.i64.gt(d[35],c.i64.cast([0,0]))?c.loopAsync(d[35],function(a){return d[36]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[34],d[36]).then(function(a){return a=a,d[37]=a[0],d[38]=a[1],a})},function(a){return d[39]=d[32].get(d[37]),d[33].set(d[37],d[39])}])}):c.resolve()},function(a){return d[24]=d[33]}]):c.resolve(d[24]=void 0)},function(a){return d[24]!==void 0?c.sequence([function(a){return d[32]=d[24].get("mt"),d[32]?d[33]=!1:d[33]=!0,d[33]?c.resolve(d[34]=void 0):c.sequence([function(a){return d[36]=new c.Map(),d[37]=d[32].keys(),d[38]=c.i64.of_int32(d[37].length),c.i64.gt(d[38],c.i64.cast([0,0]))?c.loopAsync(d[38],function(a){return d[39]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[37],d[39]).then(function(a){return a=a,d[40]=a[0],d[41]=a[1],a})},function(a){return d[42]=d[32].get(d[40]),d[36].set(d[40],d[42])}])}):c.resolve()},function(a){return d[34]=d[36]}])},function(a){return d[34]!==void 0?(d[36]=c.toJSON(d[34]),d[35]=d[36]):d[35]=void 0,d[25]=d[35]}]):c.resolve(d[25]=void 0)},function(a){return d[26]=d[16].get("supplemental_data_encrypted"),d[26]!==void 0?c.sequence([function(a){return d[32]=d[16].get("protobuf_encrypted"),d[33]=d[16].get("backup_action"),d[34]=d[16].get("timestamp_ms"),d[35]=d[26].get("sk_ciphertext"),c.nativeOperation(b("LSBase64Encode.nop"),d[35]).then(function(a){return a=a,d[36]=a[0],a})},function(a){return d[37]=d[26].get("sk_hash"),c.nativeOperation(b("LSBase64Encode.nop"),d[37]).then(function(a){return a=a,d[38]=a[0],a})},function(a){return d[39]=new c.Map(),d[39].set("supplementary_data_key",void 0),d[39].set("encrypted_protobuf",d[32]),d[39].set("key_value_backup_action",d[33]),d[39].set("protobuf_ts_ms",d[34]),d[39].set("supplemental_key_ciphertext",d[36]),d[39].set("supplemental_key_hash",d[38]),d[39].set("message_tags",d[25]),d[27]=d[39]}]):c.resolve((d[32]=d[16].get("protobuf_encrypted"),d[33]=d[16].get("backup_action"),d[34]=d[16].get("timestamp_ms"),d[35]=new c.Map(),d[35].set("supplementary_data_key",void 0),d[35].set("encrypted_protobuf",d[32]),d[35].set("key_value_backup_action",d[33]),d[35].set("protobuf_ts_ms",d[34]),d[35].set("message_tags",d[25]),d[27]=d[35]))},function(a){return d[22].set("key_value_backup_unencrypted_payload",d[27]),d[28]=d[2].get("sender_id"),d[22].set("sender_id",d[28]),d[29]=d[2].get("attachment_backup_payload"),d[29]!==void 0?d[22].set("attachment_backup_payload",d[29]):0,d[24]!==void 0?c.sequence([function(a){return d[32]=d[24].get("ttd"),d[32]?d[33]=!1:d[33]=!0,d[33]?c.resolve(d[34]=void 0):c.sequence([function(a){return d[36]=new c.Map(),d[37]=d[32].keys(),d[38]=c.i64.of_int32(d[37].length),c.i64.gt(d[38],c.i64.cast([0,0]))?c.loopAsync(d[38],function(a){return d[39]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[37],d[39]).then(function(a){return a=a,d[40]=a[0],d[41]=a[1],a})},function(a){return d[42]=d[32].get(d[40]),d[36].set(d[40],d[42])}])}):c.resolve()},function(a){return d[34]=d[36]}])},function(a){return d[34]!==void 0?(d[36]=c.toJSON(d[34]),d[35]=d[36]):d[35]=void 0,d[30]=d[35]}]):c.resolve(d[30]=void 0)},function(a){return d[30]!==void 0?d[22].set("tags_to_delete",d[30]):0,d[31]=c.toJSON(d[22]),a=[d[31],void 0,d[4]],d[5]=a[0],d[6]=a[1],d[7]=a[2]}]):c.resolve((d[3]?d[15]=!1:d[15]=!0,d[15]?(a=[void 0,void 0,d[4]],d[16]=a[0],d[17]=a[1],d[18]=a[2],a):(a=[void 0,d[3],d[4]],d[16]=a[0],d[17]=a[1],d[18]=a[2],a),a=[d[16],d[17],d[18]],d[5]=a[0],d[6]=a[1],d[7]=a[2]))},function(a){return d[15]=new c.Map(),d[16]=d[15].set("success",d[5]),d[17]=d[15].set("failure",d[6]),d[18]=d[15].set("context",d[7]),d[19]=c.toJSON(d[15]),d[8]=d[19],d[9]=c.i64.of_float(Date.now()),d[10]=c.i64.random(),d[12]="Finishing execution. Execution time: ",d[13]=c.i64.to_string(c.i64.sub(d[9],d[0])),d[14]=" ms",d[11]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][taskSerializerEncryptedBackupsOpenUpload] ",d[11],d[12],d[11],d[13],d[11],d[14]].join("")),c.i64.eq(c.i64.mod_(d[10],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[15]=",",d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"taskSerializerEncryptedBackupsOpenUpload",[d[12],d[15],d[13],d[15],d[14]].join(""),d[16],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[8],c.i64.cast([0,50048])],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsOpenUploadStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSTaskSerializerEncryptedBackupsRestoreWithSerializer",[],(function(a,b,c,d,e,f){function a(){var a,b=arguments,c=b[b.length-1],d=[];return a=[void 0,void 0,void 0],d[0]=a[0],d[1]=a[1],d[2]=a[2],c.resolve(d)}a.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsRestoreWithSerializerStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSDeriveValueSecretRefV2",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][deriveValueSecretRefV2] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[2]=a[2].get("message_payload_encryption_keys"),d[3]=d[2].get("encryption_version"),d[4]=d[2].get("epoch_anon_id"),d[5]=d[2].get("epoch_root_key"),d[6]=d[2].get("payload_key"),d[7]=c.createArray(),d[41]=(d[7].push(c.i64.cast([0,6])),d[7]),c.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_anon_id_debug").then(function(a){return a=a,d[8]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[8],void 0,d[4],d[7]).then(function(a){return a=a,d[9]=a[0],a})},function(a){return d[9]?d[10]=!1:d[10]=!0,d[10]?c.resolve(d[11]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[9],c.i64.cast([0,0])).then(function(a){return a=a,d[41]=a[0],d[42]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[41]).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[11]=d[43]==null?"":d[43]}])},function(a){return d[12]=c.createArray(),d[41]=(d[12].push(c.i64.cast([0,6])),d[12]),c.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_root_key_debug").then(function(a){return a=a,d[13]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[13],void 0,d[5],d[12]).then(function(a){return a=a,d[14]=a[0],a})},function(a){return d[14]?d[15]=!1:d[15]=!0,d[15]?c.resolve(d[16]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[14],c.i64.cast([0,0])).then(function(a){return a=a,d[41]=a[0],d[42]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[41]).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[16]=d[43]==null?"":d[43]}])},function(a){return d[17]=c.createArray(),d[41]=(d[17].push(c.i64.cast([0,6])),d[17]),c.nativeOperation(b("LSGetBlobFromString.nop"),"message_key_debug").then(function(a){return a=a,d[18]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[18],void 0,d[6],d[17]).then(function(a){return a=a,d[19]=a[0],a})},function(a){return d[19]?d[20]=!1:d[20]=!0,d[20]?c.resolve(d[21]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[19],c.i64.cast([0,0])).then(function(a){return a=a,d[41]=a[0],d[42]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[41]).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[21]=d[43]==null?"":d[43]}])},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[5]).then(function(a){return a=a,d[22]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),[d[22]==null?"":d[22],a[0]].join("")).then(function(a){return a=a,d[23]=a[0],a})},function(a){return d[24]=c.createArray(),d[41]=(d[24].push(c.i64.cast([0,6])),d[24]),c.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_root_key_thread_id_debug").then(function(a){return a=a,d[25]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[25],void 0,d[23],d[24]).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[26]?d[27]=!1:d[27]=!0,d[27]?c.resolve(d[28]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[26],c.i64.cast([0,0])).then(function(a){return a=a,d[41]=a[0],d[42]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[41]).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[28]=d[43]==null?"":d[43]}])},function(a){return d[29]=":",c.blobs.neq(d[5],void 0)?c.sequence([function(a){return d[41]=c.createArray(),d[47]=(d[41].push(c.i64.cast([0,18])),d[41]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[5],d[41]).then(function(a){return a=a,d[42]=a[0],a})},function(a){return d[42]!==void 0?c.sequence([function(a){return d[47]=c.i64.of_int32(d[42].length),c.i64.ge(d[47],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[42],c.i64.cast([0,0])).then(function(a){return a=a,d[49]=a[0],d[50]=a[1],a})},function(a){return d[48]=d[49]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[50]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[50]].join("")),d[49]=c.createArray(),void 0!==void 0?d[51]=(d[49].push(void 0),d[49]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[50],d[49],c.i64.cast([0,3]))},function(a){return d[48]=void 0}])},function(a){return d[43]=d[48]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[48]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[48]].join("")),d[47]=c.createArray(),void 0!==void 0?d[49]=(d[47].push(void 0),d[47]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[48],d[47],c.i64.cast([0,3]))},function(a){return d[43]=void 0}])},function(a){return c.blobs.neq(d[43],void 0)?d[44]=!0:d[44]=!1,d[44]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.nativeOperation(b("LSBase64Encode.nop"),d[43]).then(function(a){return a=a,d[45]=a[0],a})},function(a){return d[45]!==void 0?d[46]=d[45]:d[46]="encodingfailed",d[30]=d[46]}]):c.resolve(d[30]="null")},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[4]).then(function(a){return a=a,d[31]=a[0],a})},function(e){return d[32]=new c.Map(),d[32].set("encryption_version",d[3]),d[32].set("epoch_anon_id",d[31]==null?"":d[31]),d[32].set("message_encryption_values",[d[11],d[29],d[16],d[29],d[21],d[29],d[28]].join("")),d[32].set("root_key_fingerprint",d[30]),d[32].set("backup_id",a[1]),d[33]=c.toJSON(d[32]),d[34]=new c.Map(),d[34].set("value_secret_ref",d[33]),d[35]=c.i64.of_float(Date.now()),d[36]=c.i64.random(),d[38]="Finishing execution. Execution time: ",d[39]=c.i64.to_string(c.i64.sub(d[35],d[0])),d[40]=" ms",d[37]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][deriveValueSecretRefV2] ",d[37],d[38],d[37],d[39],d[37],d[40]].join("")),c.i64.eq(c.i64.mod_(d[36],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[41]=",",d[42]=c.createArray(),void 0!==void 0?d[43]=(d[42].push(void 0),d[42]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"deriveValueSecretRefV2",[d[38],d[41],d[39],d[41],d[40]].join(""),d[42],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[34],void 0],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDeriveValueSecretRefV2StoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSGetBlobFromInt64BE.nop",["GetBlobFromInt64BE"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,c){return d("GetBlobFromInt64BE").GetBlobFromInt64BE(c)};a.__nop_name__="LSGetBlobFromInt64BE";g["default"]=a}),98);
__d("OrderPreservingEncryption",["FBLogger","LSCryptoUtils","LSSynchronousPromise","Promise","UInt8Array","WACryptoHkdfSync","XPlatReactCrypto","gkx","isPromise"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(){return d("XPlatReactCrypto").getRandomValues(new Uint8Array(32)).buffer}function j(a){var b=a.length;return b%2!==0?"0"+a:a}function k(a){a=BigInt(a);var b=j(a.toString(16));a=b.length;a=a/2;var c=[];for(var d=0;d<a;++d)c.push(d*2);return new Uint8Array(c.map(function(a){var c=a+2;return b.slice(a,c)}).map(function(a){return parseInt(a,16)}))}function l(a){a=a.map(function(a){return a._0});return{_0:d("UInt8Array").concatBytes(a)}}function m(a){return"OPE key has length "+String(a)+", expected  "+String(32)}function n(a,b,e){var f=new ArrayBuffer(0);if(c("gkx")("13860"))try{var g=d("WACryptoHkdfSync").hkdf(a,d("LSCryptoUtils").bufToUint8(f),d("LSCryptoUtils").bufToUint8(b.buffer),e);return d("LSSynchronousPromise").makeSynchronousPromise({_0:g})}catch(a){c("FBLogger")("wmi_eb").mustfix("hkdf failed at OrderPreservingEncryption");throw a}return d("XPlatReactCrypto").subtleImportKey("raw",a.buffer,"HKDF",!1,["deriveKey","deriveBits"]).then(function(a){return d("XPlatReactCrypto").subtleDeriveBits({hash:"SHA-256",info:b.buffer,name:"HKDF",salt:f},a,e*8)}).then(function(a){return{_0:d("LSCryptoUtils").bufToUint8(a)}})}function o(a,b){return{_0:d("LSCryptoUtils").modAddBytes(a._0,b)}}function p(a,e,f,g){var j=f.byteLength;if(j!==32)throw c("FBLogger")("wmi_eb").mustfixThrow(m(j));var k=g.byteLength,p=function(a,b){var c=new Uint8Array(1+k),d=new Uint8Array(k-b).fill(0);c.set([b]);c.set(a.subarray(0,b),1);c.set(d,b+1);return c};if(k>=255)throw c("FBLogger")("wmi_eb").mustfixThrow("Input is too large");j=Array.from(g).map(function(b,c){c=p(g,c);var e=new Uint8Array(a);e[a-1]=b;b=d("LSCryptoUtils").bufToUint8(f);return n(b,c,a).then(function(a){return o(a,e)})}).map(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise);j=(i||(i=c("isPromise")))(j[0])?(h||(h=b("Promise"))).all(j):d("LSSynchronousPromise").makeSynchronousPromise(j);return j.then(function(a){return d("UInt8Array").concatBytes([new Uint8Array([e]),l(a)._0])})}function e(a,b,c,d){d=k(d);return p(a,b,c,d)}g.keyGen=a;g.intStringToBEBytes=k;g.buildKeyLengthErrorMsg=m;g.encryptBigEndianBytes=p;g.encryptIntString=e}),98);
__d("OpeEncrypt",["CryptoLogger","I64","LSResult","OrderPreservingEncryption"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e){var f=d("CryptoLogger").CryptoLogger("ope_encrypt");return d("OrderPreservingEncryption").encryptBigEndianBytes((h||(h=d("I64"))).to_int32(e),1,a,new Uint8Array(b)).then(function(a){return c("LSResult")(a.buffer)},function(a){d("CryptoLogger").captureError(f,a).mustfix("OpeEncrypt_impl failed");throw a})}g.OpeEncrypt=a}),98);
__d("LSOpeEncrypt.nop",["OpeEncrypt"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,c,e,f){return d("OpeEncrypt").OpeEncrypt(c,e,f)};a.__nop_name__="LSOpeEncrypt";g["default"]=a}),98);
__d("TruncateSortKey",["CryptoLogger","LSResult","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h,i=d("CryptoLogger").CryptoLogger("truncate_sort_key");function a(a){if(a.byteLength!==8)throw i.mustfixThrow("Bad length on sort key for truncation");var d=new Uint8Array(a);d=d.subarray(0,2);if(d.some(function(a){return a!==0}))throw i.mustfixThrow("Bad prefix on sort key for truncation");return(h||(h=b("Promise"))).resolve(c("LSResult")(a.slice(2)))}g.TruncateSortKey=a}),98);
__d("LSTruncateSortKey.nop",["TruncateSortKey"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,c){return d("TruncateSortKey").TruncateSortKey(c)};a.__nop_name__="LSTruncateSortKey";g["default"]=a}),98);
__d("LSEncryptIdentifiersV2",["LSBase64Encode.nop","LSBinaryToHex.nop","LSGetBlobFromInt64BE.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSLogMebClientEvent.nop","LSOcmfClientMap.nop","LSOpeEncrypt.nop","LSTruncateSortKey.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][encryptIdentifiersV2] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[2]=a[6].get("ocmf_shared_key"),c.nativeOperation(b("LSGetBlobFromString.nop"),a[2]).then(function(a){return a=a,d[3]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWFpbGJveF9pZF9zY29wZQ=="),d[3]).then(function(a){return a=a,d[4]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[2],d[4]).then(function(a){return a=a,d[5]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[5]).then(function(a){return a=a,d[6]=a[0],a})},function(e){return c.i64.eq(a[0],c.i64.cast([0,2]))&&c.i64.eq(a[1],c.i64.cast([0,2]))?d[7]=a[5]:d[7]=a[3],d[8]=a[6].get("ocmf_shared_key"),c.nativeOperation(b("LSGetBlobFromString.nop"),d[7]).then(function(a){return a=a,d[9]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("dGhyZWFkX2lkX3Njb3Bl"),d[9]).then(function(a){return a=a,d[10]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[8],d[10]).then(function(a){return a=a,d[11]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[11]).then(function(a){return a=a,d[12]=a[0],a})},function(e){return d[13]=a[6].get("ope_key"),c.nativeOperation(b("LSGetBlobFromInt64BE.nop"),a[4]).then(function(a){return a=a,d[14]=a[0],a})},function(a){return c.nativeOperation(b("LSTruncateSortKey.nop"),d[14]).then(function(a){return a=a,d[15]=a[0],a})},function(a){return c.nativeOperation(b("LSOpeEncrypt.nop"),d[13],d[15],c.i64.cast([0,16])).then(function(a){return a=a,d[16]=a[0],a})},function(a){return c.nativeOperation(b("LSBinaryToHex.nop"),d[16]).then(function(a){return a=a,d[17]=a[0],a})},function(e){return d[18]=a[6].get("ocmf_shared_key"),c.nativeOperation(b("LSGetBlobFromString.nop"),a[5]).then(function(a){return a=a,d[19]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWVzc2FnZV9pZF9zY29wZQ=="),d[19]).then(function(a){return a=a,d[20]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[18],d[20]).then(function(a){return a=a,d[21]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[21]).then(function(a){return a=a,d[22]=a[0],a})},function(a){return d[23]=new c.Map(),d[23].set("backup_id_ocmf_partial",d[6]==null?"":d[6]),d[23].set("act_thread_id_ocmf_partial",d[12]==null?"":d[12]),d[23].set("timestamp_encrypted",d[17]==null?"":d[17]),d[23].set("otid_ocmf_partial",d[22]==null?"":d[22]),d[24]=c.i64.of_float(Date.now()),d[25]=c.i64.random(),d[27]="Finishing execution. Execution time: ",d[28]=c.i64.to_string(c.i64.sub(d[24],d[0])),d[29]=" ms",d[26]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][encryptIdentifiersV2] ",d[26],d[27],d[26],d[28],d[26],d[29]].join("")),c.i64.eq(c.i64.mod_(d[25],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[30]=",",d[31]=c.createArray(),void 0!==void 0?d[32]=(d[31].push(void 0),d[31]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"encryptIdentifiersV2",[d[27],d[30],d[28],d[30],d[29]].join(""),d[31],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[23],void 0],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsEncryptIdentifiersV2StoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSEncryptMessagePayloadV2",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSLogMebClientEvent.nop","LSSymmetricEncryptionCreateEncryptedString.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][encryptMessagePayloadV2] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[2]=a[2].get("message_payload_encryption_keys"),d[3]=d[2].get("payload_key"),c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedString.nop"),d[3],c.blobs.of_string(["message_thread","_",a[1]].join("")),a[3]).then(function(a){return a=a,d[4]=a[0],a})},function(e){return d[4]!==void 0?c.sequence([function(a){return d[13]=d[2].get("encryption_version"),d[14]=d[2].get("epoch_anon_id"),d[15]=d[2].get("epoch_root_key"),d[16]=d[2].get("payload_key"),d[17]=c.createArray(),d[45]=(d[17].push(c.i64.cast([0,6])),d[17]),c.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_anon_id_debug").then(function(a){return a=a,d[18]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[18],void 0,d[14],d[17]).then(function(a){return a=a,d[19]=a[0],a})},function(a){return d[19]?d[20]=!1:d[20]=!0,d[20]?c.resolve(d[21]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[19],c.i64.cast([0,0])).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[45]).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[21]=d[47]==null?"":d[47]}])},function(a){return d[22]=c.createArray(),d[45]=(d[22].push(c.i64.cast([0,6])),d[22]),c.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_root_key_debug").then(function(a){return a=a,d[23]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[23],void 0,d[15],d[22]).then(function(a){return a=a,d[24]=a[0],a})},function(a){return d[24]?d[25]=!1:d[25]=!0,d[25]?c.resolve(d[26]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[24],c.i64.cast([0,0])).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[45]).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[26]=d[47]==null?"":d[47]}])},function(a){return d[27]=c.createArray(),d[45]=(d[27].push(c.i64.cast([0,6])),d[27]),c.nativeOperation(b("LSGetBlobFromString.nop"),"message_key_debug").then(function(a){return a=a,d[28]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[28],void 0,d[16],d[27]).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[29]?d[30]=!1:d[30]=!0,d[30]?c.resolve(d[31]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[29],c.i64.cast([0,0])).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[45]).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[31]=d[47]==null?"":d[47]}])},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[15]).then(function(a){return a=a,d[32]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),[d[32]==null?"":d[32],a[1]].join("")).then(function(a){return a=a,d[33]=a[0],a})},function(a){return d[34]=c.createArray(),d[45]=(d[34].push(c.i64.cast([0,6])),d[34]),c.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_root_key_thread_id_debug").then(function(a){return a=a,d[35]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[35],void 0,d[33],d[34]).then(function(a){return a=a,d[36]=a[0],a})},function(a){return d[36]?d[37]=!1:d[37]=!0,d[37]?c.resolve(d[38]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[36],c.i64.cast([0,0])).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[45]).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[38]=d[47]==null?"":d[47]}])},function(a){return d[39]=":",c.blobs.neq(d[15],void 0)?c.sequence([function(a){return d[45]=c.createArray(),d[51]=(d[45].push(c.i64.cast([0,18])),d[45]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[15],d[45]).then(function(a){return a=a,d[46]=a[0],a})},function(a){return d[46]!==void 0?c.sequence([function(a){return d[51]=c.i64.of_int32(d[46].length),c.i64.ge(d[51],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[46],c.i64.cast([0,0])).then(function(a){return a=a,d[53]=a[0],d[54]=a[1],a})},function(a){return d[52]=d[53]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[54]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[54]].join("")),d[53]=c.createArray(),void 0!==void 0?d[55]=(d[53].push(void 0),d[53]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[54],d[53],c.i64.cast([0,3]))},function(a){return d[52]=void 0}])},function(a){return d[47]=d[52]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[52]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[52]].join("")),d[51]=c.createArray(),void 0!==void 0?d[53]=(d[51].push(void 0),d[51]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[52],d[51],c.i64.cast([0,3]))},function(a){return d[47]=void 0}])},function(a){return c.blobs.neq(d[47],void 0)?d[48]=!0:d[48]=!1,d[48]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.nativeOperation(b("LSBase64Encode.nop"),d[47]).then(function(a){return a=a,d[49]=a[0],a})},function(a){return d[49]!==void 0?d[50]=d[49]:d[50]="encodingfailed",d[40]=d[50]}]):c.resolve(d[40]="null")},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[14]).then(function(a){return a=a,d[41]=a[0],a})},function(b){return d[42]=new c.Map(),d[42].set("encryption_version",d[13]),d[42].set("epoch_anon_id",d[41]==null?"":d[41]),d[42].set("message_encryption_values",[d[21],d[39],d[26],d[39],d[31],d[39],d[38]].join("")),d[42].set("root_key_fingerprint",d[40]),d[42].set("backup_id",a[0]),d[43]=c.toJSON(d[42]),d[44]=new c.Map(),d[44].set("encrypted_message_payload",d[4]),d[44].set("value_secret_ref",d[43]),b=[d[44],void 0],d[5]=b[0],d[6]=b[1]}]):c.resolve((d[13]=new c.Map(),d[13].set("error_code",c.i64.cast([0,40])),d[13].set("stored_procedure","LSEncryptedBackupsEncryptMessagePayloadV2StoredProcedure"),d[13].set("error_message",""),e=[void 0,d[13]],d[5]=e[0],d[6]=e[1]))},function(a){return d[7]=c.i64.of_float(Date.now()),d[8]=c.i64.random(),d[10]="Finishing execution. Execution time: ",d[11]=c.i64.to_string(c.i64.sub(d[7],d[0])),d[12]=" ms",d[9]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][encryptMessagePayloadV2] ",d[9],d[10],d[9],d[11],d[9],d[12]].join("")),c.i64.eq(c.i64.mod_(d[8],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[13]=",",d[14]=c.createArray(),void 0!==void 0?d[15]=(d[14].push(void 0),d[14]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"encryptMessagePayloadV2",[d[10],d[13],d[11],d[13],d[12]].join(""),d[14],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[5],d[6]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsEncryptMessagePayloadV2StoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSLoadAndEncryptProtobufWithInputsV2",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSLogMebClientEvent.nop","LSQueryLocalPersistenceStoreForBackup.nop","LSQueryLocalPersistenceStoreSupplementalForBackup.nop","LSQueryLocalPersistenceStoreTagsForBackup.nop","LSSymmetricEncryptionCreateEncryptedData.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][loadAndEncryptProtobufWithInputsV2] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.i64.eq(a[0],c.i64.cast([0,1]))?c.sequence([function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreForBackup.nop"),a[1],a[2]).then(function(a){return a=a,d[10]=a[0],d[11]=a[1],d[12]=a[2],a})},function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreTagsForBackup.nop"),a[1],a[2]).then(function(a){return a=a,d[13]=a[0],a})},function(e){return d[14]=new c.Map(),d[14].set("message_tags",d[13]),d[15]=new c.Map(),d[15].set("mt",d[14]),c.blobs.neq(d[10],void 0)?c.sequence([function(e){return d[18]=a[5].get("message_payload_encryption_keys"),d[19]=d[18].get("payload_key"),c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedData.nop"),d[19],c.blobs.of_string(["message_thread","_",a[1]].join("")),d[10]).then(function(a){return a=a,d[20]=a[0],a})},function(a){return c.blobs.neq(d[20],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[20]).then(function(a){return a=a,d[24]=a[0],a})},function(a){return d[21]=d[24]}]):c.resolve(d[21]=void 0)},function(e){return d[21]!==void 0?c.sequence([function(a){return d[15]!==void 0?c.sequence([function(a){return d[27]=d[15].get("mt"),d[27]?d[28]=!1:d[28]=!0,d[28]?c.resolve(d[29]=void 0):c.sequence([function(a){return d[31]=new c.Map(),d[32]=d[27].keys(),d[33]=c.i64.of_int32(d[32].length),c.i64.gt(d[33],c.i64.cast([0,0]))?c.loopAsync(d[33],function(a){return d[34]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[32],d[34]).then(function(a){return a=a,d[35]=a[0],d[36]=a[1],a})},function(a){return d[37]=d[27].get(d[35]),d[31].set(d[35],d[37])}])}):c.resolve()},function(a){return d[29]=d[31]}])},function(a){return d[29]!==void 0?(d[31]=c.toJSON(d[29]),d[30]=d[31]):d[30]=void 0,d[24]=d[30]}]):c.resolve(d[24]=void 0)},function(b){return d[15]!==void 0?(d[27]=d[15].get("mooos"),d[25]=d[27]):d[25]=void 0,d[26]=new c.Map(),d[26].set("backup_action",a[0]),d[26].set("protobuf_encrypted",d[21]),d[26].set("supplemental_data_encrypted",void 0),d[26].set("timestamp_ms",a[4]),d[26].set("message_tags",d[24]),d[26].set("serialized_attachment_backup_payload",void 0),d[26].set("maybe_ooo_supplemental_upload",d[25]),b=[d[26],void 0],d[22]=b[0],d[23]=b[1]}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_ENCRYPTION_FAILED"),d[24]=new c.Map(),d[24].set("error_code",c.i64.cast([0,62])),d[24].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[24].set("error_message",""),e=[void 0,d[24]],d[22]=e[0],d[23]=e[1]))},function(a){return a=[d[22],d[23]],d[16]=a[0],d[17]=a[1],a}]):c.resolve((d[12]?(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_ALREADY_DELETED"),d[20]=new c.Map(),d[20].set("error_code",c.i64.cast([0,70])),d[20].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[20].set("error_message",""),e=[void 0,d[20]],d[18]=e[0],d[19]=e[1]):(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_NOT_FOUND_IN_TOPLEVEL_TABLE"),d[20]=new c.Map(),d[20].set("error_code",c.i64.cast([0,63])),d[20].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[20].set("error_message",""),e=[void 0,d[20]],d[18]=e[0],d[19]=e[1]),e=[d[18],d[19]],d[16]=e[0],d[17]=e[1]))},function(a){return a=[d[16],d[17]],d[2]=a[0],d[3]=a[1],a}]):c.sequence([function(e){return c.i64.eq(a[0],c.i64.cast([0,2]))?c.sequence([function(e){return a[3]!==void 0?c.sequence([function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreSupplementalForBackup.nop"),a[1],a[2],a[3]).then(function(a){return a=a,d[14]=a[0],d[15]=a[1],a})},function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreTagsForBackup.nop"),a[1],a[2]).then(function(a){return a=a,d[16]=a[0],a})},function(e){return d[17]=new c.Map(),d[17].set("message_tags",d[16]),d[18]=new c.Map(),d[18].set("mt",d[17]),c.blobs.neq(d[14],void 0)?c.sequence([function(e){return a[3]!==void 0?c.sequence([function(e){return d[23]=a[5].get("mailbox_root_key_v2"),c.blobs.neq(d[23],void 0)?c.sequence([function(e){return d[26]=a[5].get("message_payload_encryption_keys"),d[27]=d[26].get("epoch_root_key"),d[28]=c.createArray(),d[41]=(d[28].push(c.i64.cast([0,32])),d[28]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleV92Mj5zdXBwbGVtZW50YWxfcHJmX2tleQ=="),void 0,d[23],d[28]).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[29]!==void 0?c.sequence([function(a){return d[41]=c.i64.of_int32(d[29].length),c.i64.ge(d[41],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[29],c.i64.cast([0,0])).then(function(a){return a=a,d[43]=a[0],d[44]=a[1],a})},function(a){return d[42]=d[43]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[44]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",d[44]].join("")),d[43]=c.createArray(),void 0!==void 0?d[45]=(d[43].push(void 0),d[43]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",d[44],d[43],c.i64.cast([0,3]))},function(a){return d[42]=void 0}])},function(a){return d[30]=d[42]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[42]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",d[42]].join("")),d[41]=c.createArray(),void 0!==void 0?d[43]=(d[41].push(void 0),d[41]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",d[42],d[41],c.i64.cast([0,3]))},function(a){return d[30]=void 0}])},function(a){return c.blobs.neq(d[30],void 0)?d[31]=!0:d[31]=!1,d[31]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),d[32]=c.createArray(),d[41]=(d[32].push(c.i64.cast([0,32])),d[32]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleV92Mj5zdXBwbGVtZW50YWxfZW5jX2tleQ=="),void 0,d[27],d[32]).then(function(a){return a=a,d[33]=a[0],a})},function(a){return d[33]!==void 0?c.sequence([function(a){return d[41]=c.i64.of_int32(d[33].length),c.i64.ge(d[41],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[33],c.i64.cast([0,0])).then(function(a){return a=a,d[43]=a[0],d[44]=a[1],a})},function(a){return d[42]=d[43]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[44]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",d[44]].join("")),d[43]=c.createArray(),void 0!==void 0?d[45]=(d[43].push(void 0),d[43]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",d[44],d[43],c.i64.cast([0,3]))},function(a){return d[42]=void 0}])},function(a){return d[34]=d[42]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[42]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",d[42]].join("")),d[41]=c.createArray(),void 0!==void 0?d[43]=(d[41].push(void 0),d[41]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",d[42],d[41],c.i64.cast([0,3]))},function(a){return d[34]=void 0}])},function(e){return c.blobs.neq(d[34],void 0)?d[35]=!0:d[35]=!1,d[35]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.nativeOperation(b("LSGetBlobFromString.nop"),a[3]).then(function(a){return a=a,d[36]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),d[30],d[36]).then(function(a){return a=a,d[37]=a[0],a})},function(a){return c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedData.nop"),d[34],c.blob("c3VwcGxlbWVudGFsX2VuY19hYWQ="),d[36]).then(function(a){return a=a,d[38]=a[0],a})},function(e){return c.blobs.neq(d[38],void 0)?c.sequence([function(e){return d[41]=new c.Map(),d[41].set("sk_ciphertext",d[38]),d[41].set("sk_hash",d[37]),d[42]=a[5].get("message_payload_encryption_keys"),d[43]=d[42].get("payload_key"),c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedData.nop"),d[43],c.blobs.of_string(["message_thread","_",a[1]].join("")),d[14]).then(function(a){return a=a,d[44]=a[0],a})},function(a){return c.blobs.neq(d[44],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[44]).then(function(a){return a=a,d[48]=a[0],a})},function(a){return d[45]=d[48]}]):c.resolve(d[45]=void 0)},function(e){return d[45]!==void 0?c.sequence([function(a){return d[18]!==void 0?c.sequence([function(a){return d[51]=d[18].get("mt"),d[51]?d[52]=!1:d[52]=!0,d[52]?c.resolve(d[53]=void 0):c.sequence([function(a){return d[55]=new c.Map(),d[56]=d[51].keys(),d[57]=c.i64.of_int32(d[56].length),c.i64.gt(d[57],c.i64.cast([0,0]))?c.loopAsync(d[57],function(a){return d[58]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[56],d[58]).then(function(a){return a=a,d[59]=a[0],d[60]=a[1],a})},function(a){return d[61]=d[51].get(d[59]),d[55].set(d[59],d[61])}])}):c.resolve()},function(a){return d[53]=d[55]}])},function(a){return d[53]!==void 0?(d[55]=c.toJSON(d[53]),d[54]=d[55]):d[54]=void 0,d[48]=d[54]}]):c.resolve(d[48]=void 0)},function(b){return d[18]!==void 0?(d[51]=d[18].get("mooos"),d[49]=d[51]):d[49]=void 0,d[50]=new c.Map(),d[50].set("backup_action",a[0]),d[50].set("protobuf_encrypted",d[45]),d[50].set("supplemental_data_encrypted",d[41]),d[50].set("timestamp_ms",a[4]),d[50].set("message_tags",d[48]),d[50].set("serialized_attachment_backup_payload",void 0),d[50].set("maybe_ooo_supplemental_upload",d[49]),b=[d[50],void 0],d[46]=b[0],d[47]=b[1]}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_ENCRYPTION_FAILED"),d[48]=new c.Map(),d[48].set("error_code",c.i64.cast([0,62])),d[48].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[48].set("error_message",""),e=[void 0,d[48]],d[46]=e[0],d[47]=e[1]))},function(a){return a=[d[46],d[47]],d[39]=a[0],d[40]=a[1],a}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error SUPPLEMENTAL_ENCRYPTION_FAILED"),d[41]=new c.Map(),d[41].set("error_code",c.i64.cast([0,66])),d[41].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[41].set("error_message",""),e=[void 0,d[41]],d[39]=e[0],d[40]=e[1]))},function(a){return a=[d[39],d[40]],d[24]=a[0],d[25]=a[1],a}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error NULL_MAILBOX_ROOT_KEY_V2"),d[26]=new c.Map(),d[26].set("error_code",c.i64.cast([0,27])),d[26].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[26].set("error_message",""),e=[void 0,d[26]],d[24]=e[0],d[25]=e[1]))},function(a){return a=[d[24],d[25]],d[21]=a[0],d[22]=a[1],a}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error SUPPLEMENTAL_KEY_NOT_SET_IN_CONTEXT_TABLE"),d[23]=new c.Map(),d[23].set("error_code",c.i64.cast([0,65])),d[23].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[23].set("error_message",""),e=[void 0,d[23]],d[21]=e[0],d[22]=e[1]))},function(a){return a=[d[21],d[22]],d[19]=a[0],d[20]=a[1],a}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_NOT_FOUND_IN_SUPPLEMENTAL_TABLE"),d[21]=new c.Map(),d[21].set("error_code",c.i64.cast([0,64])),d[21].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[21].set("error_message",""),e=[void 0,d[21]],d[19]=e[0],d[20]=e[1]))},function(a){return a=[d[19],d[20]],d[12]=a[0],d[13]=a[1],a}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error SUPPLEMENTAL_KEY_NOT_SET_IN_CONTEXT_TABLE"),d[14]=new c.Map(),d[14].set("error_code",c.i64.cast([0,65])),d[14].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[14].set("error_message",""),e=[void 0,d[14]],d[12]=e[0],d[13]=e[1]))},function(a){return a=[d[12],d[13]],d[10]=a[0],d[11]=a[1],a}]):c.sequence([function(e){return c.i64.eq(a[0],c.i64.cast([0,4]))?c.sequence([function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreForBackup.nop"),a[1],a[2]).then(function(a){return a=a,d[14]=a[0],d[15]=a[1],d[16]=a[2],a})},function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreTagsForBackup.nop"),a[1],a[2]).then(function(a){return a=a,d[17]=a[0],a})},function(e){return d[18]=new c.Map(),d[18].set("message_tags",d[17]),d[19]=new c.Map(),d[19].set("mt",d[18]),c.blobs.neq(d[14],void 0)?c.sequence([function(e){return d[22]=a[5].get("message_payload_encryption_keys"),d[23]=d[22].get("payload_key"),c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedData.nop"),d[23],c.blobs.of_string(["message_thread","_",a[1]].join("")),d[14]).then(function(a){return a=a,d[24]=a[0],a})},function(a){return c.blobs.neq(d[24],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[24]).then(function(a){return a=a,d[28]=a[0],a})},function(a){return d[25]=d[28]}]):c.resolve(d[25]=void 0)},function(e){return d[25]!==void 0?c.sequence([function(a){return d[19]!==void 0?c.sequence([function(a){return d[31]=d[19].get("mt"),d[31]?d[32]=!1:d[32]=!0,d[32]?c.resolve(d[33]=void 0):c.sequence([function(a){return d[35]=new c.Map(),d[36]=d[31].keys(),d[37]=c.i64.of_int32(d[36].length),c.i64.gt(d[37],c.i64.cast([0,0]))?c.loopAsync(d[37],function(a){return d[38]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[36],d[38]).then(function(a){return a=a,d[39]=a[0],d[40]=a[1],a})},function(a){return d[41]=d[31].get(d[39]),d[35].set(d[39],d[41])}])}):c.resolve()},function(a){return d[33]=d[35]}])},function(a){return d[33]!==void 0?(d[35]=c.toJSON(d[33]),d[34]=d[35]):d[34]=void 0,d[28]=d[34]}]):c.resolve(d[28]=void 0)},function(b){return d[19]!==void 0?(d[31]=d[19].get("mooos"),d[29]=d[31]):d[29]=void 0,d[30]=new c.Map(),d[30].set("backup_action",a[0]),d[30].set("protobuf_encrypted",d[25]),d[30].set("supplemental_data_encrypted",void 0),d[30].set("timestamp_ms",a[4]),d[30].set("message_tags",d[28]),d[30].set("serialized_attachment_backup_payload",void 0),d[30].set("maybe_ooo_supplemental_upload",d[29]),b=[d[30],void 0],d[26]=b[0],d[27]=b[1]}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_ENCRYPTION_FAILED"),d[28]=new c.Map(),d[28].set("error_code",c.i64.cast([0,62])),d[28].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[28].set("error_message",""),e=[void 0,d[28]],d[26]=e[0],d[27]=e[1]))},function(a){return a=[d[26],d[27]],d[20]=a[0],d[21]=a[1],a}]):c.resolve((d[16]?(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_ALREADY_DELETED"),d[24]=new c.Map(),d[24].set("error_code",c.i64.cast([0,70])),d[24].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[24].set("error_message",""),e=[void 0,d[24]],d[22]=e[0],d[23]=e[1]):(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_NOT_FOUND_IN_TOPLEVEL_TABLE"),d[24]=new c.Map(),d[24].set("error_code",c.i64.cast([0,63])),d[24].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[24].set("error_message",""),e=[void 0,d[24]],d[22]=e[0],d[23]=e[1]),e=[d[22],d[23]],d[20]=e[0],d[21]=e[1]))},function(a){return a=[d[20],d[21]],d[12]=a[0],d[13]=a[1],a}]):c.sequence([function(e){return c.i64.eq(a[0],c.i64.cast([0,3]))?c.sequence([function(a){return void 0!==void 0?c.sequence([function(a){return d[19]=(void 0).get("mt"),d[19]?d[20]=!1:d[20]=!0,d[20]?c.resolve(d[21]=void 0):c.sequence([function(a){return d[23]=new c.Map(),d[24]=d[19].keys(),d[25]=c.i64.of_int32(d[24].length),c.i64.gt(d[25],c.i64.cast([0,0]))?c.loopAsync(d[25],function(a){return d[26]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[24],d[26]).then(function(a){return a=a,d[27]=a[0],d[28]=a[1],a})},function(a){return d[29]=d[19].get(d[27]),d[23].set(d[27],d[29])}])}):c.resolve()},function(a){return d[21]=d[23]}])},function(a){return d[21]!==void 0?(d[23]=c.toJSON(d[21]),d[22]=d[23]):d[22]=void 0,d[16]=d[22]}]):c.resolve(d[16]=void 0)},function(b){return void 0!==void 0?(d[19]=(void 0).get("mooos"),d[17]=d[19]):d[17]=void 0,d[18]=new c.Map(),d[18].set("backup_action",a[0]),d[18].set("protobuf_encrypted",void 0),d[18].set("supplemental_data_encrypted",void 0),d[18].set("timestamp_ms",a[4]),d[18].set("message_tags",d[16]),d[18].set("serialized_attachment_backup_payload",void 0),d[18].set("maybe_ooo_supplemental_upload",d[17]),b=[d[18],void 0],d[14]=b[0],d[15]=b[1]}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error UNKNOWN_PROTOBUF_TYPE"),d[16]=new c.Map(),d[16].set("error_code",c.i64.cast([0,60])),d[16].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[16].set("error_message",""),e=[void 0,d[16]],d[14]=e[0],d[15]=e[1]))},function(a){return a=[d[14],d[15]],d[12]=a[0],d[13]=a[1],a}])},function(a){return a=[d[12],d[13]],d[10]=a[0],d[11]=a[1],a}])},function(a){return a=[d[10],d[11]],d[2]=a[0],d[3]=a[1],a}])},function(a){return d[4]=c.i64.of_float(Date.now()),d[5]=c.i64.random(),d[7]="Finishing execution. Execution time: ",d[8]=c.i64.to_string(c.i64.sub(d[4],d[0])),d[9]=" ms",d[6]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][loadAndEncryptProtobufWithInputsV2] ",d[6],d[7],d[6],d[8],d[6],d[9]].join("")),c.i64.eq(c.i64.mod_(d[5],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[10]=",",d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"loadAndEncryptProtobufWithInputsV2",[d[7],d[10],d[8],d[10],d[9]].join(""),d[11],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[2],d[3]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSLoadAndEncryptProtobufV2",["LSLoadAndEncryptProtobufWithInputsV2","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][loadAndEncryptProtobufV2] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.filter(c.db.table(305).fetch(),function(b){return c.i64.eq(b.pendingBackupTaskId,a[0])}).next().then(function(e,f){var g=e.done;e=e.value;return g?(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufV2StoredProcedure] Returning error PROTOBUF_CONTEXT_ROW_NOT_FOUND"),d[11]=new c.Map(),d[11].set("error_code",c.i64.cast([0,67])),d[11].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufV2StoredProcedure"),d[11].set("error_message",""),g=[void 0,d[11]],d[2]=g[0],d[3]=g[1]):(f=e.item,c.sequence([function(e){return c.storedProcedure(b("LSLoadAndEncryptProtobufWithInputsV2"),f.backupAction,a[2],f.toplevelOfflineThreadingId,f.supplementalKey,f.messageTimestampMs,a[1]).then(function(a){return a=a,d[11]=a[0],d[12]=a[1],a})},function(a){return a=[d[11],d[12]],d[2]=a[0],d[3]=a[1],a}]))})},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[8]="Finishing execution. Execution time: ",d[9]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[10]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][loadAndEncryptProtobufV2] ",d[7],d[8],d[7],d[9],d[7],d[10]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[11]=",",d[12]=c.createArray(),void 0!==void 0?d[13]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"loadAndEncryptProtobufV2",[d[8],d[11],d[9],d[11],d[10]].join(""),d[12],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[2],d[3]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsLoadAndEncryptProtobufV2StoredProcedure";a.__tables__=["pending_protobuf_backups_context"];e.exports=a}),null);
__d("LSSerializeBackupPayloadV2",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSDeriveValueSecretRefV2","LSEncryptIdentifiersV2","LSEncryptMessagePayloadV2","LSGetBlobFromString.nop","LSGetLatestEpochKeys","LSIsEncryptionVersionSecure","LSLoadAndEncryptProtobufV2","LSLogMebClientEvent.nop","LSLogWebQpl.nop","LSQplAnnotateBool.nop","LSQplAnnotateString.nop","LSQplMarkEnd.nop","LSQplMarkPoint.nop","LSQplStartTrace.nop","gkx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1],e=[],f=[];return d.sequence([function(g){return d.sequence([function(b){return e[0]=d.i64.of_float(Date.now()),function(a){d.logger(a).info(a)}("[EncryptedBackups][serializeBackupPayloadV2] Beginning execution."),e[1]=d.i64.of_float(Date.now()),e[19]=d.i64.mul(e[1],d.i64.cast([0,1e6])),e[2]=d.i64.random(),e[6]=d.i64.to_string(e[2]),d.db.table(2).fetch([[[a[0]]]]).next().then(function(a,b){var c=a.done;a=a.value;return c?e[3]=void 0:(b=a.item,e[3]=b.dataTraceId)})},function(a){return e[3]!==void 0?e[5]=e[3]:e[5]=void 0,e[6]!==void 0?d.nativeOperation(b("LSQplStartTrace.nop"),d.i64.cast([0,637746317]),e[6],!0,e[5]):d.resolve()},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplMarkPoint.nop"),d.i64.cast([0,637746317]),e[6],"LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure_start"):d.resolve()},function(a){return d.islc(d.filter(d.db.table(168).fetch(),function(a){return d.i64.eq(a.authorityLevel,d.i64.cast([0,80]))||!1}),0,d.i64.to_float(d.i64.cast([0,1]))).next().then(function(a,b){var c=a.done;a=a.value;return c?(e[23]=new d.Map(),e[23].set("error_msg","Expected a nonempty query result"),e[23].set("code",d.i64.cast([0,3])),e[23].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),e[24]=d.createArray(),e[25]=(e[24].push(e[23]),e[24]),c=[void 0,e[24]],e[7]=c[0],e[8]=c[1]):(b=a.item,e[23]=new d.Map(),e[23].set("backup_id",b.backupId),e[23].set("device_public_key_blob",b.devicePublicKeyBlob),e[23].set("device_private_key_blob",b.devicePrivateKeyBlob),e[23].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),e[23].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),e[23].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),e[23].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),e[23].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),e[23].set("ocmf_client_state_blob",b.ocmfClientStateBlob),e[23].set("orf_client_state_v2_blob",void 0),e[23].set("orf_v2_authority_level",void 0),e[23].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),e[23].set("device_id",b.deviceId),e[23].set("backup_tenancy",b.backupTenancy),e[23].set("encryption_version",b.encryptionVersion),e[23].set("revision_version",b.revisionVersion),e[23].set("initialize_restore_result",void 0),e[23].set("device_creation_timestamp_sec",void 0),e[23].set("authority_level",b.authorityLevel),c=[e[23],void 0],e[7]=c[0],e[8]=c[1])})},function(f){return e[10]=new d.Map(),e[10].set("value",e[7]),e[10].set("errors",e[8]),e[11]=e[10].get("value"),e[11]!==void 0?d.sequence([function(f){return e[23]=e[11].get("backup_id"),e[24]=e[11].get("device_public_key_blob"),e[25]=e[11].get("device_private_key_blob"),e[26]=e[11].get("epoch_storage_public_key_blob"),e[27]=e[11].get("epoch_storage_private_key_blob"),e[28]=e[11].get("epoch_auth_public_key_blob"),e[29]=e[11].get("epoch_auth_private_key_blob"),e[30]=e[11].get("mailbox_root_key_blob"),e[31]=e[11].get("ocmf_client_state_blob"),e[32]=e[11].get("orf_client_state_v2_blob"),e[33]=e[11].get("orf_v2_authority_level"),e[34]=e[11].get("oblivious_validation_token_blob"),e[35]=e[11].get("device_id"),e[36]=e[11].get("backup_tenancy"),e[37]=e[11].get("encryption_version"),e[38]=e[11].get("revision_version"),e[39]=e[11].get("initialize_restore_result"),e[40]=e[11].get("device_creation_timestamp_sec"),e[41]=e[11].get("authority_level"),d.i64.neq(e[35],void 0)?d.sequence([function(a){return e[46]=void 0,d.i64.neq(e[46],void 0)?d.resolve(e[47]=e[46]):d.sequence([function(a){return e[55]=d.createArray(),d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,0])).then(function(a){return a=a,e[56]=a[0],a})},function(a){return e[56]?e[65]=(e[55].push(d.i64.cast([0,0])),e[55]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,2])).then(function(a){return a=a,e[57]=a[0],a})},function(a){return e[57]?e[65]=(e[55].push(d.i64.cast([0,2])),e[55]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,3])).then(function(a){return a=a,e[58]=a[0],a})},function(a){return e[58]?e[65]=(e[55].push(d.i64.cast([0,3])),e[55]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,4])).then(function(a){return a=a,e[59]=a[0],a})},function(a){return e[59]?e[65]=(e[55].push(d.i64.cast([0,4])),e[55]):0,e[60]=d.createArray(),e[61]=d.i64.of_int32(e[55].length),d.i64.gt(e[61],d.i64.cast([0,0]))?d.loopAsync(e[61],function(a){return e[65]=a,d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[55],e[65]).then(function(a){return a=a,e[66]=a[0],e[67]=a[1],a})},function(a){return e[68]=(e[60].push(e[66]),e[60])}])}):d.resolve()},function(a){return d.sequence([function(a){return e[65]=d.createArray(),e[66]=d.i64.of_int32(e[60].length),d.i64.gt(e[66],d.i64.cast([0,0]))?d.loopAsync(e[66],function(a){return e[68]=a,d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[60],e[68]).then(function(a){return a=a,e[69]=a[0],e[70]=a[1],a})},function(a){return e[71]=(e[65].push(d.i64.to_string(e[69])),e[65])}])}):d.resolve()},function(a){return e[67]=e[65].join(","),e[62]=e[67]}])},function(a){return e[60].some(function(a){return d.i64.eq(e[37],a)})?e[63]=e[37]:e[63]=void 0,d.i64.neq(e[63],void 0)?e[64]=e[63]:e[64]=void 0,e[47]=e[64]}])},function(f){return d.i64.neq(e[47],void 0)?e[48]=e[47]:e[48]=d.i64.cast([0,0]),d.i64.neq(e[36],void 0)?e[49]=e[36]:e[49]=d.i64.cast([0,1]),d.db.table(177).fetch([[[a[0]]],"fk_pending_tasks"]).next().then(function(f,g){var h=f.done;f=f.value;return h?d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[67]=d.i64.of_float(Date.now()),b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[67],d.i64.cast([0,1e6])),e[19]),void 0],e[55]=b[0],e[56]=b[1],e[57]=b[2],e[58]=b[3],e[59]=b[4],e[60]=b[5],e[61]=b[6]):(f=c.item,e[67]=d.i64.of_float(Date.now()),b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[67],d.i64.cast([0,1e6])),e[19]),void 0],e[55]=b[0],e[56]=b[1],e[57]=b[2],e[58]=b[3],e[59]=b[4],e[60]=b[5],e[61]=b[6])})},function(a){return e[63]=new d.Map(),e[63].set("task_id",e[55]),e[63].set("queue_name",e[56]),e[63].set("enqueue_timestamp_ms",e[57]),e[63].set("priority",e[58]),e[63].set("first_executed_timestamp_ms",e[59]),e[63].set("execution_time_ns",e[60]),e[63].set("echo_encoding_execution_time_ns",e[61]),e[64]=new d.Map(),e[64].set("task_metadata",e[63]),e[64].set("action_type",void 0),e[64].set("content_type",void 0),e[64].set("identifiers",void 0),e[64].set("identifiers_v2",void 0),e[64].set("task_creation_source",void 0),e[64].set("message_payload_source",d.i64.cast([0,2])),e[65]=new d.Map(),e[65].set("error_code",d.i64.cast([0,5])),e[65].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),e[65].set("error_message","Pending backup context row not found"),e[65]!==void 0?(e[67]=e[65].get("stored_procedure"),e[68]=e[65].get("error_code"),e[69]=e[65].get("error_message"),e[70]=".",e[71]=[e[67],e[70],d.i64.to_string(e[68]),e[70],e[69]].join(""),e[6]!==void 0?e[71]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[71]):d.resolve():d.resolve()):d.resolve()},function(a){return void 0!==void 0?(e[67]=(void 0).get("stored_procedure"),e[68]=(void 0).get("error_code"),e[69]=(void 0).get("error_message"),e[70]=".",e[71]=[e[67],e[70],d.i64.to_string(e[68]),e[70],e[69]].join(""),e[6]!==void 0?e[71]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[71]):d.resolve():d.resolve()):d.resolve()},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,637746317]),e[6],!1):d.resolve()},function(a){return e[66]=d.createArray(),a=[void 0,e[65],e[64],e[66]],e[50]=a[0],e[51]=a[1],e[52]=a[2],e[53]=a[3]}]):(g=f.item,d.sequence([function(b){return e[62]=g.actionType,e[63]=g.contentType,e[68]=g.echoContent,e[69]=g.lsTraceId,e[67]=g.echoEncodingLatencyNs,e[66]=g.attachmentPayload,e[70]=g.tamThreadSubtype,e[71]=g.isInstamadillo,e[55]=new d.Map(),e[55].set("backup_id",d.i64.to_string(e[23])),e[55].set("act_thread_id",g.listKey),e[55].set("timestamp",g.sortKey),e[55].set("otid",g.uniqueKey),d.filter(d.db.table(305).fetch(),function(b){return d.i64.eq(b.pendingBackupTaskId,a[0])}).next().then(function(b,c){var a=b.done;b=b.value;return a?e[56]=!1:(c=b.item,e[55].set("supplemental_otid",c.supplementalOfflineThreadingId),e[55].set("deletion_otid",c.deletionOfflineThreadingId),e[56]=!0)})},function(a){return e[65]=d.i64.eq(void 0,void 0),e[6]!==void 0?d.nativeOperation(b("LSQplAnnotateBool.nop"),d.i64.cast([0,637746317]),e[6],"should_run_device_timestamp_sync",e[65]):d.resolve()},function(f){return e[64]=g.error==null?d.i64.cast([0,0]):g.error,[d.i64.cast([0,0]),d.i64.cast([0,32])].some(function(a){return d.i64.eq(e[64],a)})?d.sequence([function(a){return e[72]=e[55].get("act_thread_id"),e[73]=e[55].get("otid"),d.storedProcedure(b("LSGetLatestEpochKeys"),!1).then(function(a){return a=a,e[74]=a[0],e[75]=a[1],a})},function(a){return e[74]!==void 0?d.sequence([function(a){return d.i64.eq(e[63],d.i64.cast([0,1]))?d.sequence([function(a){return e[85]=d.createArray(),e[90]=(e[85].push(d.i64.cast([0,32])),e[85]),d.nativeOperation(b("LSGetBlobFromString.nop"),["thread_ope_key","_",e[72]].join("")).then(function(a){return a=a,e[86]=a[0],a})},function(a){return d.nativeOperation(b("LSCreateDerivedKeys.nop"),e[86],void 0,e[30],e[85]).then(function(a){return a=a,e[87]=a[0],a})},function(a){return e[87]?e[88]=!1:e[88]=!0,e[88]?d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),e[91]="Got null keys while deriving message list OPE key. Returning null blobish",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",e[91]].join("")),e[90]=d.createArray(),void 0!==void 0?e[92]=(e[90].push(void 0),e[90]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",e[91],e[90],d.i64.cast([0,3]))},function(a){return e[89]=void 0}]):d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[87],d.i64.cast([0,0])).then(function(a){return a=a,e[90]=a[0],e[91]=a[1],a})},function(a){return e[89]=e[90]}])},function(a){return e[82]=e[89]}]):d.sequence([function(a){return d.i64.eq(e[62],d.i64.cast([0,2]))?d.sequence([function(a){return e[86]=d.createArray(),e[91]=(e[86].push(d.i64.cast([0,32])),e[86]),d.nativeOperation(b("LSGetBlobFromString.nop"),["thread_ope_key","_",e[73]].join("")).then(function(a){return a=a,e[87]=a[0],a})},function(a){return d.nativeOperation(b("LSCreateDerivedKeys.nop"),e[87],void 0,e[30],e[86]).then(function(a){return a=a,e[88]=a[0],a})},function(a){return e[88]?e[89]=!1:e[89]=!0,e[89]?d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),e[92]="Got null keys while deriving message list OPE key. Returning null blobish",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",e[92]].join("")),e[91]=d.createArray(),void 0!==void 0?e[93]=(e[91].push(void 0),e[91]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",e[92],e[91],d.i64.cast([0,3]))},function(a){return e[90]=void 0}]):d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[88],d.i64.cast([0,0])).then(function(a){return a=a,e[91]=a[0],e[92]=a[1],a})},function(a){return e[90]=e[91]}])},function(a){return e[85]=e[90]}]):d.resolve(e[85]=void 0)},function(a){return e[82]=e[85]}])},function(a){return d.blobs.neq(e[82],void 0)?d.sequence([function(a){return e[85]=e[74].get("epoch_keys"),e[86]=e[85].get("epoch_anon_id"),e[87]=e[85].get("epoch_root_key"),e[88]=d.createArray(),e[103]=(e[88].push(d.i64.cast([0,32])),e[88]),d.i64.ge(e[48],d.i64.cast([0,3]))?d.resolve(e[89]=void 0):d.sequence([function(a){return d.nativeOperation(b("LSGetBlobFromString.nop"),e[72]).then(function(a){return a=a,e[103]=a[0],a})},function(a){return e[89]=e[103]}])},function(a){return d.i64.ge(e[48],d.i64.cast([0,4]))?(e[103]="_",e[90]=["message_key_in_epoch",e[103],d.blobs.to_string(e[86]),e[103],"cipher_version",e[103],d.i64.to_string(e[48]),e[103],"thread",e[103],e[72]==null?"":e[72]].join("")):(d.i64.ge(e[48],d.i64.cast([0,3]))?(e[104]="_",e[103]=["message_key_in_epoch",e[104],d.blobs.to_string(e[86]),e[104],"cipher_version",e[104],d.i64.to_string(e[48]),e[104],"thread",e[104],e[72]==null?"":e[72]].join("")):(d.i64.ge(e[48],d.i64.cast([0,2]))?(e[105]="_",e[104]=["message_key_in_epoch",e[105],d.blobs.to_string(e[86]),e[105],"cipher_version",e[105],d.i64.to_string(e[48])].join("")):e[104]=["message_key_in_epoch","_",d.blobs.to_string(e[86])].join(""),e[103]=e[104]),e[90]=e[103]),d.nativeOperation(b("LSGetBlobFromString.nop"),e[90]).then(function(a){return a=a,e[91]=a[0],a})},function(a){return d.nativeOperation(b("LSCreateDerivedKeys.nop"),e[91],e[89],e[87],e[88]).then(function(a){return a=a,e[92]=a[0],a})},function(a){return e[92]?e[93]=!1:e[93]=!0,e[93]?d.resolve(e[94]=void 0):d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[92],d.i64.cast([0,0])).then(function(a){return a=a,e[103]=a[0],e[104]=a[1],a})},function(a){return e[94]=e[103]}])},function(a){return d.filter(d.db.table(169).fetch(),function(a){return d.blobs.eq(a.epochAnonIdBlob,d.blob("MA=="))}).next().then(function(b,c){var a=b.done;b=b.value;return a?(e[103]=new d.Map(),e[103].set("error_msg","Expected a nonempty query result"),e[103].set("code",d.i64.cast([0,3])),e[103].set("src_line","MEBEpochClientUtils.php:556 MEBEpochClientUtils::maybeEpochWithAnonIDFromPersistentEpochsTableDirectly()"),e[104]=d.createArray(),e[105]=(e[104].push(e[103]),e[104]),a=[void 0,e[104]],e[95]=a[0],e[96]=a[1]):(c=b.item,e[103]=new d.Map(),e[103].set("epoch_id",c.epochId),e[103].set("backup_id",c.backupId),e[103].set("epoch_anon_id_blob",c.epochAnonIdBlob),e[103].set("epoch_root_key_blob",c.epochRootKeyBlob),e[103].set("epoch_status",c.epochStatus),e[103].set("epoch_head",c.epochHead),e[103].set("authority_level",c.authorityLevel),a=[e[103],void 0],e[95]=a[0],e[96]=a[1])})},function(a){return e[98]=new d.Map(),e[98].set("value",e[95]),e[98].set("errors",e[96]),e[99]=e[98].get("value"),e[99]!==void 0?d.sequence([function(a){return e[103]=e[99].get("epoch_id"),e[104]=e[99].get("backup_id"),e[105]=e[99].get("epoch_anon_id_blob"),e[106]=e[99].get("epoch_root_key_blob"),e[107]=e[99].get("epoch_status"),e[108]=e[99].get("epoch_head"),e[109]=e[99].get("authority_level"),e[110]=d.createArray(),e[118]=(e[110].push(d.i64.cast([0,32])),e[110]),d.nativeOperation(b("LSCreateDerivedKeys.nop"),d.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleT5zYWx0X21haWxib3hfcm9vdF9rZXlfdjI="),void 0,e[30],e[110]).then(function(a){return a=a,e[111]=a[0],a})},function(a){return e[111]!==void 0?d.sequence([function(a){return e[118]=d.i64.of_int32(e[111].length),d.i64.ge(e[118],d.i64.cast([0,1]))?d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[111],d.i64.cast([0,0])).then(function(a){return a=a,e[120]=a[0],e[121]=a[1],a})},function(a){return e[119]=e[120]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),e[121]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",e[121]].join("")),e[120]=d.createArray(),void 0!==void 0?e[122]=(e[120].push(void 0),e[120]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",e[121],e[120],d.i64.cast([0,3]))},function(a){return e[119]=void 0}])},function(a){return e[112]=e[119]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),e[119]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",e[119]].join("")),e[118]=d.createArray(),void 0!==void 0?e[120]=(e[118].push(void 0),e[118]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",e[119],e[118],d.i64.cast([0,3]))},function(a){return e[112]=void 0}])},function(a){return d.blobs.neq(e[112],void 0)?e[113]=!0:e[113]=!1,e[113]?0:(function(a){d.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),d["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),e[114]=d.createArray(),e[118]=(e[114].push(d.i64.cast([0,32])),e[114]),d.nativeOperation(b("LSCreateDerivedKeys.nop"),d.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleT5tYWlsYm94X3Jvb3Rfa2V5X3Yy"),e[112],e[106],e[114]).then(function(a){return a=a,e[115]=a[0],a})},function(a){return e[115]!==void 0?d.sequence([function(a){return e[118]=d.i64.of_int32(e[115].length),d.i64.ge(e[118],d.i64.cast([0,1]))?d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[115],d.i64.cast([0,0])).then(function(a){return a=a,e[120]=a[0],e[121]=a[1],a})},function(a){return e[119]=e[120]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),e[121]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",e[121]].join("")),e[120]=d.createArray(),void 0!==void 0?e[122]=(e[120].push(void 0),e[120]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",e[121],e[120],d.i64.cast([0,3]))},function(a){return e[119]=void 0}])},function(a){return e[116]=e[119]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),e[119]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",e[119]].join("")),e[118]=d.createArray(),void 0!==void 0?e[120]=(e[118].push(void 0),e[118]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",e[119],e[118],d.i64.cast([0,3]))},function(a){return e[116]=void 0}])},function(a){return d.blobs.neq(e[116],void 0)?e[117]=!0:e[117]=!1,e[117]?0:(function(a){d.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),d["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),e[100]=e[116]}]):d.sequence([function(a){return e[103]=e[98].get("errors"),e[104]=e[98].get("errors"),function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBEpochClientUtils] Failed to get mailbox_root_key_v2: epoch 0 is not available."),e[106]="Failed to get mailbox_root_key_v2: epoch 0 is not available.",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBEpochClientUtils] ","",e[106]].join("")),e[105]=d.createArray(),void 0!==void 0?e[107]=(e[105].push(void 0),e[105]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBEpochClientUtils",e[106],e[105],d.i64.cast([0,3]))},function(a){return e[100]=void 0}])},function(a){return d.blobs.neq(e[94],void 0)?d.sequence([function(a){return d.blobs.neq(e[100],void 0)?d.sequence([function(a){return e[109]=d.createArray(),e[113]=(e[109].push(d.i64.cast([0,32])),e[109]),d.nativeOperation(b("LSCreateDerivedKeys.nop"),d.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleV92Mj5mYWxsYmFja19rZXk="),void 0,e[100],e[109]).then(function(a){return a=a,e[110]=a[0],a})},function(a){return e[110]!==void 0?d.sequence([function(a){return e[113]=d.i64.of_int32(e[110].length),d.i64.ge(e[113],d.i64.cast([0,1]))?d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[110],d.i64.cast([0,0])).then(function(a){return a=a,e[115]=a[0],e[116]=a[1],a})},function(a){return e[114]=e[115]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),e[116]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",e[116]].join("")),e[115]=d.createArray(),void 0!==void 0?e[117]=(e[115].push(void 0),e[115]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",e[116],e[115],d.i64.cast([0,3]))},function(a){return e[114]=void 0}])},function(a){return e[111]=e[114]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),e[114]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",e[114]].join("")),e[113]=d.createArray(),void 0!==void 0?e[115]=(e[113].push(void 0),e[113]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",e[114],e[113],d.i64.cast([0,3]))},function(a){return e[111]=void 0}])},function(a){return d.blobs.neq(e[111],void 0)?e[112]=!0:e[112]=!1,e[112]?0:(function(a){d.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),d["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),e[103]=e[111]}]):d.resolve(e[103]=void 0)},function(a){return e[104]=e[85].get("epoch_root_key"),e[105]=e[85].get("epoch_anon_id"),e[106]=e[85].get("epoch_id"),e[107]=new d.Map(),e[107].set("payload_key",e[94]),e[107].set("payload_fallback_key",e[103]),e[107].set("encryption_version",e[48]),e[107].set("epoch_root_key",e[104]),e[107].set("epoch_anon_id",e[105]),e[107].set("epoch_id",e[106]),e[108]=new d.Map(),e[108].set("ope_key",e[82]),e[108].set("message_payload_encryption_keys",e[107]),e[108].set("ocmf_shared_key",e[31]),e[108].set("mailbox_base_salt",e[30]),e[108].set("mailbox_root_key_v2",e[100]),a=[e[108],void 0],e[101]=a[0],e[102]=a[1]}]):d.resolve((e[103]=new d.Map(),e[103].set("error_code",d.i64.cast([0,26])),e[103].set("stored_procedure","MEBKeyDeriver"),e[103].set("error_message",""),a=[void 0,e[103]],e[101]=a[0],e[102]=a[1]))},function(a){return a=[e[101],e[102]],e[83]=a[0],e[84]=a[1],a}]):d.resolve((e[85]=new d.Map(),e[85].set("error_code",d.i64.cast([0,25])),e[85].set("stored_procedure","MEBKeyDeriver"),e[85].set("error_message",""),a=[void 0,e[85]],e[83]=a[0],e[84]=a[1]))},function(a){return a=[e[83],e[84]],e[76]=a[0],e[77]=a[1],a}]):d.resolve((a=[void 0,e[75]],e[76]=a[0],e[77]=a[1],a))},function(f){return e[76]!==void 0?d.sequence([function(a){return e[82]=e[55].get("backup_id"),e[83]=e[55].get("act_thread_id"),e[84]=e[55].get("timestamp"),e[85]=e[55].get("otid"),d.storedProcedure(b("LSEncryptIdentifiersV2"),e[62],e[63],e[82],e[83],d.i64.from_string(e[84]),e[85],e[76]).then(function(a){return a=a,e[86]=a[0],e[87]=a[1],a})},function(f){return e[86]!==void 0?d.sequence([function(c){return e[92]=e[55].get("act_thread_id"),d.storedProcedure(b("LSLoadAndEncryptProtobufV2"),a[0],e[76],e[92]).then(function(a){return a=a,e[93]=a[0],e[94]=a[1],a})},function(f){return e[99]=d.i64.eq(e[64],d.i64.cast([0,32]))||!1||c("gkx")("12541")||!1,e[100]=e[93]!==void 0,e[99]&&e[100]?d.sequence([function(a){return e[101]=e[55].get("act_thread_id"),e[102]=e[55].get("backup_id"),d.storedProcedure(b("LSDeriveValueSecretRefV2"),e[101],e[102],e[76]).then(function(a){return a=a,e[103]=a[0],e[104]=a[1],a})},function(c){return e[93]!==void 0?d.sequence([function(c){return e[103]!==void 0?d.sequence([function(a){return e[113]=e[103].get("value_secret_ref"),e[114]=e[86].get("act_thread_id_ocmf_partial"),e[115]=e[86].get("otid_ocmf_partial"),e[116]=e[86].get("timestamp_encrypted"),e[117]=new d.Map(),e[117].set("list_key",e[114]),e[117].set("unique_key",e[115]),e[117].set("sort_key",e[116]),void 0!==void 0?(e[151]=(void 0).get("encrypted_message_payload"),e[152]=(void 0).get("value_secret_ref"),e[153]=new d.Map(),e[153].set("value",e[151]),e[153].set("value_secret_ref",e[152]),e[118]=e[153]):e[118]=void 0,e[119]=new d.Map(),e[119].set("list_item_id",e[117]),e[119].set("list_item",e[118]),e[119].set("action_type",e[62]),e[120]=e[55].get("timestamp"),e[121]=e[55].get("otid"),e[122]=e[55].get("act_thread_id"),e[123]=e[55].get("supplemental_otid"),e[124]=e[55].get("deletion_otid"),e[125]=new d.Map(),e[125].set("timestamp",e[120]),e[125].set("otid",e[121]),e[125].set("wa_thread_id",d.i64.from_string(e[122])),e[125].set("supplemental_otid",e[123]),e[125].set("deletion_otid",e[124]),e[126]=e[76].get("mailbox_base_salt"),d.nativeOperation(b("LSBase64Encode.nop"),e[126]).then(function(a){return a=a,e[127]=a[0],a})},function(a){return e[128]=e[76].get("ocmf_shared_key"),d.nativeOperation(b("LSBase64Encode.nop"),e[128]).then(function(a){return a=a,e[129]=a[0],a})},function(a){return e[130]=new d.Map(),e[130].set("mailbox_root_key",e[127]==null?"":e[127]),e[130].set("ocmf_client_state_blob",e[129]==null?"":e[129]),e[131]=e[86].get("backup_id_ocmf_partial"),e[132]=e[76].get("message_payload_encryption_keys"),e[133]=e[132].get("epoch_id"),e[134]=e[76].get("message_payload_encryption_keys"),e[135]=e[134].get("encryption_version"),e[150]=e[69]==null?"":e[69],e[136]=new d.Map(),e[136].set("mailbox_partial_id",e[131]),e[136].set("action",e[119]),e[136].set("device_id",e[35]),e[136].set("echo_version",d.i64.cast([0,0])),e[136].set("epoch_id",e[133]),e[136].set("trace_id",void 0),e[136].set("encryption_version",e[135]),e[136].set("is_thread",d.i64.eq(e[63],d.i64.cast([0,2]))),e[136].set("raw_identifiers",e[125]),e[136].set("raw_tokens",e[130]),e[136].set("request_id",e[150]),e[136].set("tam_thread_subtype",e[70]==null?d.i64.cast([0,0]):e[70]),e[136].set("is_instamadillo",e[71]==null?!1:e[71]),e[136].set("should_run_device_creation_timestamp_sync",e[65]),e[136].set("value_secret_ref",e[113]),e[136].set("empty_echo_payload_reason",d.i64.cast([0,1])),e[93]!==void 0?d.sequence([function(a){return e[151]=e[93].get("supplemental_data_encrypted"),e[151]!==void 0?d.sequence([function(a){return e[153]=e[93].get("protobuf_encrypted"),e[154]=e[93].get("backup_action"),e[155]=e[93].get("timestamp_ms"),e[156]=e[151].get("sk_ciphertext"),d.nativeOperation(b("LSBase64Encode.nop"),e[156]).then(function(a){return a=a,e[157]=a[0],a})},function(a){return e[158]=e[151].get("sk_hash"),d.nativeOperation(b("LSBase64Encode.nop"),e[158]).then(function(a){return a=a,e[159]=a[0],a})},function(a){return e[160]=e[93].get("message_tags"),e[161]=e[93].get("maybe_ooo_supplemental_upload"),e[162]=new d.Map(),e[162].set("supplementary_data_key",void 0),e[162].set("encrypted_protobuf",e[153]),e[162].set("key_value_backup_action",e[154]),e[162].set("protobuf_ts_ms",e[155]),e[162].set("supplemental_key_ciphertext",e[157]),e[162].set("supplemental_key_hash",e[159]),e[162].set("message_tags",e[160]),e[162].set("maybe_ooo_supplemental_upload",e[161]),e[152]=e[162]}]):d.resolve((e[153]=e[93].get("protobuf_encrypted"),e[154]=e[93].get("backup_action"),e[155]=e[93].get("timestamp_ms"),e[156]=e[93].get("message_tags"),e[157]=new d.Map(),e[157].set("supplementary_data_key",void 0),e[157].set("encrypted_protobuf",e[153]),e[157].set("key_value_backup_action",e[154]),e[157].set("protobuf_ts_ms",e[155]),e[157].set("message_tags",e[156]),e[152]=e[157]))},function(a){return e[136].set("key_value_backup_payload",e[152])}]):d.resolve()},function(a){return e[66]!==void 0?d.resolve(e[136].set("attachment_backup_payload",e[66])):(function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure] attachment_payload is null."),e[151]="payload_null",e[6]!==void 0?e[151]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"attachment_info",e[151]):d.resolve():d.resolve())},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplAnnotateBool.nop"),d.i64.cast([0,637746317]),e[6],"process_attachments_via_message_upload",!0):d.resolve()},function(a){return e[150]!==void 0?d.nativeOperation(b("LSLogWebQpl.nop"),e[150],d.i64.cast([0,521481602]),"upload_start",d.i64.cast([0,0]),void 0,void 0):d.resolve()},function(b){return e[137]=d.toJSON(e[136]),d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[151]=d.i64.of_float(Date.now()),d.i64.eq(e[67],d.i64.cast([0,0]))||d.i64.eq(e[67],void 0)?e[152]=void 0:e[152]=e[67],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[151],d.i64.cast([0,1e6])),e[19]),e[152]],e[138]=b[0],e[139]=b[1],e[140]=b[2],e[141]=b[3],e[142]=b[4],e[143]=b[5],e[144]=b[6]):(f=c.item,e[151]=d.i64.of_float(Date.now()),d.i64.eq(e[67],d.i64.cast([0,0]))||d.i64.eq(e[67],void 0)?e[152]=void 0:e[152]=e[67],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[151],d.i64.cast([0,1e6])),e[19]),e[152]],e[138]=b[0],e[139]=b[1],e[140]=b[2],e[141]=b[3],e[142]=b[4],e[143]=b[5],e[144]=b[6])})},function(a){return e[146]=new d.Map(),e[146].set("task_id",e[138]),e[146].set("queue_name",e[139]),e[146].set("enqueue_timestamp_ms",e[140]),e[146].set("priority",e[141]),e[146].set("first_executed_timestamp_ms",e[142]),e[146].set("execution_time_ns",e[143]),e[146].set("echo_encoding_execution_time_ns",e[144]),e[147]=new d.Map(),e[147].set("task_metadata",e[146]),e[147].set("action_type",e[62]),e[147].set("content_type",e[63]),e[147].set("identifiers",void 0),e[147].set("identifiers_v2",e[55]),e[147].set("task_creation_source",void 0),e[147].set("message_payload_source",d.i64.cast([0,2])),void 0!==void 0?(e[151]=(void 0).get("stored_procedure"),e[152]=(void 0).get("error_code"),e[153]=(void 0).get("error_message"),e[154]=".",e[155]=[e[151],e[154],d.i64.to_string(e[152]),e[154],e[153]].join(""),e[6]!==void 0?e[155]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[155]):d.resolve():d.resolve()):d.resolve()},function(a){return void 0!==void 0?(e[151]=(void 0).get("stored_procedure"),e[152]=(void 0).get("error_code"),e[153]=(void 0).get("error_message"),e[154]=".",e[155]=[e[151],e[154],d.i64.to_string(e[152]),e[154],e[153]].join(""),e[6]!==void 0?e[155]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[155]):d.resolve():d.resolve()):d.resolve()},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,637746317]),e[6],!0):d.resolve()},function(a){return e[148]=new d.Map(),e[148].set("payload",e[137]),e[149]=d.createArray(),e[151]=(e[149].push(void 0),e[149]),a=[e[148],void 0,e[147],e[149]],e[109]=a[0],e[110]=a[1],e[111]=a[2],e[112]=a[3]}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[124]=d.i64.of_float(Date.now()),d.i64.eq(e[67],d.i64.cast([0,0]))||d.i64.eq(e[67],void 0)?e[125]=void 0:e[125]=e[67],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[124],d.i64.cast([0,1e6])),e[19]),e[125]],e[113]=b[0],e[114]=b[1],e[115]=b[2],e[116]=b[3],e[117]=b[4],e[118]=b[5],e[119]=b[6]):(f=c.item,e[124]=d.i64.of_float(Date.now()),d.i64.eq(e[67],d.i64.cast([0,0]))||d.i64.eq(e[67],void 0)?e[125]=void 0:e[125]=e[67],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[124],d.i64.cast([0,1e6])),e[19]),e[125]],e[113]=b[0],e[114]=b[1],e[115]=b[2],e[116]=b[3],e[117]=b[4],e[118]=b[5],e[119]=b[6])})},function(a){return e[121]=new d.Map(),e[121].set("task_id",e[113]),e[121].set("queue_name",e[114]),e[121].set("enqueue_timestamp_ms",e[115]),e[121].set("priority",e[116]),e[121].set("first_executed_timestamp_ms",e[117]),e[121].set("execution_time_ns",e[118]),e[121].set("echo_encoding_execution_time_ns",e[119]),e[122]=new d.Map(),e[122].set("task_metadata",e[121]),e[122].set("action_type",e[62]),e[122].set("content_type",e[63]),e[122].set("identifiers",void 0),e[122].set("identifiers_v2",e[55]),e[122].set("task_creation_source",void 0),e[122].set("message_payload_source",d.i64.cast([0,2])),e[104]!==void 0?(e[124]=e[104].get("stored_procedure"),e[125]=e[104].get("error_code"),e[126]=e[104].get("error_message"),e[127]=".",e[128]=[e[124],e[127],d.i64.to_string(e[125]),e[127],e[126]].join(""),e[6]!==void 0?e[128]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[128]):d.resolve():d.resolve()):d.resolve()},function(a){return void 0!==void 0?(e[124]=(void 0).get("stored_procedure"),e[125]=(void 0).get("error_code"),e[126]=(void 0).get("error_message"),e[127]=".",e[128]=[e[124],e[127],d.i64.to_string(e[125]),e[127],e[126]].join(""),e[6]!==void 0?e[128]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[128]):d.resolve():d.resolve()):d.resolve()},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,637746317]),e[6],!1):d.resolve()},function(a){return e[123]=d.createArray(),e[124]=(e[123].push(void 0),e[123]),a=[void 0,e[104],e[122],e[123]],e[109]=a[0],e[110]=a[1],e[111]=a[2],e[112]=a[3]}])},function(a){return a=[e[109],e[110],e[111],e[112]],e[105]=a[0],e[106]=a[1],e[107]=a[2],e[108]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[120]=d.i64.of_float(Date.now()),d.i64.eq(e[67],d.i64.cast([0,0]))||d.i64.eq(e[67],void 0)?e[121]=void 0:e[121]=e[67],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[120],d.i64.cast([0,1e6])),e[19]),e[121]],e[109]=b[0],e[110]=b[1],e[111]=b[2],e[112]=b[3],e[113]=b[4],e[114]=b[5],e[115]=b[6]):(f=c.item,e[120]=d.i64.of_float(Date.now()),d.i64.eq(e[67],d.i64.cast([0,0]))||d.i64.eq(e[67],void 0)?e[121]=void 0:e[121]=e[67],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[120],d.i64.cast([0,1e6])),e[19]),e[121]],e[109]=b[0],e[110]=b[1],e[111]=b[2],e[112]=b[3],e[113]=b[4],e[114]=b[5],e[115]=b[6])})},function(a){return e[117]=new d.Map(),e[117].set("task_id",e[109]),e[117].set("queue_name",e[110]),e[117].set("enqueue_timestamp_ms",e[111]),e[117].set("priority",e[112]),e[117].set("first_executed_timestamp_ms",e[113]),e[117].set("execution_time_ns",e[114]),e[117].set("echo_encoding_execution_time_ns",e[115]),e[118]=new d.Map(),e[118].set("task_metadata",e[117]),e[118].set("action_type",e[62]),e[118].set("content_type",e[63]),e[118].set("identifiers",void 0),e[118].set("identifiers_v2",e[55]),e[118].set("task_creation_source",void 0),e[118].set("message_payload_source",d.i64.cast([0,2])),void 0!==void 0?(e[120]=(void 0).get("stored_procedure"),e[121]=(void 0).get("error_code"),e[122]=(void 0).get("error_message"),e[123]=".",e[124]=[e[120],e[123],d.i64.to_string(e[121]),e[123],e[122]].join(""),e[6]!==void 0?e[124]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[124]):d.resolve():d.resolve()):d.resolve()},function(a){return e[94]!==void 0?(e[120]=e[94].get("stored_procedure"),e[121]=e[94].get("error_code"),e[122]=e[94].get("error_message"),e[123]=".",e[124]=[e[120],e[123],d.i64.to_string(e[121]),e[123],e[122]].join(""),e[6]!==void 0?e[124]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[124]):d.resolve():d.resolve()):d.resolve()},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,637746317]),e[6],!1):d.resolve()},function(a){return e[119]=d.createArray(),e[120]=(e[119].push(e[94]),e[119]),a=[void 0,void 0,e[118],e[119]],e[105]=a[0],e[106]=a[1],e[107]=a[2],e[108]=a[3]}])},function(a){return a=[e[105],e[106],e[107],e[108]],e[95]=a[0],e[96]=a[1],e[97]=a[2],e[98]=a[3],a}]):d.sequence([function(c){return e[99]===!0&&e[100]===!1?d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[116]=d.i64.of_float(Date.now()),d.i64.eq(e[67],d.i64.cast([0,0]))||d.i64.eq(e[67],void 0)?e[117]=void 0:e[117]=e[67],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[116],d.i64.cast([0,1e6])),e[19]),e[117]],e[105]=b[0],e[106]=b[1],e[107]=b[2],e[108]=b[3],e[109]=b[4],e[110]=b[5],e[111]=b[6]):(f=c.item,e[116]=d.i64.of_float(Date.now()),d.i64.eq(e[67],d.i64.cast([0,0]))||d.i64.eq(e[67],void 0)?e[117]=void 0:e[117]=e[67],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[116],d.i64.cast([0,1e6])),e[19]),e[117]],e[105]=b[0],e[106]=b[1],e[107]=b[2],e[108]=b[3],e[109]=b[4],e[110]=b[5],e[111]=b[6])})},function(a){return e[113]=new d.Map(),e[113].set("task_id",e[105]),e[113].set("queue_name",e[106]),e[113].set("enqueue_timestamp_ms",e[107]),e[113].set("priority",e[108]),e[113].set("first_executed_timestamp_ms",e[109]),e[113].set("execution_time_ns",e[110]),e[113].set("echo_encoding_execution_time_ns",e[111]),e[114]=new d.Map(),e[114].set("task_metadata",e[113]),e[114].set("action_type",e[62]),e[114].set("content_type",e[63]),e[114].set("identifiers",void 0),e[114].set("identifiers_v2",e[55]),e[114].set("task_creation_source",void 0),e[114].set("message_payload_source",d.i64.cast([0,2])),void 0!==void 0?(e[116]=(void 0).get("stored_procedure"),e[117]=(void 0).get("error_code"),e[118]=(void 0).get("error_message"),e[119]=".",e[120]=[e[116],e[119],d.i64.to_string(e[117]),e[119],e[118]].join(""),e[6]!==void 0?e[120]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[120]):d.resolve():d.resolve()):d.resolve()},function(a){return e[94]!==void 0?(e[116]=e[94].get("stored_procedure"),e[117]=e[94].get("error_code"),e[118]=e[94].get("error_message"),e[119]=".",e[120]=[e[116],e[119],d.i64.to_string(e[117]),e[119],e[118]].join(""),e[6]!==void 0?e[120]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[120]):d.resolve():d.resolve()):d.resolve()},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,637746317]),e[6],!1):d.resolve()},function(a){return e[115]=d.createArray(),e[116]=(e[115].push(e[94]),e[115]),a=[void 0,void 0,e[114],e[115]],e[101]=a[0],e[102]=a[1],e[103]=a[2],e[104]=a[3]}]):d.sequence([function(c){return d.i64.eq(e[62],d.i64.cast([0,1]))?(e[113]=e[68]===""?void 0:e[68],e[113]!==void 0?(c=[e[113],void 0],e[111]=c[0],e[112]=c[1],c):(e[114]=new d.Map(),e[114].set("error_code",d.i64.cast([0,30])),e[114].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),e[114].set("error_message",""),c=[void 0,e[114]],e[111]=c[0],e[112]=c[1]),c=[e[111],e[112]],e[105]=c[0],e[106]=c[1]):(c=["",void 0],e[105]=c[0],e[106]=c[1],c),e[105]!==void 0?d.sequence([function(a){return d.i64.eq(e[62],d.i64.cast([0,1]))?d.sequence([function(a){return e[117]=e[55].get("backup_id"),e[118]=e[55].get("act_thread_id"),d.storedProcedure(b("LSEncryptMessagePayloadV2"),e[117],e[118],e[76],e[105]).then(function(a){return a=a,e[119]=a[0],e[120]=a[1],a})},function(a){return a=[e[119],e[120]],e[111]=a[0],e[112]=a[1],a}]):d.resolve((e[117]=new d.Map(),e[117].set("encrypted_message_payload",""),e[117].set("value_secret_ref",""),a=[e[117],void 0],e[111]=a[0],e[112]=a[1]))},function(c){return e[111]!==void 0?d.sequence([function(a){return e[93]!==void 0&&d.i64.eq(e[62],d.i64.cast([0,2]))?d.sequence([function(a){return e[155]=e[55].get("act_thread_id"),e[156]=e[55].get("backup_id"),d.storedProcedure(b("LSDeriveValueSecretRefV2"),e[155],e[156],e[76]).then(function(a){return a=a,e[157]=a[0],e[158]=a[1],a})},function(a){return e[157]!==void 0?(e[160]=e[157].get("value_secret_ref"),e[159]=e[160]):e[159]="",e[117]=e[159]}]):d.resolve(e[117]="")},function(a){return e[118]=e[86].get("act_thread_id_ocmf_partial"),e[119]=e[86].get("otid_ocmf_partial"),e[120]=e[86].get("timestamp_encrypted"),e[121]=new d.Map(),e[121].set("list_key",e[118]),e[121].set("unique_key",e[119]),e[121].set("sort_key",e[120]),e[111]!==void 0?(e[155]=e[111].get("encrypted_message_payload"),e[156]=e[111].get("value_secret_ref"),e[157]=new d.Map(),e[157].set("value",e[155]),e[157].set("value_secret_ref",e[156]),e[122]=e[157]):e[122]=void 0,e[123]=new d.Map(),e[123].set("list_item_id",e[121]),e[123].set("list_item",e[122]),e[123].set("action_type",e[62]),e[124]=e[55].get("timestamp"),e[125]=e[55].get("otid"),e[126]=e[55].get("act_thread_id"),e[127]=e[55].get("supplemental_otid"),e[128]=e[55].get("deletion_otid"),e[129]=new d.Map(),e[129].set("timestamp",e[124]),e[129].set("otid",e[125]),e[129].set("wa_thread_id",d.i64.from_string(e[126])),e[129].set("supplemental_otid",e[127]),e[129].set("deletion_otid",e[128]),e[130]=e[76].get("mailbox_base_salt"),d.nativeOperation(b("LSBase64Encode.nop"),e[130]).then(function(a){return a=a,e[131]=a[0],a})},function(a){return e[132]=e[76].get("ocmf_shared_key"),d.nativeOperation(b("LSBase64Encode.nop"),e[132]).then(function(a){return a=a,e[133]=a[0],a})},function(a){return e[134]=new d.Map(),e[134].set("mailbox_root_key",e[131]==null?"":e[131]),e[134].set("ocmf_client_state_blob",e[133]==null?"":e[133]),e[135]=e[86].get("backup_id_ocmf_partial"),e[136]=e[76].get("message_payload_encryption_keys"),e[137]=e[136].get("epoch_id"),e[138]=e[76].get("message_payload_encryption_keys"),e[139]=e[138].get("encryption_version"),e[154]=e[69]==null?"":e[69],e[140]=new d.Map(),e[140].set("mailbox_partial_id",e[135]),e[140].set("action",e[123]),e[140].set("device_id",e[35]),e[140].set("echo_version",d.i64.cast([0,0])),e[140].set("epoch_id",e[137]),e[140].set("trace_id",void 0),e[140].set("encryption_version",e[139]),e[140].set("is_thread",d.i64.eq(e[63],d.i64.cast([0,2]))),e[140].set("raw_identifiers",e[129]),e[140].set("raw_tokens",e[134]),e[140].set("request_id",e[154]),e[140].set("tam_thread_subtype",e[70]==null?d.i64.cast([0,0]):e[70]),e[140].set("is_instamadillo",e[71]==null?!1:e[71]),e[140].set("should_run_device_creation_timestamp_sync",e[65]),e[140].set("value_secret_ref",e[117]),e[93]!==void 0?d.sequence([function(a){return e[155]=e[93].get("supplemental_data_encrypted"),e[155]!==void 0?d.sequence([function(a){return e[157]=e[93].get("protobuf_encrypted"),e[158]=e[93].get("backup_action"),e[159]=e[93].get("timestamp_ms"),e[160]=e[155].get("sk_ciphertext"),d.nativeOperation(b("LSBase64Encode.nop"),e[160]).then(function(a){return a=a,e[161]=a[0],a})},function(a){return e[162]=e[155].get("sk_hash"),d.nativeOperation(b("LSBase64Encode.nop"),e[162]).then(function(a){return a=a,e[163]=a[0],a})},function(a){return e[164]=e[93].get("message_tags"),e[165]=e[93].get("maybe_ooo_supplemental_upload"),e[166]=new d.Map(),e[166].set("supplementary_data_key",void 0),e[166].set("encrypted_protobuf",e[157]),e[166].set("key_value_backup_action",e[158]),e[166].set("protobuf_ts_ms",e[159]),e[166].set("supplemental_key_ciphertext",e[161]),e[166].set("supplemental_key_hash",e[163]),e[166].set("message_tags",e[164]),e[166].set("maybe_ooo_supplemental_upload",e[165]),e[156]=e[166]}]):d.resolve((e[157]=e[93].get("protobuf_encrypted"),e[158]=e[93].get("backup_action"),e[159]=e[93].get("timestamp_ms"),e[160]=e[93].get("message_tags"),e[161]=new d.Map(),e[161].set("supplementary_data_key",void 0),e[161].set("encrypted_protobuf",e[157]),e[161].set("key_value_backup_action",e[158]),e[161].set("protobuf_ts_ms",e[159]),e[161].set("message_tags",e[160]),e[156]=e[161]))},function(a){return e[140].set("key_value_backup_payload",e[156])}]):d.resolve()},function(a){return e[66]!==void 0?d.resolve(e[140].set("attachment_backup_payload",e[66])):(function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure] attachment_payload is null."),e[155]="payload_null",e[6]!==void 0?e[155]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"attachment_info",e[155]):d.resolve():d.resolve())},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplAnnotateBool.nop"),d.i64.cast([0,637746317]),e[6],"process_attachments_via_message_upload",!0):d.resolve()},function(a){return e[154]!==void 0?d.nativeOperation(b("LSLogWebQpl.nop"),e[154],d.i64.cast([0,521481602]),"upload_start",d.i64.cast([0,0]),void 0,void 0):d.resolve()},function(b){return e[141]=d.toJSON(e[140]),d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[155]=d.i64.of_float(Date.now()),d.i64.eq(e[67],d.i64.cast([0,0]))||d.i64.eq(e[67],void 0)?e[156]=void 0:e[156]=e[67],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[155],d.i64.cast([0,1e6])),e[19]),e[156]],e[142]=b[0],e[143]=b[1],e[144]=b[2],e[145]=b[3],e[146]=b[4],e[147]=b[5],e[148]=b[6]):(f=c.item,e[155]=d.i64.of_float(Date.now()),d.i64.eq(e[67],d.i64.cast([0,0]))||d.i64.eq(e[67],void 0)?e[156]=void 0:e[156]=e[67],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[155],d.i64.cast([0,1e6])),e[19]),e[156]],e[142]=b[0],e[143]=b[1],e[144]=b[2],e[145]=b[3],e[146]=b[4],e[147]=b[5],e[148]=b[6])})},function(a){return e[150]=new d.Map(),e[150].set("task_id",e[142]),e[150].set("queue_name",e[143]),e[150].set("enqueue_timestamp_ms",e[144]),e[150].set("priority",e[145]),e[150].set("first_executed_timestamp_ms",e[146]),e[150].set("execution_time_ns",e[147]),e[150].set("echo_encoding_execution_time_ns",e[148]),e[151]=new d.Map(),e[151].set("task_metadata",e[150]),e[151].set("action_type",e[62]),e[151].set("content_type",e[63]),e[151].set("identifiers",void 0),e[151].set("identifiers_v2",e[55]),e[151].set("task_creation_source",void 0),e[151].set("message_payload_source",d.i64.cast([0,2])),void 0!==void 0?(e[155]=(void 0).get("stored_procedure"),e[156]=(void 0).get("error_code"),e[157]=(void 0).get("error_message"),e[158]=".",e[159]=[e[155],e[158],d.i64.to_string(e[156]),e[158],e[157]].join(""),e[6]!==void 0?e[159]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[159]):d.resolve():d.resolve()):d.resolve()},function(a){return e[94]!==void 0?(e[155]=e[94].get("stored_procedure"),e[156]=e[94].get("error_code"),e[157]=e[94].get("error_message"),e[158]=".",e[159]=[e[155],e[158],d.i64.to_string(e[156]),e[158],e[157]].join(""),e[6]!==void 0?e[159]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[159]):d.resolve():d.resolve()):d.resolve()},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,637746317]),e[6],!0):d.resolve()},function(a){return e[152]=new d.Map(),e[152].set("payload",e[141]),e[153]=d.createArray(),e[155]=(e[153].push(e[94]),e[153]),a=[e[152],void 0,e[151],e[153]],e[113]=a[0],e[114]=a[1],e[115]=a[2],e[116]=a[3]}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[128]=d.i64.of_float(Date.now()),d.i64.eq(e[67],d.i64.cast([0,0]))||d.i64.eq(e[67],void 0)?e[129]=void 0:e[129]=e[67],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[128],d.i64.cast([0,1e6])),e[19]),e[129]],e[117]=b[0],e[118]=b[1],e[119]=b[2],e[120]=b[3],e[121]=b[4],e[122]=b[5],e[123]=b[6]):(f=c.item,e[128]=d.i64.of_float(Date.now()),d.i64.eq(e[67],d.i64.cast([0,0]))||d.i64.eq(e[67],void 0)?e[129]=void 0:e[129]=e[67],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[128],d.i64.cast([0,1e6])),e[19]),e[129]],e[117]=b[0],e[118]=b[1],e[119]=b[2],e[120]=b[3],e[121]=b[4],e[122]=b[5],e[123]=b[6])})},function(a){return e[125]=new d.Map(),e[125].set("task_id",e[117]),e[125].set("queue_name",e[118]),e[125].set("enqueue_timestamp_ms",e[119]),e[125].set("priority",e[120]),e[125].set("first_executed_timestamp_ms",e[121]),e[125].set("execution_time_ns",e[122]),e[125].set("echo_encoding_execution_time_ns",e[123]),e[126]=new d.Map(),e[126].set("task_metadata",e[125]),e[126].set("action_type",e[62]),e[126].set("content_type",e[63]),e[126].set("identifiers",void 0),e[126].set("identifiers_v2",e[55]),e[126].set("task_creation_source",void 0),e[126].set("message_payload_source",d.i64.cast([0,2])),e[112]!==void 0?(e[128]=e[112].get("stored_procedure"),e[129]=e[112].get("error_code"),e[130]=e[112].get("error_message"),e[131]=".",e[132]=[e[128],e[131],d.i64.to_string(e[129]),e[131],e[130]].join(""),e[6]!==void 0?e[132]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[132]):d.resolve():d.resolve()):d.resolve()},function(a){return e[94]!==void 0?(e[128]=e[94].get("stored_procedure"),e[129]=e[94].get("error_code"),e[130]=e[94].get("error_message"),e[131]=".",e[132]=[e[128],e[131],d.i64.to_string(e[129]),e[131],e[130]].join(""),e[6]!==void 0?e[132]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[132]):d.resolve():d.resolve()):d.resolve()},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,637746317]),e[6],!1):d.resolve()},function(a){return e[127]=d.createArray(),e[128]=(e[127].push(e[94]),e[127]),a=[void 0,e[112],e[126],e[127]],e[113]=a[0],e[114]=a[1],e[115]=a[2],e[116]=a[3]}])},function(a){return a=[e[113],e[114],e[115],e[116]],e[107]=a[0],e[108]=a[1],e[109]=a[2],e[110]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[122]=d.i64.of_float(Date.now()),d.i64.eq(e[67],d.i64.cast([0,0]))||d.i64.eq(e[67],void 0)?e[123]=void 0:e[123]=e[67],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[122],d.i64.cast([0,1e6])),e[19]),e[123]],e[111]=b[0],e[112]=b[1],e[113]=b[2],e[114]=b[3],e[115]=b[4],e[116]=b[5],e[117]=b[6]):(f=c.item,e[122]=d.i64.of_float(Date.now()),d.i64.eq(e[67],d.i64.cast([0,0]))||d.i64.eq(e[67],void 0)?e[123]=void 0:e[123]=e[67],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[122],d.i64.cast([0,1e6])),e[19]),e[123]],e[111]=b[0],e[112]=b[1],e[113]=b[2],e[114]=b[3],e[115]=b[4],e[116]=b[5],e[117]=b[6])})},function(a){return e[119]=new d.Map(),e[119].set("task_id",e[111]),e[119].set("queue_name",e[112]),e[119].set("enqueue_timestamp_ms",e[113]),e[119].set("priority",e[114]),e[119].set("first_executed_timestamp_ms",e[115]),e[119].set("execution_time_ns",e[116]),e[119].set("echo_encoding_execution_time_ns",e[117]),e[120]=new d.Map(),e[120].set("task_metadata",e[119]),e[120].set("action_type",e[62]),e[120].set("content_type",e[63]),e[120].set("identifiers",void 0),e[120].set("identifiers_v2",e[55]),e[120].set("task_creation_source",void 0),e[120].set("message_payload_source",d.i64.cast([0,2])),e[106]!==void 0?(e[122]=e[106].get("stored_procedure"),e[123]=e[106].get("error_code"),e[124]=e[106].get("error_message"),e[125]=".",e[126]=[e[122],e[125],d.i64.to_string(e[123]),e[125],e[124]].join(""),e[6]!==void 0?e[126]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[126]):d.resolve():d.resolve()):d.resolve()},function(a){return e[94]!==void 0?(e[122]=e[94].get("stored_procedure"),e[123]=e[94].get("error_code"),e[124]=e[94].get("error_message"),e[125]=".",e[126]=[e[122],e[125],d.i64.to_string(e[123]),e[125],e[124]].join(""),e[6]!==void 0?e[126]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[126]):d.resolve():d.resolve()):d.resolve()},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,637746317]),e[6],!1):d.resolve()},function(a){return e[121]=d.createArray(),e[122]=(e[121].push(e[94]),e[121]),a=[void 0,e[106],e[120],e[121]],e[107]=a[0],e[108]=a[1],e[109]=a[2],e[110]=a[3]}])},function(a){return a=[e[107],e[108],e[109],e[110]],e[101]=a[0],e[102]=a[1],e[103]=a[2],e[104]=a[3],a}])},function(a){return a=[e[101],e[102],e[103],e[104]],e[95]=a[0],e[96]=a[1],e[97]=a[2],e[98]=a[3],a}])},function(a){return a=[e[95],e[96],e[97],e[98]],e[88]=a[0],e[89]=a[1],e[90]=a[2],e[91]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[103]=d.i64.of_float(Date.now()),d.i64.eq(e[67],d.i64.cast([0,0]))||d.i64.eq(e[67],void 0)?e[104]=void 0:e[104]=e[67],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[103],d.i64.cast([0,1e6])),e[19]),e[104]],e[92]=b[0],e[93]=b[1],e[94]=b[2],e[95]=b[3],e[96]=b[4],e[97]=b[5],e[98]=b[6]):(f=c.item,e[103]=d.i64.of_float(Date.now()),d.i64.eq(e[67],d.i64.cast([0,0]))||d.i64.eq(e[67],void 0)?e[104]=void 0:e[104]=e[67],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[103],d.i64.cast([0,1e6])),e[19]),e[104]],e[92]=b[0],e[93]=b[1],e[94]=b[2],e[95]=b[3],e[96]=b[4],e[97]=b[5],e[98]=b[6])})},function(a){return e[100]=new d.Map(),e[100].set("task_id",e[92]),e[100].set("queue_name",e[93]),e[100].set("enqueue_timestamp_ms",e[94]),e[100].set("priority",e[95]),e[100].set("first_executed_timestamp_ms",e[96]),e[100].set("execution_time_ns",e[97]),e[100].set("echo_encoding_execution_time_ns",e[98]),e[101]=new d.Map(),e[101].set("task_metadata",e[100]),e[101].set("action_type",e[62]),e[101].set("content_type",e[63]),e[101].set("identifiers",void 0),e[101].set("identifiers_v2",e[55]),e[101].set("task_creation_source",void 0),e[101].set("message_payload_source",d.i64.cast([0,2])),e[87]!==void 0?(e[103]=e[87].get("stored_procedure"),e[104]=e[87].get("error_code"),e[105]=e[87].get("error_message"),e[106]=".",e[107]=[e[103],e[106],d.i64.to_string(e[104]),e[106],e[105]].join(""),e[6]!==void 0?e[107]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[107]):d.resolve():d.resolve()):d.resolve()},function(a){return void 0!==void 0?(e[103]=(void 0).get("stored_procedure"),e[104]=(void 0).get("error_code"),e[105]=(void 0).get("error_message"),e[106]=".",e[107]=[e[103],e[106],d.i64.to_string(e[104]),e[106],e[105]].join(""),e[6]!==void 0?e[107]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[107]):d.resolve():d.resolve()):d.resolve()},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,637746317]),e[6],!1):d.resolve()},function(a){return e[102]=d.createArray(),e[103]=(e[102].push(void 0),e[102]),a=[void 0,e[87],e[101],e[102]],e[88]=a[0],e[89]=a[1],e[90]=a[2],e[91]=a[3]}])},function(a){return a=[e[88],e[89],e[90],e[91]],e[78]=a[0],e[79]=a[1],e[80]=a[2],e[81]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[93]=d.i64.of_float(Date.now()),d.i64.eq(e[67],d.i64.cast([0,0]))||d.i64.eq(e[67],void 0)?e[94]=void 0:e[94]=e[67],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[93],d.i64.cast([0,1e6])),e[19]),e[94]],e[82]=b[0],e[83]=b[1],e[84]=b[2],e[85]=b[3],e[86]=b[4],e[87]=b[5],e[88]=b[6]):(f=c.item,e[93]=d.i64.of_float(Date.now()),d.i64.eq(e[67],d.i64.cast([0,0]))||d.i64.eq(e[67],void 0)?e[94]=void 0:e[94]=e[67],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[93],d.i64.cast([0,1e6])),e[19]),e[94]],e[82]=b[0],e[83]=b[1],e[84]=b[2],e[85]=b[3],e[86]=b[4],e[87]=b[5],e[88]=b[6])})},function(a){return e[90]=new d.Map(),e[90].set("task_id",e[82]),e[90].set("queue_name",e[83]),e[90].set("enqueue_timestamp_ms",e[84]),e[90].set("priority",e[85]),e[90].set("first_executed_timestamp_ms",e[86]),e[90].set("execution_time_ns",e[87]),e[90].set("echo_encoding_execution_time_ns",e[88]),e[91]=new d.Map(),e[91].set("task_metadata",e[90]),e[91].set("action_type",e[62]),e[91].set("content_type",e[63]),e[91].set("identifiers",void 0),e[91].set("identifiers_v2",e[55]),e[91].set("task_creation_source",void 0),e[91].set("message_payload_source",d.i64.cast([0,2])),e[77]!==void 0?(e[93]=e[77].get("stored_procedure"),e[94]=e[77].get("error_code"),e[95]=e[77].get("error_message"),e[96]=".",e[97]=[e[93],e[96],d.i64.to_string(e[94]),e[96],e[95]].join(""),e[6]!==void 0?e[97]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[97]):d.resolve():d.resolve()):d.resolve()},function(a){return void 0!==void 0?(e[93]=(void 0).get("stored_procedure"),e[94]=(void 0).get("error_code"),e[95]=(void 0).get("error_message"),e[96]=".",e[97]=[e[93],e[96],d.i64.to_string(e[94]),e[96],e[95]].join(""),e[6]!==void 0?e[97]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[97]):d.resolve():d.resolve()):d.resolve()},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,637746317]),e[6],!1):d.resolve()},function(a){return e[92]=d.createArray(),e[93]=(e[92].push(void 0),e[92]),a=[void 0,e[77],e[91],e[92]],e[78]=a[0],e[79]=a[1],e[80]=a[2],e[81]=a[3]}])},function(a){return a=[e[78],e[79],e[80],e[81]],e[58]=a[0],e[59]=a[1],e[60]=a[2],e[61]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[84]=d.i64.of_float(Date.now()),d.i64.eq(e[67],d.i64.cast([0,0]))||d.i64.eq(e[67],void 0)?e[85]=void 0:e[85]=e[67],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[84],d.i64.cast([0,1e6])),e[19]),e[85]],e[72]=b[0],e[73]=b[1],e[74]=b[2],e[75]=b[3],e[76]=b[4],e[77]=b[5],e[78]=b[6]):(f=c.item,e[84]=d.i64.of_float(Date.now()),d.i64.eq(e[67],d.i64.cast([0,0]))||d.i64.eq(e[67],void 0)?e[85]=void 0:e[85]=e[67],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[84],d.i64.cast([0,1e6])),e[19]),e[85]],e[72]=b[0],e[73]=b[1],e[74]=b[2],e[75]=b[3],e[76]=b[4],e[77]=b[5],e[78]=b[6])})},function(a){return e[80]=new d.Map(),e[80].set("task_id",e[72]),e[80].set("queue_name",e[73]),e[80].set("enqueue_timestamp_ms",e[74]),e[80].set("priority",e[75]),e[80].set("first_executed_timestamp_ms",e[76]),e[80].set("execution_time_ns",e[77]),e[80].set("echo_encoding_execution_time_ns",e[78]),e[81]=new d.Map(),e[81].set("task_metadata",e[80]),e[81].set("action_type",e[62]),e[81].set("content_type",e[63]),e[81].set("identifiers",void 0),e[81].set("identifiers_v2",e[55]),e[81].set("task_creation_source",void 0),e[81].set("message_payload_source",d.i64.cast([0,2])),e[82]=new d.Map(),e[82].set("error_code",e[64]),e[82].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),e[82].set("error_message",""),e[82]!==void 0?(e[84]=e[82].get("stored_procedure"),e[85]=e[82].get("error_code"),e[86]=e[82].get("error_message"),e[87]=".",e[88]=[e[84],e[87],d.i64.to_string(e[85]),e[87],e[86]].join(""),e[6]!==void 0?e[88]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[88]):d.resolve():d.resolve()):d.resolve()},function(a){return void 0!==void 0?(e[84]=(void 0).get("stored_procedure"),e[85]=(void 0).get("error_code"),e[86]=(void 0).get("error_message"),e[87]=".",e[88]=[e[84],e[87],d.i64.to_string(e[85]),e[87],e[86]].join(""),e[6]!==void 0?e[88]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[88]):d.resolve():d.resolve()):d.resolve()},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,637746317]),e[6],!1):d.resolve()},function(a){return e[83]=d.createArray(),a=[void 0,e[82],e[81],e[83]],e[58]=a[0],e[59]=a[1],e[60]=a[2],e[61]=a[3]}])},function(a){return a=[e[58],e[59],e[60],e[61]],e[50]=a[0],e[51]=a[1],e[52]=a[2],e[53]=a[3],a}]))})},function(a){return a=[e[50],e[51],e[52],e[53]],e[42]=a[0],e[43]=a[1],e[44]=a[2],e[45]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(b,c){var f=b.done;b=b.value;return f?(e[58]=d.i64.of_float(Date.now()),f=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[58],d.i64.cast([0,1e6])),e[19]),void 0],e[46]=f[0],e[47]=f[1],e[48]=f[2],e[49]=f[3],e[50]=f[4],e[51]=f[5],e[52]=f[6]):(c=b.item,e[58]=d.i64.of_float(Date.now()),f=[a[0],c.queueName,c.enqueueTimestampMs,void 0,c.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[58],d.i64.cast([0,1e6])),e[19]),void 0],e[46]=f[0],e[47]=f[1],e[48]=f[2],e[49]=f[3],e[50]=f[4],e[51]=f[5],e[52]=f[6])})},function(a){return e[54]=new d.Map(),e[54].set("task_id",e[46]),e[54].set("queue_name",e[47]),e[54].set("enqueue_timestamp_ms",e[48]),e[54].set("priority",e[49]),e[54].set("first_executed_timestamp_ms",e[50]),e[54].set("execution_time_ns",e[51]),e[54].set("echo_encoding_execution_time_ns",e[52]),e[55]=new d.Map(),e[55].set("task_metadata",e[54]),e[55].set("action_type",void 0),e[55].set("content_type",void 0),e[55].set("identifiers",void 0),e[55].set("identifiers_v2",void 0),e[55].set("task_creation_source",void 0),e[55].set("message_payload_source",d.i64.cast([0,2])),e[56]=new d.Map(),e[56].set("error_code",d.i64.cast([0,24])),e[56].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),e[56].set("error_message",""),e[56]!==void 0?(e[58]=e[56].get("stored_procedure"),e[59]=e[56].get("error_code"),e[60]=e[56].get("error_message"),e[61]=".",e[62]=[e[58],e[61],d.i64.to_string(e[59]),e[61],e[60]].join(""),e[6]!==void 0?e[62]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[62]):d.resolve():d.resolve()):d.resolve()},function(a){return void 0!==void 0?(e[58]=(void 0).get("stored_procedure"),e[59]=(void 0).get("error_code"),e[60]=(void 0).get("error_message"),e[61]=".",e[62]=[e[58],e[61],d.i64.to_string(e[59]),e[61],e[60]].join(""),e[6]!==void 0?e[62]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[62]):d.resolve():d.resolve()):d.resolve()},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,637746317]),e[6],!1):d.resolve()},function(a){return e[57]=d.createArray(),a=[void 0,e[56],e[55],e[57]],e[42]=a[0],e[43]=a[1],e[44]=a[2],e[45]=a[3]}])},function(a){return a=[e[42],e[43],e[44],e[45]],e[12]=a[0],e[13]=a[1],e[14]=a[2],e[15]=a[3],a}]):d.sequence([function(b){return e[23]=e[10].get("errors"),e[24]=e[10].get("errors"),d.db.table(2).fetch([[[a[0]]]]).next().then(function(b,c){var f=b.done;b=b.value;return f?(e[37]=d.i64.of_float(Date.now()),f=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[37],d.i64.cast([0,1e6])),e[19]),void 0],e[25]=f[0],e[26]=f[1],e[27]=f[2],e[28]=f[3],e[29]=f[4],e[30]=f[5],e[31]=f[6]):(c=b.item,e[37]=d.i64.of_float(Date.now()),f=[a[0],c.queueName,c.enqueueTimestampMs,void 0,c.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[37],d.i64.cast([0,1e6])),e[19]),void 0],e[25]=f[0],e[26]=f[1],e[27]=f[2],e[28]=f[3],e[29]=f[4],e[30]=f[5],e[31]=f[6])})},function(a){return e[33]=new d.Map(),e[33].set("task_id",e[25]),e[33].set("queue_name",e[26]),e[33].set("enqueue_timestamp_ms",e[27]),e[33].set("priority",e[28]),e[33].set("first_executed_timestamp_ms",e[29]),e[33].set("execution_time_ns",e[30]),e[33].set("echo_encoding_execution_time_ns",e[31]),e[34]=new d.Map(),e[34].set("task_metadata",e[33]),e[34].set("action_type",void 0),e[34].set("content_type",void 0),e[34].set("identifiers",void 0),e[34].set("identifiers_v2",void 0),e[34].set("task_creation_source",void 0),e[34].set("message_payload_source",d.i64.cast([0,2])),e[35]=new d.Map(),e[35].set("error_code",d.i64.cast([0,1])),e[35].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),e[35].set("error_message",""),e[35]!==void 0?(e[37]=e[35].get("stored_procedure"),e[38]=e[35].get("error_code"),e[39]=e[35].get("error_message"),e[40]=".",e[41]=[e[37],e[40],d.i64.to_string(e[38]),e[40],e[39]].join(""),e[6]!==void 0?e[41]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[41]):d.resolve():d.resolve()):d.resolve()},function(a){return void 0!==void 0?(e[37]=(void 0).get("stored_procedure"),e[38]=(void 0).get("error_code"),e[39]=(void 0).get("error_message"),e[40]=".",e[41]=[e[37],e[40],d.i64.to_string(e[38]),e[40],e[39]].join(""),e[6]!==void 0?e[41]!==void 0?d.nativeOperation(b("LSQplAnnotateString.nop"),d.i64.cast([0,637746317]),e[6],"exception_error",e[41]):d.resolve():d.resolve()):d.resolve()},function(a){return e[6]!==void 0?d.nativeOperation(b("LSQplMarkEnd.nop"),d.i64.cast([0,637746317]),e[6],!1):d.resolve()},function(a){return e[36]=d.createArray(),a=[void 0,e[35],e[34],e[36]],e[12]=a[0],e[13]=a[1],e[14]=a[2],e[15]=a[3]}])},function(a){return e[16]=d.i64.of_float(Date.now()),e[17]=d.i64.random(),e[20]="Finishing execution. Execution time: ",e[21]=d.i64.to_string(d.i64.sub(e[16],e[0])),e[22]=" ms",e[18]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][serializeBackupPayloadV2] ",e[18],e[20],e[18],e[21],e[18],e[22]].join("")),d.i64.eq(d.i64.mod_(e[17],d.i64.cast([0,1e3])),d.i64.cast([0,0]))?(e[23]=",",e[24]=d.createArray(),void 0!==void 0?e[25]=(e[24].push(void 0),e[24]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"serializeBackupPayloadV2",[e[20],e[23],e[21],e[23],e[22]].join(""),e[24],d.i64.cast([0,4]))):d.resolve()},function(a){return a=[e[12],e[13],e[14],e[15]],f[0]=a[0],f[1]=a[1],f[2]=a[2],f[3]=a[3],a}])},function(a){return d.resolve(f)}])}a.__sproc_name__="LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure";a.__tables__=["pending_tasks","secure_encrypted_backups_client_state","pending_backups_context_v2","pending_protobuf_backups_context","secure_encrypted_backups_epochs"];d=a;g["default"]=d}),98);
__d("LSTaskSerializerEncryptedBackupsUpload",["LSArrayGetObjectAt","LSLogMebClientEvent.nop","LSSerializeBackupPayloadV2"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][taskSerializerEncryptedBackupsUpload] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.forEach(c.db.table(177).fetch([[[a[0]]],"fk_pending_tasks"]),function(a){var b=a.update;a.item;return b({backupStatus:c.i64.cast([0,2])})})},function(e){return c.storedProcedure(b("LSSerializeBackupPayloadV2"),a[0]).then(function(a){return a=a,d[2]=a[0],d[3]=a[1],d[4]=a[2],d[5]=a[3],a})},function(a){return d[6]=c.createArray(),d[7]=c.i64.of_int32(d[5].length),c.i64.gt(d[7],c.i64.cast([0,0]))?c.loopAsync(d[7],function(a){return d[23]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[5],d[23]).then(function(a){return a=a,d[24]=a[0],d[25]=a[1],a})},function(a){return d[24]!==void 0?d[26]=(d[6].push(d[24]),d[6]):0}])}):c.resolve()},function(a){return d[8]=c.i64.of_int32(d[6].length),c.i64.gt(d[8],c.i64.cast([0,0]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[6],c.i64.cast([0,0])).then(function(a){return a=a,d[23]=a[0],d[24]=a[1],a})},function(a){return d[9]=d[23]}]):c.resolve(d[9]=void 0)},function(a){return d[2]?d[10]=!1:d[10]=!0,d[10]?(d[3]?d[23]=!1:d[23]=!0,d[23]?(a=[void 0,void 0,d[9],d[6],d[4]],d[24]=a[0],d[25]=a[1],d[26]=a[2],d[27]=a[3],d[28]=a[4],a):(a=[void 0,d[3],d[9],d[6],d[4]],d[24]=a[0],d[25]=a[1],d[26]=a[2],d[27]=a[3],d[28]=a[4],a),a=[d[24],d[25],d[26],d[27],d[28]],d[11]=a[0],d[12]=a[1],d[13]=a[2],d[14]=a[3],d[15]=a[4]):(d[23]=d[2].get("payload"),a=[d[23],d[3],d[9],d[6],d[4]],d[11]=a[0],d[12]=a[1],d[13]=a[2],d[14]=a[3],d[15]=a[4]),d[23]=new c.Map(),d[24]=d[23].set("success",d[11]),d[25]=d[23].set("failure",d[12]),d[26]=d[23].set("protobuf_failure",d[13]),d[27]=d[23].set("protobuf_failures",d[14]),d[28]=d[23].set("context",d[15]),d[29]=c.toJSON(d[23]),d[16]=d[29],d[17]=c.i64.of_float(Date.now()),d[18]=c.i64.random(),d[20]="Finishing execution. Execution time: ",d[21]=c.i64.to_string(c.i64.sub(d[17],d[0])),d[22]=" ms",d[19]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][taskSerializerEncryptedBackupsUpload] ",d[19],d[20],d[19],d[21],d[19],d[22]].join("")),c.i64.eq(c.i64.mod_(d[18],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[23]=",",d[24]=c.createArray(),void 0!==void 0?d[25]=(d[24].push(void 0),d[24]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"taskSerializerEncryptedBackupsUpload",[d[20],d[23],d[21],d[23],d[22]].join(""),d[24],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[16],c.i64.cast([0,50026])],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadStoredProcedure";a.__tables__=["pending_backups_context_v2"];e.exports=a}),null);
__d("LSTaskSerializerEncryptedBackupsUploadProtobufOnly",[],(function(a,b,c,d,e,f){function a(){var a,b=arguments,c=b[b.length-1],d=[],e=[];return d[0]=new c.Map(),d[0].set("error_code",c.i64.cast([0,802])),d[0].set("stored_procedure","LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadProtobufOnlyStoredProcedure"),d[0].set("error_message",""),d[2]=new c.Map(),d[3]=d[2].set("success",void 0),d[4]=d[2].set("failure",d[0]),d[5]=d[2].set("context",void 0),d[6]=c.toJSON(d[2]),d[1]=d[6],a=[d[1],c.i64.cast([0,50042]),void 0],e[0]=a[0],e[1]=a[1],e[2]=a[2],c.resolve(e)}a.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadProtobufOnlyStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSTaskSerializerEncryptedBackupsUploadSenderBackup",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(a){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][taskSerializerEncryptedBackupsUploadSenderBackup] Beginning execution."),d[1]=c.i64.of_float(Date.now()),function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadSenderBackupStoredProcedure] LSEncryptedBackupsMinosEncrypt native op not supported"),d[3]="LSEncryptedBackupsMinosEncrypt native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadSenderBackupStoredProcedure] ","",d[3]].join("")),d[2]=c.createArray(),void 0!==void 0?d[12]=(d[2].push(void 0),d[2]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadSenderBackupStoredProcedure",d[3],d[2],c.i64.cast([0,3]))},function(a){return d[4]=new c.Map(),d[4].set("error_code",c.i64.cast([0,3])),d[4].set("stored_procedure","taskSerializerEncryptedBackupsUploadSenderBackup"),d[4].set("error_message",""),d[12]=new c.Map(),d[13]=d[12].set("success",void 0),d[14]=d[12].set("failure",d[4]),d[15]=d[12].set("context",void 0),d[16]=c.toJSON(d[12]),d[5]=d[16],d[6]=c.i64.of_float(Date.now()),d[7]=c.i64.random(),d[9]="Finishing execution. Execution time: ",d[10]=c.i64.to_string(c.i64.sub(d[6],d[0])),d[11]=" ms",d[8]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][taskSerializerEncryptedBackupsUploadSenderBackup] ",d[8],d[9],d[8],d[10],d[8],d[11]].join("")),c.i64.eq(c.i64.mod_(d[7],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[12]=",",d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"taskSerializerEncryptedBackupsUploadSenderBackup",[d[9],d[12],d[10],d[12],d[11]].join(""),d[13],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[5],c.i64.cast([0,50057]),void 0],e[0]=a[0],e[1]=a[1],e[2]=a[2],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadSenderBackupStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSTaskSerializerMuteThreadV2",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(e){return b.sequence([function(d){return b.db.table(32).fetch([[[a[0]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?(c[4]=b.createArray(),c[5]=(c[4].push("TaskSerializerMuteThreadV2: Task ID not found"),c[4]),c[6]=(c[4].push(a[0]),c[4]),c[7]=b.toJSON(c[4]),function(a){b.logger(a).mustfix(a)}(c[7]),f=[void 0,void 0,void 0],c[0]=f[0],c[1]=f[1],c[2]=f[2]):(e=d.item,b.sequence([function(a){return c[8]=e.threadKey,b.db.table(9).fetch([[[c[8]]]]).next().then(function(d,e){var a=d.done;d=d.value;return a?(c[9]=b.createArray(),c[10]=(c[9].push("TaskSerializerMuteThreadV2: Thread not found"),c[9]),c[11]=(c[9].push(c[8]),c[9]),c[12]=b.toJSON(c[9]),function(a){b.logger(a).mustfix(a)}(c[12]),a=[void 0,void 0,void 0],c[4]=a[0],c[5]=a[1],c[6]=a[2]):(e=d.item,b.sequence([function(a){return b.db.table(9).fetch([[[c[8]]]]).next().then(function(d,e){var a=d.done;d=d.value;return a?c[9]=b.i64.cast([0,1]):(e=d.item,c[14]=e.syncGroup,b.i64.neq(c[14],void 0)?c[13]=c[14]:c[13]=b.i64.cast([0,1]),c[9]=c[13])})},function(a){return c[11]=new b.Map(),c[11].set("thread_key",c[8]),c[11].set("mailbox_type",b.i64.cast([0,0])),c[11].set("mute_expire_time_ms",e.muteExpireTimeMs),c[11].set("sync_group",c[9]),c[12]=b.toJSON(c[11]),a=[c[12],b.i64.cast([0,144]),void 0],c[4]=a[0],c[5]=a[1],c[6]=a[2]}]))})},function(a){return a=[c[4],c[5],c[6]],c[0]=a[0],c[1]=a[1],c[2]=a[2],a}]))})},function(a){return a=[c[0],c[1]],d[0]=a[0],d[1]=a[1],a}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxTaskSerializerMuteThreadV2StoredProcedure";a.__tables__=["threads_optimistic_context","threads"];e.exports=a}),null);
__d("LSTaskSerializerRemoveThread",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(e){return b.sequence([function(d){return b.db.table(32).fetch([[[a[0]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?(c[4]=b.createArray(),c[5]=(c[4].push("TaskSerializerRemoveThreadV2: Task ID not found"),c[4]),c[6]=(c[4].push(a[0]),c[4]),c[7]=b.toJSON(c[4]),function(a){b.logger(a).mustfix(a)}(c[7]),f=[void 0,void 0,void 0],c[0]=f[0],c[1]=f[1],c[2]=f[2]):(e=d.item,c[7]=e.removeType,b.i64.neq(c[7],void 0)?(c[8]=new b.Map(),c[8].set("thread_key",e.threadKey),c[8].set("remove_type",c[7]),c[8].set("sync_group",e.syncGroup==null?b.i64.cast([0,1]):e.syncGroup),c[9]=b.toJSON(c[8]),f=[c[9],b.i64.cast([0,146]),void 0],c[4]=f[0],c[5]=f[1],c[6]=f[2]):(d=[void 0,void 0,void 0],c[4]=d[0],c[5]=d[1],c[6]=d[2],d),e=[c[4],c[5],c[6]],c[0]=e[0],c[1]=e[1],c[2]=e[2])})},function(a){return a=[c[0],c[1]],d[0]=a[0],d[1]=a[1],a}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxTaskSerializerRemoveThreadStoredProcedure";a.__tables__=["threads_optimistic_context"];e.exports=a}),null);
__d("LSTaskSerializerSendMessageV2",["LSSymmetricEncryptionCreateEncryptedString.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(e){return b.sequence([function(d){return b.db.table(31).fetch([[[a[0]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?(c[4]=b.createArray(),c[5]=(c[4].push("task ID not found"),c[4]),c[6]=(c[4].push(a[0]),c[4]),c[7]=b.toJSON(c[4]),function(a){b.logger(a).mustfix(a)}(c[7]),f=[void 0,void 0,void 0],c[0]=f[0],c[1]=f[1],c[2]=f[2]):(e=d.item,b.sequence([function(d){return c[11]=e.offlineThreadingId,c[12]=e.messageId,c[23]=e.threadAttributionSource,c[9]=e.platformRef,c[10]=e.platformToken,c[8]=e.replySourceId,c[13]=e.replySourceType,c[22]=e.sendType,c[25]=e.markThreadRead,c[15]=e.initiatingSource,c[16]=e.skipUrlPreviewGen,c[18]=e.textHasLinks,c[19]=e.dataclassParams,c[20]=e.multitabEnv,c[21]=e.metadataDataclass,c[17]=e.richTextFormatType,c[24]=e.subthreadParentMessageId,c[14]=e.isExclusiveToSubthread,b.db.table(12).fetch([[[c[11]]],"optimistic"]).next().then(function(e,f){var d=e.done;e=e.value;return d?(c[26]=b.createArray(),c[27]=(c[26].push("OTID not found"),c[26]),c[28]=(c[26].push(c[11]),c[26]),c[29]=b.toJSON(c[26]),function(a){b.logger(a).mustfix(a)}(c[29]),d=[void 0,void 0,void 0],c[4]=d[0],c[5]=d[1],c[6]=d[2]):(f=e.item,b.sequence([function(d){return c[34]=f.text,c[30]=f.threadKey,c[35]=f.messageId,c[43]=f.senderId,c[32]=f.stickerId,c[37]=f.mentionOffsets,c[38]=f.mentionLengths,c[31]=f.mentionIds,c[39]=f.mentionTypes,c[42]=f.replyType,c[40]=f.isForwarded,c[36]=f.forwardScore,c[41]=f.hotEmojiSize,c[33]=f.metadataDataclass,b.db.table(9).fetch([[[c[30]]]]).next().then(function(e,g){var d=e.done;e=e.value;return d?(c[44]=b.createArray(),c[45]=(c[44].push("thread not found"),c[44]),c[46]=(c[44].push(c[30]),c[44]),c[47]=b.toJSON(c[44]),function(a){b.logger(a).mustfix(a)}(c[47]),d=[void 0,void 0,void 0],c[26]=d[0],c[27]=d[1],c[28]=d[2]):(g=e.item,b.sequence([function(d){return c[51]=g.threadName,c[50]=g.threadKey,c[52]=g.mailboxType,c[44]=g.threadType,c[53]=g.capabilities,c[54]=g.capabilities2,c[55]=g.capabilities3,c[56]=g.capabilities4,c[57]=g.capabilities5,b.db.table(2).fetch([[[a[0]]]]).next().then(function(e,f){var d=e.done;e=e.value;return d?c[45]=!1:(f=e.item,b.sequence([function(d){return b.islc(b.db.table(2).fetch([[[f.queueName]],"queueNameTaskId"]),0,b.i64.to_float(b.i64.cast([0,1]))).next().then(function(e,f){var d=e.done;e=e.value;return d?c[58]=!1:(f=e.item,c[58]=b.i64.eq(f.taskId,a[0]))})},function(a){return c[45]=c[58]}]))})},function(a){return b.i64.eq(g.authorityLevel,b.i64.cast([0,20]))&&(b.i64.eq(c[44],b.i64.cast([0,2]))||b.i64.eq(c[44],b.i64.cast([0,5]))||b.i64.eq(c[44],b.i64.cast([0,26])))&&c[45]?b.sequence([function(a){return c[61]=c[22]==null?b.i64.cast([0,1]):c[22],b.db.table(9).fetch([[[c[30]]]]).next().then(function(d,e){var a=d.done;d=d.value;return a?c[58]=b.i64.cast([0,1]):(e=d.item,c[77]=e.syncGroup,b.i64.neq(c[77],void 0)?c[76]=c[77]:c[76]=b.i64.cast([0,1]),c[58]=c[76])})},function(a){return c[60]=new b.Map(),c[60].set("thread_id",c[30]),c[60].set("otid",c[11]),c[60].set("source",c[23]==null?b.i64.cast([0,0]):c[23]),c[60].set("send_type",b.i64.cast([0,1])),c[60].set("sync_group",c[58]),c[60].set("mark_thread_read",c[25]),b.i64.eq(c[61],b.i64.cast([0,1]))?b.resolve(c[60].set("text",c[34])):b.i64.eq(c[61],b.i64.cast([0,2]))?b.resolve(b.i64.neq(c[32],void 0)?(c[60].set("sticker_id",c[32]),c[60].set("send_type",c[61])):0):b.i64.eq(c[61],b.i64.cast([0,7]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[30],c[35]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[void 0,void 0],c[76]=a[0],c[77]=a[1],a):(d=b.item,a=[d.filename,d.attributionAppId],c[76]=a[0],c[77]=a[1])})},function(a){return c[76]!==void 0?b.i64.neq(c[77],void 0)?(c[60].set("url",c[76]),c[60].set("attribution_app_id",c[77]),c[60].set("send_type",c[61]),c[33]!==void 0?c[60].set("metadata_dataclass",c[33]):0):0:0}]):b.i64.eq(c[61],b.i64.cast([0,3]))?b.sequence([function(a){return c[60].set("text",c[34]),c[76]=b.createArray(),c[77]=b.createArray(),b.forEach(b.sortBy(b.db.table(16).fetch([[[c[30],c[35]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[78]=a.offlineAttachmentId,c[79]=(c[76].push(b.i64.from_string(a.attachmentFbid)),c[76]),c[78]!==void 0?c[79]=(c[77].push(c[78]),c[77]):0})},function(a){return c[60].set("attachment_fbids",c[76]),b.i64.eq(c[61],b.i64.cast([0,9]))?c[60].set("offline_attachment_ids",c[77]):0,c[60].set("send_type",c[61])}]):b.i64.eq(c[61],b.i64.cast([0,9]))?b.sequence([function(a){return c[60].set("text",c[34]),c[76]=b.createArray(),c[77]=b.createArray(),b.forEach(b.sortBy(b.db.table(16).fetch([[[c[30],c[35]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[78]=a.offlineAttachmentId,c[79]=(c[76].push(b.i64.from_string(a.attachmentFbid)),c[76]),c[78]!==void 0?c[79]=(c[77].push(c[78]),c[77]):0})},function(a){return c[60].set("attachment_fbids",c[76]),b.i64.eq(c[61],b.i64.cast([0,9]))?c[60].set("offline_attachment_ids",c[77]):0,c[60].set("send_type",c[61])}]):b.i64.eq(c[61],b.i64.cast([0,4]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[30],c[35]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?c[76]=void 0:(d=b.item,c[76]=d.attachmentFbid)})},function(a){return b.db.table(16).fetch([[[c[30],c[35]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?c[78]=void 0:(d=b.item,c[78]=d.actionUrl)})},function(a){return c[76]!==void 0?(c[60].set("text",c[34]),c[78]!==void 0?c[60].set("url",c[78]):0,c[60].set("forwarded_share_id",c[76]),c[60].set("send_type",c[61])):0}]):b.i64.eq(c[61],b.i64.cast([0,5]))?b.resolve(c[12]!==void 0?(c[60].set("forwarded_msg_id",c[12]),c[60].set("send_type",c[61]),b.i64.neq(c[36],void 0)?c[60].set("forward_score",c[36]):0,c[60].set("strip_forwarded_msg_caption",!1)):0):b.i64.eq(c[61],b.i64.cast([0,6]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[30],c[35]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[void 0,void 0],c[76]=a[0],c[77]=a[1],a):(d=b.item,a=[d.filename,d.attributionAppId],c[76]=a[0],c[77]=a[1])})},function(a){return c[76]!==void 0?(c[60].set("url",c[76]),c[60].set("text",c[34]),c[60].set("send_type",c[61])):0}]):b.i64.eq(c[61],b.i64.cast([0,11]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[30],c[35]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[void 0,void 0],c[76]=a[0],c[77]=a[1],a):(d=b.item,a=[d.actionUrl,d.attributionAppId],c[76]=a[0],c[77]=a[1])})},function(a){return c[76]!==void 0?(c[60].set("url",c[76]),c[60].set("text",c[34]),c[60].set("send_type",c[61])):0}]):b.resolve(b.i64.eq(c[61],b.i64.cast([0,12]))?c[60].set("send_type",c[61]):0)},function(a){return c[72]=c[24]==null?void 0:c[24],c[71]=c[8]===""?void 0:c[8],c[71]!==void 0?b.i64.neq(c[13],void 0)?(c[76]=new b.Map(),c[76].set("reply_source_id",c[71]),c[76].set("reply_source_type",c[13]),c[76].set("reply_type",c[42]==null?b.i64.cast([0,0]):c[42]),c[76].set("reply_source_attachment_id",void 0),c[60].set("reply_metadata",c[76])):0:0,c[72]!==void 0?c[14]!==void 0?(c[76]=new b.Map(),c[76].set("subthread_parent_message_id",c[72]),c[76].set("is_exclusive_to_subthread",c[14]),c[60].set("subthread_data",c[76])):0:0,c[73]=c[31]===""?void 0:c[31],c[73]!==void 0?(c[76]=c[37]===""?void 0:c[37],c[76]!==void 0?(c[77]=c[38]===""?void 0:c[38],c[77]!==void 0?(c[78]=new b.Map(),c[78].set("mention_ids",c[73]),c[78].set("mention_offsets",c[76]),c[78].set("mention_lengths",c[77]),c[78].set("mention_types",c[39]===""?void 0:c[39]),c[60].set("mention_data",c[78])):0):0):0,c[40]!==void 0?c[60].set("is_forwarded",c[40]):0,c[74]=c[9]===""?void 0:c[9],c[74]!==void 0?c[60].set("platform_ref",c[74]):0,c[75]=c[10]===""?void 0:c[10],c[75]!==void 0?c[60].set("platform_token",c[75]):0,[b.i64.cast([0,1]),b.i64.cast([0,2])].some(function(a){return b.i64.eq(c[61],a)})?b.i64.neq(c[41],void 0)?c[60].set("hot_emoji_size",c[41]):0:0,b.i64.neq(c[15],void 0)?c[60].set("initiating_source",c[15]):0,c[16]!==void 0?c[60].set("skip_url_preview_gen",c[16]):0,b.i64.neq(c[17],void 0)?c[60].set("rich_text_format_type",c[17]):0,b.resolve()},function(a){return c[18]!==void 0?c[60].set("text_has_links",c[18]):0,c[19]!==void 0?c[60].set("dataclass_params",c[19]):0,c[20]!==void 0?c[60].set("multitab_env",c[20]):0,c[21]!==void 0?c[60].set("metadata_dataclass",c[21]):0,b.filter(b.db.table(14).fetch([[[c[50],c[43]]]]),function(a){return b.i64.eq(a.threadKey,c[50])&&b.i64.eq(b.i64.cast([0,0]),c[52])&&b.i64.eq(a.contactId,c[43])}).next().then(function(d,e){var a=d.done;d=d.value;return a?c[62]=!1:(e=d.item,b.i64.eq(c[44],b.i64.cast([0,152]))?(c[77]=e.threadRoles,b.i64.lt(b.i64.cast([0,7]),b.i64.cast([0,0]))||b.i64.gt(b.i64.cast([0,7]),b.i64.cast([0,9]))?c[78]=!1:c[78]=!b.i64.eq(b.i64.and_(b.i64.lsl_(b.i64.cast([0,1]),b.i64.to_int32(b.i64.cast([0,7]))),c[77]),b.i64.cast([0,0])),c[79]=c[53],c[80]=c[54],c[81]=c[55],c[82]=c[56],c[83]=c[57],c[85]=b.i64.div(b.i64.cast([0,223]),b.i64.cast([0,64])),c[86]=b.i64.lsl_(b.i64.cast([0,1]),b.i64.to_int32(b.i64.sub(b.i64.cast([0,223]),b.i64.mul(c[85],b.i64.cast([0,64]))))),b.i64.lt(b.i64.cast([0,223]),b.i64.cast([0,0]))||b.i64.gt(b.i64.cast([0,223]),b.i64.cast([0,294]))?c[84]=!1:(b.i64.eq(c[85],b.i64.cast([0,0]))?c[87]=!b.i64.eq(b.i64.and_(c[86],c[79]),b.i64.cast([0,0])):(b.i64.eq(c[85],b.i64.cast([0,1]))?c[88]=!b.i64.eq(b.i64.and_(c[86],c[80]),b.i64.cast([0,0])):(b.i64.eq(c[85],b.i64.cast([0,2]))?c[89]=!b.i64.eq(b.i64.and_(c[86],c[81]),b.i64.cast([0,0])):(b.i64.eq(c[85],b.i64.cast([0,3]))?c[90]=!b.i64.eq(b.i64.and_(c[86],c[82]),b.i64.cast([0,0])):(b.i64.eq(c[85],b.i64.cast([0,4]))?c[91]=!b.i64.eq(b.i64.and_(c[86],c[83]),b.i64.cast([0,0])):c[91]=!1,c[90]=c[91]),c[89]=c[90]),c[88]=c[89]),c[87]=c[88]),c[84]=c[87]),c[78]===c[84]?0:(function(a){b.logger(a).mustfix(a)}("LS::assert is failed. Thread role and thread capability don't agree for Broadcast Channels message-as-page functionality; aborting"),b["throw"]("LS::assert is failed. Thread role and thread capability don't agree for Broadcast Channels message-as-page functionality; aborting")),c[76]=c[78]):c[76]=!1,c[62]=c[76])})},function(a){return c[62]?c[60].set("perform_action_as_page",!0):0,c[64]=b.createArray(),b.forEach(b.db.table(14).fetch([[[c[30]]]]),function(a){a=a.item;return c[76]=(c[64].push(a.contactId),c[64])})},function(a){return c[65]=new b.Map(),c[65].set("participants",c[64]),c[65].set("send_payload",c[60]),c[51]!==void 0?c[65].set("thread_name",c[51]):0,b.db.table(312).fetch([[[c[30]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?c[66]=void 0:(d=b.item,c[66]=d.metadata)})},function(a){return c[65].set("thread_metadata",c[66]),b.forEach(b.db.table(9).fetch([[[c[50]]]]),function(a){var b=a.update;a.item;return b({otidOfFirstMessage:f.offlineThreadingId})})},function(a){return c[66]===void 0||!1?(b.i64.eq(c[44],b.i64.cast([0,5]))||b.i64.eq(c[44],b.i64.cast([0,26]))?(function(a){b.logger(a).mustfix(a)}("For Marketplace & community chat subthreads, thread metadata cannot be null"),a=[void 0,void 0,void 0],c[76]=a[0],c[77]=a[1],c[78]=a[2]):(c[79]=b.toJSON(c[65]),a=[c[79],b.i64.cast([0,130]),void 0],c[76]=a[0],c[77]=a[1],c[78]=a[2]),a=[c[76],c[77],c[78]],c[68]=a[0],c[69]=a[1],c[70]=a[2]):(b.i64.eq(c[44],b.i64.cast([0,5]))?(c[79]=b.toJSON(c[65]),a=[c[79],b.i64.cast([0,645]),void 0],c[76]=a[0],c[77]=a[1],c[78]=a[2]):(b.i64.eq(c[44],b.i64.cast([0,2]))?(c[82]=b.toJSON(c[65]),a=[c[82],b.i64.cast([0,787]),void 0],c[79]=a[0],c[80]=a[1],c[81]=a[2]):(c[82]=b.toJSON(c[65]),a=[c[82],b.i64.cast([0,645]),void 0],c[79]=a[0],c[80]=a[1],c[81]=a[2]),a=[c[79],c[80],c[81]],c[76]=a[0],c[77]=a[1],c[78]=a[2]),a=[c[76],c[77],c[78]],c[68]=a[0],c[69]=a[1],c[70]=a[2]),a=[c[68],c[69],c[70]],c[47]=a[0],c[48]=a[1],c[49]=a[2]}]):b.sequence([function(a){return c[61]=c[22]==null?b.i64.cast([0,1]):c[22],b.db.table(9).fetch([[[c[30]]]]).next().then(function(d,e){var a=d.done;d=d.value;return a?c[58]=b.i64.cast([0,1]):(e=d.item,c[71]=e.syncGroup,b.i64.neq(c[71],void 0)?c[70]=c[71]:c[70]=b.i64.cast([0,1]),c[58]=c[70])})},function(a){return c[60]=new b.Map(),c[60].set("thread_id",c[30]),c[60].set("otid",c[11]),c[60].set("source",c[23]==null?b.i64.cast([0,0]):c[23]),c[60].set("send_type",b.i64.cast([0,1])),c[60].set("sync_group",c[58]),c[60].set("mark_thread_read",c[25]),b.i64.eq(c[61],b.i64.cast([0,1]))?b.resolve(c[60].set("text",c[34])):b.i64.eq(c[61],b.i64.cast([0,2]))?b.resolve(b.i64.neq(c[32],void 0)?(c[60].set("sticker_id",c[32]),c[60].set("send_type",c[61])):0):b.i64.eq(c[61],b.i64.cast([0,7]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[30],c[35]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[void 0,void 0],c[70]=a[0],c[71]=a[1],a):(d=b.item,a=[d.filename,d.attributionAppId],c[70]=a[0],c[71]=a[1])})},function(a){return c[70]!==void 0?b.i64.neq(c[71],void 0)?(c[60].set("url",c[70]),c[60].set("attribution_app_id",c[71]),c[60].set("send_type",c[61]),c[33]!==void 0?c[60].set("metadata_dataclass",c[33]):0):0:0}]):b.i64.eq(c[61],b.i64.cast([0,3]))?b.sequence([function(a){return c[60].set("text",c[34]),c[70]=b.createArray(),c[71]=b.createArray(),b.forEach(b.sortBy(b.db.table(16).fetch([[[c[30],c[35]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[72]=a.offlineAttachmentId,c[73]=(c[70].push(b.i64.from_string(a.attachmentFbid)),c[70]),c[72]!==void 0?c[73]=(c[71].push(c[72]),c[71]):0})},function(a){return c[60].set("attachment_fbids",c[70]),b.i64.eq(c[61],b.i64.cast([0,9]))?c[60].set("offline_attachment_ids",c[71]):0,c[60].set("send_type",c[61])}]):b.i64.eq(c[61],b.i64.cast([0,9]))?b.sequence([function(a){return c[60].set("text",c[34]),c[70]=b.createArray(),c[71]=b.createArray(),b.forEach(b.sortBy(b.db.table(16).fetch([[[c[30],c[35]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[72]=a.offlineAttachmentId,c[73]=(c[70].push(b.i64.from_string(a.attachmentFbid)),c[70]),c[72]!==void 0?c[73]=(c[71].push(c[72]),c[71]):0})},function(a){return c[60].set("attachment_fbids",c[70]),b.i64.eq(c[61],b.i64.cast([0,9]))?c[60].set("offline_attachment_ids",c[71]):0,c[60].set("send_type",c[61])}]):b.i64.eq(c[61],b.i64.cast([0,4]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[30],c[35]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?c[70]=void 0:(d=b.item,c[70]=d.attachmentFbid)})},function(a){return b.db.table(16).fetch([[[c[30],c[35]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?c[72]=void 0:(d=b.item,c[72]=d.actionUrl)})},function(a){return c[70]!==void 0?(c[60].set("text",c[34]),c[72]!==void 0?c[60].set("url",c[72]):0,c[60].set("forwarded_share_id",c[70]),c[60].set("send_type",c[61])):0}]):b.i64.eq(c[61],b.i64.cast([0,5]))?b.resolve(c[12]!==void 0?(c[60].set("forwarded_msg_id",c[12]),c[60].set("send_type",c[61]),b.i64.neq(c[36],void 0)?c[60].set("forward_score",c[36]):0,c[60].set("strip_forwarded_msg_caption",!1)):0):b.i64.eq(c[61],b.i64.cast([0,6]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[30],c[35]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[void 0,void 0],c[70]=a[0],c[71]=a[1],a):(d=b.item,a=[d.filename,d.attributionAppId],c[70]=a[0],c[71]=a[1])})},function(a){return c[70]!==void 0?(c[60].set("url",c[70]),c[60].set("text",c[34]),c[60].set("send_type",c[61])):0}]):b.i64.eq(c[61],b.i64.cast([0,11]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[30],c[35]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[void 0,void 0],c[70]=a[0],c[71]=a[1],a):(d=b.item,a=[d.actionUrl,d.attributionAppId],c[70]=a[0],c[71]=a[1])})},function(a){return c[70]!==void 0?(c[60].set("url",c[70]),c[60].set("text",c[34]),c[60].set("send_type",c[61])):0}]):b.resolve(b.i64.eq(c[61],b.i64.cast([0,12]))?c[60].set("send_type",c[61]):0)},function(a){return c[66]=c[24]==null?void 0:c[24],c[65]=c[8]===""?void 0:c[8],c[65]!==void 0?b.i64.neq(c[13],void 0)?(c[70]=new b.Map(),c[70].set("reply_source_id",c[65]),c[70].set("reply_source_type",c[13]),c[70].set("reply_type",c[42]==null?b.i64.cast([0,0]):c[42]),c[70].set("reply_source_attachment_id",void 0),c[60].set("reply_metadata",c[70])):0:0,c[66]!==void 0?c[14]!==void 0?(c[70]=new b.Map(),c[70].set("subthread_parent_message_id",c[66]),c[70].set("is_exclusive_to_subthread",c[14]),c[60].set("subthread_data",c[70])):0:0,c[67]=c[31]===""?void 0:c[31],c[67]!==void 0?(c[70]=c[37]===""?void 0:c[37],c[70]!==void 0?(c[71]=c[38]===""?void 0:c[38],c[71]!==void 0?(c[72]=new b.Map(),c[72].set("mention_ids",c[67]),c[72].set("mention_offsets",c[70]),c[72].set("mention_lengths",c[71]),c[72].set("mention_types",c[39]===""?void 0:c[39]),c[60].set("mention_data",c[72])):0):0):0,c[40]!==void 0?c[60].set("is_forwarded",c[40]):0,c[68]=c[9]===""?void 0:c[9],c[68]!==void 0?c[60].set("platform_ref",c[68]):0,c[69]=c[10]===""?void 0:c[10],c[69]!==void 0?c[60].set("platform_token",c[69]):0,[b.i64.cast([0,1]),b.i64.cast([0,2])].some(function(a){return b.i64.eq(c[61],a)})?b.i64.neq(c[41],void 0)?c[60].set("hot_emoji_size",c[41]):0:0,b.i64.neq(c[15],void 0)?c[60].set("initiating_source",c[15]):0,c[16]!==void 0?c[60].set("skip_url_preview_gen",c[16]):0,b.i64.neq(c[17],void 0)?c[60].set("rich_text_format_type",c[17]):0,b.resolve()},function(a){return c[18]!==void 0?c[60].set("text_has_links",c[18]):0,c[19]!==void 0?c[60].set("dataclass_params",c[19]):0,c[20]!==void 0?c[60].set("multitab_env",c[20]):0,c[21]!==void 0?c[60].set("metadata_dataclass",c[21]):0,b.filter(b.db.table(14).fetch([[[c[50],c[43]]]]),function(a){return b.i64.eq(a.threadKey,c[50])&&b.i64.eq(b.i64.cast([0,0]),c[52])&&b.i64.eq(a.contactId,c[43])}).next().then(function(d,e){var a=d.done;d=d.value;return a?c[62]=!1:(e=d.item,b.i64.eq(c[44],b.i64.cast([0,152]))?(c[71]=e.threadRoles,b.i64.lt(b.i64.cast([0,7]),b.i64.cast([0,0]))||b.i64.gt(b.i64.cast([0,7]),b.i64.cast([0,9]))?c[72]=!1:c[72]=!b.i64.eq(b.i64.and_(b.i64.lsl_(b.i64.cast([0,1]),b.i64.to_int32(b.i64.cast([0,7]))),c[71]),b.i64.cast([0,0])),c[73]=c[53],c[74]=c[54],c[75]=c[55],c[76]=c[56],c[77]=c[57],c[79]=b.i64.div(b.i64.cast([0,223]),b.i64.cast([0,64])),c[80]=b.i64.lsl_(b.i64.cast([0,1]),b.i64.to_int32(b.i64.sub(b.i64.cast([0,223]),b.i64.mul(c[79],b.i64.cast([0,64]))))),b.i64.lt(b.i64.cast([0,223]),b.i64.cast([0,0]))||b.i64.gt(b.i64.cast([0,223]),b.i64.cast([0,294]))?c[78]=!1:(b.i64.eq(c[79],b.i64.cast([0,0]))?c[81]=!b.i64.eq(b.i64.and_(c[80],c[73]),b.i64.cast([0,0])):(b.i64.eq(c[79],b.i64.cast([0,1]))?c[82]=!b.i64.eq(b.i64.and_(c[80],c[74]),b.i64.cast([0,0])):(b.i64.eq(c[79],b.i64.cast([0,2]))?c[83]=!b.i64.eq(b.i64.and_(c[80],c[75]),b.i64.cast([0,0])):(b.i64.eq(c[79],b.i64.cast([0,3]))?c[84]=!b.i64.eq(b.i64.and_(c[80],c[76]),b.i64.cast([0,0])):(b.i64.eq(c[79],b.i64.cast([0,4]))?c[85]=!b.i64.eq(b.i64.and_(c[80],c[77]),b.i64.cast([0,0])):c[85]=!1,c[84]=c[85]),c[83]=c[84]),c[82]=c[83]),c[81]=c[82]),c[78]=c[81]),c[72]===c[78]?0:(function(a){b.logger(a).mustfix(a)}("LS::assert is failed. Thread role and thread capability don't agree for Broadcast Channels message-as-page functionality; aborting"),b["throw"]("LS::assert is failed. Thread role and thread capability don't agree for Broadcast Channels message-as-page functionality; aborting")),c[70]=c[72]):c[70]=!1,c[62]=c[70])})},function(a){return c[62]?c[60].set("perform_action_as_page",!0):0,c[64]=b.toJSON(c[60]),a=[c[64],b.i64.cast([0,46]),void 0],c[47]=a[0],c[48]=a[1],c[49]=a[2]}])},function(a){return a=[c[47],c[48],c[49]],c[26]=a[0],c[27]=a[1],c[28]=a[2],a}]))})},function(a){return a=[c[26],c[27],c[28]],c[4]=a[0],c[5]=a[1],c[6]=a[2],a}]))})},function(a){return a=[c[4],c[5],c[6]],c[0]=a[0],c[1]=a[1],c[2]=a[2],a}]))})},function(a){return a=[c[0],c[1]],d[0]=a[0],d[1]=a[1],a}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxTaskSerializerSendMessageV2StoredProcedure";a.__tables__=["messages_optimistic_context","messages","threads","pending_tasks","attachments","participants","threads_optimistic_metadata"];e.exports=a}),null);
__d("LSTaskSerializerSyncThreadCapabilities",[],(function(a,b,c,d,e,f){function a(){var a,b=arguments,c=b[b.length-1],d=[];return a=[void 0,void 0,void 0],d[0]=a[0],d[1]=a[1],d[2]=a[2],c.resolve(d)}a.__sproc_name__="LSMailboxTaskSerializerSyncThreadCapabilitiesStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSIsExperimentCapabilityEnabled.nop",["LSACSExperimentCapability","LSIntEnum","MetaConfig","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("MetaConfig")._("87"),k=c("MetaConfig")._("156");a=function(a,e,f,g){switch((i||(i=d("LSIntEnum"))).toNumber(f)){case c("LSACSExperimentCapability").BUMP_TOKEN_SYNC_TASK_AT_TASK_SERIALIZATION:return(h||(h=b("Promise"))).resolve([k]);case c("LSACSExperimentCapability").INSERT_PENDING_TASK_PARENT_ROW_WHEN_NO_ACS_TOKENS_AT_TASK_INSERTION:return(h||(h=b("Promise"))).resolve([!1]);case c("LSACSExperimentCapability").RETRY_AFTER_TASK_SERIALIZATION_FAILURE_EXPONENTIAL_BACKOFF:return(h||(h=b("Promise"))).resolve([j])}return(h||(h=b("Promise"))).resolve([!1])};a.__nop_name__="LSIsExperimentCapabilityEnabled";g["default"]=a}),98);
__d("LSVoprfHmac.nop",["ACSCipherSuiteModule","ACSTokenHmacUtil","XPlatReactTextEncoder"],(function(a,b,c,d,e,f,g){"use strict";a=async function(a,b,c,e){a=d("ACSCipherSuiteModule").getACSCipherSuiteByValue(d("ACSCipherSuiteModule").VOPRF_RISTRETTO_HMACSHA512.value);if(!a)return Promise.resolve([void 0]);b=await d("ACSTokenHmacUtil").hmac(a.macAlgorithm,new Uint8Array(e).slice(),new(d("XPlatReactTextEncoder").TextEncoder)().encode(c));return Promise.resolve([b.buffer])};a.__nop_name__="LSVoprfHmac";g.default=a}),98);
__d("LSTaskSerializerUnauthenticatedTask",["LSArrayGetObjectAt","LSBase64Encode.nop","LSIsExperimentCapabilityEnabled.nop","LSMailboxTaskCompletionApiOnTaskCompletion","LSRemoveUsedTokens","LSVoprfHmac.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return c.db.table(311).fetch([[[a[0]]]]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[0]=void 0:(b=a.item,d[0]=b.projectName)})},function(e){return d[0]!==void 0?c.sequence([function(e){return a[1]!==void 0?c.sequence([function(a){return d[9]=c.createArray(),d[10]=c.i64.of_float(Date.now()),c.forEach(c.filter(c.db.table(307).fetch(),function(a){return d[0]===a.projectName&&c.i64.gt(a.expirationTimestampMs,d[10])}),function(a){a=a.item;return d[16]=(d[9].push(a.configId),d[9])})},function(a){return c.sequence([function(a){return d[16]=c.createArray(),d[17]=c.i64.of_int32(d[9].length),c.i64.gt(d[17],c.i64.cast([0,0]))?c.loopAsync(d[17],function(a){return d[19]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[9],d[19]).then(function(a){return a=a,d[20]=a[0],d[21]=a[1],a})},function(a){return d[22]=(d[16].push(d[20]),d[16])}])}):c.resolve()},function(a){return d[18]=d[16].join(","),d[11]=d[18]}])},function(e){return c.filter(c.db.table(309).fetch(),function(a){return d[9].includes(a.configId)&&c.i64.gt(a.redeemLimit,c.i64.cast([0,0]))}).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(a){return c.nativeOperation(b("LSIsExperimentCapabilityEnabled.nop"),c.i64.cast([0,0]),d[0]).then(function(a){return a=a,d[16]=a[0],a})},function(e){return d[16]?c.sequence([function(b){return c.db.table(311).fetch([[[a[0]]]]).next().then(function(b,e){var a=b.done;b=b.value;return a?d[20]=c.i64.cast([0,0]):(e=b.item,d[20]=e.failureCount)})},function(b){return c.forEach(c.db.table(311).fetch([[[a[0]]]]),function(a){a=a.item;return c.forEach(c.db.table(311).fetch([[[a.taskId]]]),function(a){var b=a.update;a.item;return b({failureCount:c.i64.add(d[20],c.i64.cast([0,1]))})})})},function(a){return a=[void 0,void 0,c.i64.mul(c.i64.lsl_(c.i64.cast([0,1]),c.i64.to_int32(c.i64.mod_(d[20],c.i64.cast([0,7])))),c.i64.cast([0,500]))],d[17]=a[0],d[18]=a[1],d[19]=a[2],a}]):c.sequence([function(d){return c.storedProcedure(b("LSMailboxTaskCompletionApiOnTaskCompletion"),a[0],!1)},function(b){return d[20]=c.createArray(),d[21]=(d[20].push("Unauthenticated Task Serializer: no valid tokens"),d[20]),d[22]=(d[20].push(a[0]),d[20]),d[23]=(d[20].push(d[0]),d[20]),d[24]=c.toJSON(d[20]),function(a){c.logger(a).mustfix(a)}(d[24]),b=[void 0,void 0,void 0],d[17]=b[0],d[18]=b[1],d[19]=b[2]}])},function(a){return a=[d[17],d[18],d[19]],d[12]=a[0],d[13]=a[1],d[14]=a[2],a}]):(f=e.item,c.sequence([function(e){return d[20]=f.tokenId,c.nativeOperation(b("LSVoprfHmac.nop"),a[2]==null?"":a[2],f.sharedSecret).then(function(a){return a=a,d[16]=a[0],a})},function(e){return c.blobs.neq(d[16],void 0)?c.sequence([function(a){return c.forEach(c.db.table(309).fetch([[[d[20]]]]),function(a){var b=a.update;a=a.item;return b({redeemLimit:c.i64.sub(a.redeemLimit,c.i64.cast([0,1]))})})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[16]).then(function(a){return a=a,d[21]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),f.nonce).then(function(a){return a=a,d[22]=a[0],a})},function(b){return d[23]=new c.Map(),d[23].set("config_id",f.configId),d[23].set("tag",d[21]==null?"":d[21]),d[23].set("aux",d[22]==null?"":d[22]),d[23].set("project_name",d[0]),d[24]=c.toJSON(d[23]),d[25]=new c.Map(),d[25].set("payload",a[2]==null?"":a[2]),d[25].set("token",d[24]),d[26]=c.toJSON(d[25]),b=[d[26],c.i64.from_string(a[1]),void 0],d[17]=b[0],d[18]=b[1],d[19]=b[2]}]):c.sequence([function(a){return c.forEach(c.db.table(309).fetch([[[d[20]]]]),function(a){return a["delete"]()})},function(d){return c.storedProcedure(b("LSMailboxTaskCompletionApiOnTaskCompletion"),a[0],!1)},function(b){return d[21]=c.createArray(),d[22]=(d[21].push("Unauthenticated Task Serializer: hmac failed"),d[21]),d[23]=(d[21].push(a[0]),d[21]),d[24]=c.toJSON(d[21]),function(a){c.logger(a).mustfix(a)}(d[24]),b=[void 0,void 0,void 0],d[17]=b[0],d[18]=b[1],d[19]=b[2]}])},function(a){return a=[d[17],d[18],d[19]],d[12]=a[0],d[13]=a[1],d[14]=a[2],a}]))})},function(a){return a=[d[12],d[13],d[14]],d[6]=a[0],d[7]=a[1],d[8]=a[2],a}]):c.sequence([function(d){return c.storedProcedure(b("LSMailboxTaskCompletionApiOnTaskCompletion"),a[0],!1)},function(b){return d[9]=c.createArray(),d[10]=(d[9].push("Unauthenticated Task Serializer: task has no write label"),d[9]),d[11]=(d[9].push(a[0]),d[9]),d[12]=c.toJSON(d[9]),function(a){c.logger(a).mustfix(a)}(d[12]),b=[void 0,void 0,void 0],d[6]=b[0],d[7]=b[1],d[8]=b[2]}])},function(a){return a=[d[6],d[7],d[8]],d[2]=a[0],d[3]=a[1],d[4]=a[2],a}]):c.sequence([function(d){return c.storedProcedure(b("LSMailboxTaskCompletionApiOnTaskCompletion"),a[0],!1)},function(b){return d[6]=c.createArray(),d[7]=(d[6].push("Unauthenticated Task Serializer: anonymous_task_context row not found"),d[6]),d[8]=(d[6].push(a[0]),d[6]),d[9]=c.toJSON(d[6]),function(a){c.logger(a).mustfix(a)}(d[9]),b=[void 0,void 0,void 0],d[2]=b[0],d[3]=b[1],d[4]=b[2]}])},function(a){return c.storedProcedure(b("LSRemoveUsedTokens"))},function(a){return d[0]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSIsExperimentCapabilityEnabled.nop"),c.i64.cast([0,1]),d[0]).then(function(a){return a=a,d[6]=a[0],a})},function(a){return d[6]?c.sequence([function(a){return c.i64.neq(d[4],void 0)?c.resolve(d[8]=!0):c.sequence([function(a){return d[10]=c.createArray(),d[11]=c.i64.of_float(Date.now()),c.forEach(c.filter(c.db.table(307).fetch(),function(a){return d[0]===a.projectName&&c.i64.gt(a.expirationTimestampMs,d[11])}),function(a){a=a.item;return d[15]=(d[10].push(a.configId),d[10])})},function(a){return c.sequence([function(a){return d[15]=c.createArray(),d[16]=c.i64.of_int32(d[10].length),c.i64.gt(d[16],c.i64.cast([0,0]))?c.loopAsync(d[16],function(a){return d[18]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[10],d[18]).then(function(a){return a=a,d[19]=a[0],d[20]=a[1],a})},function(a){return d[21]=(d[15].push(d[19]),d[15])}])}):c.resolve()},function(a){return d[17]=d[15].join(","),d[12]=d[17]}])},function(a){return c.filter(c.db.table(309).fetch(),function(a){return d[10].includes(a.configId)&&c.i64.gt(a.redeemLimit,c.i64.cast([0,0]))}).next().then(function(a,b){b=a.done;a=a.value;return b?d[13]=!0:(a.item,d[13]=!1)})},function(a){return d[8]=d[13]}])},function(a){return d[8]?c.sequence([function(a){return c.filter(c.db.table(310).fetch(),function(a){return a.projectName===d[0]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[10]=void 0:(b=a.item,d[10]=b.taskId)})},function(a){return d[9]=d[10]}]):c.resolve(d[9]=void 0)},function(a){return d[7]=d[9]}]):c.resolve(d[7]=void 0)},function(a){return d[5]=d[7]}]):c.resolve(d[5]=void 0)},function(a){return a=[d[2],d[3],d[4],d[5]],e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSAnonymousCredentialsTaskSerializerUnauthenticatedTaskStoredProcedure";a.__tables__=["anonymous_task_context","secure_acs_configurations","secure_acs_tokens","acs_request_context"];e.exports=a}),null);
__d("LSTaskSerializerUpdateThreadName",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(e){return b.sequence([function(d){return b.db.table(32).fetch([[[a[0]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?(c[4]=b.createArray(),c[5]=(c[4].push("taskSerializerUpdateThreadName: Task ID not found"),c[4]),c[6]=(c[4].push(a[0]),c[4]),c[7]=b.toJSON(c[4]),function(a){b.logger(a).mustfix(a)}(c[7]),f=[void 0,void 0,void 0],c[0]=f[0],c[1]=f[1],c[2]=f[2]):(e=d.item,b.sequence([function(a){return c[8]=e.threadKey,b.db.table(9).fetch([[[c[8]]]]).next().then(function(d,e){var a=d.done;d=d.value;return a?(c[9]=b.createArray(),c[10]=(c[9].push("taskSerializerUpdateThreadName: Thread not found"),c[9]),c[11]=(c[9].push(c[8]),c[9]),c[12]=b.toJSON(c[9]),function(a){b.logger(a).mustfix(a)}(c[12]),a=[void 0,void 0,void 0],c[4]=a[0],c[5]=a[1],c[6]=a[2]):(e=d.item,b.sequence([function(a){return b.db.table(9).fetch([[[c[8]]]]).next().then(function(d,e){var a=d.done;d=d.value;return a?c[9]=b.i64.cast([0,1]):(e=d.item,c[14]=e.syncGroup,b.i64.neq(c[14],void 0)?c[13]=c[14]:c[13]=b.i64.cast([0,1]),c[9]=c[13])})},function(a){return c[11]=new b.Map(),c[11].set("thread_key",c[8]),c[11].set("thread_name",e.threadName==null?"":e.threadName),c[11].set("sync_group",c[9]),c[12]=b.toJSON(c[11]),a=[c[12],b.i64.cast([0,32]),void 0],c[4]=a[0],c[5]=a[1],c[6]=a[2]}]))})},function(a){return a=[c[4],c[5],c[6]],c[0]=a[0],c[1]=a[1],c[2]=a[2],a}]))})},function(a){return a=[c[0],c[1],c[2]],d[0]=a[0],d[1]=a[1],d[2]=a[2],a}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxTaskSerializerUpdateThreadNameStoredProcedure";a.__tables__=["threads_optimistic_context","threads"];e.exports=a}),null);
__d("LSSerializeTask",["LSForceTaskExecutionImmediately","LSLogMebClientEvent.nop","LSTaskSerializerAcsIssueNextSync","LSTaskSerializerDeleteChatHistory","LSTaskSerializerE2eeMessageIntegrityCheckV2","LSTaskSerializerE2eeMetadataThreadIntegrityCheck","LSTaskSerializerEncryptedBackupAction","LSTaskSerializerEncryptedBackupsLoopingUpload","LSTaskSerializerEncryptedBackupsOpenUpload","LSTaskSerializerEncryptedBackupsRestoreWithSerializer","LSTaskSerializerEncryptedBackupsUpload","LSTaskSerializerEncryptedBackupsUploadProtobufOnly","LSTaskSerializerEncryptedBackupsUploadSenderBackup","LSTaskSerializerMuteThreadV2","LSTaskSerializerRemoveThread","LSTaskSerializerSendMessageV2","LSTaskSerializerSyncThreadCapabilities","LSTaskSerializerUnauthenticatedTask","LSTaskSerializerUpdateThreadName"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return a[1]==="46"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerSendMessageV2"),a[0]).then(function(a){return a=a,d[8]=a[0],d[9]=a[1],a})},function(a){return a=[d[8],c.i64.to_string(d[9]),void 0,void 0],d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3],a}]):c.sequence([function(e){return a[1]==="144"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerMuteThreadV2"),a[0]).then(function(a){return a=a,d[12]=a[0],d[13]=a[1],a})},function(a){return a=[d[12],c.i64.to_string(d[13]),void 0,void 0],d[8]=a[0],d[9]=a[1],d[10]=a[2],d[11]=a[3],a}]):c.sequence([function(e){return a[1]==="146"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerRemoveThread"),a[0]).then(function(a){return a=a,d[16]=a[0],d[17]=a[1],a})},function(a){return a=[d[16],c.i64.to_string(d[17]),void 0,void 0],d[12]=a[0],d[13]=a[1],d[14]=a[2],d[15]=a[3],a}]):c.sequence([function(e){return a[1]==="32"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerUpdateThreadName"),a[0]).then(function(a){return a=a,d[20]=a[0],d[21]=a[1],d[22]=a[2],a})},function(a){return a=[d[20],c.i64.to_string(d[21]),void 0,d[22]],d[16]=a[0],d[17]=a[1],d[18]=a[2],d[19]=a[3],a}]):c.sequence([function(e){return a[1]==="362"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerAcsIssueNextSync"),a[0]).then(function(a){return a=a,d[24]=a[0],d[25]=a[1],d[26]=a[2],a})},function(a){return a=[d[24],c.i64.to_string(d[25]),void 0,d[26]],d[20]=a[0],d[21]=a[1],d[22]=a[2],d[23]=a[3],a}]):c.sequence([function(e){return a[1]==="50015"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerEncryptedBackupsRestoreWithSerializer"),a[0]).then(function(a){return a=a,d[28]=a[0],d[29]=a[1],d[30]=a[2],a})},function(a){return a=[d[28],c.i64.to_string(d[29]),void 0,d[30]],d[24]=a[0],d[25]=a[1],d[26]=a[2],d[27]=a[3],a}]):c.sequence([function(e){return a[1]==="319"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerEncryptedBackupAction"),a[0]).then(function(a){return a=a,d[32]=a[0],d[33]=a[1],d[34]=a[2],a})},function(a){return a=[d[32],c.i64.to_string(d[33]),void 0,d[34]],d[28]=a[0],d[29]=a[1],d[30]=a[2],d[31]=a[3],a}]):c.sequence([function(e){return a[1]==="50026"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerEncryptedBackupsUpload"),a[0]).then(function(a){return a=a,d[36]=a[0],d[37]=a[1],a})},function(a){return a=[d[36],c.i64.to_string(d[37]),void 0,void 0],d[32]=a[0],d[33]=a[1],d[34]=a[2],d[35]=a[3],a}]):c.sequence([function(e){return a[1]==="50042"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerEncryptedBackupsUploadProtobufOnly"),a[0]).then(function(a){return a=a,d[40]=a[0],d[41]=a[1],d[42]=a[2],a})},function(a){return a=[d[40],c.i64.to_string(d[41]),void 0,d[42]],d[36]=a[0],d[37]=a[1],d[38]=a[2],d[39]=a[3],a}]):c.sequence([function(e){return a[1]==="700"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerE2eeMetadataThreadIntegrityCheck"),a[0]).then(function(a){return a=a,d[44]=a[0],d[45]=a[1],d[46]=a[2],a})},function(a){return a=[d[44],c.i64.to_string(d[45]),void 0,d[46]],d[40]=a[0],d[41]=a[1],d[42]=a[2],d[43]=a[3],a}]):c.sequence([function(e){return a[1]==="705"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerE2eeMessageIntegrityCheckV2"),a[0]).then(function(a){return a=a,d[48]=a[0],d[49]=a[1],d[50]=a[2],a})},function(a){return a=[d[48],c.i64.to_string(d[49]),void 0,d[50]],d[44]=a[0],d[45]=a[1],d[46]=a[2],d[47]=a[3],a}]):c.sequence([function(e){return a[1]==="50043"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerEncryptedBackupsLoopingUpload"),a[0]).then(function(a){return a=a,d[52]=a[0],d[53]=a[1],d[54]=a[2],a})},function(a){return a=[d[52],c.i64.to_string(d[53]),void 0,d[54]],d[48]=a[0],d[49]=a[1],d[50]=a[2],d[51]=a[3],a}]):c.sequence([function(e){return a[1]==="50048"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerEncryptedBackupsOpenUpload"),a[0]).then(function(a){return a=a,d[56]=a[0],d[57]=a[1],a})},function(a){return a=[d[56],c.i64.to_string(d[57]),void 0,void 0],d[52]=a[0],d[53]=a[1],d[54]=a[2],d[55]=a[3],a}]):c.sequence([function(e){return a[1]==="160013"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerSyncThreadCapabilities"),a[0]).then(function(a){return a=a,d[60]=a[0],d[61]=a[1],d[62]=a[2],a})},function(a){return a=[d[60],c.i64.to_string(d[61]),void 0,d[62]],d[56]=a[0],d[57]=a[1],d[58]=a[2],d[59]=a[3],a}]):c.sequence([function(e){return a[1]==="903"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerDeleteChatHistory"),a[0]).then(function(a){return a=a,d[64]=a[0],d[65]=a[1],d[66]=a[2],a})},function(a){return a=[d[64],c.i64.to_string(d[65]),void 0,d[66]],d[60]=a[0],d[61]=a[1],d[62]=a[2],d[63]=a[3],a}]):c.sequence([function(e){return a[1]==="50057"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerEncryptedBackupsUploadSenderBackup"),a[0]).then(function(a){return a=a,d[68]=a[0],d[69]=a[1],d[70]=a[2],a})},function(a){return a=[d[68],c.i64.to_string(d[69]),void 0,d[70]],d[64]=a[0],d[65]=a[1],d[66]=a[2],d[67]=a[3],a}]):c.resolve((e=[a[2],a[1],void 0,void 0],d[64]=e[0],d[65]=e[1],d[66]=e[2],d[67]=e[3],e))},function(a){return a=[d[64],d[65],d[66],d[67]],d[60]=a[0],d[61]=a[1],d[62]=a[2],d[63]=a[3],a}])},function(a){return a=[d[60],d[61],d[62],d[63]],d[56]=a[0],d[57]=a[1],d[58]=a[2],d[59]=a[3],a}])},function(a){return a=[d[56],d[57],d[58],d[59]],d[52]=a[0],d[53]=a[1],d[54]=a[2],d[55]=a[3],a}])},function(a){return a=[d[52],d[53],d[54],d[55]],d[48]=a[0],d[49]=a[1],d[50]=a[2],d[51]=a[3],a}])},function(a){return a=[d[48],d[49],d[50],d[51]],d[44]=a[0],d[45]=a[1],d[46]=a[2],d[47]=a[3],a}])},function(a){return a=[d[44],d[45],d[46],d[47]],d[40]=a[0],d[41]=a[1],d[42]=a[2],d[43]=a[3],a}])},function(a){return a=[d[40],d[41],d[42],d[43]],d[36]=a[0],d[37]=a[1],d[38]=a[2],d[39]=a[3],a}])},function(a){return a=[d[36],d[37],d[38],d[39]],d[32]=a[0],d[33]=a[1],d[34]=a[2],d[35]=a[3],a}])},function(a){return a=[d[32],d[33],d[34],d[35]],d[28]=a[0],d[29]=a[1],d[30]=a[2],d[31]=a[3],a}])},function(a){return a=[d[28],d[29],d[30],d[31]],d[24]=a[0],d[25]=a[1],d[26]=a[2],d[27]=a[3],a}])},function(a){return a=[d[24],d[25],d[26],d[27]],d[20]=a[0],d[21]=a[1],d[22]=a[2],d[23]=a[3],a}])},function(a){return a=[d[20],d[21],d[22],d[23]],d[16]=a[0],d[17]=a[1],d[18]=a[2],d[19]=a[3],a}])},function(a){return a=[d[16],d[17],d[18],d[19]],d[12]=a[0],d[13]=a[1],d[14]=a[2],d[15]=a[3],a}])},function(a){return a=[d[12],d[13],d[14],d[15]],d[8]=a[0],d[9]=a[1],d[10]=a[2],d[11]=a[3],a}])},function(a){return a=[d[8],d[9],d[10],d[11]],d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3],a}])},function(e){return a[3]?c.sequence([function(a){return d[9]="60009"===d[1]||"60006"===d[1]||"60008"===d[1]||"60011"===d[1]||"765"===d[1]||"1006"===d[1]||"160009"===d[1]||"761"===d[1]||"1018"===d[1]||"632"===d[1]||"384"===d[1]||"384"===d[1],d[9]?d[1]!==void 0?(d[15]=["Deidentified task is being executed through the 'identified' path. Canceling task with label: ",d[1]].join(""),function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSCoreSerializeTaskStoredProcedure] ","",d[15]].join("")),d[14]=c.createArray(),void 0!==void 0?d[16]=(d[14].push(void 0),d[14]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSCoreSerializeTaskStoredProcedure",d[15],d[14],c.i64.cast([0,3]))):c.resolve():c.resolve()},function(a){return c.resolve(d[8]=!1)},function(a){return d[9]||d[8]?(a=[void 0,void 0,void 0,void 0],d[10]=a[0],d[11]=a[1],d[12]=a[2],d[13]=a[3],a):(a=[d[0],d[1],d[2],d[3]],d[10]=a[0],d[11]=a[1],d[12]=a[2],d[13]=a[3],a),a=[d[10],d[11],d[12],d[13]],d[4]=a[0],d[5]=a[1],d[6]=a[2],d[7]=a[3]}]):c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerUnauthenticatedTask"),a[0],d[1],d[0]).then(function(a){return a=a,d[8]=a[0],d[9]=a[1],d[10]=a[2],d[11]=a[3],a})},function(a){return c.i64.neq(d[11],void 0)?c.storedProcedure(b("LSForceTaskExecutionImmediately"),d[11]):c.resolve()},function(a){return a=[d[8],c.i64.to_string(d[9]),void 0,d[10]],d[4]=a[0],d[5]=a[1],d[6]=a[2],d[7]=a[3],a}])},function(a){return a=[d[4],d[5],d[6],d[7]],e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSCoreSerializeTaskStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSSerializeTaskStoredProcedure",["LSSerializeTask","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSSerializeTask"),e.taskId,e.taskLabel,e.taskValue,e.requiresAuthentication);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSBeginHandlingPendingTasksForQueue2",["I64","LSFactory","LSIntEnum","LSPendingTasksPluginType","LSSerializeTaskStoredProcedure","LSShape","LSVec","ReQL","XPlatReactCrypto","gkx","isNativeTask"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=500,k=3e4,l=5,m=100,n=7;async function o(a,b){a=await a.lightspeed_task_context.get(b);return a==null||a.requiresAuthentication}async function p(a,b){a=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.pending_tasks.index("queueNameTaskId")).getKeyRange(b));return a==null?{context:void 0,failureCount:(h||(h=d("I64"))).neg_one,httpUrlOverride:void 0,minTimeToSyncTimestampMs:h.neg_one,pluginType:(i||(i=d("LSIntEnum"))).ofNumber(c("LSPendingTasksPluginType").LS_BROKER),queueName:""}:a}async function q(a,b){a=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.network_requests).getKeyRange(b));return a==null?0:(h||(h=d("I64"))).to_float(a.lastSyncRequestTimestampMs)}function r(a,b,c){b=(h||(h=d("I64"))).equal(a.failureCount,(h||(h=d("I64"))).zero)||b;if(b)return 0;b=(h||(h=d("I64"))).to_float(a.failureCount)>n?(h||(h=d("I64"))).to_float(a.failureCount)-n:(h||(h=d("I64"))).to_float(a.failureCount);a=Math.min((1<<Math.min(b-1,n))*j,k);b=c+a;return Math.max(b-Date.now(),0)}function s(){var a=Array.from(d("XPlatReactCrypto").getRandomValues(new Uint32Array(2)));a[0]>>>=1;return(h||(h=d("I64"))).add(h.lsl_(h.of_float(a[0]),32),h.of_float(a[1]))}function t(){var a=(h||(h=d("I64"))).of_float(Date.now());return h.and_(h.or_(h.lsl_(a,22),h.and_(s(),h.castExn([0,4194303]))),h.castExn([2147483647,4294967295]))}async function u(a,b){var c=t(),e=await a.network_requests.get(b,(h||(h=d("I64"))).neg_one);e==null?await a.network_requests.add({epochId:c,failureCount:(h||(h=d("I64"))).zero,lastSentTimestampMs:h.zero,lastSyncRequestTimestampMs:h.of_float(Date.now()),syncDatabaseId:h.neg_one,taskQueueName:b}):await a.network_requests.put(babelHelpers.extends({},e,{epochId:c,lastSyncRequestTimestampMs:(h||(h=d("I64"))).of_float(Date.now())}));return c}async function v(a,b){return await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.network_requests).getKeyRange(b).filter(function(a){return a.epochId!=null}))!=null}function w(a,b,c){var e=(h||(h=d("I64"))).to_float(a.minTimeToSyncTimestampMs),f=Date.now();e=e-f;f=e<=0;return f?r(a,b,c):e}function x(a){return a.httpUrlOverride!=null||(h||(h=d("I64"))).to_float(a.failureCount)>n}function y(a){return a.timeoutTimestampMs!=null?(h||(h=d("I64"))).to_float(a.timeoutTimestampMs)<=Date.now():!1}function z(a){return a===90..toString()||a===130..toString()||a===153..toString()}function A(a,b,c,d,e){e=e===0?void 0:e;return{failureCount:e,label:a,payload:b,queueName:c,taskId:d}}async function B(a,b,e){a=await c("LSSerializeTaskStoredProcedure")(c("LSFactory")(a),{requiresAuthentication:e,taskId:b.taskId,taskLabel:b.context,taskValue:b.taskValue});e=a[0];var f=a[1];a[2];a=a[3];if(e==null){if(a!=null)return{minRetryDelayMs:a};return}return A(f,e,b.queueName,b.taskId,(h||(h=d("I64"))).to_float(b.failureCount))}async function C(a,b,c){if(b.context==null){await a.pending_tasks.delete(b.taskId);return}var d=y(b);if(d){await a.pending_tasks.delete(b.taskId);return}return B(a,b,c)}function D(a,b){b=b>=(c("gkx")("26373")&&a===String(207)?m:l)||z(a);return!b}async function E(a,b){var c=await a.pending_tasks.get(b.taskId);c!=null&&(h||(h=d("I64"))).equal(b.firstExecutedTimestampMs,(h||(h=d("I64"))).zero)&&await a.pending_tasks.put(babelHelpers.extends({},c,{firstExecutedTimestampMs:(h||(h=d("I64"))).of_float(Date.now())}))}async function F(a,b){if(b.length===0)return{epochId:void 0,tasks:[]};var c=[],e=b[0].httpUrlOverride,f=(await Promise.all(b.map(function(b){return o(a,b.taskId)}))).some(Boolean);for(b of b){var g=b.httpUrlOverride===e,i=await o(a,b.taskId)===f;await E(a,b);if(!g||!i)break;g=await C(a,b,f);if(g!=null&&g.payload!=null)c.push(g);else if((g==null?void 0:g.minRetryDelayMs)!=null){i=await a.pending_tasks.get(b.taskId);if(i!=null){await a.pending_tasks.put(babelHelpers.extends({},i,{failureCount:(h||(h=d("I64"))).add((i=i.failureCount)!=null?i:(h||(h=d("I64"))).zero,h.one),minTimeToSyncTimestampMs:h.add(g.minRetryDelayMs,h.of_float(Date.now()))}))}}else await a.pending_tasks.delete(b.taskId);if(!D(b.context,c.length))break}return{epochId:void 0,tasks:c}}async function G(a,b,c,d,e){e===void 0&&(e=!0);b=await F(a,b);var f=b.tasks;if(f.length===0)return{httpUrlOverride:void 0,networkPayload:void 0,nextSyncMs:void 0,queueName:c,skipRealtimeGateway:!1,workItemType:4};if(e===!0){f=await u(a,c);b.epochId=f}e=await p(a,c);return{httpUrlOverride:e.httpUrlOverride,networkPayload:b,nextSyncMs:void 0,queueName:c,skipRealtimeGateway:x(e),workItemType:d}}async function H(a,b,e){var f=await p(a,b),g=await q(a,b);f=w(f,e,g);e=f!==0;if(e)return[{httpUrlOverride:void 0,networkPayload:void 0,nextSyncMs:f,queueName:b,skipRealtimeGateway:!1,workItemType:3}];g=[];e=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.pending_tasks.index("queueNameTaskId")).getKeyRange(b));f=e.filter(c("isNativeTask"));if(f.length>0){f=await G(a,f,b,2,c("gkx")("4778")===!0);g.push(f)}f=e.filter(function(a){return!c("isNativeTask")(a)});if(f.length>0){e=await G(a,f,b,1);g.push(e)}return g}async function I(a,b,c){var d=!await v(a,b);return d?H(a,b,c):[{httpUrlOverride:void 0,networkPayload:void 0,nextSyncMs:void 0,queueName:b,skipRealtimeGateway:!1,workItemType:4}]}async function a(a,b){var e=b.ignoreSoftDelay;b=b.queueName;a=await I(a,b,e);return a.map(function(a){var b;return d("LSShape").ofRecord({network_payload:d("LSShape").ofRecord({epoch_id:(b=a.networkPayload)==null?void 0:b.epochId,tasks:c("LSVec").ofArray(((b=(b=a.networkPayload)==null?void 0:b.tasks)!=null?b:[]).map(function(a){var b;return d("LSShape").ofRecord({failure_count:a.failureCount!=null?(h||(h=d("I64"))).of_float(a.failureCount):void 0,label:(b=a.label)!=null?b:void 0,payload:a.payload,queue_name:a.queueName,task_id:a.taskId})}))}),next_sync_ms:a.nextSyncMs!=null?(h||(h=d("I64"))).of_float(a.nextSyncMs):void 0,queue_name:a.queueName,skip_realtime_gateway:a.skipRealtimeGateway,work_item_type:(i||(i=d("LSIntEnum"))).ofNumber(a.workItemType)})})}a._updateTaskIfNeeded=E;a._getHeadOfNormalQueue=p;a._lastSyncRequestTimestampForQueue=q;a._exponentialBackoffForNormalQueue=r;a._generateNewEpoch=t;a._openNewEpochForQueue=u;a._isEpochOpenForQueue=v;a._calculateDelayForNormalQueue=w;a._queueShouldSkipRealtimeGateway=x;a._isNativeTask=c("isNativeTask");a._taskIsTimedOut=y;a._taskShouldStopBatching=z;a._buildTaskPayloadExpressionForNormalTaskWithParameters=A;a._buildTaskPayloadExpressionForValidatedNormalTask=B;a._buildTaskPayloadExpressionForUnvalidatedNormalTask=C;a._workForNormalQueueWithoutDelay=G;a._workForNormalQueueWithClosedEpoch=H;a._buildWorkForNormalQueue=I;a._buildNetworkPayloadShapeForTasks=F;a._canContinueBatchingForQueue=D;g.default=a}),98);
__d("LSDataTraceFlushDeferred",["MetaConfig","Promise","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("LSDataTraceFlush").__setRef("LSDataTraceFlushDeferred");function a(a){if(!c("MetaConfig")._("62"))return(h||(h=b("Promise"))).resolve(function(){});else return i.load().then(function(b){return b.flushExpiredDataTraces(a)})}g.watchForExpiredTraces=a}),98);
__d("LSDedicatedMqttChannel",["FBMqttChannel","cr:1232"],(function(a,b,c,d,e,f,g){"use strict";function a(){b("cr:1232")!=null&&b("cr:1232").shutdownAndClear()}function d(a,d,e,f,g,h){return function(i){if(b("cr:1232")!=null)return b("cr:1232").getInstance(i,a,d,e,f,g,h);else return c("FBMqttChannel")}}g.shutdownAndClear=a;g.getInstance=d}),98);
__d("LSTruncateTableAndSetShowError",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return b.sequence([function(a){return b.forEach(b.db.table(115).fetch(),function(a){return a["delete"]()})},function(d){return c[0]=b.i64.of_float(Date.now()),b.db.table(115).add({statusId:b.i64.cast([0,0]),timestampMs:c[0],errorShouldBeShown:a[0]})}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSConnectivityTruncateTableAndSetShowErrorStoredProcedure";a.__tables__=["user_visible_network_connectivity_error"];e.exports=a}),null);
__d("LSDeleteAllAndInsertConnectivityStatus",["LSTruncateTableAndSetShowError"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return c.forEach(c.db.table(114).fetch(),function(a){return a["delete"]()})},function(b){return d[0]=c.i64.of_float(Date.now()),c.db.table(114).add({statusId:void 0,timestampMs:d[0],internetConnectionState:a[0]})},function(d){return c.storedProcedure(b("LSTruncateTableAndSetShowError"),c.i64.neq(a[0],c.i64.cast([0,1])))}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSConnectivityDeleteAllAndInsertConnectivityStatusStoredProcedure";a.__tables__=["connectivity_status"];e.exports=a}),null);
__d("LSDeleteAllAndInsertConnectivityStatusStoredProcedure",["LSDeleteAllAndInsertConnectivityStatus","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSDeleteAllAndInsertConnectivityStatus"),e.internetConnectionState);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSHandleTaskSuccessOpsDownloadFailureForQueue",["I64","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(a,b){var c=await a.network_requests.get(b,(h||(h=d("I64"))).neg_one);c!=null&&c.epochId!=null&&await a.network_requests.delete(b,(h||(h=d("I64"))).neg_one);c=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.pending_tasks.index("queueNameTaskId")).getKeyRange(b));c!=null&&await a.pending_tasks.delete(c.taskId)}g.default=a}),98);
__d("LSPlatformRequestId",[],(function(a,b,c,d,e,f){"use strict";var g=4;function a(){var a=g;g+=1;return a}b={generate:a};f["default"]=b}),66);
__d("LSPlatformRequestScheduler",["clearTimeout","justknobx","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h=Math.pow(2,31)-1;a=function(){function a(){this.requests=new Map()}var b=a.prototype;b.schedule=function(a,b,d){var e=this.requests.get(b);e!=null&&c("clearTimeout")(e);e=c("justknobx")._("4435")?Math.min(d,h):d;this.requests.set(b,c("setTimeout")(a,e))};b.cleanup=function(){this.requests.forEach(function(a){return c("clearTimeout")(a)})};return a}();g["default"]=a}),98);
__d("LSPlatformServerResponseHandler",["FBLogger","clearTimeout","nullthrows","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h="executeFirstBlockForSyncTransaction";a=function(){function a(a){this.eval=a,this.currentlyRunning=new Map()}var b=a.prototype;b.evalWhenReady=async function(a,b){var d;try{await a,d=c("setTimeout")(function(){c("FBLogger")("messenger_web").mustfix("waited longer than 30 seconds to eval sync script")},3e4),await this.eval(b)}finally{c("clearTimeout")(d)}};b.$1=function(a){var b=this.currentlyRunning.get(a);b==null&&(b=Promise.resolve(),this.currentlyRunning.set(a,b));return b};a.getSyncScriptType=function(a){var b;if(!((b=a.sp)!=null&&b.includes(h)))return{status:"non-transactional"};b=function(){try{var b;return(b=JSON.parse(a.syncScript))==null?void 0:b.step}catch(a){return null}}();if(!Array.isArray(b)){c("FBLogger")("messenger_web").warn("Sync payload appears invalid.");return{status:"non-transactional"}}b=[b];while(b.length){var d=c("nullthrows")(b.shift());for(d of d)if(Array.isArray(d)){if(d[0]===5&&d[1]===h&&Array.isArray(d[2]))return{status:"transactional",syncGroup:parseInt(d[2][1],10)};b.push(d)}}return{status:"err"}};b.maybeEvalInOrderReceived=function(b,d){var e,f=this,g=a.getSyncScriptType(d),h=0;switch(g.status){case"err":c("FBLogger")("messenger_web").warn("Sync script sync group parsing failed: employed sprocs were %s",JSON.stringify((e=d.sp)!=null?e:void 0));break;case"non-transactional":return this.evalWhenReady(b,d);case"transactional":h=g.syncGroup;break}e=this.$1(h);g=e.then(function(){return f.evalWhenReady(b,babelHelpers.extends({},d,{priority:"sync_script"}))}).catch(function(a){f.currentlyRunning.delete(h);throw a});this.currentlyRunning.set(h,g);return g};return a}();g.default=a}),98);
__d("LSPlatformTaskSyncGroupId",[],(function(a,b,c,d,e,f){"use strict";a=-1;b=a;f["default"]=b}),66);
__d("MWPBeginHandlingPendingTasksForQueue",["LSBeginHandlingFireForgetTasksForQueueStoredProcedure","LSBeginHandlingPendingTasksForQueue2","LSFactory"],(function(a,b,c,d,e,f,g){"use strict";async function a(a,b){var d=b.fireAndForgetTask,e=b.ignoreSoftDelay,g=b.queueName;b=await a.runInTransaction(async function(a){if(d===!0){var b=await c("LSBeginHandlingFireForgetTasksForQueueStoredProcedure")(c("LSFactory")(a),{queueName:g});b=b[0];return[b]}return c("LSBeginHandlingPendingTasksForQueue2")(a,{ignoreSoftDelay:e,queueName:g})},"readwrite",void 0,void 0,f.id+":37");return b}g.default=a}),98);
__d("MWPlatformTaskUtils",["FBLogger","I64","JSScheduler","MetaConfig","ReQL","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b){async function e(){try{await a(b)}catch(a){c("FBLogger")("messenger_web").catching(a).warn("Failed to calculate work for task queue %s",b.queueName)}}if((i||(i=d("I64"))).gt(b.priority,(i||(i=d("I64"))).zero)&&c("MetaConfig")._("78")){var f=function(){e()};(h||(h=c("JSScheduler"))).scheduleLoggingPriCallback(f)}else c("promiseDone")(e())}async function k(a,b){try{await a(b)}catch(a){c("FBLogger")("messenger_web").catching(a).warn("Failed to calculate work for fire forget queue %s",b.queueName)}}function a(a,b){var c=new Set(),e=[],f=[];f.push(a.tables.pending_tasks.index("queueNameTaskId").subscribe(function(a,b){var f;if(b.operation==="delete"){c.add(a[0]);return}a=b.operation==="put"&&b.prevValue==null||b.operation==="add";f=b.operation==="put"&&(i||(i=d("I64"))).compare(b.value.failureCount,(f=(f=b.prevValue)==null?void 0:f.failureCount)!=null?f:(i||(i=d("I64"))).zero)>0;(a||f)&&c.add(b.value.queueName);(b.operation==="add"&&b.value.dataTraceId==null||b.value.dataTraceId==="")&&e.push(b.value)}));f.push(a.tables.network_requests.subscribe(function(a,b){a=a[0];if(a==="")return;b.operation==="delete"?c.add(a):b.value.epochId==null&&c.add(a)}));f.push(a.subscribeToCommit(function(){var f=Array.from(c);c.clear();e=[];f.forEach(async function(c){c=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.pending_tasks.index("queueNameTaskId")).bounds({gte:[c]}));c!=null&&j(b,c)})}));return f}function b(a,b){c("promiseDone")(async function(){var c=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.pending_tasks)),e=new Set();for(c of c){if(e.has(c.queueName))continue;e.add(c.queueName);j(b,c)}}())}function l(a,b){c("promiseDone")(async function(){var e=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.pending_fire_and_forget_tasks));await Promise.all(e.map(function(a){return k(b,a)}));c("promiseDone")(a.runInTransaction(function(a){return Promise.all(e.map(function(b){return a.pending_fire_and_forget_tasks.delete(b.taskId)}))},"readwrite","background",void 0,f.id+":196"))}())}function e(a,b){var c=!1,d=[];d.push(a.tables.pending_fire_and_forget_tasks.subscribe(function(a,b){if(b.operation==="delete")return;a=b.operation==="put"&&b.prevValue==null||b.operation==="add";a&&(c=!0)}));d.push(a.subscribeToCommit(function(){c&&l(a,b),c=!1}));return d}g.checkQueuesWhenPendingTaskTableUpdates=a;g.checkAllPendingTasksForWork=b;g.checkAllFireForgetTasksForWork=l;g.checkQueuesWhenPendingFireForgetTaskTableUpdates=e}),98);
__d("LSPlatformTaskSystemTransport",["CurrentMessengerUser","FBLogger","I64","JSResourceForInteraction","JSScheduler","LSDatabaseProviderType","LSHandleTaskSendFailureForQueue2","LSHandleTaskSendSuccessForQueue2","LSHandleTaskSuccessOpsDownloadFailureForQueue","LSIntEnum","LSJson","LSMailboxInitialSyncCursor","LSPlatformRealtimeTransport","LSPlatformRequestId","LSPlatformRequestScheduler","LSPlatformServerResponseHandler","LSPlatformTaskSyncGroupId","LSShape","LSVec","MWPBeginHandlingPendingTasksForQueue","MWPBumpEntityKey","MWPlatformTaskUtils","ReQL","cr:4031","cr:6668","gkx","promiseDone","qex"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=500,l=c("JSResourceForInteraction")("publishLSPlatformDeidentifiedPayload").__setRef("LSPlatformTaskSystemTransport"),m=new Set([632,765,60011,1006,1018].map(function(a){return a.toString()}));a=function(){function a(a,b,e,f){var g=this;this.key="ls";this.$8=!1;this.$19=async function(a,b){b=await c("MWPBeginHandlingPendingTasksForQueue")(g.$1,{ignoreSoftDelay:b,queueName:a});for(a of b)await g.$18(d("LSShape").toRecord(a))};this.$1=a;this.$2=b;this.$3=e;this.$4=f;this.$8=d("LSDatabaseProviderType").isProviderPersisted(a);this.$5=new(c("LSPlatformRequestScheduler"))();this.$6=new(c("LSPlatformServerResponseHandler"))(e);this.$7=this.$9();this.$10()}var e=a.prototype;e.$11=async function(a,b){var d=a.filter(function(a){return a.label!=null&&m.has(a.label)});if(d.length<a.length){d.length>0&&c("FBLogger")("maw_ohai").mustfix("Deidentifed tasks label %s sent together with normal tasks",d[0].label);a=await this.$2.publish(b);return a}a=d[0];d=await l.load();d=await d(babelHelpers.extends({},b,{taskLabel:a.label}));return d};e.$12=async function(a){await this.$1.runInTransaction(function(b){return c("LSHandleTaskSendFailureForQueue2")(b,a)},"readwrite",void 0,void 0,f.id+":151")};e.$13=async function(a){await this.$1.runInTransaction(function(b){return c("LSHandleTaskSendSuccessForQueue2")(b,a)},"readwrite","background",void 0,f.id+":160")};e.$14=async function(a){await this.$1.runInTransaction(function(b){return c("LSHandleTaskSuccessOpsDownloadFailureForQueue")(b,a)},"readwrite",void 0,void 0,f.id+":168")};e.$15=async function(a){a=c("LSVec").toArray(a.tasks).slice(0).map(function(a){return d("LSShape").toRecord(a)});a=a[0];if(a==null)return;a=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(this.$1.tables.pending_tasks).getKeyRange(a.task_id));return a==null?void 0:a.dataTraceId};e.$16=async function(a,e){var f=this;if(a.network_payload==null)return;var g=d("LSShape").toRecord(a.network_payload);(j||(j=c("JSScheduler"))).scheduleLoggingPriCallback(function(){return g&&(b("cr:6668")==null?void 0:b("cr:6668").recordTaskSending(g.tasks))});var i=this.$4;try{await Promise.all(c("LSVec").toArray(g.tasks).map(function(a){return d("LSShape").toRecord(a)}).map(function(b){var g=c("LSPlatformRequestId").generate();return f.$11([b],{databaseType:c("LSPlatformTaskSyncGroupId"),payload:d("LSJson").stringify(d("LSShape").ofRecord({label:b.label,payload:b.payload,version:i})),queueName:a.queue_name,requestId:g,syncChannel:d("LSMailboxInitialSyncCursor").taskChannel,type_:(h||(h=d("I64"))).of_int32(e)})}))}catch(a){}};e.$17=async function(a,e){if(a.network_payload==null)return;var f=d("LSShape").toRecord(a.network_payload),g=c("LSVec").toArray(f.tasks).map(function(a){return d("LSShape").toRecord(a)}),k=await this.$15(f);(j||(j=c("JSScheduler"))).scheduleLoggingPriCallback(function(){return f&&(b("cr:6668")==null?void 0:b("cr:6668").recordTaskSending(f.tasks))});var l=c("LSPlatformRequestId").generate(),m,n=c("qex")._("2071");if(n!=null&&n!=="default"){var o=n+"."+(i||(i=d("LSIntEnum"))).toNumber(d("LSMailboxInitialSyncCursor").taskChannel)+"."+e.toString();d("MWPBumpEntityKey").bumpEntityKeyWithAppId("messenger.lightspeed",o)}try{m=await this.$11(g,{databaseType:c("LSPlatformTaskSyncGroupId"),payload:d("LSJson").stringify(d("LSShape").ofRecord(babelHelpers.extends({},f,{version_id:this.$4},k==null?{}:{data_trace_id:k}))),queueName:a.queue_name,requestId:l,syncChannel:d("LSMailboxInitialSyncCursor").taskChannel,type_:(h||(h=d("I64"))).of_int32(e)})}catch(b){if(n!=null&&n!=="default"){o=n+"."+(i||(i=d("LSIntEnum"))).toNumber(d("LSMailboxInitialSyncCursor").taskChannel)+"."+e.toString();d("MWPBumpEntityKey").bumpEntityKeyWithAppId("messenger.lightspeed",o+".exception");b.RE_EXN_ID===d("LSPlatformRealtimeTransport").Timeout?d("MWPBumpEntityKey").bumpEntityKeyWithAppId("messenger.lightspeed",o+".exception.timeout"):b.RE_EXN_ID===d("LSPlatformRealtimeTransport").NotConnected&&d("MWPBumpEntityKey").bumpEntityKeyWithAppId("messenger.lightspeed",o+".exception.notconnected")}b.RE_EXN_ID===d("LSPlatformRealtimeTransport").Timeout?d("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_tasks","send_fail_timeout"):b.RE_EXN_ID===d("LSPlatformRealtimeTransport").NotConnected?(d("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_tasks","send_fail_notconnected"),c("FBLogger")("messenger_web").warn("Publishing a task to the server not connected")):(d("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_tasks","send_fail_generic"),c("FBLogger")("messenger_web").warn("Error while publishing a task for request: %s, error %s",e,JSON.stringify(b)));await this.$12(a.queue_name)}if(m!=null&&m.type==="taskresponse")try{k=m.downloadTask;var p=m.payload;l={experiments:p.ex,sp:p.sp,syncScript:p.payload,target:p.target,taskNames:g.map(function(a){return a.label}).filter(Boolean)};this.$8||c("gkx")("10470")?await this.$6.evalWhenReady(k,l):await this.$3(l);await this.$13(a.queue_name);(j||(j=c("JSScheduler"))).scheduleLoggingPriCallback(function(){return f&&(b("cr:6668")==null?void 0:b("cr:6668").recordTaskSent(f.tasks,p.payload))})}catch(b){d("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_tasks","handle_task_failure"),c("FBLogger")("messenger_web").catching(b).mustfix("Encountered an error while processing a task response via realtime transport"),(b==null?void 0:b.name)==="dynamic_sproc_loading_timeout"&&c("gkx")("14417")?await this.$14(a.queue_name):await this.$12(a.queue_name)}};e.decideWhatToDoWithTask=async function(a,b,e,f){var g=this,h=await c("MWPBeginHandlingPendingTasksForQueue")(a,{fireAndForgetTask:f,ignoreSoftDelay:!1,queueName:b,transportKey:e});c("promiseDone")(async function(){for(var a of h)await g.$18(d("LSShape").toRecord(a))}())};e.$18=async function(a){var e=this.$5,f=this.$19;function g(a,b){e.schedule(function(){c("promiseDone")(f(a,!1))},a,b!=null?(h||(h=d("I64"))).to_float(b):k)}var i=(h||(h=d("I64"))).to_int32(a.work_item_type);switch(i){case 1:await this.$17(a,3);break;case 5:await this.$16(a,4);break;case 3:g(a.queue_name,a.next_sync_ms);break;case 2:await b("cr:4031").handleLSWork(this.$1,a,d("CurrentMessengerUser").getAccountID());break;case 4:break;default:c("FBLogger")("messenger_web").warn("Unknown Task type of %s",i)}};e.$9=function(){var a=this,b=this.$1;return this.$2.onReconnect(function(e){if(d("LSMailboxInitialSyncCursor").isWebApp&&3===e&&c("qex")._("2082")===!0)return;c("promiseDone")(b.runInTransaction(async function(a){var b=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.network_requests).bounds({gte:d("ReQL").key("")}));await Promise.all(b.map(function(b){b=b.taskQueueName;return c("LSHandleTaskSendFailureForQueue2")(a,b)}))},"readwrite",void 0,void 0,f.id+":488"));a.$10()})};e.$10=function(){var a=this;d("MWPlatformTaskUtils").checkAllPendingTasksForWork(this.$1,function(b){b=b.queueName;return a.decideWhatToDoWithTask(a.$1,b)})};e.cleanup=function(){this.$7()};return a}();g.default=a}),98);
__d("MWPlatformTaskSystem",["LSPlatformRequestScheduler","MWPlatformTaskUtils"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b){var e=this;this.$1=a;this.$2=b;this.$3=new(c("LSPlatformRequestScheduler"))();this.$4=d("MWPlatformTaskUtils").checkQueuesWhenPendingTaskTableUpdates(a,function(b){var c=b.queueName;b=b.transportKey;return e.$6(a,c,b,!1)});this.$5=d("MWPlatformTaskUtils").checkQueuesWhenPendingFireForgetTaskTableUpdates(a,function(b){var c=b.queueName;b=b.transportKey;return e.$6(a,c,b,!0)});this.$7()}var b=a.prototype;b.$6=async function(a,b,c,d){await this.$2.decideWhatToDoWithTask(a,b,c,d)};b.$7=function(){var a=this;d("MWPlatformTaskUtils").checkAllPendingTasksForWork(this.$1,function(b){b=b.queueName;return a.$6(a.$1,b)})};b.cleanup=function(){this.$4.forEach(function(a){return a()}),this.$5.forEach(function(a){return a()}),this.$2.cleanup()};return a}();g.default=a}),98);/*FB_PKG_DELIM*/
__d("ArmadilloSignatures",["WASignalKeys","WASignalOther","WASignalSignatures","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c,e=(c=d("WASignalOther")).ensureSize(d("XPlatReactCrypto").getRandomValues(new Uint8Array(64)),64);return d("WASignalSignatures").makeSignature(d("WASignalKeys").makeKeyPairFromArrayBuffers(c.toBuffer(c.makeBytes(32)),c.toBuffer(a)),b,e)}function b(a,b,c){return d("WASignalSignatures").verifyMsgSignalVariant(d("WASignalSignatures").convertPublicKeyToSerializedPubKey(b),c,a)}g.armadilloSign=a;g.validateArmadilloSignature=b}),98);
__d("ArrayBuffer",["UInt8Array"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a.map(function(a){return new Uint8Array(a)});return d("UInt8Array").concatBytes(a).buffer}g.mergeBuffers=a}),98);
__d("CreateEncryptionKeyPair",["CryptoLogger","Promise","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("X25519").__setRef("CreateEncryptionKeyPair");function a(){return i.load().then(function(a){a=a.generateKeys(a.KeyPurpose.Encryption);return(h||(h=b("Promise"))).resolve([a.sk.buffer,a.pk.buffer])})["catch"](function(a){var b=d("CryptoLogger").CryptoLogger("create_encryption_key_pair");d("CryptoLogger").captureError(b,a).mustfix("failed to generate an encryption key pair");throw a})}g["default"]=a}),98);
__d("EBBatchRequestResignCdnUrlQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="25466358572966617"}),null);
__d("EBBatchRequestResignCdnUrlQuery.graphql",["EBBatchRequestResignCdnUrlQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"request"},{defaultValue:null,kind:"LocalArgument",name:"source"}],c=[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"MessengerDefaultEncryptedBackup",kind:"LinkedField",name:"messenger_default_encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:[{kind:"Variable",name:"payloads",variableName:"request"},{kind:"Variable",name:"source",variableName:"source"}],concreteType:"XFBResignCdnUrlResponse",kind:"LinkedField",name:"batch_resigned_attachment_cdn_url",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"instance_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"path",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"exception_message",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"EBBatchRequestResignCdnUrlQuery",selections:c,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"EBBatchRequestResignCdnUrlQuery",selections:c},params:{id:b("EBBatchRequestResignCdnUrlQuery_facebookRelayOperation"),metadata:{},name:"EBBatchRequestResignCdnUrlQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("EBBatchRequestResignCdnUrl",["EBBatchRequestResignCdnUrlQuery.graphql","EBEnqueueResignCdnUrlRequests","FBLogger","WADirectPath","WAErrorMessage","WAMediaUtils","WAResultOrError","createWorkerQuery"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r=function(){return c("FBLogger")("wmi").tags(["labyrinth_web","resign_cdn_url"])};async function a(a,b){var c=d("EBEnqueueResignCdnUrlRequests").getGqlRestoredCdnUrlMap();c=c.entries().filter(function(a){a[0];a=a[1];return!a.pending}).toArray();if(c.length<1)return;var e=c.map(function(a){return{instance_key:a[0],payload:a[1].payload}});c.forEach(function(a){var b=a[0];a=a[1];d("EBEnqueueResignCdnUrlRequests").setGqlRestoredCdnUrlMap(b,{payload:a.payload,pending:!0,resolvable:a.resolvable})});await s(a,e,b)}async function s(a,b,e){if(b.length<1)return;var f=d("EBEnqueueResignCdnUrlRequests").getGqlRestoredCdnUrlMap();a==null||a.addPoint("resign_cdn_url_query_start");try{var g,h;e=await c("createWorkerQuery")(t,{request:b.map(function(a){return{instance_key:a.instance_key,payload:a.payload.payload}}),source:e});a==null||a.addPoint("resign_cdn_url_query_end");e=e==null||(g=e.viewer)==null||(g=g.messenger_default_encrypted_backup)==null||(g=g.mailbox)==null?void 0:g.batch_resigned_attachment_cdn_url;r().DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Received "," requests"])),e==null?void 0:e.length);a==null||a.addAnnotations({int:{resign_cdn_url_gql_batch_size:(h=e==null?void 0:e.length)!=null?h:0}});e==null||e.forEach(function(a){var b=a.instance_key!=null?d("WAMediaUtils").stringToDeliveryObjectId(a.instance_key):null,c=a.path;if(b!=null){var e=d("WADirectPath").validateDirectPath(c);e.success||r().WARN(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url with EBLS GraphQL failed: ",", graphql error: ",""])),e.error,a.exception_message);a=(a=f.get(b))==null?void 0:a.resolvable;a!=null?a.resolve(e):r().MUSTFIX(k||(k=babelHelpers.taggedTemplateLiteralLoose(["No resolvable found for instance key: ",""])),b);f.delete(b)}else r().MUSTFIX(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url came back with no instance key, ",""])),c)})}catch(c){h=d("WAErrorMessage").maybeGetMessageFromError(c);a==null||a.addPoint("resign_cdn_url_query_fail");a==null||a.addAnnotations({string:{resign_cdn_url_gql_error:h}});r().WARN(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url with EBLS GraphQL failed: ",""])),h);b.forEach(function(a){var b;b=(b=f.get(d("WAMediaUtils").stringToDeliveryObjectId(a.instance_key)))==null?void 0:b.resolvable;b!=null?b.resolve(d("WAResultOrError").makeError("resign-cdn-url-gql-error")):r().MUSTFIX(n||(n=babelHelpers.taggedTemplateLiteralLoose(["No resolvable found during error for instance key: ",""])),a.instance_key)})}finally{b.forEach(function(a){var b=d("WAMediaUtils").stringToDeliveryObjectId(a.instance_key);b=(b=f.get(b))==null?void 0:b.resolvable;(b==null?void 0:b.isSettled)===!1&&r().MUSTFIX(o||(o=babelHelpers.taggedTemplateLiteralLoose(["Resolvable was not properly settled"])));f.delete(d("WAMediaUtils").stringToDeliveryObjectId(a.instance_key))})}}async function e(a,b,e,f){a==null||a.addPoint("resign_cdn_url_query_start");try{var g;b=await c("createWorkerQuery")(t,{request:[{instance_key:b,payload:e.payload}],source:f});a==null||a.addPoint("resign_cdn_url_query_end");e=b==null||(g=b.viewer)==null||(g=g.messenger_default_encrypted_backup)==null||(g=g.mailbox)==null?void 0:g.batch_resigned_attachment_cdn_url;(e==null?void 0:e.length)!==1&&(a==null||a.addPoint("resign_cdn_url_should_have_one_response"));f=e==null?void 0:e[0];b=f==null?void 0:f.path;e=d("WADirectPath").validateDirectPath(b);e.success||r().WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url with EBLS GraphQL failed: ",", graphql error: ",""])),e.error,f==null?void 0:f.exception_message);return e}catch(c){b=d("WAErrorMessage").maybeGetMessageFromError(c);a==null||a.addPoint("resign_cdn_url_query_fail");a==null||a.addAnnotations({string:{resign_cdn_url_gql_error:b}});r().WARN(q||(q=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url with EBLS GraphQL failed: ",""])),b);return d("WAResultOrError").makeError("resign-cdn-url-gql-error")}}var t=h!==void 0?h:h=b("EBBatchRequestResignCdnUrlQuery.graphql");g.batchedResignCdnUrlFromMap=a;g.batchedResignCdnUrlWithGraphQL=s;g.resignCdnUrlWithGraphQL=e}),98);
__d("EBEnqueueResignCdnUrlRequests",["EBBatchRequestResignCdnUrl","WACustomError","WAPromiseDelays","WAPromiseTimeout","WAResolvable","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h=function(){var a=!0;return{get:function(){return a},set:function(b){a=b}}}(),i=function(){var a=window.performance.now();return{get:function(){return a},set:function(b){a=b}}}(),j=new Map(),k=c("justknobx")._("4662"),l=c("justknobx")._("3244");function a(a,b,c,e){var f;f=(f=j.get(a))==null?void 0:f.resolvable;if(f!=null){e==null||e.addPoint("resign_cdn_url_map_hit");return m({mediaDownloadFlow:e,objectId:a,payload:b,promise:f.promise,source:c})}f=new(d("WAResolvable").Resolvable)();var g=j.size===0;j.set(a,{payload:b,pending:!1,resolvable:f});if(!h.get())return m({mediaDownloadFlow:e,objectId:a,payload:b,promise:f.promise,source:c});void n(g,e,c);return m({mediaDownloadFlow:e,objectId:a,payload:b,promise:f.promise,source:c})}function m(a){var b=a.mediaDownloadFlow,c=a.objectId,e=a.payload,f=a.promise,g=a.source;return d("WAPromiseTimeout").promiseTimeout(f,l).then(function(a){if(!a.success&&a.error==="direct-path-undefined"){j["delete"](c);return d("WAPromiseDelays").delayMs(l).then(function(){return d("EBBatchRequestResignCdnUrl").resignCdnUrlWithGraphQL(b,c,e,g)})}return a})["catch"](function(a){var f=a instanceof Error&&["NetworkTransportError","NetworkTimeoutError","NetworkRequestError"].includes(a.name);if(a instanceof d("WACustomError").TimeoutError||f){b==null||b.addPoint("resign-cdn-url-gql-timeout");j["delete"](c);return d("EBBatchRequestResignCdnUrl").resignCdnUrlWithGraphQL(b,c,e,g)}else{b==null||b.addPoint("resign-cdn-url-gql-unexpected-error");b==null||b.addAnnotations({string:{resign_cdn_url_payload_fail_reason:a.message}});throw a}})}function n(a,b,c){h.set(!1);if(a){h.set(!0);i.set(window.performance.now());return d("EBBatchRequestResignCdnUrl").batchedResignCdnUrlFromMap(b,c)}else{a=Math.max(k-(window.performance.now()-i.get()),0);return d("WAPromiseDelays").delayMs(a).then(function(){h.set(!0);i.set(window.performance.now());return d("EBBatchRequestResignCdnUrl").batchedResignCdnUrlFromMap(b,c)})}}function b(){return j}function e(a,b){j.set(a,b)}g.enqueueResignCdnUrl=a;g.getGqlRestoredCdnUrlMap=b;g.setGqlRestoredCdnUrlMap=e}),98);
__d("EBCreateResignCDNUrlPayload",["CreateDerivedKeys","EBBase64Encode","EBWorkerEBDBApi","GetBlobFromInt64BE","Hmac_v2","I64","LSVec","OcmfClientMap","OpeEncrypt","TruncateSortKey","WAArrayBufferUtils"],(function(a,b,c,d,e,f,g){"use strict";var h,i="thread_ope_key",j="__DEVICE_ID_PLACEHOLDER__";async function a(a){var b=a.accessTokenSecret,c=a.deliveryObjectId,d=a.mediaType,e=a.messageId,f=a.primaryKeySecret,g=a.productType,h=a.sort;h=h===void 0?!1:h;var i=a.sortOrderMs;a=a.threadId;b=await k({accessTokenSecret:b,deliveryObjectId:c,mediaType:d,messageId:e,primaryKeySecret:f,productType:g,sortOrderMs:i,threadId:a});if(b==null)return null;c=b.device_id;d=babelHelpers.extends({},b,{device_id:j});e=h?JSON.stringify(d,Object.keys(d).sort()):JSON.stringify(d);return e.replace('"'+j+'"',String(c))}async function k(a){var b=a.accessTokenSecret,e=a.deliveryObjectId,f=a.mediaType,g=a.messageId,h=a.primaryKeySecret,i=a.productType,j=a.sortOrderMs;a=a.threadId;var k=await d("EBWorkerEBDBApi").getSecureEBClientState(),n=String(k.backupId),o=k.deviceId;if(o==null)return null;var p=c("EBBase64Encode")(k.mailboxRootKeyBlob),q=c("EBBase64Encode")(k.ocmfClientStateBlob);k=await Promise.all([l("attachment_key_scope",JSON.stringify([n,e]),k.ocmfClientStateBlob),l("mailbox_id_scope",n,k.ocmfClientStateBlob),l("message_id_scope",g,k.ocmfClientStateBlob),l("attachment_token_salt_scope",g,k.ocmfClientStateBlob),l("attachment_key_salt_scope",JSON.stringify([n,e]),k.ocmfClientStateBlob),l("attachment_token_salt_scope",JSON.stringify([g,e]),k.ocmfClientStateBlob),l("thread_id_scope",a,k.ocmfClientStateBlob),m(k.mailboxRootKeyBlob,j,a)]);var r=k[0],s=k[1],t=k[2],u=k[3],v=k[4],w=k[5],x=k[6];k=k[7];return k==null?null:{access_token_secret:b,attachment_index_key:c("EBBase64Encode")(r),backup_ent_fbid:-8,backup_id:n,delivery_object_id:e,device_id:o,isOpenEB:0,mailbox_partial_id:c("EBBase64Encode")(s),media_type:f,message_partial_id:c("EBBase64Encode")(t),primary_key_secret:h,product_type:i,raw_identifiers:{otid:g,server_thread_key:null,timestamp:j.toString()},raw_tokens:{mailbox_root_key:p,ocmf_client_state_blob:q},salt_partial_access_token:c("EBBase64Encode")(w),salt_partial_attachment_index_key:c("EBBase64Encode")(v),salt_partial_id:c("EBBase64Encode")(u),sort_key:k,thread_id:a,thread_partial_id:c("EBBase64Encode")(x)}}function l(a,b,e){return c("Hmac_v2")(d("WAArrayBufferUtils").stringToArrayBuffer(a),d("WAArrayBufferUtils").stringToArrayBuffer(b)).then(function(a){return c("OcmfClientMap")(e,a[0])})}async function m(a,b,e){e=new TextEncoder().encode(i+"_"+e).buffer;e=(await d("CreateDerivedKeys").CreateDerivedKeys(e,void 0,a,[(h||(h=d("I64"))).of_int32(32)]))[0];if(e==null)return null;a=await d("GetBlobFromInt64BE").GetBlobFromInt64BE(h.of_float(b));b=await d("TruncateSortKey").TruncateSortKey(a[0]);a=await d("OpeEncrypt").OpeEncrypt(c("LSVec").toArray(e)[0],b[0],h.of_int32(16));e=Array.from(new Uint8Array(a[0]));b=e.map(function(a){return a.toString(16).padStart(2,"0")});return b.join("").toUpperCase()}g.createStringifiedMediaRestorePayloadFromEBDB=a}),98);
__d("EBGetLatestChatJids",["I64","MAWBridgeSafeActionsWorkerAndUI","ReQL","WAResultOrError","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";var h,i=1e3;async function a(a,b){b===void 0&&(b=i);try{a=j(a,b);return d("WAResultOrError").makeResult(await a)}catch(a){return d("WAResultOrError").makeError(c("getErrorSafe")(a))}}async function j(a,b){b===void 0&&(b=i);b=await Promise.all([d("MAWBridgeSafeActionsWorkerAndUI").sendAndReceiveBackendWorkerAndUIShared("getLatestChatJids",{count:b}),await a.runInTransaction(function(a){return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.mi_act_mapping_table).map(function(a){a=a.jid;return(h||(h=d("I64"))).to_string(a)}))},"readonly",void 0,void 0,f.id+":54")]);a=b[0];b=b[1];var c=[];if(b.length>0){var e=new Set(b);a.forEach(function(a){var b=a.split("@")[0];e.has(b)&&c.push(a)})}return c}g.getLatestChatJids=a}),98);
__d("EBMinosWasmDeriveAttachmentTokenPrimaryKey",["EBMinosWasmDeriveAttachmentAccessTokenSecret","EBMinosWasmDeriveAttachmentPrimaryKeySecret","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";async function a(a){var b=await d("EBMinosWasmDeriveAttachmentPrimaryKeySecret").deriveAttachmentPrimaryKeySecret({mediaKey:a});if(!b.success)return d("WAResultOrError").makeError("derive-primary-key-secret-error");a=await d("EBMinosWasmDeriveAttachmentAccessTokenSecret").deriveAttachmentAccessTokenSecret({mediaKey:a});return!a.success?d("WAResultOrError").makeError("derive-access-token-secret-error"):d("WAResultOrError").makeResult({accessToken:a.value,primaryKey:b.value})}g.deriveAttachmentTokenPrimaryKeySecret=a}),98);
__d("LSFindBackup",["LSArrayGetObjectAt","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(a){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsFindBackupStoredProcedure] Beginning execution."),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,e){var f=a.done;a=a.value;return f?(f=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,20]),void 0,void 0],d[1]=f[0],d[2]=f[1],d[3]=f[2],d[4]=f[3],d[5]=f[4],d[6]=f[5],d[7]=f[6],d[8]=f[7],d[9]=f[8],d[10]=f[9],d[11]=f[10],d[12]=f[11],d[13]=f[12],d[14]=f[13],d[15]=f[14],d[16]=f[15],d[17]=f[16],d[18]=f[17],f):(e=a.item,c.sequence([function(a){return d[32]=e.backupTenancy,d[31]=e.encryptionVersion,d[27]=void 0,c.i64.neq(d[27],void 0)?c.resolve(d[28]=d[27]):c.sequence([function(a){return d[33]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[34]=a[0],a})},function(a){return d[34]?d[43]=(d[33].push(c.i64.cast([0,0])),d[33]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[35]=a[0],a})},function(a){return d[35]?d[43]=(d[33].push(c.i64.cast([0,2])),d[33]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[36]=a[0],a})},function(a){return d[36]?d[43]=(d[33].push(c.i64.cast([0,3])),d[33]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[37]=a[0],a})},function(a){return d[37]?d[43]=(d[33].push(c.i64.cast([0,4])),d[33]):0,d[38]=c.createArray(),d[39]=c.i64.of_int32(d[33].length),c.i64.gt(d[39],c.i64.cast([0,0]))?c.loopAsync(d[39],function(a){return d[43]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[33],d[43]).then(function(a){return a=a,d[44]=a[0],d[45]=a[1],a})},function(a){return d[46]=(d[38].push(d[44]),d[38])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[43]=c.createArray(),d[44]=c.i64.of_int32(d[38].length),c.i64.gt(d[44],c.i64.cast([0,0]))?c.loopAsync(d[44],function(a){return d[46]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[38],d[46]).then(function(a){return a=a,d[47]=a[0],d[48]=a[1],a})},function(a){return d[49]=(d[43].push(c.i64.to_string(d[47])),d[43])}])}):c.resolve()},function(a){return d[45]=d[43].join(","),d[40]=d[45]}])},function(a){return d[38].some(function(a){return c.i64.eq(d[31],a)})?d[41]=d[31]:d[41]=void 0,c.i64.neq(d[41],void 0)?d[42]=d[41]:d[42]=void 0,d[28]=d[42]}])},function(a){return c.i64.neq(d[28],void 0)?d[29]=d[28]:d[29]=c.i64.cast([0,0]),c.i64.neq(d[32],void 0)?d[30]=d[32]:d[30]=c.i64.cast([0,1]),a=[e.backupId,e.deviceId,e.mailboxRootKeyBlob,e.ocmfClientStateBlob,void 0,void 0,d[29],d[30],e.epochAuthPublicKeyBlob,e.epochAuthPrivateKeyBlob,e.devicePublicKeyBlob,e.devicePrivateKeyBlob,e.epochStoragePublicKeyBlob,e.epochStoragePrivateKeyBlob,e.obliviousValidationTokenBlob,e.authorityLevel,void 0,void 0],d[1]=a[0],d[2]=a[1],d[3]=a[2],d[4]=a[3],d[5]=a[4],d[6]=a[5],d[7]=a[6],d[8]=a[7],d[9]=a[8],d[10]=a[9],d[11]=a[10],d[12]=a[11],d[13]=a[12],d[14]=a[13],d[15]=a[14],d[16]=a[15],d[17]=a[16],d[18]=a[17]}]))})},function(a){return c.i64.neq(d[1],void 0)?d[20]=c.i64.to_string(d[1]):d[20]=void 0,d[21]=c.i64.of_float(Date.now()),d[22]=c.i64.random(),d[24]="Finishing execution. Execution time: ",d[25]=c.i64.to_string(c.i64.sub(d[21],d[0])),d[26]=" ms",d[23]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsFindBackupStoredProcedure] ",d[23],d[24],d[23],d[25],d[23],d[26]].join("")),c.i64.eq(c.i64.mod_(d[22],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[27]=",",d[28]=c.createArray(),void 0!==void 0?d[29]=(d[28].push(void 0),d[28]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFindBackupStoredProcedure",[d[24],d[27],d[25],d[27],d[26]].join(""),d[28],c.i64.cast([0,4]))):c.resolve()},function(a){return e[0]=d[20]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsFindBackupStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state"];e.exports=a}),null);
__d("LSCreateResignCDNUrlPayload",["LSArrayGetObjectAt","LSBase64Encode.nop","LSBinaryToHex.nop","LSCreateDerivedKeys.nop","LSFindBackup","LSGetBlobFromInt64BE.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop","LSOcmfClientMap.nop","LSOpeEncrypt.nop","LSTruncateSortKey.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return a[10]?c.sequence([function(e){return c.blobs.neq(a[11],void 0)?c.sequence([function(e){return c.i64.neq(a[8],void 0)?c.sequence([function(e){return a[9]!==void 0?c.sequence([function(e){return c.blobs.neq(a[12],void 0)?c.sequence([function(e){return d[10]=c.createArray(),d[19]=(d[10].push(a[9]),d[10]),d[19]=(d[10].push(a[1]),d[10]),d[11]=c.toJSON(d[10]),d[12]=c.createArray(),d[19]=(d[12].push(c.i64.cast([0,32])),d[12]),c.nativeOperation(b("LSGetBlobFromString.nop"),["thread_ope_key","_",a[5]].join("")).then(function(a){return a=a,d[13]=a[0],a})},function(e){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[13],void 0,a[12],d[12]).then(function(a){return a=a,d[14]=a[0],a})},function(a){return d[14]?d[15]=!1:d[15]=!0,d[15]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),d[20]="Got null keys while deriving message list OPE key. Returning null blobish",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",d[20]].join("")),d[19]=c.createArray(),void 0!==void 0?d[21]=(d[19].push(void 0),d[19]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",d[20],d[19],c.i64.cast([0,3]))},function(a){return d[16]=void 0}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[14],c.i64.cast([0,0])).then(function(a){return a=a,d[19]=a[0],d[20]=a[1],a})},function(a){return d[16]=d[19]}])},function(e){return c.blobs.neq(d[16],void 0)?c.sequence([function(e){return c.nativeOperation(b("LSGetBlobFromInt64BE.nop"),a[6]).then(function(a){return a=a,d[19]=a[0],a})},function(a){return c.nativeOperation(b("LSTruncateSortKey.nop"),d[19]).then(function(a){return a=a,d[20]=a[0],a})},function(a){return c.nativeOperation(b("LSOpeEncrypt.nop"),d[16],d[20],c.i64.cast([0,16])).then(function(a){return a=a,d[21]=a[0],a})},function(a){return c.nativeOperation(b("LSBinaryToHex.nop"),d[21]).then(function(a){return a=a,d[22]=a[0],a})},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),d[11]).then(function(a){return a=a,d[23]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF9rZXlfc2NvcGU="),d[23]).then(function(a){return a=a,d[24]=a[0],a})},function(e){return c.nativeOperation(b("LSOcmfClientMap.nop"),a[11],d[24]).then(function(a){return a=a,d[25]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[25]).then(function(a){return a=a,d[26]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[9]).then(function(a){return a=a,d[27]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWFpbGJveF9pZF9zY29wZQ=="),d[27]).then(function(a){return a=a,d[28]=a[0],a})},function(e){return c.nativeOperation(b("LSOcmfClientMap.nop"),a[11],d[28]).then(function(a){return a=a,d[29]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[29]).then(function(a){return a=a,d[30]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[4]).then(function(a){return a=a,d[31]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWVzc2FnZV9pZF9zY29wZQ=="),d[31]).then(function(a){return a=a,d[32]=a[0],a})},function(e){return c.nativeOperation(b("LSOcmfClientMap.nop"),a[11],d[32]).then(function(a){return a=a,d[33]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[33]).then(function(a){return a=a,d[34]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[4]).then(function(a){return a=a,d[35]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),d[35]).then(function(a){return a=a,d[36]=a[0],a})},function(e){return c.nativeOperation(b("LSOcmfClientMap.nop"),a[11],d[36]).then(function(a){return a=a,d[37]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[37]).then(function(a){return a=a,d[38]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[5]).then(function(a){return a=a,d[39]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("dGhyZWFkX2lkX3Njb3Bl"),d[39]).then(function(a){return a=a,d[40]=a[0],a})},function(e){return c.nativeOperation(b("LSOcmfClientMap.nop"),a[11],d[40]).then(function(a){return a=a,d[41]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[41]).then(function(a){return a=a,d[42]=a[0],a})},function(e){return d[43]=new c.Map(),d[43].set("attachment_index_key",d[26]==null?"":d[26]),d[43].set("backup_ent_fbid",a[0]),d[43].set("delivery_object_id",a[1]),d[43].set("device_id",a[8]),d[43].set("mailbox_partial_id",d[30]==null?"":d[30]),d[43].set("media_type",a[3]),d[43].set("message_partial_id",d[34]==null?"":d[34]),d[43].set("product_type",a[2]),d[43].set("salt_partial_id",d[38]==null?"":d[38]),d[43].set("sort_key",d[22]==null?"":d[22]),d[43].set("thread_partial_id",d[42]==null?"":d[42]),d[43].set("isOpenEB",a[10]===!0),d[44]=new c.Map(),d[44].set("otid",a[4]),d[44].set("server_thread_key",a[7]),d[44].set("timestamp",c.i64.to_string(a[6])),c.nativeOperation(b("LSBase64Encode.nop"),a[11]).then(function(a){return a=a,d[45]=a[0],a})},function(e){return c.nativeOperation(b("LSBase64Encode.nop"),a[12]).then(function(a){return a=a,d[46]=a[0],a})},function(e){return d[47]=new c.Map(),d[47].set("ocmf_client_state_blob",d[45]==null?"":d[45]),d[47].set("mailbox_root_key",d[46]==null?"":d[46]),d[48]=c.createArray(),d[60]=(d[48].push(a[4]),d[48]),d[60]=(d[48].push(a[1]),d[48]),d[49]=c.toJSON(d[48]),d[43].set("raw_identifiers",d[44]),d[43].set("backup_id",a[9]),d[43].set("thread_id",a[5]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[49]).then(function(a){return a=a,d[50]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),d[50]).then(function(a){return a=a,d[51]=a[0],a})},function(e){return c.nativeOperation(b("LSOcmfClientMap.nop"),a[11],d[51]).then(function(a){return a=a,d[52]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[52]).then(function(a){return a=a,d[53]=a[0],a})},function(a){return d[43].set("salt_partial_access_token",d[53]==null?"":d[53]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[11]).then(function(a){return a=a,d[54]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF9rZXlfc2FsdF9zY29wZQ=="),d[54]).then(function(a){return a=a,d[55]=a[0],a})},function(e){return c.nativeOperation(b("LSOcmfClientMap.nop"),a[11],d[55]).then(function(a){return a=a,d[56]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[56]).then(function(a){return a=a,d[57]=a[0],a})},function(b){return d[43].set("salt_partial_attachment_index_key",d[57]==null?"":d[57]),d[43].set("raw_tokens",d[47]),a[13]!==void 0?d[43].set("access_token_secret",a[13]):0,a[14]!==void 0?d[43].set("primary_key_secret",a[14]):0,d[58]=c.toJSON(d[43]),d[59]=new c.Map(),d[59].set("payload",d[58]),b=[d[59],void 0],d[17]=b[0],d[18]=b[1]}]):c.resolve((d[19]=new c.Map(),d[19].set("error_code",c.i64.cast([0,25])),d[19].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),d[19].set("error_message","OPE key is null for IssueAttachmentRestoreTask"),e=[void 0,d[19]],d[17]=e[0],d[18]=e[1]))},function(a){return a=[d[17],d[18]],d[8]=a[0],d[9]=a[1],a}]):c.resolve((d[10]=new c.Map(),d[10].set("error_code",c.i64.cast([0,20])),d[10].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),d[10].set("error_message","Missing mailbox_root_key for IssueAttachmentRestoreTask"),e=[void 0,d[10]],d[8]=e[0],d[9]=e[1]))},function(a){return a=[d[8],d[9]],d[6]=a[0],d[7]=a[1],a}]):c.resolve((d[8]=new c.Map(),d[8].set("error_code",c.i64.cast([0,1])),d[8].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),d[8].set("error_message","Missing backup_id for IssueAttachmentRestoreTask"),e=[void 0,d[8]],d[6]=e[0],d[7]=e[1]))},function(a){return a=[d[6],d[7]],d[4]=a[0],d[5]=a[1],a}]):c.resolve((d[6]=new c.Map(),d[6].set("error_code",c.i64.cast([0,24])),d[6].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),d[6].set("error_message","Missing device_id for IssueAttachmentRestoreTask"),e=[void 0,d[6]],d[4]=e[0],d[5]=e[1]))},function(a){return a=[d[4],d[5]],d[2]=a[0],d[3]=a[1],a}]):c.resolve((d[4]=new c.Map(),d[4].set("error_code",c.i64.cast([0,22])),d[4].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),d[4].set("error_message","Missing ocmf_client_state_blob for IssueAttachmentRestoreTask"),e=[void 0,d[4]],d[2]=e[0],d[3]=e[1]))},function(a){return a=[d[2],d[3]],d[0]=a[0],d[1]=a[1],a}]):c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,e){var f=a.done;a=a.value;return f?(f=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,20]),void 0,void 0],d[2]=f[0],d[3]=f[1],d[4]=f[2],d[5]=f[3],d[6]=f[4],d[7]=f[5],d[8]=f[6],d[9]=f[7],d[10]=f[8],d[11]=f[9],d[12]=f[10],d[13]=f[11],d[14]=f[12],d[15]=f[13],d[16]=f[14],d[17]=f[15],d[18]=f[16],d[19]=f[17],f):(e=a.item,c.sequence([function(a){return d[29]=e.backupTenancy,d[28]=e.encryptionVersion,d[24]=void 0,c.i64.neq(d[24],void 0)?c.resolve(d[25]=d[24]):c.sequence([function(a){return d[30]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[31]=a[0],a})},function(a){return d[31]?d[40]=(d[30].push(c.i64.cast([0,0])),d[30]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[32]=a[0],a})},function(a){return d[32]?d[40]=(d[30].push(c.i64.cast([0,2])),d[30]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[33]=a[0],a})},function(a){return d[33]?d[40]=(d[30].push(c.i64.cast([0,3])),d[30]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[34]=a[0],a})},function(a){return d[34]?d[40]=(d[30].push(c.i64.cast([0,4])),d[30]):0,d[35]=c.createArray(),d[36]=c.i64.of_int32(d[30].length),c.i64.gt(d[36],c.i64.cast([0,0]))?c.loopAsync(d[36],function(a){return d[40]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[30],d[40]).then(function(a){return a=a,d[41]=a[0],d[42]=a[1],a})},function(a){return d[43]=(d[35].push(d[41]),d[35])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[40]=c.createArray(),d[41]=c.i64.of_int32(d[35].length),c.i64.gt(d[41],c.i64.cast([0,0]))?c.loopAsync(d[41],function(a){return d[43]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[35],d[43]).then(function(a){return a=a,d[44]=a[0],d[45]=a[1],a})},function(a){return d[46]=(d[40].push(c.i64.to_string(d[44])),d[40])}])}):c.resolve()},function(a){return d[42]=d[40].join(","),d[37]=d[42]}])},function(a){return d[35].some(function(a){return c.i64.eq(d[28],a)})?d[38]=d[28]:d[38]=void 0,c.i64.neq(d[38],void 0)?d[39]=d[38]:d[39]=void 0,d[25]=d[39]}])},function(a){return c.i64.neq(d[25],void 0)?d[26]=d[25]:d[26]=c.i64.cast([0,0]),c.i64.neq(d[29],void 0)?d[27]=d[29]:d[27]=c.i64.cast([0,1]),a=[e.backupId,e.deviceId,e.mailboxRootKeyBlob,e.ocmfClientStateBlob,void 0,void 0,d[26],d[27],e.epochAuthPublicKeyBlob,e.epochAuthPrivateKeyBlob,e.devicePublicKeyBlob,e.devicePrivateKeyBlob,e.epochStoragePublicKeyBlob,e.epochStoragePrivateKeyBlob,e.obliviousValidationTokenBlob,e.authorityLevel,void 0,void 0],d[2]=a[0],d[3]=a[1],d[4]=a[2],d[5]=a[3],d[6]=a[4],d[7]=a[5],d[8]=a[6],d[9]=a[7],d[10]=a[8],d[11]=a[9],d[12]=a[10],d[13]=a[11],d[14]=a[12],d[15]=a[13],d[16]=a[14],d[17]=a[15],d[18]=a[16],d[19]=a[17]}]))})},function(a){return c.storedProcedure(b("LSFindBackup")).then(function(a){return a=a,d[21]=a[0],a})},function(e){return c.blobs.neq(d[5],void 0)?c.sequence([function(e){return c.i64.neq(d[3],void 0)?c.sequence([function(e){return d[21]!==void 0?c.sequence([function(e){return c.blobs.neq(d[4],void 0)?c.sequence([function(e){return d[30]=c.createArray(),d[39]=(d[30].push(d[21]),d[30]),d[39]=(d[30].push(a[1]),d[30]),d[31]=c.toJSON(d[30]),d[32]=c.createArray(),d[39]=(d[32].push(c.i64.cast([0,32])),d[32]),c.nativeOperation(b("LSGetBlobFromString.nop"),["thread_ope_key","_",a[5]].join("")).then(function(a){return a=a,d[33]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[33],void 0,d[4],d[32]).then(function(a){return a=a,d[34]=a[0],a})},function(a){return d[34]?d[35]=!1:d[35]=!0,d[35]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),d[40]="Got null keys while deriving message list OPE key. Returning null blobish",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",d[40]].join("")),d[39]=c.createArray(),void 0!==void 0?d[41]=(d[39].push(void 0),d[39]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",d[40],d[39],c.i64.cast([0,3]))},function(a){return d[36]=void 0}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[34],c.i64.cast([0,0])).then(function(a){return a=a,d[39]=a[0],d[40]=a[1],a})},function(a){return d[36]=d[39]}])},function(e){return c.blobs.neq(d[36],void 0)?c.sequence([function(e){return c.nativeOperation(b("LSGetBlobFromInt64BE.nop"),a[6]).then(function(a){return a=a,d[39]=a[0],a})},function(a){return c.nativeOperation(b("LSTruncateSortKey.nop"),d[39]).then(function(a){return a=a,d[40]=a[0],a})},function(a){return c.nativeOperation(b("LSOpeEncrypt.nop"),d[36],d[40],c.i64.cast([0,16])).then(function(a){return a=a,d[41]=a[0],a})},function(a){return c.nativeOperation(b("LSBinaryToHex.nop"),d[41]).then(function(a){return a=a,d[42]=a[0],a})},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),d[31]).then(function(a){return a=a,d[43]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF9rZXlfc2NvcGU="),d[43]).then(function(a){return a=a,d[44]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[44]).then(function(a){return a=a,d[45]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[45]).then(function(a){return a=a,d[46]=a[0],a})},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),d[21]).then(function(a){return a=a,d[47]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWFpbGJveF9pZF9zY29wZQ=="),d[47]).then(function(a){return a=a,d[48]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[48]).then(function(a){return a=a,d[49]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[49]).then(function(a){return a=a,d[50]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[4]).then(function(a){return a=a,d[51]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWVzc2FnZV9pZF9zY29wZQ=="),d[51]).then(function(a){return a=a,d[52]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[52]).then(function(a){return a=a,d[53]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[53]).then(function(a){return a=a,d[54]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[4]).then(function(a){return a=a,d[55]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),d[55]).then(function(a){return a=a,d[56]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[56]).then(function(a){return a=a,d[57]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[57]).then(function(a){return a=a,d[58]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[5]).then(function(a){return a=a,d[59]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("dGhyZWFkX2lkX3Njb3Bl"),d[59]).then(function(a){return a=a,d[60]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[60]).then(function(a){return a=a,d[61]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[61]).then(function(a){return a=a,d[62]=a[0],a})},function(e){return d[63]=new c.Map(),d[63].set("attachment_index_key",d[46]==null?"":d[46]),d[63].set("backup_ent_fbid",a[0]),d[63].set("delivery_object_id",a[1]),d[63].set("device_id",d[3]),d[63].set("mailbox_partial_id",d[50]==null?"":d[50]),d[63].set("media_type",a[3]),d[63].set("message_partial_id",d[54]==null?"":d[54]),d[63].set("product_type",a[2]),d[63].set("salt_partial_id",d[58]==null?"":d[58]),d[63].set("sort_key",d[42]==null?"":d[42]),d[63].set("thread_partial_id",d[62]==null?"":d[62]),d[63].set("isOpenEB",a[10]===!0),d[64]=new c.Map(),d[64].set("otid",a[4]),d[64].set("server_thread_key",a[7]),d[64].set("timestamp",c.i64.to_string(a[6])),c.nativeOperation(b("LSBase64Encode.nop"),d[5]).then(function(a){return a=a,d[65]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[4]).then(function(a){return a=a,d[66]=a[0],a})},function(e){return d[67]=new c.Map(),d[67].set("ocmf_client_state_blob",d[65]==null?"":d[65]),d[67].set("mailbox_root_key",d[66]==null?"":d[66]),d[68]=c.createArray(),d[80]=(d[68].push(a[4]),d[68]),d[80]=(d[68].push(a[1]),d[68]),d[69]=c.toJSON(d[68]),d[63].set("raw_identifiers",d[64]),d[63].set("backup_id",d[21]),d[63].set("thread_id",a[5]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[69]).then(function(a){return a=a,d[70]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),d[70]).then(function(a){return a=a,d[71]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[71]).then(function(a){return a=a,d[72]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[72]).then(function(a){return a=a,d[73]=a[0],a})},function(a){return d[63].set("salt_partial_access_token",d[73]==null?"":d[73]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[31]).then(function(a){return a=a,d[74]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF9rZXlfc2FsdF9zY29wZQ=="),d[74]).then(function(a){return a=a,d[75]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[75]).then(function(a){return a=a,d[76]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[76]).then(function(a){return a=a,d[77]=a[0],a})},function(b){return d[63].set("salt_partial_attachment_index_key",d[77]==null?"":d[77]),d[63].set("raw_tokens",d[67]),a[13]!==void 0?d[63].set("access_token_secret",a[13]):0,a[14]!==void 0?d[63].set("primary_key_secret",a[14]):0,d[78]=c.toJSON(d[63]),d[79]=new c.Map(),d[79].set("payload",d[78]),b=[d[79],void 0],d[37]=b[0],d[38]=b[1]}]):c.resolve((d[39]=new c.Map(),d[39].set("error_code",c.i64.cast([0,25])),d[39].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),d[39].set("error_message","OPE key is null for IssueAttachmentRestoreTask"),e=[void 0,d[39]],d[37]=e[0],d[38]=e[1]))},function(a){return a=[d[37],d[38]],d[28]=a[0],d[29]=a[1],a}]):c.resolve((d[30]=new c.Map(),d[30].set("error_code",c.i64.cast([0,20])),d[30].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),d[30].set("error_message","Missing mailbox_root_key for IssueAttachmentRestoreTask"),e=[void 0,d[30]],d[28]=e[0],d[29]=e[1]))},function(a){return a=[d[28],d[29]],d[26]=a[0],d[27]=a[1],a}]):c.resolve((d[28]=new c.Map(),d[28].set("error_code",c.i64.cast([0,1])),d[28].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),d[28].set("error_message","Missing backup_id for IssueAttachmentRestoreTask"),e=[void 0,d[28]],d[26]=e[0],d[27]=e[1]))},function(a){return a=[d[26],d[27]],d[24]=a[0],d[25]=a[1],a}]):c.resolve((d[26]=new c.Map(),d[26].set("error_code",c.i64.cast([0,24])),d[26].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),d[26].set("error_message","Missing device_id for IssueAttachmentRestoreTask"),e=[void 0,d[26]],d[24]=e[0],d[25]=e[1]))},function(a){return a=[d[24],d[25]],d[22]=a[0],d[23]=a[1],a}]):c.resolve((d[24]=new c.Map(),d[24].set("error_code",c.i64.cast([0,22])),d[24].set("stored_procedure","LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure"),d[24].set("error_message","Missing ocmf_client_state_blob for IssueAttachmentRestoreTask"),e=[void 0,d[24]],d[22]=e[0],d[23]=e[1]))},function(a){return a=[d[22],d[23]],d[0]=a[0],d[1]=a[1],a}])},function(a){return a=[d[0],d[1]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsCreateResignCDNUrlPayloadStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state"];e.exports=a}),null);
__d("LSCreateResignCDNUrlPayloadStoredProcedure",["LSCreateResignCDNUrlPayload","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSCreateResignCDNUrlPayload"),e.backupEntFbid,e.deliveryObjectId,e.productType,e.mediaType,e.messageId,e.threadId,e.sortOrder,e.serverThreadKey,e.deviceId,e.backupId,e.isOpenEb,e.ocmfClientState,e.mailboxRootKey,e.accessTokenSecret,e.primaryKeySecret);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("EBLSResignCdnUrl",["Base64Utils","EBCreateResignCDNUrlPayload","EBEnqueueResignCdnUrlRequests","EBLS","EBMinosCheckWasmFeatureSupport","EBMinosWasmDeriveAttachmentTokenPrimaryKey","FBLogger","I64","LSCreateResignCDNUrlPayloadStoredProcedure","LSFactory","LSShape","MAWConfig","WAJids","WAResultOrError","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t,u=function(){return c("FBLogger")("wmi").tags(["labyrinth_web","resign_cdn_url"])};e="-8";var v=(t||(t=d("I64"))).of_string(e);async function a(a){var b=a.chatJid,e=a.deliveryObjectId,g=a.externalId,o=a.mediaDownloadFlow,p=a.mediaKey,q=a.mediaType,r=a.sortOrderMs;a=a.source;u().INFO(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url with EBLS GraphQL"])));var s=await d("EBMinosCheckWasmFeatureSupport").checkWasFeatureSupportAndGK();o==null||o.addPoint("resign_cdn_url_gql_ebls_start");var w=(await d("EBLS").init()).db;o==null||o.addPoint("resign_cdn_url_gql_ebls_end");var x=null,y=null;if(s){s=await d("EBMinosWasmDeriveAttachmentTokenPrimaryKey").deriveAttachmentTokenPrimaryKeySecret(p);!s.success?u().WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["",""])),s.error):(x=d("Base64Utils").fromArrayBuffer(s.value.accessToken),y=d("Base64Utils").fromArrayBuffer(s.value.primaryKey))}var z={accessTokenSecret:x,backupEntFbid:v,deliveryObjectId:e,mediaType:q,messageId:g,primaryKeySecret:y,productType:d("MAWConfig").getConfig().productTypeForEBAttachments,sortOrder:(t||(t=d("I64"))).of_float(r),threadId:d("WAJids").threadIdForChatJid(b)};o==null||o.addPoint("resign_cdn_url_gql_payload_start");p=[w.runInTransaction(function(a){return c("LSCreateResignCDNUrlPayloadStoredProcedure")(c("LSFactory")(a),z)},"readwrite",void 0,void 0,f.id+":99").then(function(a){var b=a[0];a=a[1];if(b!=null)return d("LSShape").toRecord(b);b=a==null?{}:d("LSShape").toRecord(a);u().MUSTFIX(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Failed to create payload. stored procedure: ",", error code: ",", error message: ",""])),b.stored_procedure,b.error_code,b.error_message);return null}).catch(function(a){a=c("getErrorSafe")(a);o==null||o.addPoint("resign_cdn_url_gql_lsdb_payload_fail");u().catching(a).MUSTFIX(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Failed to create lsdb payload"])));return null}),d("EBCreateResignCDNUrlPayload").createStringifiedMediaRestorePayloadFromEBDB({accessTokenSecret:x,deliveryObjectId:e,mediaType:q,messageId:g,primaryKeySecret:y,productType:d("MAWConfig").getConfig().productTypeForEBAttachments,sortOrderMs:r,threadId:d("WAJids").threadIdForChatJid(b)}).then(function(a){if(a!=null)return{payload:a};o==null||o.addPoint("resign_cdn_url_gql_ebdb_payload_fail");return null}).catch(function(a){a=c("getErrorSafe")(a);u().catching(a).MUSTFIX(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Failed to create ebdb payload"])));o==null||o.addPoint("resign_cdn_url_gql_ebdb_payload_fail",{string:{payload_fail_error:a.message}});return null})];s=await Promise.all(p);w=s[0];x=s[1];q=w!=null?w:x;w==null&&x!=null&&(o==null||o.addPoint("resign_cdn_url_fallback_to_ebdb"));if(q==null){o==null||o.addPoint("resign_cdn_url_gql_payload_fail");return d("WAResultOrError").makeError("create-payload-failed")}o==null||o.addPoint("resign_cdn_url_gql_payload_end");o==null||o.addPoint("resign_cdn_url_gql_restore_start");g=await d("EBEnqueueResignCdnUrlRequests").enqueueResignCdnUrl(e,q,a,o);if(!g.success){u().MUSTFIX(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url with EBLS GraphQL failed: ",""])),g.error);o==null||o.addPoint("resign_cdn_url_gql_restore_fail");return g}o==null||o.addPoint("resign_cdn_url_gql_restore_end");u().INFO(n||(n=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url with EBLS GraphQL succeeded"])));return d("WAResultOrError").makeResult(g.value)}function w(a,b){var c=[];for(var d in a)a[d]instanceof Object?!(b[d]instanceof Object)?c.push(d):c.push.apply(c,w(a[d],b[d])):a[d]!==b[d]&&c.push(d);return c}async function b(a){var b=a.chatJid,e=a.deliveryObjectId,g=a.externalId,h=a.mediaDownloadFlow,i=a.mediaKey,j=a.mediaType,k=a.sortOrderMs;a=a.source;u().INFO(o||(o=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url with EBDB GraphQL"])));var l=await d("EBMinosCheckWasmFeatureSupport").checkWasFeatureSupportAndGK(),m=null,n=null;if(l){l=await d("EBMinosWasmDeriveAttachmentTokenPrimaryKey").deriveAttachmentTokenPrimaryKeySecret(i);!l.success?u().WARN(p||(p=babelHelpers.taggedTemplateLiteralLoose(["",""])),l.error):(m=d("Base64Utils").fromArrayBuffer(l.value.accessToken),n=d("Base64Utils").fromArrayBuffer(l.value.primaryKey))}h==null||h.addPoint("resign_cdn_url_gql_payload_start");i=await d("EBCreateResignCDNUrlPayload").createStringifiedMediaRestorePayloadFromEBDB({accessTokenSecret:m,deliveryObjectId:e,mediaType:j,messageId:g,primaryKeySecret:n,productType:d("MAWConfig").getConfig().productTypeForEBAttachments,sortOrderMs:k,threadId:d("WAJids").threadIdForChatJid(b)}).then(function(a){return a!=null?{payload:a}:null}).catch(function(a){a=c("getErrorSafe")(a);u().catching(a).MUSTFIX(q||(q=babelHelpers.taggedTemplateLiteralLoose(["Failed to create ebdb payload"])));h==null||h.addAnnotations({string:{payload_fail_error:a.message}});return null});if(i==null){h==null||h.addPoint("resign_cdn_url_gql_payload_fail");return d("WAResultOrError").makeError("create-payload-failed")}h==null||h.addPoint("resign_cdn_url_gql_payload_end");h==null||h.addPoint("resign_cdn_url_gql_restore_start");l=await d("EBEnqueueResignCdnUrlRequests").enqueueResignCdnUrl(e,i,a,h);if(!l.success){u().MUSTFIX(r||(r=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url with EBDB GraphQL failed: ",""])),l.error);h==null||h.addPoint("resign_cdn_url_gql_restore_fail");a=(await d("EBLS").init()).db;a=(await a.runInTransaction(function(a){return c("LSCreateResignCDNUrlPayloadStoredProcedure")(c("LSFactory")(a),{accessTokenSecret:m,backupEntFbid:v,deliveryObjectId:e,mediaType:j,messageId:g,primaryKeySecret:n,productType:d("MAWConfig").getConfig().productTypeForEBAttachments,sortOrder:(t||(t=d("I64"))).of_float(k),threadId:d("WAJids").threadIdForChatJid(b)})},"readwrite",void 0,void 0,f.id+":285"))[0];if(a!=null){a=JSON.parse(d("LSShape").toRecord(a).payload);i=JSON.parse(i.payload);var x=w(a,i),y=w(i,a);h==null||h.addAnnotations({bool:{string_payload_mismatch:JSON.stringify(a,Object.keys(a).sort())!==JSON.stringify(i,Object.keys(i).sort())},string:{ebdb_mismatches:y.join(","),mismatches:x.join(",")}})}return l}h==null||h.addPoint("resign_cdn_url_gql_restore_end");u().INFO(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Resigning cdn url with EBDB GraphQL succeeded"])));return d("WAResultOrError").makeResult(l.value)}g.DEPRECATED_eblsResignCdnUrlWithGraphQL=a;g.getPayloadMismatches=w;g.ebdbResignCdnUrlWithGraphQL=b}),98);
__d("EBMainThreadEBDBApi",["$InternalEnum","EBDB","EBDBConsistencyApi","FBLogger","LSDatabaseSingleton","WAResolvable","WormDump"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new(d("WAResolvable").Resolvable)();async function a(){var a=await (h||(h=d("LSDatabaseSingleton"))).LSDatabaseSingleton;try{await d("EBDBConsistencyApi").startListeningDeviceRegistrations(a,d("EBDB").EBDBEnvironment.UI)}catch(a){c("FBLogger")("wmi_eb").catching(a).mustfix("Error on startListeningDeviceRegistrations in UI")}finally{i.resolve(a)}}async function e(a){await d("EBDBConsistencyApi").trackOverprompting(d("EBDB").EBDBEnvironment.UI,a)}async function f(a){var b=await i.promise;await d("EBDBConsistencyApi").addNewDevice(b,d("EBDB").EBDBEnvironment.UI,a)}async function j(){var a=await d("EBDB").getEBDB();return a.dump({auto_restore_opt_out:{customFields:{optOutKey:(a=d("WormDump")).wormNonSensitiveField,optOutValue:a.wormNonSensitiveField}},device_metadata:{customFields:{backupId:a.wormNonSensitiveField,deviceRegistrationId:a.wormNonSensitiveField,pk:a.wormNonSensitiveField,taskId:a.wormNonSensitiveField}},device_state:{customFields:{deviceId:a.wormNonSensitiveField,env:a.wormNonSensitiveField}},encrypted_backups:{customFields:{authorityLevel:a.wormNonSensitiveField,backupId:a.wormNonSensitiveField,backupTenancy:a.wormNonSensitiveField,hasOtcEligibleDevices:a.wormNonSensitiveField,isUserOptedOut:a.wormNonSensitiveField,pk:a.wormNonSensitiveField}},encrypted_backups_virtual_devices:{customFields:{backupId:a.wormNonSensitiveField,creationTime:a.wormNonSensitiveField,deviceCreatedOn:a.wormNonSensitiveField,pk:a.wormNonSensitiveField,removalStatus:a.wormNonSensitiveField,requiresHsmMigration:a.wormNonSensitiveField}},experiences_shared_state:{},secure_encrypted_backups_client_state:{customFields:{authorityLevel:a.wormNonSensitiveField,backupId:a.wormNonSensitiveField,backupTenancy:a.wormNonSensitiveField,deviceId:a.wormNonSensitiveField,encryptionVersion:a.wormNonSensitiveField}},secure_encrypted_backups_epochs:{customFields:{authorityLevel:a.wormNonSensitiveField,epochId:a.wormNonSensitiveField,epochStatus:a.wormNonSensitiveField}},secure_encrypted_backups_recovery_code_status:{customFields:{pk:a.wormNonSensitiveField,recoveryCodeStatus:a.wormNonSensitiveField}}})}var k=b("$InternalEnum")({Disabled:0,UIInconsistent:1,WorkerInconsistent:2,Consistent:3});async function l(a,b){var c=await i.promise;void d("EBDBConsistencyApi").trackConsistency(c,d("EBDB").EBDBEnvironment.UI,a,function(){var a=k.Disabled,c=d("EBDBConsistencyApi").getDeviceId();c!=null&&b!=null?a=k.Consistent:c!=null&&b==null?a=k.WorkerInconsistent:c==null&&b!=null&&(a=k.UIInconsistent);return{int:{crossEnvConsistency:a}}})}g.startListeningDeviceRegistrations=a;g.trackOverprompting=e;g.addNewDevice=f;g.getEBDBDump=j;g.EBCrossEnvConsistencyResult=k;g.trackConsistency=l}),98);
__d("EBSetRestoreStatusForInitialRestore",["I64","LSEncryptedBackupsClientRestoreState","LSIntEnum","ReQL","WAJids","performanceAbsoluteNow"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;async function a(a,b){var e=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(b.tables.encrypted_backups_client_restore_status).map(function(a){a=a.threadId;return a}));return b.runInTransaction(async function(b){var f=[],g=[];e.forEach(function(a){f.push(b.encrypted_backups_client_restore_status.delete(a))});await Promise.all(f);a.forEach(function(a){g.push(b.encrypted_backups_client_restore_status.put({lastUpdated:(j||(j=d("I64"))).of_float((h||(h=c("performanceAbsoluteNow")))()),restoreStatus:(i||(i=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsClientRestoreState").RESTORE_IN_PROGRESS),threadId:d("WAJids").threadIdForChatJid(a)}))});await Promise.all(g)},"readwrite",void 0,void 0,f.id+":37")}async function b(a){var b=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.encrypted_backups_client_restore_status).map(function(a){a=a.threadId;return a}));return a.runInTransaction(async function(a){var c=[];b.forEach(function(b){c.push(a.encrypted_backups_client_restore_status.delete(b))});await Promise.all(c)},"readwrite",void 0,void 0,f.id+":75")}g.setRestoreStatusForInitialRestore=a;g.resetClientRestoreStatus=b}),98);
__d("GaloisField32",["EBLogger"],(function(a,b,c,d,e,f,g){"use strict";var h=d("EBLogger").EBLogger(),i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,5,7,1,3,13,15,9,11,21,23,17,19,29,31,25,27,0,3,6,5,12,15,10,9,24,27,30,29,20,23,18,17,21,22,19,16,25,26,31,28,13,14,11,8,1,2,7,4,0,4,8,12,16,20,24,28,5,1,13,9,21,17,29,25,10,14,2,6,26,30,18,22,15,11,7,3,31,27,23,19,0,5,10,15,20,17,30,27,13,8,7,2,25,28,19,22,26,31,16,21,14,11,4,1,23,18,29,24,3,6,9,12,0,6,12,10,24,30,20,18,21,19,25,31,13,11,1,7,15,9,3,5,23,17,27,29,26,28,22,16,2,4,14,8,0,7,14,9,28,27,18,21,29,26,19,20,1,6,15,8,31,24,17,22,3,4,13,10,2,5,12,11,30,25,16,23,0,8,16,24,5,13,21,29,10,2,26,18,15,7,31,23,20,28,4,12,17,25,1,9,30,22,14,6,27,19,11,3,0,9,18,27,1,8,19,26,2,11,16,25,3,10,17,24,4,13,22,31,5,12,23,30,6,15,20,29,7,14,21,28,0,10,20,30,13,7,25,19,26,16,14,4,23,29,3,9,17,27,5,15,28,22,8,2,11,1,31,21,6,12,18,24,0,11,22,29,9,2,31,20,18,25,4,15,27,16,13,6,1,10,23,28,8,3,30,21,19,24,5,14,26,17,12,7,0,12,24,20,21,25,13,1,15,3,23,27,26,22,2,14,30,18,6,10,11,7,19,31,17,29,9,5,4,8,28,16,0,13,26,23,17,28,11,6,7,10,29,16,22,27,12,1,14,3,20,25,31,18,5,8,9,4,19,30,24,21,2,15,0,14,28,18,29,19,1,15,31,17,3,13,2,12,30,16,27,21,7,9,6,8,26,20,4,10,24,22,25,23,5,11,0,15,30,17,25,22,7,8,23,24,9,6,14,1,16,31,11,4,21,26,18,29,12,3,28,19,2,13,5,10,27,20,0,16,5,21,10,26,15,31,20,4,17,1,30,14,27,11,13,29,8,24,7,23,2,18,25,9,28,12,19,3,22,6,0,17,7,22,14,31,9,24,28,13,27,10,18,3,21,4,29,12,26,11,19,2,20,5,1,16,6,23,15,30,8,25,0,18,1,19,2,16,3,17,4,22,5,23,6,20,7,21,8,26,9,27,10,24,11,25,12,30,13,31,14,28,15,29,0,19,3,16,6,21,5,22,12,31,15,28,10,25,9,26,24,11,27,8,30,13,29,14,20,7,23,4,18,1,17,2,0,20,13,25,26,14,23,3,17,5,28,8,11,31,6,18,7,19,10,30,29,9,16,4,22,2,27,15,12,24,1,21,0,21,15,26,30,11,17,4,25,12,22,3,7,18,8,29,23,2,24,13,9,28,6,19,14,27,1,20,16,5,31,10,0,22,9,31,18,4,27,13,1,23,8,30,19,5,26,12,2,20,11,29,16,6,25,15,3,21,10,28,17,7,24,14,0,23,11,28,22,1,29,10,9,30,2,21,31,8,20,3,18,5,25,14,4,19,15,24,27,12,16,7,13,26,6,17,0,24,21,13,15,23,26,2,30,6,11,19,17,9,4,28,25,1,12,20,22,14,3,27,7,31,18,10,8,16,29,5,0,25,23,14,11,18,28,5,22,15,1,24,29,4,10,19,9,16,30,7,2,27,21,12,31,6,8,17,20,13,3,26,0,26,17,11,7,29,22,12,14,20,31,5,9,19,24,2,28,6,13,23,27,1,10,16,18,8,3,25,21,15,4,30,0,27,19,8,3,24,16,11,6,29,21,14,5,30,22,13,12,23,31,4,15,20,28,7,10,17,25,2,9,18,26,1,0,28,29,1,31,3,2,30,27,7,6,26,4,24,25,5,19,15,14,18,12,16,17,13,8,20,21,9,23,11,10,22,0,29,31,2,27,6,4,25,19,14,12,17,8,21,23,10,3,30,28,1,24,5,7,26,16,13,15,18,11,22,20,9,0,30,25,7,23,9,14,16,11,21,18,12,28,2,5,27,22,8,15,17,1,31,24,6,29,3,4,26,10,20,19,13,0,31,27,4,19,12,8,23,3,28,24,7,16,15,11,20,6,25,29,2,21,10,14,17,5,26,30,1,22,9,13,18],j=[0,1,18,28,9,23,14,12,22,4,25,16,7,15,6,13,11,24,2,29,30,26,8,5,17,10,21,31,3,19,20,27],k="ACDEFHJKLMNPQRSTUVWXYZ0123456789",l=function(){var a={};for(var b=0;b<k.length;b++)a[k[b]]=b;return a}();function m(a,b){return i[a*32+b]}function a(a){var b=[];for(var c=0;c<a.length;c++){if(!(a[c]in l)){h.mustfix("gf32: tried to convert invalid string to GF32 matrix: %s",a);return null}b[c]=l[a[c]]}return b}function b(a){var b=[];for(a of a)b.push(k[a]);return b.join("")}function n(a){return a===0||a===1||a===2||a===3||a===4||a===5||a===6||a===7||a===8||a===9||a===10||a===11||a===12||a===13||a===14||a===15||a===16||a===17||a===18||a===19||a===20||a===21||a===22||a===23||a===24||a===25||a===26||a===27||a===28||a===29||a===30||a===31?a:null}function c(a){var b=[];for(var c=0;c<a.length;c++){var d=n(a[c]);if(d==null)throw h.mustfixThrow("gf32: tried to convert bad value to GF32 element: %s",a[c]);b.push(d)}return b}function o(a,b){var c=a^b,d=n(c);if(d==null)throw h.mustfixThrow("gf32: xor of gf32 elements returned a non-element (should be impossible): %s ^ %s = %s",a,b,c);return d}function p(a,b,c,d,e){for(var f=0;f<b;f++)a[c*b+f]=o(a[c*b+f],m(a[d*b+f],e))}function q(a,b,c,d){for(var e=0;e<b;e++){var f=a[c*b+e];a[c*b+e]=a[d*b+e];a[d*b+e]=f}}function r(a,b,c,d){for(var e=0;e<b;e++)a[c*b+e]=m(a[c*b+e],d)}function s(a,b){if(b===0)throw h.mustfixThrow("gf32: tried to divide by 0");return m(a,j[b])}function t(a){var b=Array(a*a).fill(0);for(var c=0;c<a;c++)b[c*a+c]=1;return b}function e(a,b){a=a.slice();var c=t(b);for(var d=0;d<b;d++){var e=d;if(a[d*b+e]===0){var f=!1;for(var g=d+1;g<b;g++)if(a[g*b+e]!==0){q(a,b,d,g);q(c,b,d,g);f=!0;break}if(!f)return null}for(g=d+1;g<b;g++){f=s(a[g*b+e],a[d*b+e]);p(a,b,g,d,f);p(c,b,g,d,f)}}for(f=b-1;f>=0;f--){e=f;for(g=f-1;g>=0;g--){d=s(a[g*b+e],a[f*b+e]);p(a,b,g,f,d);p(c,b,g,f,d)}}for(d=0;d<b;d++){e=a[d*b+d];if(e===0)return null;r(c,b,d,j[e])}return c}f=0;g.zero=f;g.matrixToSymbols=b;g.symbolsToMatrix=a;g.invert=e;g.xor=o;g.multiply=m;g.asGf32MatExn=c}),98);
__d("GF32RecoveryCodes",["EBLogger","GaloisField32"],(function(a,b,c,d,e,f,g){"use strict";var h=d("EBLogger").EBLogger(),i=34,j=4,k=3,l=i+j,m=d("GaloisField32").asGf32MatExn([18,24,16,12,8,20,2,19,4,22,21,5,28,5,14,21,7,16,15,10,3,9,28,22,11,30,19,6,7,7,9,18,16,2,9,12,18,14,7,6,5,16,9,24,16,28,19,2,14,8,2,4,1,21,26,21,10,27,16,25,18,14,20,17,11,22,21,22,16,20,2,5,0,9,6,7,23,23,23,11,6,5,3,31,29,30,17,28,0,30,28,7,13,5,11,22,12,16,25,3,20,22,26,22,14,29,5,14,5,19,12,19,18,8,25,7,30,7,8,12,0,26,15,10,17,21,2,29,14,4,31,7,29,6,29,1,14,16,17,15,4,16,7,4,7,4,8,26,10,23,24,26]);function n(a,b,c){c===void 0&&(c=1);var d=[];for(a=a;a<b;a+=c)d.push(a);return d}var o={};function p(a,b){function c(a,b,d,e){if(b<=0)return[[]];if(e-d<=b)return[n(d,e)];var f=a|b<<8|d<<16|e<<24,g=o[f];if(g!=null)return g;var h=[];c(a-1,b-1,d+1,e).forEach(function(a){a=a.slice();a.splice(0,0,d);h.push(a)});c(a-1,b,d+1,e).forEach(function(a){h.push(a.slice())});o[f]=h;return h}return c(a,b,0,a)}function q(a,b){var c=a.length,d=Array(c*c).fill(0),e=0;for(var f=0;f<j;f++){if(f===b)continue;for(var g=0;g<c;g++){var h=a[g];d[e*c+g]=m[f*l+h]}e++}return d}function r(a,b){for(var c=0;c<j;c++){var e=q(a,c);e=d("GaloisField32").invert(e,b);if(e!=null)return{excludeRow:c,submatInv:e}}return null}function a(a){var b=Array(j).fill(0);for(var c=0;c<j;c++)for(var e=0;e<i;e++)b[c]=d("GaloisField32").xor(b[c],d("GaloisField32").multiply(m[c*l+e],a[e]));e=Array(j*j);for(a=0;a<j;a++)for(c=0;c<j;c++)e[a*j+c]=m[a*l+i+c];c=d("GaloisField32").invert(e,j);if(c==null)throw h.mustfixThrow("gf32: failed to invert error code submatrix (should be impossible): %s",JSON.stringify(e));a=Array(j).fill(0);for(e=0;e<j;e++)for(var f=0;f<j;f++)a[e]=d("GaloisField32").xor(a[e],d("GaloisField32").multiply(c[e*j+f],b[f]));return a}function b(a){var b=new Set(),c=d("GaloisField32").symbolsToMatrix(a);if(c==null){h.warn("gf32: recovery code %s could not be converted to GF32 matrix",a);return[a]}a=Array(j).fill(0);for(var e=0;e<j;e++)for(var f=0;f<l;f++)a[e]=d("GaloisField32").xor(a[e],d("GaloisField32").multiply(m[e*l+f],c[f]));f=p(l,k);for(e of f){f=a.slice();for(var g=0;g<j;g++)for(var i of e)f[g]=d("GaloisField32").xor(f[g],d("GaloisField32").multiply(m[g*l+i],c[i]));i=r(e,k);if(i==null){h.warn("gf32: no submat inverse found for error locs %s",JSON.stringify(e));continue}g=i.excludeRow;i=i.submatInv;var n=Array(k).fill(0),o=f.slice();o.splice(g,1);for(var q=0;q<k;q++)for(var s=0;s<k;s++)n[q]=d("GaloisField32").xor(n[q],d("GaloisField32").multiply(i[q*k+s],o[s]));s=d("GaloisField32").zero;for(q=0;q<k;q++)s=d("GaloisField32").xor(s,d("GaloisField32").multiply(m[g*l+e[q]],n[q]));if(s===f[g]){i=c.slice();for(o=0;o<e.length;o++)i[e[o]]=n[o];b.add(d("GaloisField32").matrixToSymbols(i))}}return Array.from(b)}g.getEccForCode=a;g.getCandidateCodes=b}),98);
__d("LSCreateAuthKeyPair.nop",["CryptoLogger","Promise","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("X25519").__setRef("LSCreateAuthKeyPair.nop");a=function(a,c){return i.load().then(function(a){a=a.generateKeys(a.KeyPurpose.Encryption);var c=a.pk;a=a.sk;return(h||(h=b("Promise"))).resolve([a.buffer,c.buffer])})["catch"](function(a){d("CryptoLogger").captureError(d("CryptoLogger").CryptoLogger("create_auth_key_pair"),a).mustfix("failed to generate an auth key pair");throw a})};a.__nop_name__="LSCreateAuthKeyPair";g["default"]=a}),98);
__d("LSCreateDebugToken.nop",["ArrayBuffer","Base64Utils","CryptoLogger","I64","LSCreateDerivedKeys.nop","LSCryptoUtils","LSVec","Promise","RetUtil","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=d("LSCryptoUtils").strToBuf("debug_token_type_"),k=d("LSCryptoUtils").strToBuf("debug_token_rkid"),l=d("LSCryptoUtils").strToBuf("debug_token_anon"),m=(i||(i=d("I64"))).of_string("32"),n=i.of_string("12");function o(a){return Array.from(a.keys()).reduce(function(b,c){var d=a.get(c);d!=null&&(b[c]=d);return b},{})}function p(a){return new Int32Array([new DataView(new Int32Array([a]).buffer).getInt32(0)]).buffer}function q(a,b){var c=b.length;a=d("ArrayBuffer").mergeBuffers([a,p(c)]);return d("ArrayBuffer").mergeBuffers([a,d("LSCryptoUtils").strToBuf(b)])}function r(a,b){var c=b.keys().sort();return c.reduce(function(a,c){var d=b.get(c);return d!=null?q(q(a,c),d):a},q(j,a))}function s(a,b,d,e,f){return c("LSCreateDerivedKeys.nop")(a,b,d,void 0,e,c("LSVec").ofArray([f])).then(function(a){a=a[0];if(a==null)return void 0;a=c("LSVec").toArray(a);return a.length===1?a[0]:void 0})}function t(a,e,f,g,j){return(i||(i=d("I64"))).equal((i||(i=d("I64"))).zero,j)?s(a,e,l,g,m).then(function(b){return s(a,e,f,c("nullthrows")(b),(i||(i=d("I64"))).of_int32(f.byteLength))}):(h||(h=b("Promise"))).resolve(f)}function u(a,b,d,e,f,g,h){return s(a,b,d,e,f).then(function(d){return t(a,b,c("nullthrows")(d),g,h)})}a=function(a,e,f,g,j,l,p){try{return(h||(h=b("Promise"))).all([s(a,e,r(g,p),f,m).then(function(b){return u(a,e,j,c("nullthrows")(b),n,f,l)}),u(a,e,k,f,n,f,l)]).then(function(a){var b=a[0];a=a[1];return d("RetUtil").getNullableRetResult(d("LSCryptoUtils").strToBuf(JSON.stringify({ctx:(i||(i=d("I64"))).equal((i||(i=d("I64"))).zero,l)?"anon":"auth",rkid:d("Base64Utils").fromArrayBuffer(c("nullthrows")(a)),scopes:o(p),type:g,val:d("Base64Utils").fromArrayBuffer(c("nullthrows")(b))})))})}catch(a){d("CryptoLogger").CryptoLogger("create_debug_token").warn("getExn Error");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult())}};a.__nop_name__="LSCreateDebugToken";g["default"]=a}),98);
__d("LSCreateEncryptionKeyPair.nop",["CreateEncryptionKeyPair"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b){return c("CreateEncryptionKeyPair")()};a.__nop_name__="LSCreateEncryptionKeyPair";g["default"]=a}),98);
__d("LSCreateSignatureKeyPair.nop",["CryptoLogger","Promise","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("X25519").__setRef("LSCreateSignatureKeyPair.nop");a=function(a,c){return i.load().then(function(a){a=a.generateKeys(a.KeyPurpose.Signing);return(h||(h=b("Promise"))).resolve([a.sk.buffer,a.pk.buffer])})["catch"](function(a){var b=d("CryptoLogger").CryptoLogger("create_signature_key_pair");d("CryptoLogger").captureError(b,a).mustfix("Failed to create signing key pair keys");throw a})};a.__nop_name__="LSCreateSignatureKeyPair";g["default"]=a}),98);
__d("LSCreateSignatureWithArmadilloKey.nop",["ArmadilloSignatures","EBDeps","LSResult"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,e){return d("EBDeps").getDeps().getMAWIdentityKeys().then(function(a){a=a.identityPrivateKey;return d("ArmadilloSignatures").armadilloSign(a,new Uint8Array(e))}).then(function(a){return c("LSResult")(a.buffer)})};a.__nop_name__="LSCreateSignatureWithArmadilloKey";g["default"]=a}),98);
__d("LSCreateSignature_v2.nop",["CryptoLogger","LSResult","Promise","UInt8Array","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("X25519").__setRef("LSCreateSignature_v2.nop");function j(a){return c("LSResult")(a)}function k(a,b){return d("UInt8Array").concatBytes([b,a].map(function(a){return new Uint8Array(a)}))}a=function(a,c,e,f,g){var l=d("CryptoLogger").CryptoLogger("create_signature_v2");if(f.byteLength!==1){l.mustfix("Bad aad for signing, should be 1 byte");return(h||(h=b("Promise"))).resolve(j(void 0))}return i.load().then(function(a){var c=a.secretKeyFromBytes(new Uint8Array(e),a.KeyPurpose.Signing);if(c!=null)return a.sign(c,k(g,f)).then(function(a){return(h||(h=b("Promise"))).resolve(j(a.buffer))});l.mustfix("No Signature Private key");return(h||(h=b("Promise"))).resolve(j(void 0))})};a.__nop_name__="LSCreateSignature_v2";g["default"]=a}),98);
__d("LSGenerateLocalKeys",["LSArrayGetObjectAt","LSCreateAuthKeyPair.nop","LSCreateEncryptionKeyPair.nop","LSCreateSignatureKeyPair.nop","LSCreateSignature_v2.nop","LSIsEncryptionVersionSecure","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][generateLocalKeys] Beginning execution."),d[1]=c.i64.of_float(Date.now()),a[0]?c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!0}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[29]=new c.Map(),d[29].set("error_msg","Expected a nonempty query result"),d[29].set("code",c.i64.cast([0,3])),d[29].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[30]=c.createArray(),d[31]=(d[30].push(d[29]),d[30]),e=[void 0,d[30]],d[17]=e[0],d[18]=e[1]):(b=a.item,d[29]=new c.Map(),d[29].set("backup_id",b.backupId),d[29].set("device_public_key_blob",b.devicePublicKeyBlob),d[29].set("device_private_key_blob",b.devicePrivateKeyBlob),d[29].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[29].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[29].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[29].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[29].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[29].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[29].set("orf_client_state_v2_blob",void 0),d[29].set("orf_v2_authority_level",void 0),d[29].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[29].set("device_id",b.deviceId),d[29].set("backup_tenancy",b.backupTenancy),d[29].set("encryption_version",b.encryptionVersion),d[29].set("revision_version",b.revisionVersion),d[29].set("initialize_restore_result",void 0),d[29].set("device_creation_timestamp_sec",void 0),d[29].set("authority_level",b.authorityLevel),e=[d[29],void 0],d[17]=e[0],d[18]=e[1])})},function(a){return d[20]=new c.Map(),d[20].set("value",d[17]),d[20].set("errors",d[18]),d[21]=d[20].get("value"),d[21]!==void 0?c.sequence([function(a){return d[29]=d[21].get("backup_id"),d[30]=d[21].get("device_public_key_blob"),d[31]=d[21].get("device_private_key_blob"),d[32]=d[21].get("epoch_storage_public_key_blob"),d[33]=d[21].get("epoch_storage_private_key_blob"),d[34]=d[21].get("epoch_auth_public_key_blob"),d[35]=d[21].get("epoch_auth_private_key_blob"),d[36]=d[21].get("mailbox_root_key_blob"),d[37]=d[21].get("ocmf_client_state_blob"),d[38]=d[21].get("orf_client_state_v2_blob"),d[39]=d[21].get("orf_v2_authority_level"),d[40]=d[21].get("oblivious_validation_token_blob"),d[41]=d[21].get("device_id"),d[42]=d[21].get("backup_tenancy"),d[43]=d[21].get("encryption_version"),d[44]=d[21].get("revision_version"),d[45]=d[21].get("initialize_restore_result"),d[46]=d[21].get("device_creation_timestamp_sec"),d[47]=d[21].get("authority_level"),c.i64.neq(d[41],void 0)?c.sequence([function(a){return d[55]=void 0,c.i64.neq(d[55],void 0)?c.resolve(d[56]=d[55]):c.sequence([function(a){return d[59]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[60]=a[0],a})},function(a){return d[60]?d[69]=(d[59].push(c.i64.cast([0,0])),d[59]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[61]=a[0],a})},function(a){return d[61]?d[69]=(d[59].push(c.i64.cast([0,2])),d[59]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[62]=a[0],a})},function(a){return d[62]?d[69]=(d[59].push(c.i64.cast([0,3])),d[59]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[63]=a[0],a})},function(a){return d[63]?d[69]=(d[59].push(c.i64.cast([0,4])),d[59]):0,d[64]=c.createArray(),d[65]=c.i64.of_int32(d[59].length),c.i64.gt(d[65],c.i64.cast([0,0]))?c.loopAsync(d[65],function(a){return d[69]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[59],d[69]).then(function(a){return a=a,d[70]=a[0],d[71]=a[1],a})},function(a){return d[72]=(d[64].push(d[70]),d[64])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[69]=c.createArray(),d[70]=c.i64.of_int32(d[64].length),c.i64.gt(d[70],c.i64.cast([0,0]))?c.loopAsync(d[70],function(a){return d[72]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[64],d[72]).then(function(a){return a=a,d[73]=a[0],d[74]=a[1],a})},function(a){return d[75]=(d[69].push(c.i64.to_string(d[73])),d[69])}])}):c.resolve()},function(a){return d[71]=d[69].join(","),d[66]=d[71]}])},function(a){return d[64].some(function(a){return c.i64.eq(d[43],a)})?d[67]=d[43]:d[67]=void 0,c.i64.neq(d[67],void 0)?d[68]=d[67]:d[68]=void 0,d[56]=d[68]}])},function(a){return c.i64.neq(d[56],void 0)?d[57]=d[56]:d[57]=c.i64.cast([0,0]),c.i64.neq(d[42],void 0)?d[58]=d[42]:d[58]=c.i64.cast([0,1]),a=[!0,d[30],d[31],d[32],d[33],d[34],d[35]],d[48]=a[0],d[49]=a[1],d[50]=a[2],d[51]=a[3],d[52]=a[4],d[53]=a[5],d[54]=a[6]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateLocalKeysStoredProcedure] Fetching keys locally failed. Reason: 24"),d[56]="Fetching keys locally failed. Reason: 24",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGenerateLocalKeysStoredProcedure] ","",d[56]].join("")),d[55]=c.createArray(),void 0!==void 0?d[57]=(d[55].push(void 0),d[55]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateLocalKeysStoredProcedure",d[56],d[55],c.i64.cast([0,3]))},function(a){return a=[!1,c.blob("ZGV2aWNlX3B1YmxpY19rZXk="),c.blob("ZGV2aWNlX3ByaXZhdGVfa2V5"),c.blob("ZXBvY2hfc3RvcmFnZV9wdWJsaWNfa2V5"),c.blob("ZXBvY2hfc3RvcmFnZV9wcml2YXRlX2tleQ=="),c.blob("ZXBvY2hfYXV0aF9wdWJsaWNfa2V5"),c.blob("ZXBvY2hfYXV0aF9wcml2YXRlX2tleQ==")],d[48]=a[0],d[49]=a[1],d[50]=a[2],d[51]=a[3],d[52]=a[4],d[53]=a[5],d[54]=a[6],a}])},function(a){return a=[d[48],d[49],d[50],d[51],d[52],d[53],d[54]],d[22]=a[0],d[23]=a[1],d[24]=a[2],d[25]=a[3],d[26]=a[4],d[27]=a[5],d[28]=a[6],a}]):c.sequence([function(a){return d[29]=d[20].get("errors"),d[30]=d[20].get("errors"),function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGenerateLocalKeysStoredProcedure] Fetching keys locally failed. Reason: 1"),d[32]="Fetching keys locally failed. Reason: 1",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGenerateLocalKeysStoredProcedure] ","",d[32]].join("")),d[31]=c.createArray(),void 0!==void 0?d[33]=(d[31].push(void 0),d[31]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGenerateLocalKeysStoredProcedure",d[32],d[31],c.i64.cast([0,3]))},function(a){return a=[!1,c.blob("ZGV2aWNlX3B1YmxpY19rZXk="),c.blob("ZGV2aWNlX3ByaXZhdGVfa2V5"),c.blob("ZXBvY2hfc3RvcmFnZV9wdWJsaWNfa2V5"),c.blob("ZXBvY2hfc3RvcmFnZV9wcml2YXRlX2tleQ=="),c.blob("ZXBvY2hfYXV0aF9wdWJsaWNfa2V5"),c.blob("ZXBvY2hfYXV0aF9wcml2YXRlX2tleQ==")],d[22]=a[0],d[23]=a[1],d[24]=a[2],d[25]=a[3],d[26]=a[4],d[27]=a[5],d[28]=a[6],a}])},function(a){return a=[d[22],d[23],d[24],d[25],d[26],d[27],d[28]],d[2]=a[0],d[3]=a[1],d[4]=a[2],d[5]=a[3],d[6]=a[4],d[7]=a[5],d[8]=a[6],a}]):c.sequence([function(a){return c.nativeOperation(b("LSCreateSignatureKeyPair.nop")).then(function(a){return a=a,d[17]=a[0],d[18]=a[1],a})},function(a){return c.nativeOperation(b("LSCreateEncryptionKeyPair.nop")).then(function(a){return a=a,d[19]=a[0],d[20]=a[1],a})},function(a){return c.nativeOperation(b("LSCreateAuthKeyPair.nop")).then(function(a){return a=a,d[21]=a[0],d[22]=a[1],a})},function(a){return a=[!0,d[18],d[17],d[20],d[19],d[22],d[21]],d[2]=a[0],d[3]=a[1],d[4]=a[2],d[5]=a[3],d[6]=a[4],d[7]=a[5],d[8]=a[6],a}])},function(a){return d[2]?c.sequence([function(a){return c.nativeOperation(b("LSCreateSignature_v2.nop"),d[4],c.blob("MA=="),d[5]).then(function(a){return a=a,d[17]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateSignature_v2.nop"),d[4],c.blob("MQ=="),d[7]).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[19]=new c.Map(),d[19].set("device_private_key",d[4]),d[19].set("device_public_key",d[3]),d[20]=new c.Map(),d[20].set("epoch_storage_private_key",d[6]),d[20].set("epoch_storage_public_key",d[5]),d[21]=new c.Map(),d[21].set("epoch_auth_private_key",d[8]),d[21].set("epoch_auth_public_key",d[7]),d[22]=new c.Map(),d[22].set("device_key",d[19]),d[22].set("epoch_storage_key",d[20]),d[22].set("epoch_storage_public_key_sig",d[17]==null?c.blob("bnVsbA=="):d[17]),d[22].set("epoch_auth_key",d[21]),d[22].set("epoch_auth_public_key_sig",d[18]==null?c.blob("bnVsbA=="):d[18]),a=[d[22],void 0],d[9]=a[0],d[10]=a[1]}]):c.resolve((d[17]=new c.Map(),d[17].set("error_code",c.i64.cast([0,9])),d[17].set("stored_procedure","LSEncryptedBackupsGenerateLocalKeysStoredProcedure"),d[17].set("error_message",""),a=[void 0,d[17]],d[9]=a[0],d[10]=a[1]))},function(a){return d[11]=c.i64.of_float(Date.now()),d[12]=c.i64.random(),d[14]="Finishing execution. Execution time: ",d[15]=c.i64.to_string(c.i64.sub(d[11],d[0])),d[16]=" ms",d[13]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][generateLocalKeys] ",d[13],d[14],d[13],d[15],d[13],d[16]].join("")),c.i64.eq(c.i64.mod_(d[12],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[17]=",",d[18]=c.createArray(),void 0!==void 0?d[19]=(d[18].push(void 0),d[18]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"generateLocalKeys",[d[14],d[17],d[15],d[17],d[16]].join(""),d[18],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[9],d[10]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsGenerateLocalKeysStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state"];e.exports=a}),null);
__d("LSGetArmadilloPublicKey.nop",["CryptoLogger","EBDeps","Promise","RetUtil"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,c){return d("EBDeps").getDeps().getMAWIdentityKeys().then(function(a){return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult(a.identityPublicKey.buffer))})["catch"](function(a){var c=d("CryptoLogger").CryptoLogger("get_armadillo_keys");c.catching(a).mustfix("Failed to get identity keys.");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult())})};a.__nop_name__="LSGetArmadilloPublicKey";g["default"]=a}),98);
__d("LSGetOpenEpochKeys",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSDeleteBackupOnClient","LSIsMobileClient","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] Beginning execution."),d[11]="Querying latest epoch keys with authority level: ",a[0]?d[1]="OPTIMISTIC":d[1]="AUTHORITATIVE",d[2]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ",d[2],d[11],d[2],d[1]].join("")),c.resolve()},function(e){return a[0]?d[3]="OPTIMISTIC":d[3]="AUTHORITATIVE",c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,2842]),c.i64.cast([0,2]),void 0,d[3]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[16]?d[17]=!0:d[17]=!1,d[17]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[19]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[19]].join("")),d[18]=c.createArray(),void 0!==void 0?d[20]=(d[18].push(void 0),d[18]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[19],d[18],c.i64.cast([0,3]))):c.resolve()}])},function(a){return c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,2844]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[16]?d[17]=!0:d[17]=!1,d[17]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[19]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[19]].join("")),d[18]=c.createArray(),void 0!==void 0?d[20]=(d[18].push(void 0),d[18]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[19],d[18],c.i64.cast([0,3]))):c.resolve()}])},function(b){return d[4]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(b){return a[0]||c.i64.eq(b.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[16]=(d[4].push(c.blobs.to_string(a.epochAnonIdBlob)),d[4])})},function(a){return d[5]=c.i64.of_int32(d[4].length),c.i64.gt(d[5],c.i64.cast([0,0]))?c.sequence([function(a){return d[16]=c.i64.of_int32(d[4].length),c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,2845]),c.i64.cast([0,2]),void 0,c.i64.to_string(d[16])):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[21]=a[0],a})},function(a){return d[21]?d[22]=!0:d[22]=!1,d[22]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[24]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[24]].join("")),d[23]=c.createArray(),void 0!==void 0?d[25]=(d[23].push(void 0),d[23]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[24],d[23],c.i64.cast([0,3]))):c.resolve()}])},function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[4],c.i64.cast([0,0])).then(function(a){return a=a,d[17]=a[0],d[18]=a[1],a})},function(a){return d[19]=d[17],d[20]=c.i64.of_int32(d[4].length),c.i64.gt(d[20],c.i64.cast([0,0]))?c.loopAsync(d[20],function(a){return d[21]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[4],d[21]).then(function(a){return a=a,d[22]=a[0],d[23]=a[1],a})},function(a){return c.i64.eq([0,d[19].length],[0,d[22].length])?(d[19]===d[22]?d[25]=d[19]:(d[19]>d[22]?d[26]=d[19]:d[26]=d[22],d[25]=d[26]),d[24]=d[25]):(c.i64.gt([0,d[19].length],[0,d[22].length])?d[25]=d[19]:d[25]=d[22],d[24]=d[25]),d[19]=d[24]}])}):c.resolve()},function(a){return d[6]=d[19]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] Epoch anon ID list is empty."),d[17]="Epoch anon ID list is empty.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ","",d[17]].join("")),d[16]=c.createArray(),void 0!==void 0?d[18]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGetOpenEpochKeysStoredProcedure",d[17],d[16],c.i64.cast([0,3]))},function(a){return c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,2846]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[18]?d[19]=!0:d[19]=!1,d[19]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[21]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[21]].join("")),d[20]=c.createArray(),void 0!==void 0?d[22]=(d[20].push(void 0),d[20]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[21],d[20],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[6]=void 0}])},function(a){return d[6]!==void 0?c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,2863]),c.i64.cast([0,2]),void 0,d[6]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[16]?d[17]=!0:d[17]=!1,d[17]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[19]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[19]].join("")),d[18]=c.createArray(),void 0!==void 0?d[20]=(d[18].push(void 0),d[18]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[19],d[18],c.i64.cast([0,3]))):c.resolve()}]):c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,2864]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[16]?d[17]=!0:d[17]=!1,d[17]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[19]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[19]].join("")),d[18]=c.createArray(),void 0!==void 0?d[20]=(d[18].push(void 0),d[18]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[19],d[18],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[12]=c.blobs.of_string(d[6]),c.blobs.neq(d[12],void 0)?c.sequence([function(a){return c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,2847]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[18]?d[19]=!0:d[19]=!1,d[19]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[21]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[21]].join("")),d[20]=c.createArray(),void 0!==void 0?d[22]=(d[20].push(void 0),d[20]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[21],d[20],c.i64.cast([0,3]))):c.resolve()}])},function(a){return c.filter(c.db.table(169).fetch(),function(a){return c.blobs.eq(a.epochAnonIdBlob,d[12])}).next().then(function(a,e){var f=a.done;a=a.value;return f?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] Found a most recent epoch anon ID, but unable to locate it again in the table. This can really only happen if the tablesomehow changed in the middle of our transaction."),d[19]="Found a most recent epoch anon ID, but unable to locate it again in the table. This can really only happen if the tablesomehow changed in the middle of our transaction.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ","",d[19]].join("")),d[18]=c.createArray(),void 0!==void 0?d[20]=(d[18].push(void 0),d[18]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGetOpenEpochKeysStoredProcedure",d[19],d[18],c.i64.cast([0,3]))},function(a){return c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,2848]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[20]?d[21]=!0:d[21]=!1,d[21]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[23]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[23]].join("")),d[22]=c.createArray(),void 0!==void 0?d[24]=(d[22].push(void 0),d[22]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[23],d[22],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[16]=void 0}]):(e=a.item,c.sequence([function(a){return d[22]=e.epochAnonIdBlob,d[20]="Using latest epoch: ",d[21]=c.blobs.to_string(d[22]),d[18]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ",d[18],d[20],d[18],d[21]].join("")),c.resolve()},function(a){return d[19]=new c.Map(),d[19].set("epoch_id",e.epochId),d[19].set("epoch_root_key",e.epochRootKeyBlob),d[19].set("epoch_anon_id",d[22]),d[16]=d[19]}]))})},function(a){return d[7]=d[16]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] No epochs whatsoever on client! This should absolutely never happen. Deleting backup from client."),d[17]="No epochs whatsoever on client! This should absolutely never happen. Deleting backup from client.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ","",d[17]].join("")),d[16]=c.createArray(),void 0!==void 0?d[18]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGetOpenEpochKeysStoredProcedure",d[17],d[16],c.i64.cast([0,3]))},function(a){return c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,2843]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[18]?d[19]=!0:d[19]=!1,d[19]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[21]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[21]].join("")),d[20]=c.createArray(),void 0!==void 0?d[22]=(d[20].push(void 0),d[20]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[21],d[20],c.i64.cast([0,3]))):c.resolve()}])},function(a){return c.storedProcedure(b("LSDeleteBackupOnClient"),void 0,"get_open_epoch_keys",!0,void 0,"Attempted to fetch epoch keys when there are no epochs on the client.",!1)},function(a){return d[7]=void 0}])},function(a){return d[8]=c.i64.of_float(Date.now()),d[9]=c.i64.random(),d[13]="Finishing execution. Execution time: ",d[14]=c.i64.to_string(c.i64.sub(d[8],d[0])),d[15]=" ms",d[10]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure] ",d[10],d[13],d[10],d[14],d[10],d[15]].join("")),c.i64.eq(c.i64.mod_(d[9],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[16]=",",d[17]=c.createArray(),void 0!==void 0?d[18]=(d[17].push(void 0),d[17]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsGetOpenEpochKeysStoredProcedure",[d[13],d[16],d[14],d[16],d[15]].join(""),d[17],c.i64.cast([0,4]))):c.resolve()},function(a){return e[0]=d[7]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsGetOpenEpochKeysStoredProcedure";a.__tables__=["secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSHandleCreateVirtualDeviceFailure",["LSAppendDataTraceAddon","LSDeleteBackupOnClient","LSFlushDataTrace.nop","LSIsMobileClient","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure] Beginning execution."),c.sequence([function(d){return a[2]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[2],c.i64.cast([0,1412]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[7]=a[0],a})},function(a){return d[7]?d[8]=!0:d[8]=!1,d[8]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[10]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[10]].join("")),d[9]=c.createArray(),void 0!==void 0?d[11]=(d[9].push(void 0),d[9]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[10],d[9],c.i64.cast([0,3]))):c.resolve()}])},function(e){return a[1]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure] Failure when creating virtual device, deleting backup"),d[8]="Failure when creating virtual device, deleting backup",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure] ","",d[8]].join("")),d[7]=c.createArray(),void 0!==void 0?d[9]=(d[7].push(void 0),d[7]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure",d[8],d[7],c.i64.cast([0,3]))},function(d){return c.storedProcedure(b("LSDeleteBackupOnClient"),a[0],void 0,!1,a[2],void 0,!1)}]):c.sequence([function(e){return d[7]="Failure when creating virtual device",d[7]!==void 0?(function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure] ","",d[7]].join("")),d[8]=c.createArray(),a[2]!==void 0?d[9]=(d[8].push(a[2]),d[8]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure",d[7],d[8],c.i64.cast([0,3]))):c.resolve()},function(a){return c.db.table(178).put({pk:c.i64.cast([0,1]),recoveryCodeStatus:c.i64.cast([0,3])})}])},function(e){return c.sequence([function(d){return a[2]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[2]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[7]=a[0],a})},function(a){return d[7]?d[8]=!0:d[8]=!1,d[8]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[10]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[10]].join("")),d[9]=c.createArray(),void 0!==void 0?d[11]=(d[9].push(void 0),d[9]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[10],d[9],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[1]=c.i64.of_float(Date.now()),d[2]=c.i64.random(),d[4]="Finishing execution. Execution time: ",d[5]=c.i64.to_string(c.i64.sub(d[1],d[0])),d[6]=" ms",d[3]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure] ",d[3],d[4],d[3],d[5],d[3],d[6]].join("")),c.i64.eq(c.i64.mod_(d[2],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[7]=",",d[8]=c.createArray(),void 0!==void 0?d[9]=(d[8].push(void 0),d[8]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure",[d[4],d[7],d[5],d[7],d[6]].join(""),d[8],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsHandleCreateVirtualDeviceFailureStoredProcedure";a.__tables__=["secure_encrypted_backups_recovery_code_status"];e.exports=a}),null);
__d("ObliviousConsistentMappingFunction",["FBLogger","UInt8Array","nullthrows","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("ristretto255").__setRef("ObliviousConsistentMappingFunction");function i(a){return a.some(function(a){return a!==0})}function j(a){while(!0){var b=a.getRandom();if(i(b))return b;continue}return new Uint8Array(0)}var k=c("nullthrows")(d("UInt8Array").fromHexString("edd3f55c1a631258d69cf7a2def9de1400000000000000000000000000000010"));function l(a){return"ClientState has length "+String(a)+", expected "+String(32)}function a(a){return"ClientState is greater or equal to max: "+a.toString()}var m="ClientState is zero.";function n(a){var b=a.length;if(b!==32)throw c("FBLogger")("wmi_eb").mustfixThrow(l(b));b=a.reduce(function(b,a){if(b)return!0;else return a>0},!1);if(!b)throw c("FBLogger")("wmi_eb").mustfixThrow(m);b=!1;for(var d=31;d>=0;--d)if(!b){var e=a[d],f=k[d];if(e>f)throw c("FBLogger")("wmi_eb").mustfixThrow("ClientState is greater or equal to max: "+a.toString());e<f&&(b=!0)}if(!b)throw c("FBLogger")("wmi_eb").mustfixThrow("ClientState is greater or equal to max: "+a.toString())}function b(a){n(a);return h.load().then(function(b){var c=j(b.scalar),d=b.scalar.mul(a,c);b=b.scalar.invert(c);return{evolveToken:b,newClientState:d}})}g.checkNonZero=i;g.maxState=k;g.buildInputLengthErrorMsg=l;g.buildInputValueErrorMsg=a;g.getInputZeroErrorMsg=m;g.clientEvolve=b}),98);
__d("LSOcmfClientEvolve_v2.nop",["CryptoLogger","ObliviousConsistentMappingFunction"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,c){return d("ObliviousConsistentMappingFunction").clientEvolve(new Uint8Array(c)).then(function(a){return[a.newClientState.buffer,a.evolveToken.buffer]})["catch"](function(a){d("CryptoLogger").captureError(d("CryptoLogger").CryptoLogger("ocmf_client_evolve_v2"),a).mustfix("Failed to evolve client.");throw a})};a.__nop_name__="LSOcmfClientEvolve_v2";g["default"]=a}),98);
__d("checkLSRecoveryCodeMatch",["LSBinaryToHex.nop","LSShape","LSVec","Promise","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,e,f,g,i){i=c("LSVec").toArray(i).map(function(a){return d("LSShape").toRecord(a)});var j=c("LSBinaryToHex.nop")(a,e,c("nullthrows")(f)),k=function(d,i){return d.then(function(d){if(d[0]!=null)return(h||(h=b("Promise"))).resolve(d);d=c("LSBinaryToHex.nop")(a,e,i.virtual_device_id);return(h||(h=b("Promise"))).all([j,d]).then(function(a){var c=a[0],d=a[1];a=c.length===d.length&&c.every(function(a,b){return a===d[b]});if(a)return(h||(h=b("Promise"))).resolve([f,g]);else return(h||(h=b("Promise"))).resolve([void 0,void 0])})})};return i.reduce(k,(h||(h=b("Promise"))).resolve([void 0,void 0]))}g["default"]=a}),98);
__d("deriveLSKey",["I64","LSCreateDerivedKeys.nop","LSCryptoUtils","LSVec"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e,f,g){g=g==="1"?(h||(h=d("I64"))).of_string("8"):(h||(h=d("I64"))).of_string("16");g=c("LSVec").ofArray([g,(h||(h=d("I64"))).of_string("32")]);return c("LSCreateDerivedKeys.nop")(a,b,d("LSCryptoUtils").strToBuf(f),void 0,d("LSCryptoUtils").strToBuf(e),g).then(function(a){a=a[0];if(a==null)return[void 0,void 0];a=c("LSVec").toArray(a);return a.length===2?[a[0],a[1]]:[void 0,void 0]})}g["default"]=a}),98);
__d("parseLSRecoveryCode",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c=a.substring(0,1);if(a.length!==40||c!=="1"&&c!=="2")return;var d=c==="1"?35:34,e=a.substring(1,2);a=a.substring(2,d+2);d="BackupRecoveryCode_v"+c+"_"+e+"_"+b;return[a,d,c]}f["default"]=a}),66);
__d("LSParseRecoveryCode_v2.nop",["CryptoLogger","GF32RecoveryCodes","Promise","checkLSRecoveryCodeMatch","deriveLSKey","parseLSRecoveryCode"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,e,f,g,i){var j=d("CryptoLogger").CryptoLogger("parse_recovery_code_v2");f=c("parseLSRecoveryCode")(f,g);if(f!=null)return c("deriveLSKey")(a,e,f[0],f[1],f[2]);else{i&&j.mustfix("could not parse recovery code with uid");return(h||(h=b("Promise"))).resolve([void 0,void 0])}}var j=new Map([["B","8"],["G","C"],["I","1"],["O","0"]]),k=new RegExp("["+Array.from(j.keys()).join("")+"]","g");function l(a){return a.replace(k,function(a){return j.get(a)||a})}a=function(a,e,f,g,j){if(f.length!==40)return(h||(h=b("Promise"))).resolve([void 0,void 0]);var k=f.substring(0,2),m=l(f.substring(2,40));f=d("GF32RecoveryCodes").getCandidateCodes(m);var n=function(d,f){return d.then(function(d){if(d[0]!=null)return(h||(h=b("Promise"))).resolve(d);else return i(a,e,k+f,g,!1).then(function(d){var f=d[0];if(f==null)return(h||(h=b("Promise"))).resolve([void 0,void 0]);else return c("checkLSRecoveryCodeMatch")(a,e,f,d[1],j)}).then(function(a){if(a[0]==null)return[void 0,void 0];else return a})})};return f.reduce(n,(h||(h=b("Promise"))).resolve([void 0,void 0])).then(function(c){return c[0]==null?i(a,e,k+m,g,!0):(h||(h=b("Promise"))).resolve(c)})};a.__nop_name__="LSParseRecoveryCode_v2";g["default"]=a}),98);
__d("MWPakeQPLEvents",["qpl"],(function(a,b,c,d,e,f,g){"use strict";a=c("qpl")._(231349365,"1751");g.pakeInitiatorQplEvent=a}),98);
__d("PAKEMessageQplLoggingAction",[],(function(a,b,c,d,e,f){a=Object.freeze({ADD_MARKER:0,END_SUCCESS:1,END_FAILURE:2,ADD_ERROR_ANNOTATION:3});f["default"]=a}),66);
__d("LSQplInteractionHelper.nop",["FBLogger","I64","MWPakeQPLEvents","PAKEMessageQplLoggingAction","Promise","QPLUserFlow"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(a,e,f,g,j){a=(i||(i=d("I64"))).to_int32(g);switch(a){case c("PAKEMessageQplLoggingAction").ADD_MARKER:f==null?c("FBLogger")("wmi_eb").mustfix("PAKE: markerName is null when adding DS PAKE marker."):c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,f);break;case c("PAKEMessageQplLoggingAction").END_FAILURE:f==null?c("FBLogger")("wmi_eb").mustfix("PAKE: markerName is null when adding failure DS PAKE marker."):c("QPLUserFlow").endFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,f);break;case c("PAKEMessageQplLoggingAction").END_SUCCESS:c("QPLUserFlow").endSuccess(d("MWPakeQPLEvents").pakeInitiatorQplEvent);break;case c("PAKEMessageQplLoggingAction").ADD_ERROR_ANNOTATION:j==null?c("FBLogger")("wmi_eb").mustfix("PAKE: pakeMessageType is null when annotating PAKE error."):c("QPLUserFlow").addAnnotations(d("MWPakeQPLEvents").pakeInitiatorQplEvent,{"int":{errorCode:(i||(i=d("I64"))).to_int32(j)}});break}return(h||(h=b("Promise"))).resolve()};a.__nop_name__="LSQplInteractionHelper";g["default"]=a}),98);
__d("MWEncryptedBackupsInitializeRestore",["EBGetLatestChatJids","EBSetRestoreStatusForInitialRestore","ExecutionEnvironment","FBLogger","LSRequestId","MAWBridge","MAWBridgeSendAndReceive","MAWEBRestoreTrackingUtils","MAWMpsGating","MAWUICacheServices","MpsOverBridge","MpsTypes","getErrorSafe","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=20;function a(a){var b=c("LSRequestId").generate();if(d("MAWMpsGating").isFullMpsEnabled())return k(a,b,l,"FULL_MPS");else return k(a,b,m,"MPS")}async function k(a,b,e,f){c("FBLogger")("messenger_web").INFO(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Initializing restore with ",""])),f);n(f);try{d("MAWEBRestoreTrackingUtils").markEBRestoreInitial({querySource:"GQL_MAIN_THREAD",traceId:b});f=await d("EBGetLatestChatJids").getLatestChatJids(a,50);if(f.success===!1){d("MAWEBRestoreTrackingUtils").markEBRestoreFail(b,(i||(i=c("ExecutionEnvironment"))).isInWorker,"latestChatJidsResultOrError: "+c("getErrorSafe")(f.error).message);return}await d("EBSetRestoreStatusForInitialRestore").setRestoreStatusForInitialRestore(f.value,a);if(d("MAWMpsGating").isMpsSnippetsCacheServiceEnabled()||c("gkx")("2792")){var g=d("MAWUICacheServices").getMAWUICacheServices();c("promiseDone")(g.getFromScratchSkippingCacheAndNotifyListenersFor("snippets",f.value.map(d("MpsTypes").toThreadId)))}await e(f.value);d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(b)}catch(a){d("MAWEBRestoreTrackingUtils").markEBRestoreFail(b,(i||(i=c("ExecutionEnvironment"))).isInWorker,"initialize_restore_failed: "+c("getErrorSafe")(a).message);throw a}finally{await d("EBSetRestoreStatusForInitialRestore").resetClientRestoreStatus(a)}}function l(a){return Promise.all(a.map(function(a){return d("MpsOverBridge").mps().loadMessages({debug:{purpose:"InitializeRestore"},direction:"desc",from:[d("MpsTypes").toTimestamp(Number.MAX_SAFE_INTEGER),void 0],numMessages:j,threadId:d("MpsTypes").toThreadId(a)})})).then(function(){})}function m(a){return d("MAWBridgeSendAndReceive").sendAndReceive("backend","maw_load_msgs_by_chat_jids_into_maw",{actionType:"pre-load",config:a.map(function(a){return{chatJid:a,direction:"before",includeLowerBoundMsg:!0,lowerBoundSortOrderMs:Date.now(),numMsgs:j}})})}function n(a){d("MAWBridge").getBridge().fireAndForget("backend","logInitRestoreMethodForDebugging",{method:a})}g.initializeRestore=a}),98);
__d("WASmaxInAbPropsIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","error");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQErrorResponseMixin=a}),98);
__d("WASmaxInAbPropsIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",400);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBadRequestMixin=a}),98);
__d("WASmaxInAbPropsIQErrorFeatureNotImplementedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","feature-not-implemented");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",501);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorFeatureNotImplementedMixin=a}),98);
__d("WASmaxInAbPropsNoRetryErrors",["WAResultOrError","WASmaxInAbPropsIQErrorBadRequestMixin","WASmaxInAbPropsIQErrorFeatureNotImplementedMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInAbPropsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInAbPropsIQErrorFeatureNotImplementedMixin").parseIQErrorFeatureNotImplementedMixin(a);return c.success?d("WAResultOrError").makeResult({name:"IQErrorFeatureNotImplemented",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorFeatureNotImplemented"],[b,c])}g.parseNoRetryErrors=a}),98);
__d("WASmaxInAbPropsGetExperimentConfigResponseErrorNoRetry",["WAResultOrError","WASmaxInAbPropsIQErrorResponseMixin","WASmaxInAbPropsNoRetryErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInAbPropsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInAbPropsNoRetryErrors").parseNoRetryErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorNoRetryErrors:b.value}))}g.parseGetExperimentConfigResponseErrorNoRetry=a}),98);
__d("WASmaxInAbPropsIQErrorInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","internal-server-error");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",500);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorInternalServerErrorMixin=a}),98);
__d("WASmaxInAbPropsGetExperimentConfigResponseErrorRetry",["WAResultOrError","WASmaxInAbPropsIQErrorInternalServerErrorMixin","WASmaxInAbPropsIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;c=d("WASmaxInAbPropsIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(c.value);if(!c.success)return c;a=d("WASmaxInAbPropsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({errorIQErrorInternalServerErrorMixin:c.value},a.value))}g.parseGetExperimentConfigResponseErrorRetry=a}),98);
__d("WASmaxInAbPropsExperimentConfigMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"prop");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"config_code",1,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").attrString(a,"config_value");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"config_expo_key",0,void 0);return!a.success?a:d("WAResultOrError").makeResult({configCode:b.value,configValue:c.value,configExpoKey:a.value})}g.parseExperimentConfigMixin=a}),98);
__d("WASmaxInAbPropsSamplingConfigMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"prop");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"event_code",1,void 0);if(!b.success)return b;a=d("WASmaxParseUtils").attrIntRange(a,"sampling_weight",-1e4,1e4);return!a.success?a:d("WAResultOrError").makeResult({eventCode:b.value,samplingWeight:a.value})}g.parseSamplingConfigMixin=a}),98);
__d("WASmaxInAbPropsConfigs",["WAResultOrError","WASmaxInAbPropsExperimentConfigMixin","WASmaxInAbPropsSamplingConfigMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInAbPropsExperimentConfigMixin").parseExperimentConfigMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"ExperimentConfig",value:b.value});var c=d("WASmaxInAbPropsSamplingConfigMixin").parseSamplingConfigMixin(a);return c.success?d("WAResultOrError").makeResult({name:"SamplingConfig",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["ExperimentConfig","SamplingConfig"],[b,c])}g.parseConfigs=a}),98);
__d("WASmaxInAbPropsIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQResultResponseMixin=a}),98);
__d("WASmaxInAbPropsGetExperimentConfigResponseSuccess",["WAResultOrError","WASmaxInAbPropsConfigs","WASmaxInAbPropsIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"prop");if(!b.success)return b;b=d("WASmaxInAbPropsConfigs").parseConfigs(a);return!b.success?b:d("WAResultOrError").makeResult({configs:b.value})}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"erid");if(!b.success)return b;b=d("WASmaxParseUtils").contentBytesRange(a,1,100);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"props");if(!c.success)return c;var e=d("WASmaxParseUtils").optionalChildWithTag(a,"erid",i);if(!e.success)return e;var f=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,c.value,"protocol","1");if(!f.success)return f;var g=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,c.value,"ab_key");if(!g.success)return g;var j=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,c.value,"hash");if(!j.success)return j;var k=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,c.value,"refresh",0,void 0);if(!k.success)return k;var l=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,c.value,"refresh_id",0,void 0);if(!l.success)return l;a=d("WASmaxInAbPropsIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"prop",0,Infinity,h);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({propsProtocol:f.value,propsAbKey:g.value,propsHash:j.value,propsRefresh:k.value,propsRefreshId:l.value},a.value,{erid:e.value,propsProp:b.value}))}g.parseGetExperimentConfigResponseSuccessPropsProp=h;g.parseGetExperimentConfigResponseSuccessErid=i;g.parseGetExperimentConfigResponseSuccess=a}),98);
__d("WASmaxOutAbPropsBaseIQGetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"get"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQGetRequestMixin=a}),98);
__d("WASmaxOutAbPropsGetExperimentConfigRequest",["WASmaxAttrs","WASmaxJsx","WASmaxOutAbPropsBaseIQGetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(a){a=a.propsHash;a=d("WASmaxOutAbPropsBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(d("WASmaxJsx").smax("iq",{xmlns:"abt",to:d("WAWap").S_WHATSAPP_NET},d("WASmaxJsx").smax("props",{protocol:"1",hash:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)})));return a}g.makeGetExperimentConfigRequest=a}),98);
__d("WASmaxAbPropsGetExperimentConfigRPC",["WAComms","WASmaxInAbPropsGetExperimentConfigResponseErrorNoRetry","WASmaxInAbPropsGetExperimentConfigResponseErrorRetry","WASmaxInAbPropsGetExperimentConfigResponseSuccess","WASmaxOutAbPropsGetExperimentConfigRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){async function a(a,b){a=d("WASmaxOutAbPropsGetExperimentConfigRequest").makeGetExperimentConfigRequest(a);b=await d("WAComms").sendSmaxStanza(a,b);var c=d("WASmaxInAbPropsGetExperimentConfigResponseSuccess").parseGetExperimentConfigResponseSuccess(b,a);if(c.success)return{name:"GetExperimentConfigResponseSuccess",value:c.value};var e=d("WASmaxInAbPropsGetExperimentConfigResponseErrorNoRetry").parseGetExperimentConfigResponseErrorNoRetry(b,a);if(e.success)return{name:"GetExperimentConfigResponseErrorNoRetry",value:e.value};b=d("WASmaxInAbPropsGetExperimentConfigResponseErrorRetry").parseGetExperimentConfigResponseErrorRetry(b,a);if(b.success)return{name:"GetExperimentConfigResponseErrorRetry",value:b.value};throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("GetExperimentConfig",{Success:c,ErrorNoRetry:e,ErrorRetry:b}))}g.sendGetExperimentConfigRPC=a}),98);
__d("WAGetAbPropsProtocol",["WALogger","WAResultOrError","WASmaxAbPropsGetExperimentConfigRPC"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(a){a=await d("WASmaxAbPropsGetExperimentConfigRPC").sendGetExperimentConfigRPC({propsHash:a});if(a.name==="GetExperimentConfigResponseSuccess"){var b=a.value,c=b.propsAbKey,e=b.propsHash,f=b.propsRefresh,g=b.propsRefreshId,j=b.propsProp;b=b.erid;j=i(j);var k=j.newProps;j=j.samplingConfigs;return d("WAResultOrError").makeResult({abKey:c,hash:e,refresh:f,refreshId:g,props:k,samplingConfigs:j,erid:b==null?void 0:b.elementValue})}d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["getAbPropsProtocol failed ",""])),a.value);return d("WAResultOrError").makeError()}function i(a){var b=[],c=[];a.forEach(function(a){a=a.configs;if(a.name==="ExperimentConfig"){var d;b.push({configCode:a.value.configCode,configValue:a.value.configValue,configExpoKey:(d=a.value.configExpoKey)==null?void 0:d.toString()})}else a.name==="SamplingConfig"&&c.push({eventCode:a.value.eventCode,samplingWeight:a.value.samplingWeight})});return{newProps:b,samplingConfigs:c}}g.getAbPropsProtocol=a}),98);
__d("WAAbPropsSync",["WAAbProps","WAAbPropsHelpers","WAGetAbPropsProtocol","WALogger","WAPromiseManagement","WAResultOrError","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;b=d("WAPromiseManagement").cacheWhilePending(function(){return"abProps"},a);function a(a){var b=a.sendHash;b=b===void 0?!0:b;var c=a.eventFlow;c==null||c.addPoint("sync_ab_props",{bool:{sendHash:b}});return b==null||b===!1?l(null,c):d("WAAbProps").getHash().then(function(a){return l(a,c)})}c=a;async function l(a,b){b==null||b.addPoint("fetch_ab_props");a=await d("WAGetAbPropsProtocol").getAbPropsProtocol(a);if(!a.success)d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["fetchAbProps failed"])));else{a=a.value;var c=a.abKey,e=a.hash,f=a.refresh;a=a.props;a=d("WAAbPropsHelpers").parseAbProps(d("WAAbProps").getConfig(),a);b==null||b.addPoint("save_ab_props");b=await m(c,e,f,a);b.success===!1&&(b.error,d("WALogger").LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["syncAbProps: detected no hash"]))))}c=await d("WAAbProps").getRefreshSecs();return{seconds:c}}async function m(a,b,c,e){var f=await d("WAAbProps").getAbProps();a={abKey:a!=null?a:f.abKey,hash:b!=null?b:f.hash,refresh:d("WAAbPropsHelpers").maybeUpdateRefresh(c),lastSyncTime:d("WATimeUtils").unixTime(),propValues:f.propValues,propExpoKeys:f.propExpoKeys,internalExpoKeys:f.internalExpoKeys,expoKeyStr:f.expoKeyStr};if(b==null){await d("WAAbProps").setAbProps(a);d("WALogger").LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["WAAbProps.update: detected no hash"])));return d("WAResultOrError").makeError("noHash")}d("WALogger").LOG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["WAAbProps.update: updating ab configs"])));c=e.values;b=e.expoKeys;e=d("WAAbPropsHelpers").maybeUpdatePropValues(c,f.propValues,d("WAAbProps").getConfig());c=d("WAAbPropsHelpers").maybeUpdateExpoKeys(b,f.propExpoKeys,d("WAAbProps").getConfig());b=c.propExpoKeys;c=c.expoKeysToDelete;var g,h;c=d("WAAbPropsHelpers").maybeUpdateInternalExpoKeys(c,f.internalExpoKeys);c!=null&&(g=c.internalExpoKeys,h=c.expoKeyStr);await d("WAAbProps").setAbProps(babelHelpers.extends({},a,{propValues:e,propExpoKeys:b,internalExpoKeys:g,expoKeyStr:h}));return d("WAResultOrError").makeResult()}g.syncAbProps=b;g.syncAbPropsDebug=c}),98);
__d("WACheckCiphertextInServer",["WAHttpResumeCheck","WAMediaUrl","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e){return e.run(async function(e,f){e=d("WAMediaUrl").buildUploadUrl(a,c,b,e.domain,f,!0);f=await d("WAHttpResumeCheck").httpResumeCheck(e);if(f.success)return d("WAResultOrError").makeResult(f);else{e=f.error;switch(e){case"server-timeout":case"unspecified-http-error":return d("WAResultOrError").makeError({progressMade:!0});default:return d("WAResultOrError").makeResult(d("WAResultOrError").makeError(e))}}}).then(function(a){return a!=null?a:d("WAResultOrError").makeError("max-attempts-exceeded")})}g.checkCiphertextInServer=a}),98);
__d("WAIsMediaKeyReusable",["WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=2*d("WATimeUtils").DAY_SECONDS;function a(a){var b=Math.floor(Math.random()*d("WATimeUtils").DAY_SECONDS);return a!=null&&d("WATimeUtils").happenedWithin(a,h+b)}g.MMS_MEDIA_KEY_TTL=h;g.isMediaKeyReusable=a}),98);
__d("WAFindReusableMediaEntry",["WAIsMediaKeyReusable","WAMediaUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=["fileEncSha256","mediaKey","mediaKeyTimestamp","uploadToken"];function a(a,b){if(a==null)return null;b=b.get(a);if(b==null)return null;a=d("WAMediaUtils").decodeMediaEntryData(b);b=a.fileEncSha256;var c=a.mediaKey,e=a.mediaKeyTimestamp,f=a.uploadToken;a=babelHelpers.objectWithoutPropertiesLoose(a,h);return c!=null&&f!=null&&b!=null&&e!=null&&d("WAIsMediaKeyReusable").isMediaKeyReusable(e)?babelHelpers["extends"]({},a,{fileEncSha256:b,mediaKey:c,mediaKeyTimestamp:e,uploadToken:f}):null}g.findReusableMediaEntryForArmadillo=a}),98);
__d("WASmaxInDevicesFetchSelfResponseError",["WAResultOrError","WASmaxInDevicesIQErrorResponseMixin","WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInDevicesIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup").parseRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup:b.value}))}g.parseFetchSelfResponseError=a}),98);
__d("WASmaxInDevicesDeviceInfoMixin",["WAResultOrError","WASmaxInDevicesIdentityKeyMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"platform");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"manufacturer");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function j(a){var b=d("WASmaxParseUtils").assertTag(a,"model");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function k(a){var b=d("WASmaxParseUtils").assertTag(a,"seen");if(!b.success)return b;b=d("WASmaxParseUtils").contentInt(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function l(a){var b=d("WASmaxParseUtils").assertTag(a,"creation");if(!b.success)return b;b=d("WASmaxParseUtils").contentInt(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function m(a){var b=d("WASmaxParseUtils").assertTag(a,"ip");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function n(a){var b=d("WASmaxParseUtils").assertTag(a,"location");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"latitude");if(!b.success)return b;var c=d("WASmaxParseUtils").attrString(a,"longitude");if(!c.success)return c;a=d("WASmaxParseUtils").contentString(a);return!a.success?a:d("WAResultOrError").makeResult({latitude:b.value,longitude:c.value,elementValue:a.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"device");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"platform",h);if(!b.success)return b;var c=d("WASmaxParseUtils").optionalChildWithTag(a,"manufacturer",i);if(!c.success)return c;var e=d("WASmaxParseUtils").optionalChildWithTag(a,"model",j);if(!e.success)return e;var f=d("WASmaxParseUtils").optionalChildWithTag(a,"seen",k);if(!f.success)return f;var g=d("WASmaxParseUtils").optionalChildWithTag(a,"creation",l);if(!g.success)return g;var o=d("WASmaxParseUtils").optionalChildWithTag(a,"ip",m);if(!o.success)return o;var p=d("WASmaxParseUtils").optionalChildWithTag(a,"location",n);if(!p.success)return p;var q=d("WASmaxParseUtils").attrIntRange(a,"id",1,999);if(!q.success)return q;a=d("WASmaxInDevicesIdentityKeyMixin").parseIdentityKeyMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({id:q.value},a.value,{platform:b.value,manufacturer:c.value,model:e.value,seen:f.value,creation:g.value,ip:o.value,location:p.value}))}g.parseDeviceInfoPlatform=h;g.parseDeviceInfoManufacturer=i;g.parseDeviceInfoModel=j;g.parseDeviceInfoSeen=k;g.parseDeviceInfoCreation=l;g.parseDeviceInfoIp=m;g.parseDeviceInfoLocation=n;g.parseDeviceInfoMixin=a}),98);
__d("WASmaxInDevicesFetchSelfResponseSuccess",["WAResultOrError","WASmaxInDevicesDeviceInfoMixin","WASmaxInDevicesIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"device");if(!b.success)return b;b=d("WASmaxInDevicesDeviceInfoMixin").parseDeviceInfoMixin(a);return!b.success?b:b}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"self");if(!c.success)return c;a=d("WASmaxInDevicesIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"device",1,25,h);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{selfDevice:b.value}))}g.parseFetchSelfResponseSuccessSelfDevice=h;g.parseFetchSelfResponseSuccess=a}),98);
__d("WASmaxOutDevicesFetchSelfRequest",["WASmaxJsx","WASmaxOutDevicesBaseIQGetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(){var a=d("WASmaxOutDevicesBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"fbid:devices"},d("WASmaxJsx").smax("self",null)));return a}g.makeFetchSelfRequest=a}),98);
__d("WASmaxDevicesFetchSelfRPC",["WAComms","WASmaxInDevicesFetchSelfResponseError","WASmaxInDevicesFetchSelfResponseSuccess","WASmaxOutDevicesFetchSelfRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){async function a(a){var b=d("WASmaxOutDevicesFetchSelfRequest").makeFetchSelfRequest();a=await d("WAComms").sendSmaxStanza(b,a);var c=d("WASmaxInDevicesFetchSelfResponseSuccess").parseFetchSelfResponseSuccess(a,b);if(c.success)return{name:"FetchSelfResponseSuccess",value:c.value};a=d("WASmaxInDevicesFetchSelfResponseError").parseFetchSelfResponseError(a,b);if(a.success)return{name:"FetchSelfResponseError",value:a.value};throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("FetchSelf",{Success:c,Error:a}))}g.sendFetchSelfRPC=a}),98);
__d("WAGetCurrentUserDeviceList",["WAAssertUnreachable","WAGlobals","WAJids","WALogger","WAPersistedJobManager","WASignalKeys","WASmaxDevicesFetchSelfRPC","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){if(a.isCurrentDevice&&b.isCurrentDevice){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Two devices were detected as isCurrentDevice in getCurrentUserDeviceList"])));return 0}if(a.isCurrentDevice)return-1;if(b.isCurrentDevice)return 1;if(a.lastSeen!=null&&b.lastSeen==null)return-1;if(a.lastSeen==null&&b.lastSeen!=null)return 1;if(a.lastSeen!=null&&b.lastSeen!=null){a=a.lastSeen;b=b.lastSeen;return b.getTime()-a.getTime()}return 0}async function a(a){a=await d("WASmaxDevicesFetchSelfRPC").sendFetchSelfRPC();switch(a.name){case"FetchSelfResponseError":var b=a.value.errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup;switch(b.name){case"RetryableIQError":var e=b.value.backoff;if(e!=null)throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{delay:e,type:"constant"},jitter:0});else throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{first:d("WATimeUtils").HOUR_MILLISECONDS/60,type:"exponential"},jitter:.1});default:b.name;e=b.value.code;throw c("err")("Failed with an error code "+e)}case"FetchSelfResponseSuccess":var f=d("WAJids").extractDeviceId(d("WAGlobals").getMyDeviceJid());return a.value.selfDevice.map(function(a){var b=a.creation,c=a.elementValue,e=a.id,g=a.ip,h=a.location,i=a.manufacturer,j=a.model,k=a.platform;a=a.seen;return{creationTime:b==null?null:d("WATimeUtils").toDate(d("WATimeUtils").castToUnixTime(b.elementValue)),id:d("WAJids").interpretAsDeviceId(e),identityKey:d("WASignalKeys").serializeIdentity(c),ipAddress:(b=g==null?void 0:g.elementValue)!=null?b:null,isCurrentDevice:e===f,lastSeen:a==null?null:d("WATimeUtils").toDate(d("WATimeUtils").castToUnixTime(a.elementValue)),latitude:h==null?null:parseFloat(h.latitude),location:(c=h==null?void 0:h.elementValue)!=null?c:null,longitude:h==null?null:parseFloat(h.longitude),manufacturer:(g=i==null?void 0:i.elementValue)!=null?g:null,model:(b=j==null?void 0:j.elementValue)!=null?b:null,platform:(e=k==null?void 0:k.elementValue)!=null?e:null}}).sort(i);default:return c("WAAssertUnreachable")(a.name)}}g.getCurrentUserDeviceList=a}),98);
__d("WASaveReceiptApi",["MAWTransactionMode","WADbTransactor","WAMsg"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({receipts:d("MAWTransactionMode").READWRITE},"saveReceipt",function(a){return function(b){return a.receipts.put({msgId:b.id.externalId.toString(),permittedIdentitiesPerDevice:b.permittedIdentitiesPerDevice,recipientDevices:b.recipientDevices,waMsgId:d("WAMsg").craftWAMsgIdString(b.id)}).then(function(){})}});g.saveReceipt=a}),98);
__d("WAPublishMessage",["FBLogger","WAGenReportingMeta","WAGlobals","WAJids","WALoadReceiptApi","WALogger","WAMsg","WASaveReceiptApi","WASendMsgInternal","WASentBytesCache","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i;async function j(a,b){var c=a.identities;a=a.messagePayload;a={author:a.protocolMsgId.author,chat:a.protocolMsgId.chat,externalId:a.protocolMsgId.externalId};var e=await d("WALoadReceiptApi").loadReceipt(a);if(e.success)return e.value;e=new Map();for(c of c){c[0];var f=c[1];for(f of f){var g=f[0],h=f[1];if(g===d("WAGlobals").getMyDeviceJid())continue;e.set(g,{pubKey:h})}}g=new Set();h={permittedIdentitiesPerDevice:e,recipientDevices:g,id:a};b.addPoint("save_receipts_start");await d("WASaveReceiptApi").saveReceipt(h);b.addPoint("save_receipts_end");return h}async function a(a,b){var e=a.messagePayload,f=a.identities;a=a.sendIdentity;a=a===void 0?!1:a;b.addPoint("prepare_receipt_start");f=await j({messagePayload:e,identities:f},b);b.addPoint("prepare_receipt_end");b.addPoint("calculate_recipients_start");var g=e.frankingKey,i=e.frankingVersion,m=e.messageBytes,n=e.backupDirective,o=e.messageType;e=e.protocolMsgId;f=k(f.permittedIdentitiesPerDevice);f=o.type==="text"&&o.invitedParticipantUserJid!=null?f.filter(function(a){return a.user===o.invitedParticipantUserJid||a.user===d("WAGlobals").getMyUserJid()}):f;b.addPoint("calculate_recipients_end",{int:{recipientsCount:f.length}});var p=o.type==="text"&&o.invitedParticipantUserJid!=null?o.invitedParticipantUserJid:e.chat,q=e.chat===d("WAGlobals").getMyUserJid();if(f.length===0&&!q)throw c("FBLogger")("wmi").mustfixThrow("Trying to send a message with no recipients");else if(f.length===0&&q)return{serverResponse:{type:"success",ts:d("WATimeUtils").unixTime(),phash:{type:"ok"},count:null,reportingMeta:null},encryption:{type:"user",messageTo:d("WAGlobals").getMyUserJid(),participants:[],phash:""}};q=a?await d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return l(a)},{operationType:"get_my_device_identity",flush:!1,afterInit:!0}):null;a=await (o.isRevoked===!0?Promise.resolve(null):d("WAGenReportingMeta").genReportingMeta(m.bytes,g,i));p=await d("WASendMsgInternal").sendMessageV2({type:"chat",messageBytes:m,chat:p,deviceIdentity:q,messageType:o,protocolMsgId:e,externalId:e.externalId,recipients:f,reportingMeta:a,backupDirective:n},b);q=p.serverResponse;q.type==="success"&&await d("WASentBytesCache").sentBytesCache().saveSentBytes({ts:q.ts,frankingKey:g,frankingVersion:i,messageBytes:m,backupDirective:n,messageType:o,protocolMsgId:e,waMsgId:d("WAMsg").craftWAMsgIdString({author:e.author,chat:e.chat,externalId:e.externalId})}).catch(function(a){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg failed to save sent bytes to cache: ",""])),a)});return p}function k(a){var b=new Map();a.forEach(function(a,c){a=a.pubKey;var e=d("WAJids").extractUserJid(c);a={identity:a,jid:c};c=b.get(e)||[];c.push(a);b.set(e,c)});return Array.from(b,function(a){var b=a[0];a=a[1];return{devicesInfo:a,user:b}})}async function l(a){try{a=await a.storage.loadIdentities(d("WAGlobals").getMyUserJid());a=a.get(d("WAGlobals").getMyDeviceJid());if(a!=null)return a;throw c("err")("missing-identity")}catch(a){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Error loading current device identity ",""])),a)}}g.publishMessage=a}),98);
__d("WASmaxInDevicesIQErrorBadRequestOrItemNotFoundMixinGroup",["WAResultOrError","WASmaxInDevicesIQErrorBadRequestMixin","WASmaxInDevicesIQErrorItemNotFoundMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInDevicesIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInDevicesIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);return c.success?d("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorItemNotFound"],[b,c])}g.parseIQErrorBadRequestOrItemNotFoundMixinGroup=a}),98);
__d("WASmaxInDevicesNonRetryableRemoveDeviceIQErrorMixin",["WAResultOrError","WASmaxInDevicesIQErrorBadRequestOrItemNotFoundMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxInDevicesIQErrorBadRequestOrItemNotFoundMixinGroup").parseIQErrorBadRequestOrItemNotFoundMixinGroup(a);return!b.success?b:d("WAResultOrError").makeResult({iQErrorBadRequestOrItemNotFoundMixinGroup:b.value})}g.parseNonRetryableRemoveDeviceIQErrorMixin=a}),98);
__d("WASmaxInDevicesRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup",["WAResultOrError","WASmaxInDevicesNonRetryableRemoveDeviceIQErrorMixin","WASmaxInDevicesRetryableIQErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInDevicesRetryableIQErrorMixin").parseRetryableIQErrorMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"RetryableIQError",value:b.value});var c=d("WASmaxInDevicesNonRetryableRemoveDeviceIQErrorMixin").parseNonRetryableRemoveDeviceIQErrorMixin(a);return c.success?d("WAResultOrError").makeResult({name:"NonRetryableRemoveDeviceIQError",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["RetryableIQError","NonRetryableRemoveDeviceIQError"],[b,c])}g.parseRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup=a}),98);
__d("WASmaxInDevicesRemoveResponseError",["WAResultOrError","WASmaxInDevicesIQErrorResponseMixin","WASmaxInDevicesRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInDevicesIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInDevicesRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup").parseRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup:b.value}))}g.parseRemoveResponseError=a}),98);
__d("WASmaxInDevicesRemoveResponseSuccess",["WASmaxInDevicesIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInDevicesIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!c.success?c:c}g.parseRemoveResponseSuccess=a}),98);
__d("WASmaxOutDevicesKeyDataMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.anyElementValue;a=d("WASmaxJsx").smax("smax$any",null,a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeKeyDataMixin=a}),98);
__d("WASmaxOutDevicesIdentityKeyMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutDevicesKeyDataMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxOutDevicesKeyDataMixin").mergeKeyDataMixin(d("WASmaxJsx").smax("identity",null),a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIdentityKeyMixin=a}),98);
__d("WASmaxOutDevicesRemoveRequest",["WASmaxJsx","WASmaxOutDevicesBaseIQSetRequestMixin","WASmaxOutDevicesIdentityKeyMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b=a.removeId;a=a.identityKeyMixinArgs;b=d("WASmaxOutDevicesBaseIQSetRequestMixin").mergeBaseIQSetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"fbid:devices"},d("WASmaxOutDevicesIdentityKeyMixin").mergeIdentityKeyMixin(d("WASmaxJsx").smax("remove",{id:d("WAWap").INT(b)}),a)));return b}g.makeRemoveRequest=a}),98);
__d("WASmaxDevicesRemoveRPC",["WAComms","WASmaxInDevicesRemoveResponseError","WASmaxInDevicesRemoveResponseSuccess","WASmaxOutDevicesRemoveRequest","WASmaxParsingFailure","WASmaxRpcUtils"],(function(a,b,c,d,e,f,g){async function a(a,b){a=d("WASmaxOutDevicesRemoveRequest").makeRemoveRequest(a);b=await d("WAComms").sendSmaxStanza(a,b);var c=d("WASmaxInDevicesRemoveResponseSuccess").parseRemoveResponseSuccess(b,a);if(c.success)return{name:"RemoveResponseSuccess",value:c.value};b=d("WASmaxInDevicesRemoveResponseError").parseRemoveResponseError(b,a);if(b.success)return{name:"RemoveResponseError",value:b.value};throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Remove",{Success:c,Error:b}))}g.sendRemoveRPC=a}),98);
__d("WARemoveDevice",["WALogger","WAPersistedJobManager","WAPushSafeTypes","WAResultOrError","WASignalOther","WASmaxDevicesRemoveRPC","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h,i;async function a(a,b){a=d("WAPushSafeTypes").unsafeNotNullable(b);b=a.deviceId;a=a.identity;d("WALogger").DEV(h||(h=babelHelpers.taggedTemplateLiteralLoose(["removeDevice called for device "," and identity ",""])),b,a);a=d("WASignalOther").sliceBytes(a,1,32);a=await d("WASmaxDevicesRemoveRPC").sendRemoveRPC({removeId:b,identityKeyMixinArgs:{anyElementValue:a}});d("WALogger").LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["removeDevice result for ",": "," "])),b,a);if(a.name==="RemoveResponseSuccess")return d("WAResultOrError").makeResult();else{a.name;b=a.value.errorRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup;if(b.name!=="RetryableIQError")return d("WAResultOrError").makeError();b.name;a=b.value.backoff;if(a!=null)throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{type:"constant",delay:a},jitter:0});else throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{type:"exponential",first:d("WATimeUtils").HOUR_MILLISECONDS/60},jitter:.1})}}g.removeDevice=a}),98);
__d("WARemoveCurrentDevice",["WAGetCurrentUserDeviceInfoApi","WAGlobals","WALogger","WARemoveDevice","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=async function(a){d("WALogger").DEV(h||(h=babelHelpers.taggedTemplateLiteralLoose(["removeCurrentDevice called for current device"])));var b=await d("WAGetCurrentUserDeviceInfoApi").getCurrentUserDeviceInfo();if(b==null){d("WALogger").WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["There is no stored user info, it was already deleted or this job was called twice, possibly from another tab"])));return d("WAResultOrError").makeResult()}var c=b.deviceId;b=b.identityKey;a=await d("WARemoveDevice").removeDevice(a,{deviceId:c,identity:b});if(a.success){await d("WAGlobals").getDependencies().clearSignalAndTempStores();return d("WAResultOrError").makeResult()}return d("WAResultOrError").makeResult()};g.removeCurrentDevice=a}),98);
__d("WASendAppDataFanoutProtocol",["WAAsMessageApplication","WABridge","WAConvertAppData","WAEncUserMsg","WAErrorMessage","WAGetCurrentUserDeviceInfoApi","WAGlobals","WAMsgApplication.pb","WAOdsEnums","WAResultOrError","WASmaxAppdataPublishPeerRPC","WATagsLogger","WATimeUtils","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o=d("WATagsLogger").TAGS(["sendAppDataFanout"]),p=24;function a(a,b){a=b.contents;var c=b.externalId,e=b.permittedIdentitiesPerDevice;b=b.checkPhash;b=b===void 0?"checkPhash":b;return q(a,c,e,b).catch(function(a){a=d("WAErrorMessage").maybeGetMessageFromError(a);o.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Failed to send appdata to devices with error: ",""])),a);return d("WAResultOrError").makeError("runtime-error")})}async function q(a,b,c,e){e===void 0&&(e="checkPhash");o.LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Sending appdata, externalId: ",""])),b);a=d("WAConvertAppData").convertAppData(a);var f={bytes:d("WAAsMessageApplication").castToMessageApplicationBytes(d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,a).readByteArrayView()),version:"v3"},g=[];a=Array.from(c.entries()).map(function(a){var b=a[0];a=a[1];return{identity:a.pubKey,jid:b}});c=p;a.length>c&&(o.WARN(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Attempting to send an appData stanza to "," devices"])),a.length),o.ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Attempting to send an appData stanza to more than the allowed "," devices"])),c),a=a.slice(0,c));var h=[{devicesInfo:a,user:d("WAGlobals").getMyUserJid()}];c=await d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return d("WAEncUserMsg").encryptUserMsg(h,{messageBytes:f,type:"appdata"},{cryptoManager:a})},{operationType:"encrypt",flush:!0});a=c.phash;var q=!1;c.participants!=null&&c.participants.forEach(function(a){a.type==="pkmsg"&&(q=!0),g.push({toJid:a.to,encTypeIndividualMixinArgs:{encType:a.type,encElementValue:a.ciphertext},encVersionFutureproofMixinArgs:{encV:parseInt(a.v,10)}})});c={appdataTo:d("WAGlobals").getMyUserJid(),toArgs:g};c={peerPeerFanout:c};var r=void 0;if(q){var s=await d("WAGetCurrentUserDeviceInfoApi").getCurrentUserDeviceInfo();s=s==null?void 0:s.identityKey;if(s==null){o.ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Failed to fetch current device public identity key"])));return d("WAResultOrError").makeError("no-public-identity")}r={deviceIdentityElementValue:s}}s={appdataDeviceListCheck:e==="checkPhash"?"true":"false"};e={appdataId:b,peerMsgTypesArgs:c,deviceIdentityMixinArgs:r,withDeviceListCheckMixinArgs:s};b=await d("WASmaxAppdataPublishPeerRPC").sendPeerRPC(e);switch(b.name){case"PeerResponseSuccess":r=(c=b.value.deviceListStaleMixin)==null?void 0:c.phash;if(r!=null&&a!=null&&r!==a){o.LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Got phash mismatch on appdata, local[","] server[","]"])),a,r);d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PHASH_MISMATCH,key:"appdata"});return d("WAResultOrError").makeResult({phashMismatch:!0,serverTs:d("WATimeUtils").castToUnixTime(b.value.t)})}else return d("WAResultOrError").makeResult({phashMismatch:!1,serverTs:d("WATimeUtils").castToUnixTime(b.value.t)});default:b.name;o.ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["Failed to send appdata. Error: ",""])),b.value.error);return d("WAResultOrError").makeError("ack-failure")}}g.MAX_APPDATA_RECIPIENTS=p;g.sendAppDataToDevicesProtocol=a}),98);
__d("WASendMsgUtilV2",["WADevicesState","WAGenReportingMeta","WAGlobals","WAJids","WALoadReceiptApi","WALogger","WAMsg","WAResultOrError","WASaveReceiptApi","WASendMsgInternal","WASentBytesCache","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n;function o(a){return Promise.resolve()}function p(a,b){return d("WADevicesState").getDevicesState().waitForUserDevices(Array.from(new Set([a,d("WAGlobals").getMyUserJid()])),"GetDevicesBeforeSend: "+b)}function q(a,b){a=b.chatJid;var c=b.reason;return d("WAJids").switchOnChatJidType(a,{group:function(a){return o(a)},interopUser:function(a){return p(a,c)},lidUser:function(a){return p(a,c)},msgrUser:function(a){return p(a,c)},phoneUser:function(a){return p(a,c)}}).catch(function(a){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Error during get devices before sending: ",""])),a);return Promise.resolve()})}async function r(a,b){var c=a.messagePayload;a=a.loadThreadParticipants;var e={author:c.protocolMsgId.author,chat:c.protocolMsgId.chat,externalId:c.protocolMsgId.externalId},f=await d("WALoadReceiptApi").loadReceipt(e);if(f.success)return f;b.addPoint("get_devices_before_send_start");await q(void 0,{chatJid:c.protocolMsgId.chat,reason:"prepareReceipt"});b.addPoint("get_devices_before_send_end");var g=await a(c.protocolMsgId.chat);b.addPoint("get_identities_start");f=await d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return a.storage.bulkLoadIdentities(g)},{flush:!1,afterInit:!0,operationType:"prepare_receipt_load_identities"});a=[];if(f.size===0)a=[].concat(g);else for(c of f){var h=c[0],j=c[1];j.size===0&&a.push(h)}a.length>0&&(await d("WADevicesState").getDevicesState().waitForUserDevices(a,"GetDevicesBeforeSend: prepareReceipt",!0),f=await d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return a.storage.bulkLoadIdentities(g)},{afterInit:!0,flush:!1,operationType:"prepare_receipt_load_identities"}));j=new Map();for(h of f){h[0];c=h[1];for(a of c){f=a[0];c=a[1];if(f===d("WAGlobals").getMyDeviceJid())continue;j.set(f,{pubKey:c})}}b.addPoint("get_identities_end");f=new Set();c={permittedIdentitiesPerDevice:j,recipientDevices:f,id:e};b.addPoint("save_receipts_start");await d("WASaveReceiptApi").saveReceipt(c).catch(function(a){b.addPoint("save_receipts_fail");d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Failed to save receipt for message with error ",""])),a);return d("WAResultOrError").makeError("missing-receipt")});b.addPoint("save_receipts_end");return d("WAResultOrError").makeResult(c)}async function a(a,b,c){a=b.messagePayload;var e=b.loadThreadParticipants,f=b.sendIdentity;f=f===void 0?!1:f;b=b.isInstamadillo;b=b===void 0?!1:b;c.addPoint("prepare_receipt_start");e=await r({messagePayload:a,loadThreadParticipants:e},c);if(e.success===!1){c.addPoint("prepare_receipt_fail");d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Trying to send a message that does not have a receipt in db"])));return d("WAResultOrError").makeError({type:"missing-receipt"})}c.addPoint("prepare_receipt_end");e=e.value;var g=a.frankingKey,h=a.frankingVersion,i=a.messageBytes,n=a.backupDirective,o=a.messageType,p=a.protocolMsgId;a=s(e.permittedIdentitiesPerDevice);e=o.type==="text"&&o.invitedParticipantUserJid!=null?a.filter(function(a){return a.user===o.invitedParticipantUserJid||a.user===d("WAGlobals").getMyUserJid()}):a;c.addPoint("recipients-calculated",{int:{recipientsCount:e.length},string:{msgType:o.type}});a=o.type==="text"&&o.invitedParticipantUserJid!=null?o.invitedParticipantUserJid:p.chat;var q=p.chat===d("WAGlobals").getMyUserJid();if(e.length===0&&!q){d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Trying to send a message with no recipients"])));return d("WAResultOrError").makeError({type:"no-recipients",isRetriable:!1})}else if(e.length===0&&q){d("WALogger").LOG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Trying to send a message with no recipients, but it is a self thread"])));return d("WAResultOrError").makeResult({baseKey:null,reportingMeta:null,serverTs:d("WATimeUtils").unixTime()})}q=f?await d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return t(a)},{operationType:"get_my_device_identity",flush:!1,afterInit:!0}):null;f=await (o.isRevoked===!0?Promise.resolve(null):d("WAGenReportingMeta").genReportingMeta(i.bytes,g,h));return d("WASendMsgInternal").sendMessage({type:"chat",messageBytes:i,chat:a,deviceIdentity:q,messageType:o,protocolMsgId:p,externalId:p.externalId,recipients:e,reportingMeta:f,backupDirective:n},c,b).then(function(a){if(a.success)return d("WASentBytesCache").sentBytesCache().saveSentBytes({ts:a.value.serverTs,frankingKey:g,frankingVersion:h,messageBytes:i,backupDirective:n,messageType:o,protocolMsgId:p,waMsgId:d("WAMsg").craftWAMsgIdString({author:p.author,chat:p.chat,externalId:p.externalId})}).catch(function(a){d("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg failed to save sent bytes to cache: ",""])),a)}).then(function(){return a});else return a})}function s(a){var b=new Map();a.forEach(function(a,c){a=a.pubKey;var e=d("WAJids").extractUserJid(c);a={identity:a,jid:c};c=b.get(e)||[];c.push(a);b.set(e,c)});return Array.from(b,function(a){var b=a[0];a=a[1];return{devicesInfo:a,user:b}})}async function t(a){try{a=await a.storage.loadIdentities(d("WAGlobals").getMyUserJid());a=a.get(d("WAGlobals").getMyDeviceJid());if(a!=null)return a;throw c("err")("missing-identity")}catch(a){d("WALogger").ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["Error loading current device identity ",""])),a)}}g.getDevicesBeforeSend=q;g.sendChatMessage=a}),98);
__d("WASetClockSkewApi",["WASetMetaApi"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){a=a.clockSkew;return d("WASetMetaApi").setMeta({clockSkew:a})};g.setClockSkew=a}),98);
__d("WASendPing",["WAComms","WALogger","WASetClockSkewApi","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["sendPing: sending"]))),d("WAComms").sendPing()}async function b(a,b){a=b.clockSkew;d("WATimeUtils").setClockSkew(a);await d("WASetClockSkewApi").setClockSkew({clockSkew:a})}g.sendPing=a;g.updateClockSkew=b}),98);
__d("WASyncAbProps",["WAAbPropsSync","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(a,b){b=b.sendHash;d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Syncing ABProps"])));await d("WAAbPropsSync").syncAbProps({sendHash:b,eventFlow:a!=null?a:void 0})}g.syncAbProps=a}),98);
__d("WAUploadMedia",["WABase64","WABlobToArrayBuffer","WACheckCiphertextInServer","WACreateRetrier","WAEncryptAndUploadPlaintext","WAErrorMessage","WAFindReusableMediaEntry","WALogger","WAMediaUtils","WAResultOrError","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t,u;function a(a){var b=a.uploadMediaMetric;return v(babelHelpers.extends({},a)).catch(function(a){a=d("WAErrorMessage").maybeGetMessageFromError(a);d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: unexpected runtime error: ",""])),a);return d("WAResultOrError").makeError("runtime-error")}).then(function(a){a.success?b.endSuccess():b.endFail(a.error,{string:{failReason:a.error}});return a})}async function v(a){a.chatJid;var b=a.filename,c=a.hash,e=a.mediaTypeDetails,f=a.protocolMsgId,g=a.size,h=a.uploadMediaMetric,u=a.getMediaKnownEntries,v=a.getMediaPlaintext,x=a.updateMediaEntryForMsg,y=a.updateMediaEntryForOptimisticUpload;a=a.getDownloadableThumbnailForMedia;var z;e.type==="regular"?z=e.mediaType:(z="preview",h.addAnnotations({string:{fullSizeMediaType:e.messageType}}));h.addPoint("create_upload_retrier_start");e=await d("WACreateRetrier").createUploadRetrier(z,h);if(!e.success){d("WALogger").WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: fail to gather media routes"])));h.addPoint("create_upload_retrier_fail");return e}h.addPoint("create_upload_retrier_end");e=e.value;x=w(f,c,x,y,h);h.addPoint("get_media_entry_start");y=await u(c).catch(function(a){d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: get media entry unexpected runtime error: ",""])),d("WAErrorMessage").maybeGetMessageFromError(a));h.addPoint("get_media_entry_fail");throw a});u=d("WAFindReusableMediaEntry").findReusableMediaEntryForArmadillo(f,y);h.addPoint("get_media_entry_end");if(u==null){h.addPoint("create_media_key_start");d("WALogger").LOG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: no media entry found, need to upload media"])));f=d("WAMediaUtils").createMediaKey();y=d("WAMediaUtils").createUploadToken();var A=d("WATimeUtils").unixTime();h.addPoint("create_media_key_end");h.addPoint("get_media_plaintext_start");var B=await v(c).then(function(a){return a==null?null:d("WABlobToArrayBuffer").blobToArrayBuffer(a)});if(B==null){d("WALogger").ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: no plaintext"])));h.addPoint("get_media_plaintext_fail");return d("WAResultOrError").makeError("no-plaintext")}h.addPoint("get_media_plaintext_end");return d("WAEncryptAndUploadPlaintext").encryptAndUploadPlaintext({size:g,filename:b,mediaKey:f,mediaKeyTimestamp:A,serverMediaType:z,mediaUploadFlow:h,plaintext:B,plaintextHash:c,updateMediaEntry:x,uploadRetrier:e,uploadToken:y,getDownloadableThumbnailForMedia:a})}f=u.directPath;A=u.downloadableThumbnail;B=u.fileEncSha256;y=u.fileSha256;var C=u.mediaKey,D=u.mediaKeyTimestamp,E=u.objectId;u=u.uploadToken;A={directPath:f,downloadableThumbnail:A,fileEncSha256:B,filename:b,fileSha256:y||d("WABase64").decodeB64UrlSafe(c),mediaKey:C,mediaKeyTimestamp:D,objectId:E,serverMediaType:z,size:g,uploadToken:u};if(f!=null){d("WALogger").LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: async upload"])));await x(A);h.addAnnotations({bool:{reused_media_entry:!0}});return d("WAResultOrError").makeResult(A)}h.addPoint("resume_check_start");y=await d("WACheckCiphertextInServer").checkCiphertextInServer(z,B,u,e).catch(function(a){d("WALogger").ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: resume check unexpected runtime error: ",""])),d("WAErrorMessage").maybeGetMessageFromError(a));h.addPoint("resume_check_fail");throw a});if(!y.success){h.addPoint("resume_check_fail");d("WALogger").WARN(o||(o=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: resume/exist check exhausted available retries"])));return y}h.addPoint("resume_check_end");E=y.value;if(E.type==="media-found"){d("WALogger").LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: media is on the server"])));h.addAnnotations({bool:{existingMediaFound:!0}});f=babelHelpers.extends({},A,{directPath:E.directPath,objectId:E.objectId});await x(f);h.addAnnotations({bool:{reused_media_entry:!0}});return d("WAResultOrError").makeResult(f)}else if(E.type==="media-partial-found"){d("WALogger").LOG(q||(q=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: media is partially on the server, start uploading from byteOffset ",""])),E.resumeFromBytes);B=E.resumeFromBytes;h.addPoint("get_media_plaintext_start");y=await v(c).then(function(a){return a==null?null:d("WABlobToArrayBuffer").blobToArrayBuffer(a)});if(y==null){d("WALogger").ERROR(r||(r=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: no plaintext"])));h.addPoint("get_media_plaintext_fail");return d("WAResultOrError").makeError("no-plaintext")}h.addPoint("get_media_plaintext_end");return d("WAEncryptAndUploadPlaintext").encryptAndUploadPlaintext({size:g,filename:b,fromOffset:B,mediaKey:C,mediaKeyTimestamp:D,serverMediaType:z,mediaUploadFlow:h,plaintext:y,plaintextHash:c,updateMediaEntry:x,uploadRetrier:e,uploadToken:u,getDownloadableThumbnailForMedia:a})}d("WALogger").LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: media is not on the server, start uploading"])));A=d("WATimeUtils").unixTime();h.addPoint("get_media_plaintext_start");f=await v(c).then(function(a){return a==null?null:d("WABlobToArrayBuffer").blobToArrayBuffer(a)});if(f==null){d("WALogger").ERROR(t||(t=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: no plaintext"])));h.addPoint("get_media_plaintext_fail");return d("WAResultOrError").makeError("no-plaintext")}h.addPoint("get_media_plaintext_end");return d("WAEncryptAndUploadPlaintext").encryptAndUploadPlaintext({size:g,filename:b,mediaKey:C,mediaKeyTimestamp:A,serverMediaType:z,mediaUploadFlow:h,plaintext:f,plaintextHash:c,updateMediaEntry:x,uploadRetrier:e,uploadToken:u,getDownloadableThumbnailForMedia:a})}function w(a,b,c,e,f){return function(g){f.addPoint("update_media_entry_start");var h=d("WAMediaUtils").encodeMediaEntryForUpload(g);g=a==null?e(b,function(){return h},g==null?void 0:g.objectId,g==null?void 0:g.serverMediaType):c(b,a,function(){return h},g==null?void 0:g.objectId,g==null?void 0:g.serverMediaType);return g.then(function(a){f.addPoint("update_media_entry_end");return a}).catch(function(a){d("WALogger").ERROR(u||(u=babelHelpers.taggedTemplateLiteralLoose(["updateMediaEntry unexpected runtime error: ",""])),d("WAErrorMessage").maybeGetMessageFromError(a));f.addPoint("update_media_entry_fail");throw a})}}g.uploadMedia=a}),98);/*FB_PKG_DELIM*/
__d("BizInboxUnifiedThreadsQuery.graphql",["relay-runtime"],(function(aa,ba,ca,da,ea,fa){"use strict";aa=function(){var aa={defaultValue:null,kind:"LocalArgument",name:"before"},ba={defaultValue:[],kind:"LocalArgument",name:"businessAssets"},ca={defaultValue:!1,kind:"LocalArgument",name:"getShouldUnifyConfigQueries"},da={defaultValue:480,kind:"LocalArgument",name:"height"},ea={defaultValue:null,kind:"LocalArgument",name:"ig_params"},fa={defaultValue:!0,kind:"LocalArgument",name:"includeDeliveryReceipts"},ga={defaultValue:!1,kind:"LocalArgument",name:"includeSeqID"},ha={defaultValue:!1,kind:"LocalArgument",name:"isDependencyOfRemovePageDependencyEnabledTool"},ia={defaultValue:!1,kind:"LocalArgument",name:"isWorkUser"},ja={defaultValue:!1,kind:"LocalArgument",name:"is_work_teamwork_not_putting_muted_in_unreads"},ka={defaultValue:null,kind:"LocalArgument",name:"item_after"},la={defaultValue:null,kind:"LocalArgument",name:"item_limit"},ma={defaultValue:!1,kind:"LocalArgument",name:"loadThreadItems"},na={defaultValue:!0,kind:"LocalArgument",name:"loadThreads"},oa={defaultValue:!1,kind:"LocalArgument",name:"load_delivery_receipts"},pa={defaultValue:!0,kind:"LocalArgument",name:"load_items"},qa={defaultValue:!0,kind:"LocalArgument",name:"load_messages"},ra={defaultValue:!0,kind:"LocalArgument",name:"load_read_receipts"},sa={defaultValue:null,kind:"LocalArgument",name:"message_limit"},ta={defaultValue:null,kind:"LocalArgument",name:"msgr_params"},ua={defaultValue:null,kind:"LocalArgument",name:"msgr_pending_params"},va={defaultValue:null,kind:"LocalArgument",name:"page_id"},wa={defaultValue:null,kind:"LocalArgument",name:"selected_item_id"},xa={defaultValue:!1,kind:"LocalArgument",name:"should3DContextCardSections"},ya={defaultValue:!1,kind:"LocalArgument",name:"shouldSkipMessage"},za={defaultValue:!1,kind:"LocalArgument",name:"shouldSkipPageQuery"},Aa={defaultValue:!1,kind:"LocalArgument",name:"shouldUnifyContextCardQueries"},Ba={defaultValue:null,kind:"LocalArgument",name:"source"},Ca={defaultValue:!1,kind:"LocalArgument",name:"threadlistViewFieldsOnly"},Da={defaultValue:null,kind:"LocalArgument",name:"wa_params"},Ea={defaultValue:null,kind:"LocalArgument",name:"wa_pending_params"},Fa={defaultValue:480,kind:"LocalArgument",name:"width"},Ga={alias:"unused",args:[{kind:"Variable",name:"string",variableName:"source"}],kind:"ScalarField",name:"xfb_returns_zero_make_parameter_used",storageKey:null},Ha=[{kind:"Variable",name:"ig_params",variableName:"ig_params"},{kind:"Variable",name:"msgr_params",variableName:"msgr_params"},{kind:"Variable",name:"selected_item_id",variableName:"selected_item_id"},{kind:"Variable",name:"wa_params",variableName:"wa_params"}],Ia={alias:null,args:null,kind:"ScalarField",name:"sync_sequence_id",storageKey:null},Ja={condition:"includeSeqID",kind:"Condition",passingValue:!0,selections:[Ia]},a={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},Ka={alias:null,args:null,kind:"ScalarField",name:"thread_fbid",storageKey:null},La={alias:null,args:null,concreteType:"MessageThreadKey",kind:"LinkedField",name:"thread_key",plural:!1,selections:[Ka,{alias:null,args:null,kind:"ScalarField",name:"other_user_id",storageKey:null}],storageKey:null},b={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},Ma=[{kind:"Literal",name:"last",value:1}],c={alias:null,args:null,kind:"ScalarField",name:"snippet",storageKey:null},d=[a],Na={alias:null,args:null,kind:"ScalarField",name:"timestamp_precise",storageKey:null},Oa={alias:null,args:null,kind:"ScalarField",name:"commerce_message_type",storageKey:null},Pa={alias:null,args:null,kind:"ScalarField",name:"legacy_attachment_id",storageKey:null},e={alias:null,args:null,kind:"ScalarField",name:"text",storageKey:null},f=[e],Qa={alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"description",plural:!1,selections:f,storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"title",storageKey:null},Ra={alias:null,args:null,kind:"ScalarField",name:"action_url",storageKey:null},Sa={alias:null,args:null,kind:"ScalarField",name:"native_url",storageKey:null},i=[g,h,Ra,Sa,{alias:null,args:null,kind:"ScalarField",name:"target_id",storageKey:null}];i={alias:null,args:null,concreteType:"MessengerGenericXMATemplateExtraFields",kind:"LinkedField",name:"messenger_generic_xma_template_extra_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"media_owner_profile_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"media_owner_profile_pic_uri",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"favicon_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"favicon_url_fallback",storageKey:null},{alias:null,args:null,concreteType:"MessengerGenericXMATemplateCTA",kind:"LinkedField",name:"default_cta",plural:!1,selections:i,storageKey:null},{alias:null,args:null,concreteType:"MessengerGenericXMATemplateCTA",kind:"LinkedField",name:"cta1",plural:!1,selections:i,storageKey:null},{alias:null,args:null,concreteType:"MessengerGenericXMATemplateCTA",kind:"LinkedField",name:"cta2",plural:!1,selections:i,storageKey:null},{alias:null,args:null,concreteType:"MessengerGenericXMATemplateCTA",kind:"LinkedField",name:"cta3",plural:!1,selections:i,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"list_item_id_1",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"list_item_contact_url_list_1",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"list_item_contact_url_expiration_timestamp_list_1",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"list_item_contact_url_fallback_list_1",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"list_item_title_text_1",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"list_item_accessibility_text_1",storageKey:null}],storageKey:null};var j={alias:null,args:null,kind:"ScalarField",name:"label",storageKey:null},k=[{kind:"Literal",name:"height",value:240},{kind:"Literal",name:"width",value:240}],l={alias:null,args:null,kind:"ScalarField",name:"uri",storageKey:null},m=[l],Ta=[{kind:"Literal",name:"height",value:120},{kind:"Literal",name:"width",value:120}],n={alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"height",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"width",storageKey:null};k=[a,{alias:null,args:null,concreteType:"StickerPack",kind:"LinkedField",name:"pack",plural:!1,selections:d,storageKey:null},j,{alias:null,args:null,kind:"ScalarField",name:"frame_count",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"frame_rate",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"frames_per_row",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"frames_per_column",storageKey:null},{alias:"sprite_image_2x",args:k,concreteType:"Image",kind:"LinkedField",name:"sprite_image",plural:!1,selections:m,storageKey:"sprite_image(height:240,width:240)"},{alias:null,args:Ta,concreteType:"Image",kind:"LinkedField",name:"sprite_image",plural:!1,selections:m,storageKey:"sprite_image(height:120,width:120)"},{alias:null,args:Ta,concreteType:"Image",kind:"LinkedField",name:"padded_sprite_image",plural:!1,selections:m,storageKey:"padded_sprite_image(height:120,width:120)"},{alias:"padded_sprite_image_2x",args:k,concreteType:"Image",kind:"LinkedField",name:"padded_sprite_image",plural:!1,selections:m,storageKey:"padded_sprite_image(height:240,width:240)"},n,o,p];var Ua={kind:"InlineFragment",selections:k,type:"Sticker",abstractKey:null},q=[l,o,p],Va={alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"animated_image",plural:!1,selections:q,storageKey:null},Wa={kind:"Literal",name:"sizing",value:"contain-fit"},Xa=[Wa],Ya={alias:null,args:Xa,concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:q,storageKey:'image(sizing:"contain-fit")'},r={alias:null,args:null,kind:"ScalarField",name:"playable_duration_in_ms",storageKey:null},Za={alias:null,args:null,kind:"ScalarField",name:"is_playable",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"playable_url",storageKey:null},t={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"media",plural:!1,selections:[Ua,Va,Ya,r,Za,s],storageKey:null},$a={alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"source",plural:!1,selections:f,storageKey:null},ab={alias:null,args:null,kind:"ScalarField",name:"style_list",storageKey:null},bb={alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"title_with_entities",plural:!1,selections:f,storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},cb={alias:null,args:null,concreteType:"AttachmentProperty",kind:"LinkedField",name:"properties",plural:!0,selections:[u,{alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"value",plural:!1,selections:f,storageKey:null}],storageKey:null},db={alias:"url",args:null,kind:"ScalarField",name:"messenger_dot_com_url",storageKey:null},eb={alias:null,args:null,kind:"ScalarField",name:"deduplication_key",storageKey:null},fb={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"action_links",plural:!0,selections:[h,n],storageKey:null},gb={alias:null,args:null,concreteType:"MessagingAttribution",kind:"LinkedField",name:"messaging_attribution",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"attribution_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"attribution_id",storageKey:null},b,{alias:null,args:null,kind:"ScalarField",name:"icon_url",storageKey:null}],storageKey:null},hb={alias:"action_link",args:null,kind:"ScalarField",name:"action_url",storageKey:null},ib={alias:null,args:null,kind:"ScalarField",name:"action_open_type",storageKey:null},jb={alias:null,args:null,kind:"ScalarField",name:"preview_title",storageKey:null},kb={alias:null,args:null,kind:"ScalarField",name:"preview_subtitle",storageKey:null},v={alias:null,args:null,kind:"ScalarField",name:"target_display",storageKey:null},lb={alias:null,args:null,kind:"ScalarField",name:"image_url",storageKey:null},w={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"action_objects",plural:!0,selections:[{kind:"InlineFragment",selections:[a,jb,kb,v,lb],type:"MessengerPlatformEntPreview",abstractKey:"__isMessengerPlatformEntPreview"}],storageKey:null},mb={alias:"title",args:null,kind:"ScalarField",name:"action_title",storageKey:null},nb={alias:null,args:null,concreteType:"MessengerCTAUserConfirmation",kind:"LinkedField",name:"user_confirmation",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"cancel_button_label",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"continue_button_label",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"confirmation_message",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"confirmation_title",storageKey:null}],storageKey:null},ob={alias:null,args:null,kind:"ScalarField",name:"is_disabled",storageKey:null},pb={alias:null,args:null,kind:"ScalarField",name:"is_mutable_by_server",storageKey:null},qb={alias:null,args:null,kind:"ScalarField",name:"logging_token",storageKey:null},rb={alias:"render_style",args:null,kind:"ScalarField",name:"cta_render_style",storageKey:null},sb={alias:null,args:null,concreteType:"MessengerPlatformWebviewMetadata",kind:"LinkedField",name:"webview_metadata",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"fallback_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"messenger_extensions",storageKey:null},{alias:"webview_height_ratio",args:null,kind:"ScalarField",name:"height_ratio",storageKey:null},{alias:"webview_share_button",args:null,kind:"ScalarField",name:"hide_share_button",storageKey:null}],storageKey:null},x={alias:null,args:null,kind:"ScalarField",name:"page_id",storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"placeholder",storageKey:null},tb={alias:null,args:null,kind:"ScalarField",name:"subtitle",storageKey:null},z={alias:null,args:null,kind:"ScalarField",name:"length",storageKey:null},ub={alias:null,args:null,kind:"ScalarField",name:"format",storageKey:null},vb={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"form_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"form_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"form_num_screens",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"form_current_screen_index",storageKey:null},{alias:null,args:null,concreteType:"MessengerPIIFormScreenObject",kind:"LinkedField",name:"form_first_screen",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"screen_title",storageKey:null},{alias:null,args:null,concreteType:"MessengerPIIQuestionObject",kind:"LinkedField",name:"questions",plural:!0,selections:[a,g,h,y,tb,z,ub,{alias:null,args:null,kind:"ScalarField",name:"mask",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"MessengerPIIBusinessPrivacyObject",kind:"LinkedField",name:"business_privacy",plural:!1,selections:[e,n],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"form_color_theme",storageKey:null}],type:"MessengerDirectSendCallToActionData",abstractKey:null};y={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"feedback_form_current_screen_index",storageKey:null},{alias:null,args:null,concreteType:"MessengerFeedbackFormScreenObject",kind:"LinkedField",name:"feedback_form_first_screen",plural:!1,selections:[{alias:null,args:null,concreteType:"MessengerFeedbackQuestionObject",kind:"LinkedField",name:"feedback_questions",plural:!0,selections:[a,h,g,{alias:null,args:null,kind:"ScalarField",name:"score_label",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"left_score_label",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"right_score_label",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"score_option",storageKey:null},{alias:null,args:null,concreteType:"MessengerFeedBackQuestionFollowup",kind:"LinkedField",name:"follow_up",plural:!1,selections:[g,y],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"feedback_form_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"feedback_form_num_screens",storageKey:null},{alias:null,args:null,concreteType:"MessengerFeedbackBusinessPrivacyObject",kind:"LinkedField",name:"feedback_form_privacy_policy",plural:!1,selections:[e,j,n],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"feedback_form_state",storageKey:null}],type:"MessengerFeedbackFormOpenCallToActionData",abstractKey:null};var A={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"cta_data",plural:!1,selections:[vb,y],storageKey:null},wb={alias:null,args:null,kind:"ScalarField",name:"is_high_confidence",storageKey:null},xb={alias:null,args:null,concreteType:"MessengerCallToAction",kind:"LinkedField",name:"messenger_call_to_actions",plural:!0,selections:[hb,ib,w,mb,nb,a,ob,pb,qb,rb,sb,x,A,wb,Sa],storageKey:null},yb={alias:null,args:null,concreteType:"XMALayoutInfo",kind:"LinkedField",name:"xma_layout_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"layout_type",storageKey:null}],storageKey:null},B={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},zb={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"listing_type",storageKey:null},{alias:null,args:null,concreteType:"CrisisListingCategoryWrapper",kind:"LinkedField",name:"listing_category",plural:!1,selections:[{alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"offer_image",plural:!1,selections:m,storageKey:null},{alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"request_image",plural:!1,selections:m,storageKey:null}],storageKey:null},{alias:null,args:[{kind:"Literal",name:"height",value:315},{kind:"Literal",name:"width",value:851}],concreteType:"Image",kind:"LinkedField",name:"map_image",plural:!1,selections:m,storageKey:"map_image(height:315,width:851)"}],type:"CrisisListing",abstractKey:null},Ab={alias:null,args:null,kind:"ScalarField",name:"filename",storageKey:null},Bb={alias:null,args:null,kind:"ScalarField",name:"url_shimhash",storageKey:null},Cb={alias:null,args:null,kind:"ScalarField",name:"extension",storageKey:null},Db={alias:null,args:null,kind:"ScalarField",name:"filesize",storageKey:null},Eb={alias:null,args:null,kind:"ScalarField",name:"duration",storageKey:null},C={alias:"transfer_id",args:null,kind:"ScalarField",name:"id",storageKey:null},D={alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"profile_picture",plural:!1,selections:m,storageKey:null},E=[a,{alias:"name",args:null,kind:"ScalarField",name:"short_name",storageKey:null},{alias:"full_name",args:null,kind:"ScalarField",name:"name",storageKey:null},D,n],Fb={alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"sender",plural:!1,selections:E,storageKey:null};E={alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"receiver",plural:!1,selections:E,storageKey:null};var Gb={alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null};u={alias:"actionDatas",args:null,concreteType:"PaymentActivityActionData",kind:"LinkedField",name:"action_datas",plural:!0,selections:[B,{alias:"additionalInfo",args:null,concreteType:"PaymentActivityActionDataAdditionalInfo",kind:"LinkedField",name:"additional_info",plural:!0,selections:[u,Gb],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"category",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"identifier",storageKey:null},{alias:"inputType",args:null,kind:"ScalarField",name:"input_type",storageKey:null},z,{alias:null,args:null,kind:"ScalarField",name:"optional",storageKey:null},{alias:"placeholderText",args:null,kind:"ScalarField",name:"placeholder_text",storageKey:null}],storageKey:null};var Hb={alias:"actionIdentifier",args:null,kind:"ScalarField",name:"action_identifier",storageKey:null},Ib={alias:null,args:null,kind:"ScalarField",name:"style",storageKey:null},Jb={alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"title",plural:!1,selections:f,storageKey:null},Kb={kind:"InlineFragment",selections:[{alias:"receiptView",args:null,concreteType:"PaymentReceiptView",kind:"LinkedField",name:"receipt_view",plural:!1,selections:[{alias:"additionalInstruction",args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"additional_instruction",plural:!1,selections:f,storageKey:null},a,{alias:"otherParticipant",args:null,concreteType:"PaymentActivityParticipantView",kind:"LinkedField",name:"other_participant",plural:!1,selections:[{alias:"imageUrl",args:null,kind:"ScalarField",name:"image_url",storageKey:null},tb,h],storageKey:null},{alias:null,args:null,concreteType:"PaymentActivityViewSection",kind:"LinkedField",name:"sections",plural:!0,selections:[{alias:"preferredPosition",args:null,kind:"ScalarField",name:"preferred_position",storageKey:null}],storageKey:null},Jb],storageKey:null}],type:"P2POpenReceiptActionButton",abstractKey:null},F={alias:null,args:null,kind:"ScalarField",name:"amount",storageKey:null},Lb={alias:null,args:null,kind:"ScalarField",name:"currency",storageKey:null},G=[F,Lb,{alias:"formattedAmount",args:null,kind:"ScalarField",name:"formatted_amount",storageKey:null}],Mb={alias:"amount",args:null,concreteType:"CurrencyAmount",kind:"LinkedField",name:"currency_amount",plural:!1,selections:G,storageKey:null},H=[B,u,Hb,Ib,h,Kb,{kind:"InlineFragment",selections:[{alias:"moneyTransfer",args:null,concreteType:null,kind:"LinkedField",name:"generic_money_transfer",plural:!1,selections:[C,Fb,E,Mb],storageKey:null}],type:"P2PPaymentActionButtonWithTransfer",abstractKey:null}],Nb={alias:"componentType",args:null,kind:"ScalarField",name:"component_type",storageKey:null},Ob={alias:null,args:null,kind:"ScalarField",name:"color",storageKey:null};G={kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"CurrencyAmount",kind:"LinkedField",name:"amount",plural:!1,selections:G,storageKey:null},Ob],type:"P2PBubbleAmountComponent",abstractKey:null};var I=[{alias:"dimensionlessCacheKey",args:null,kind:"ScalarField",name:"dimensionless_cache_key",storageKey:null},o,{alias:"isSilhouette",args:null,kind:"ScalarField",name:"is_silhouette",storageKey:null},{alias:"mimeType",args:null,kind:"ScalarField",name:"mime_type",storageKey:null},b,{alias:null,args:null,kind:"ScalarField",name:"scale",storageKey:null},l,p],Pb={kind:"InlineFragment",selections:[{alias:"aspectRatio",args:null,kind:"ScalarField",name:"aspect_ratio",storageKey:null},{alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:I,storageKey:null}],type:"P2PBubbleImageComponent",abstractKey:null};I={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"alignment",storageKey:null},Ob,{alias:"facepileUsers",args:null,concreteType:"User",kind:"LinkedField",name:"facepile_users",plural:!0,selections:[a,{alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"profile_picture",plural:!1,selections:I,storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"images",plural:!0,selections:I,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"size",storageKey:null},e],type:"P2PBubbleTextComponent",abstractKey:null};var Qb={alias:"iconCurrencyCode",args:null,kind:"ScalarField",name:"icon_currency_code",storageKey:null};H={kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"P2PBubbleView",kind:"LinkedField",name:"bubble_view",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"actions",plural:!0,selections:H,storageKey:null},{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"components",plural:!0,selections:[Nb,G,Pb,I],storageKey:null},{alias:null,args:null,concreteType:"P2PBubbleRobotext",kind:"LinkedField",name:"robotext",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"action",plural:!1,selections:H,storageKey:null},Ob,Qb,e],storageKey:null},{alias:"rootAction",args:null,concreteType:null,kind:"LinkedField",name:"root_action",plural:!1,selections:H,storageKey:null}],storageKey:null}],type:"PaymentViewData",abstractKey:"__isPaymentViewData"};var Rb={alias:null,args:null,kind:"ScalarField",name:"short_name",storageKey:null},Sb={kind:"InlineFragment",selections:[Rb,n],type:"User",abstractKey:null},Tb={alias:null,args:null,concreteType:"CurrencyAmount",kind:"LinkedField",name:"transaction_amount",plural:!1,selections:[F,{alias:null,args:null,kind:"ScalarField",name:"formatted_amount",storageKey:null}],storageKey:null},Ub={alias:null,args:null,kind:"ScalarField",name:"transfer_status",storageKey:null},Vb={alias:"completedTime",args:null,kind:"ScalarField",name:"completed_time",storageKey:null},Wb={alias:"updatedTime",args:null,kind:"ScalarField",name:"updated_time",storageKey:null},Xb={alias:"creationTime",args:null,kind:"ScalarField",name:"creation_time",storageKey:null},J={alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:m,storageKey:null},Yb=[J],Zb={alias:null,args:null,concreteType:"MessengerPayTheme",kind:"LinkedField",name:"transfer_theme",plural:!1,selections:d,storageKey:null},K={alias:null,args:null,kind:"ScalarField",name:"formatted",storageKey:null},$b=[K],ac={alias:null,args:null,concreteType:"CurrencyQuantity",kind:"LinkedField",name:"amount_fb_discount",plural:!1,selections:$b,storageKey:null},bc={alias:null,args:null,kind:"ScalarField",name:"funds_availability",storageKey:null},L={alias:null,args:null,kind:"ScalarField",name:"group_thread_fbid",storageKey:null},M={alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},N={alias:null,args:null,kind:"ScalarField",name:"status_description",storageKey:null},cc={alias:null,args:null,concreteType:"CurrencyAmount",kind:"LinkedField",name:"currency_amount",plural:!1,selections:[Lb],storageKey:null},dc={alias:null,args:null,kind:"ScalarField",name:"memo_text",storageKey:null},ec=[{alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"sender",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"P2PSenderReceiver"}],storageKey:null},{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"receiver_profile",plural:!1,selections:[a,b,D,Sb],storageKey:null},Tb,Ub,C,Vb,Wb,Xb,{alias:null,args:null,concreteType:"PeerToPeerTransferContext",kind:"LinkedField",name:"transfer_context",plural:!1,selections:[{alias:null,args:null,concreteType:"MessageImage",kind:"LinkedField",name:"memo_images",plural:!0,selections:Yb,storageKey:null},Zb],storageKey:null},ac,bc,L,{alias:null,args:null,concreteType:"PeerToPeerPlatformSoldItemDetail",kind:"LinkedField",name:"platform_item",plural:!1,selections:[b,M,{alias:null,args:null,concreteType:"Photo",kind:"LinkedField",name:"photos",plural:!0,selections:Yb,storageKey:null},n],storageKey:null},a,N,cc,dc,H];K={alias:null,args:null,concreteType:"CurrencyQuantity",kind:"LinkedField",name:"amount",plural:!1,selections:[K,Lb],storageKey:null};var fc={alias:null,args:null,concreteType:"CurrencyAmount",kind:"LinkedField",name:"transaction_amount",plural:!1,selections:[F],storageKey:null},O=[b,a,D,Sb],P={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"requester",plural:!1,selections:O,storageKey:null};O={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"requestee",plural:!1,selections:O,storageKey:null};var gc={alias:null,args:null,kind:"ScalarField",name:"request_status",storageKey:null},hc={alias:null,args:null,concreteType:"MessengerPayTheme",kind:"LinkedField",name:"request_theme",plural:!1,selections:d,storageKey:null},Q={alias:null,args:null,concreteType:"PeerToPeerTransfer",kind:"LinkedField",name:"transfer",plural:!1,selections:ec,storageKey:null},ic={alias:null,args:null,kind:"ScalarField",name:"creation_time",storageKey:null},R={alias:null,args:null,kind:"ScalarField",name:"updated_time",storageKey:null},jc={alias:"message",args:null,kind:"ScalarField",name:"snippet",storageKey:null};w=[hb,ib,w,mb,nb,a,ob,pb,qb,rb,sb,x,A];A={alias:null,args:null,concreteType:"MessengerCallToAction",kind:"LinkedField",name:"call_to_actions",plural:!0,selections:w,storageKey:null};var kc={alias:null,args:null,kind:"ScalarField",name:"image_aspect_ratio",storageKey:null},lc={alias:null,args:null,kind:"ScalarField",name:"first_metaline",storageKey:null},mc={alias:null,args:null,kind:"ScalarField",name:"source_name",storageKey:null},nc={alias:null,args:null,kind:"ScalarField",name:"target_url",storageKey:null};w={alias:null,args:null,concreteType:"MessengerCallToAction",kind:"LinkedField",name:"default_action",plural:!1,selections:w,storageKey:null};var oc=[a,{alias:"large_preview",args:null,concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:q,storageKey:null}],pc={kind:"InlineFragment",selections:oc,type:"MessageImage",abstractKey:null};oc={kind:"InlineFragment",selections:oc,type:"Photo",abstractKey:null};var qc={kind:"Literal",name:"media_type",value:"image/gif"},rc={alias:null,args:[qc],concreteType:"Image",kind:"LinkedField",name:"animated_image",plural:!1,selections:q,storageKey:'animated_image(media_type:"image/gif")'};qc={alias:"preview_image",args:[{kind:"Literal",name:"height",value:206},qc,{kind:"Literal",name:"width",value:206}],concreteType:"Image",kind:"LinkedField",name:"animated_image",plural:!1,selections:q,storageKey:'animated_image(height:206,media_type:"image/gif",width:206)'};var sc={kind:"InlineFragment",selections:[rc,qc,{alias:"large_preview",args:[{kind:"Literal",name:"height",value:420},Wa,{kind:"Literal",name:"width",value:420}],concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:q,storageKey:'image(height:420,sizing:"contain-fit",width:420)'}],type:"MessageAnimatedImage",abstractKey:null},tc={alias:null,args:null,concreteType:"Application",kind:"LinkedField",name:"attribution_app",plural:!1,selections:[a,b,{alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"square_logo",plural:!1,selections:m,storageKey:null}],storageKey:null},uc={alias:null,args:null,kind:"ScalarField",name:"attribution_metadata",storageKey:null},vc=[o,p,l],wc=[{alias:null,args:null,kind:"ScalarField",name:"x",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"y",storageKey:null}],xc={alias:null,args:null,concreteType:"Vect2",kind:"LinkedField",name:"original_dimensions",plural:!1,selections:wc,storageKey:null};vc={kind:"InlineFragment",selections:[tc,uc,Ab,s,{alias:"chat_image",args:[{kind:"Literal",name:"height",value:200},Wa,{kind:"Literal",name:"width",value:168}],concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:vc,storageKey:'image(height:200,sizing:"contain-fit",width:168)'},Pa,{alias:null,args:null,kind:"ScalarField",name:"video_type",storageKey:null},xc,r,{alias:"large_image",args:[{kind:"Literal",name:"height",value:640},Wa,{kind:"Literal",name:"width",value:640}],concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:vc,storageKey:'image(height:640,sizing:"contain-fit",width:640)'},{alias:"inbox_image",args:[{kind:"Literal",name:"height",value:450},Wa,{kind:"Literal",name:"width",value:450}],concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:vc,storageKey:'image(height:450,sizing:"contain-fit",width:450)'}],type:"MessageVideo",abstractKey:null};var yc={kind:"InlineFragment",selections:[p,o,a,s],type:"Video",abstractKey:null},S=[{alias:null,args:null,concreteType:"MessengerRetailItem",kind:"LinkedField",name:"nodes",plural:!0,selections:[a,M,kc,lb,lc,b,mc,nc,w,A,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"media_blob_attachments",plural:!0,selections:[B,pc,oc,sc,vc,yc],storageKey:null}],storageKey:null}],zc={kind:"InlineFragment",selections:[{alias:"video_id",args:null,kind:"ScalarField",name:"id",storageKey:null}],type:"Video",abstractKey:null},Ac={alias:null,args:null,kind:"ScalarField",name:"expiration_time",storageKey:null},Bc={alias:null,args:null,kind:"ScalarField",name:"latitude",storageKey:null},Cc={alias:null,args:null,kind:"ScalarField",name:"longitude",storageKey:null},Dc=[Bc,Cc],Ec={kind:"InlineFragment",selections:[{alias:"live_location_id",args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_expired",storageKey:null},Ac,{alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"sender",plural:!1,selections:d,storageKey:null},{alias:null,args:null,concreteType:"Coordinate",kind:"LinkedField",name:"coordinate",plural:!1,selections:Dc,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"location_title",storageKey:null},{alias:null,args:null,concreteType:"LiveLocationDestination",kind:"LinkedField",name:"sender_destination",plural:!1,selections:[Bc,Cc,j],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"stop_reason",storageKey:null}],type:"MessageLiveLocation",abstractKey:null},Fc={alias:null,args:null,concreteType:"MessagingParticipant",kind:"LinkedField",name:"kept_by",plural:!1,selections:d,storageKey:null},Gc={alias:null,args:null,kind:"ScalarField",name:"kept_at",storageKey:null},Hc={alias:null,args:null,kind:"ScalarField",name:"is_keep_disabled",storageKey:null},Ic={alias:null,args:null,kind:"ScalarField",name:"blob_media_type",storageKey:null},Jc=[s,n,J],Kc={kind:"InlineFragment",selections:Jc,type:"MessageVideo",abstractKey:null};Jc={kind:"InlineFragment",selections:Jc,type:"MessageImage",abstractKey:null};var Lc={alias:null,args:null,kind:"ScalarField",name:"montage_container_id",storageKey:null},Mc={alias:null,args:null,kind:"ScalarField",name:"story_id",storageKey:null},Nc={alias:null,args:null,kind:"ScalarField",name:"calendar_sync_type",storageKey:null},Oc={alias:null,args:null,concreteType:"Page",kind:"LinkedField",name:"page",plural:!1,selections:[a,Nc,{alias:null,args:null,concreteType:"ServicesVerticalPageBasedInfo",kind:"LinkedField",name:"services_vertical_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"is_eligible_for_appointment_calendar",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_eligible_for_mbs_calendar",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_page_sp_enabled",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"time_zone_name",storageKey:null}],storageKey:null}],storageKey:null},Pc={alias:null,args:null,kind:"ScalarField",name:"message_bubble_type",storageKey:null},Qc={alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:d,storageKey:null},Rc={alias:null,args:null,kind:"ScalarField",name:"ls_xma_title",storageKey:null},Sc={alias:null,args:null,kind:"ScalarField",name:"ls_xma_subtitle",storageKey:null},Tc={alias:"availability",args:null,kind:"ScalarField",name:"user_availability",storageKey:null},Uc={alias:null,args:null,kind:"ScalarField",name:"request_flow_type",storageKey:null},Vc={alias:null,args:null,kind:"ScalarField",name:"service_general_info",storageKey:null},Wc={alias:null,args:null,kind:"ScalarField",name:"has_saved_to_calendar",storageKey:null},Xc=[a,b,D],Yc={alias:null,args:null,concreteType:"Page",kind:"LinkedField",name:"page",plural:!1,selections:Xc,storageKey:null},Zc={alias:null,args:null,kind:"ScalarField",name:"start",storageKey:null},$c={alias:null,args:null,kind:"ScalarField",name:"end",storageKey:null},ad=[Zc,$c],bd={alias:null,args:null,concreteType:"TimeRange",kind:"LinkedField",name:"suggested_time_range",plural:!1,selections:ad,storageKey:null},cd={alias:"duration",args:null,kind:"ScalarField",name:"duration_in_seconds",storageKey:null},dd={alias:null,args:null,kind:"ScalarField",name:"duration_type",storageKey:null},ed=[{kind:"Literal",name:"first",value:1}],fd={alias:null,args:[{kind:"Literal",name:"sizing",value:"cover-fill-cropped"}],concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:m,storageKey:'image(sizing:"cover-fill-cropped")'},gd={alias:"price",args:null,kind:"ScalarField",name:"display_price",storageKey:null},hd={alias:null,args:null,kind:"ScalarField",name:"requested_time",storageKey:null},id={alias:null,args:null,kind:"ScalarField",name:"special_request",storageKey:null},jd={alias:null,args:null,kind:"ScalarField",name:"booking_status_value",storageKey:null},kd={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},ld={alias:null,args:null,kind:"ScalarField",name:"archived_status",storageKey:null},md={alias:null,args:null,kind:"ScalarField",name:"reminder_bubble_text",storageKey:null},nd={alias:null,args:null,kind:"ScalarField",name:"request_admin_approval_type",storageKey:null},od={alias:null,args:null,concreteType:"JobApplication",kind:"LinkedField",name:"job_application",plural:!1,selections:d,storageKey:null},pd={alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[a,Rb,D],storageKey:null},qd={alias:null,args:null,concreteType:"ServicesNativeBookingRequestAdditionalInfoField",kind:"LinkedField",name:"additional_info",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"field_key",storageKey:null},Gb,j],storageKey:null},rd={alias:null,args:null,concreteType:"PhoneNumber",kind:"LinkedField",name:"consumer_phone_number",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"display_number",storageKey:null}],storageKey:null},sd={alias:null,args:null,kind:"ScalarField",name:"recur_message",storageKey:null},td={alias:null,args:null,concreteType:"Page",kind:"LinkedField",name:"page",plural:!1,selections:d,storageKey:null},ud={alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"consumer",plural:!1,selections:d,storageKey:null},vd={alias:null,args:null,concreteType:"TimeRange",kind:"LinkedField",name:"formatted_available_time_ranges",plural:!0,selections:ad,storageKey:null},wd={alias:null,args:null,kind:"ScalarField",name:"has_booking_request_created",storageKey:null},xd={alias:null,args:null,kind:"ScalarField",name:"cta_click_events",storageKey:null},yd={alias:null,args:null,kind:"ScalarField",name:"cta_texts",storageKey:null},zd={alias:null,args:null,concreteType:"ServicesWWWURL",kind:"LinkedField",name:"www_url",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"is_async",storageKey:null},l],storageKey:null},Ad={alias:null,args:null,kind:"ScalarField",name:"render_template",storageKey:null},Bd={alias:null,args:null,kind:"ScalarField",name:"primary_text",storageKey:null},Cd={alias:null,args:null,kind:"ScalarField",name:"visible_on_platforms",storageKey:null},Dd=[a,b],Ed=[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"messaging_actor",plural:!1,selections:Dd,storageKey:null}],Fd={alias:"eventID",args:null,kind:"ScalarField",name:"id",storageKey:null},Gd={alias:"guestStatus",args:null,kind:"ScalarField",name:"viewer_guest_status",storageKey:null},Hd={alias:"canViewerJoin",args:null,kind:"ScalarField",name:"can_viewer_join",storageKey:null},Id={alias:"timeString",args:null,kind:"ScalarField",name:"start_time_sentence",storageKey:null},Jd=[b],Kd={alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"social_context",plural:!1,selections:f,storageKey:null},Ld={alias:"watchStatus",args:null,kind:"ScalarField",name:"viewer_watch_status",storageKey:null},Md={alias:null,args:null,kind:"ScalarField",name:"connection_style",storageKey:null},Nd={alias:"canViewerWatch",args:null,kind:"ScalarField",name:"can_viewer_watch",storageKey:null},Od={alias:null,args:[{kind:"Literal",name:"width",value:300}],concreteType:"Image",kind:"LinkedField",name:"profile_picture",plural:!1,selections:m,storageKey:"profile_picture(width:300)"},Pd={alias:null,args:null,kind:"ScalarField",name:"start_timestamp",storageKey:null},Qd={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"application_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"artist_names",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"audio_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"duration_ms",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"music_title",storageKey:null}],type:"ExternalSong",abstractKey:null},Rd={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"lwa_state",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"lwa_type",storageKey:null}],type:"LightweightAction",abstractKey:null},Sd={alias:"desc",args:null,kind:"ScalarField",name:"description",storageKey:null},Td={alias:"thumb_url",args:null,kind:"ScalarField",name:"image_url",storageKey:null},Ud={alias:"item_url",args:null,kind:"ScalarField",name:"target_url",storageKey:null},Vd={alias:"source",args:null,kind:"ScalarField",name:"source_name",storageKey:null},Wd={alias:null,args:null,kind:"ScalarField",name:"second_metaline",storageKey:null},Xd={alias:null,args:null,kind:"ScalarField",name:"third_metaline",storageKey:null},Yd={alias:"total_cost",args:null,kind:"ScalarField",name:"formated_price",storageKey:null},Zd={alias:"merchant_name",args:null,kind:"ScalarField",name:"seller_info",storageKey:null},$d={alias:"raw_amount",args:null,kind:"ScalarField",name:"price_amount",storageKey:null},ae={alias:null,args:null,concreteType:"MessengerCommercePayment",kind:"LinkedField",name:"payment",plural:!1,selections:d,storageKey:null},be={alias:null,args:null,kind:"ScalarField",name:"price_currency",storageKey:null},ce={alias:null,args:null,kind:"ScalarField",name:"price_amount",storageKey:null},de={alias:null,args:null,kind:"ScalarField",name:"can_donate",storageKey:null},ee={alias:null,args:null,kind:"ScalarField",name:"has_viewer_donated",storageKey:null},fe={alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"fundraiser_detailed_progress_text",plural:!1,selections:f,storageKey:null},ge={alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"fundraiser_subtitle_text",plural:!1,selections:f,storageKey:null},T=[l,p,o],he={alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:T,storageKey:null},ie={alias:null,args:null,kind:"ScalarField",name:"recipient_name",storageKey:null},je={alias:null,args:null,kind:"ScalarField",name:"merchant_name",storageKey:null},ke={alias:null,args:null,kind:"ScalarField",name:"account_holder_name",storageKey:null},le={alias:null,args:null,kind:"ScalarField",name:"receipt_id",storageKey:null},me={alias:null,args:null,kind:"ScalarField",name:"shipping_method",storageKey:null},ne={alias:null,args:null,kind:"ScalarField",name:"order_payment_method",storageKey:null},oe={alias:null,args:null,kind:"ScalarField",name:"receipt_url",storageKey:null},pe={alias:null,args:null,kind:"ScalarField",name:"cancellation_url",storageKey:null},qe={alias:null,args:null,kind:"ScalarField",name:"receipient_address",storageKey:null},re={alias:null,args:null,kind:"ScalarField",name:"streets",storageKey:null},se={alias:null,args:null,kind:"ScalarField",name:"city",storageKey:null},U={alias:null,args:null,kind:"ScalarField",name:"country",storageKey:null},te={alias:null,args:null,kind:"ScalarField",name:"postal_code",storageKey:null},ue={alias:null,args:null,kind:"ScalarField",name:"state",storageKey:null},ve={alias:null,args:null,concreteType:"MessengerCommerceBusinessLocation",kind:"LinkedField",name:"structured_address",plural:!1,selections:[re,se,U,te,ue],storageKey:null},we={alias:null,args:null,kind:"ScalarField",name:"total",storageKey:null},xe={alias:null,args:null,kind:"ScalarField",name:"tax",storageKey:null},ye={alias:null,args:null,kind:"ScalarField",name:"shipping_cost",storageKey:null},ze={alias:null,args:null,kind:"ScalarField",name:"subtotal",storageKey:null},Ae={alias:null,args:null,kind:"ScalarField",name:"bubble_type",storageKey:null},Be={alias:null,args:null,kind:"ScalarField",name:"order_time_for_display",storageKey:null},Ce={alias:null,args:null,concreteType:"RetailReceiptAdjustment",kind:"LinkedField",name:"retail_adjustments",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"adjustment_amount",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"adjustment_type",storageKey:null}],storageKey:null},De={alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"partner_logo",plural:!1,selections:m,storageKey:null},Ee={alias:null,args:null,kind:"ScalarField",name:"payment_modules_client",storageKey:null},Fe={alias:null,args:null,kind:"ScalarField",name:"is_viewer_seller",storageKey:null},Ge={alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"payment_snippet",plural:!1,selections:f,storageKey:null},He={alias:null,args:null,kind:"ScalarField",name:"item_id",storageKey:null},Ie={alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"subtitle",plural:!1,selections:f,storageKey:null};F=[F,Lb];Lb={alias:null,args:null,concreteType:"CurrencyAmount",kind:"LinkedField",name:"unit_price",plural:!1,selections:F,storageKey:null};var Je={alias:null,args:Ta,concreteType:"Image",kind:"LinkedField",name:"images",plural:!0,selections:m,storageKey:"images(height:120,width:120)"},Ke={alias:null,args:null,kind:"ScalarField",name:"quantity",storageKey:null};Ta={alias:null,args:null,concreteType:"PaymentPlatformAttachmentComponent",kind:"LinkedField",name:"components",plural:!0,selections:[Jb,Ie,{alias:null,args:Ta,concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:m,storageKey:"image(height:120,width:120)"}],storageKey:null};var Le=[ue,{alias:null,args:null,kind:"ScalarField",name:"action_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"action_detail",storageKey:null},{alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"label",plural:!1,selections:f,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"checkmark",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"extra_data",storageKey:null}],Me={alias:null,args:null,concreteType:"PaymentPlatformAttachmentCallToAction",kind:"LinkedField",name:"payment_call_to_actions",plural:!0,selections:Le,storageKey:null},Ne={alias:null,args:null,concreteType:"PaymentPlatformAttachmentCallToAction",kind:"LinkedField",name:"click_action",plural:!1,selections:Le,storageKey:null};Le={alias:null,args:null,concreteType:"PaymentPlatformAttachmentCallToAction",kind:"LinkedField",name:"summary_action",plural:!1,selections:Le,storageKey:null};var Oe={alias:null,args:null,kind:"ScalarField",name:"invoicer_id",storageKey:null},Pe={alias:null,args:null,kind:"ScalarField",name:"is_last_attachment",storageKey:null};F={alias:null,args:null,concreteType:"CurrencyAmount",kind:"LinkedField",name:"payment_total",plural:!1,selections:F,storageKey:null};var Qe={alias:null,args:null,kind:"ScalarField",name:"product_detail",storageKey:null},Re={alias:null,args:null,concreteType:"PaymentPlatformAttachmentIcon",kind:"LinkedField",name:"payment_status_icon",plural:!1,selections:[kd],storageKey:null},Se={alias:null,args:null,kind:"ScalarField",name:"user_facing_payment_status",storageKey:null},Te={alias:null,args:null,kind:"ScalarField",name:"payment_sub_statuses",storageKey:null},Ue={alias:null,args:null,kind:"ScalarField",name:"should_show_new_xma",storageKey:null},Ve={alias:null,args:null,kind:"ScalarField",name:"buyer_name",storageKey:null},We={alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"group_commerce_item_description",plural:!1,selections:f,storageKey:null},Xe={alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"formatted_price",plural:!1,selections:f,storageKey:null},Ye={alias:null,args:null,kind:"ScalarField",name:"group_commerce_item_title",storageKey:null};Xa={alias:null,args:Xa,concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:m,storageKey:'image(sizing:"contain-fit")'};var Ze={alias:"primary_photo",args:null,concreteType:null,kind:"LinkedField",name:"primary_listing_photo",plural:!1,selections:[Xa],storageKey:null},$e={alias:null,args:null,concreteType:"StreetAddress",kind:"LinkedField",name:"address",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"single_line_full_address",storageKey:null}],storageKey:null},af={alias:null,args:null,kind:"ScalarField",name:"top_category_name",storageKey:null};Wa={alias:null,args:null,concreteType:"FocusedPhoto",kind:"LinkedField",name:"cover_photo",plural:!1,selections:[{alias:null,args:null,concreteType:"Photo",kind:"LinkedField",name:"photo",plural:!1,selections:[a,{alias:null,args:[{kind:"Literal",name:"height",value:720},Wa,{kind:"Literal",name:"width",value:720}],concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:T,storageKey:'image(height:720,sizing:"contain-fit",width:720)'}],storageKey:null}],storageKey:null};var bf={alias:null,args:null,concreteType:"Location",kind:"LinkedField",name:"location",plural:!1,selections:Dc,storageKey:null};Gb={alias:null,args:null,concreteType:"Rating",kind:"LinkedField",name:"overall_star_rating",plural:!1,selections:[Gb],storageKey:null};var cf={alias:null,args:null,kind:"ScalarField",name:"price_range_description",storageKey:null},df={alias:null,args:null,kind:"ScalarField",name:"event_title",storageKey:null},ef={alias:null,args:null,kind:"ScalarField",name:"time",storageKey:null},ff={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"is_active",storageKey:null},df,ef],type:"MessengerEventReminder",abstractKey:null},gf={alias:null,args:null,kind:"ScalarField",name:"tracking_number",storageKey:null},hf={alias:null,args:null,kind:"ScalarField",name:"shipdate_for_display",storageKey:null},jf={alias:null,args:null,kind:"ScalarField",name:"estimated_delivery_time_for_display",storageKey:null},kf={alias:null,args:null,kind:"ScalarField",name:"timezone",storageKey:null};U=[U,se,te,Cc,Bc,ue,re,kf];te={alias:null,args:null,concreteType:"MessengerCommerceBusinessLocation",kind:"LinkedField",name:"commerce_origin",plural:!1,selections:U,storageKey:null};Cc={alias:null,args:null,concreteType:"MessengerCommerceBusinessLocation",kind:"LinkedField",name:"commerce_destination",plural:!1,selections:U,storageKey:null};Bc={alias:null,args:null,concreteType:"RetailShipmentItemsConnection",kind:"LinkedField",name:"retail_shipment_items",plural:!1,selections:[{alias:null,args:null,concreteType:"MessengerRetailItem",kind:"LinkedField",name:"nodes",plural:!0,selections:[a,b,Sd,Td,Ud,Vd,kc,lc,Wd,Xd,A],storageKey:null}],storageKey:null};re={alias:null,args:null,kind:"ScalarField",name:"carrier_tracking_url",storageKey:null};var lf=[p,o,l],mf={alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"logo",plural:!1,selections:lf,storageKey:null},nf={alias:null,args:null,concreteType:"MessengerRetailCarrier",kind:"LinkedField",name:"retail_carrier",plural:!1,selections:[b,re,mf],storageKey:null};U={alias:null,args:null,concreteType:"MessengerCommerceBusinessLocation",kind:"LinkedField",name:"messenger_commerce_location",plural:!1,selections:U,storageKey:null};var of={alias:null,args:null,concreteType:"RetailShipmentTrackingEventsConnection",kind:"LinkedField",name:"shipment_tracking_events",plural:!1,selections:[{alias:null,args:null,concreteType:"MessengerRetailShipmentTrackingEvent",kind:"LinkedField",name:"nodes",plural:!0,selections:[a,U],storageKey:null}],storageKey:null},pf={alias:null,args:null,kind:"ScalarField",name:"tracking_event_time_for_display",storageKey:null},qf={alias:null,args:null,kind:"ScalarField",name:"shipment_tracking_event_type",storageKey:null},rf={alias:null,args:null,kind:"ScalarField",name:"tracking_event_description",storageKey:null};re={alias:null,args:null,concreteType:"MessengerRetailCarrier",kind:"LinkedField",name:"retail_carrier",plural:!1,selections:[b,re,mf,{alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"legal_terms_of_service_text",plural:!1,selections:f,storageKey:null}],storageKey:null};mf={alias:null,args:null,concreteType:"RetailShipmentTrackingEventsConnection",kind:"LinkedField",name:"shipment_tracking_events",plural:!1,selections:[{alias:null,args:null,concreteType:"MessengerRetailShipmentTrackingEvent",kind:"LinkedField",name:"nodes",plural:!0,selections:[a,qf,U],storageKey:null}],storageKey:null};var sf={alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"cover_image",plural:!1,selections:T,storageKey:null},tf={alias:null,args:null,kind:"ScalarField",name:"headline",storageKey:null},uf={alias:null,args:null,concreteType:"Page",kind:"LinkedField",name:"page",plural:!1,selections:Dd,storageKey:null},vf={alias:null,args:null,concreteType:"LeadGenUserInfoField",kind:"LinkedField",name:"field_data",plural:!0,selections:[j,b,{alias:null,args:null,kind:"ScalarField",name:"values",storageKey:null}],storageKey:null},wf=[e,g];wf={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"sender_wec_number",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"sender_wec_number_formated",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"sender_wec_number_fbid",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"sender_wec_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"wec_referral_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"wec_referral_body",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"wec_referral_headline",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"wec_referral_media",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"wec_referral_media_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"wec_referral_has_admin_text",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"wec_sticker_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"templated_message_body",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"templated_message_footer",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"templated_message_header_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"templated_message_header_text",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"templated_message_header_media",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"templated_message_btn1_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"templated_message_btn1_text",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"templated_message_btn2_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"templated_message_btn2_text",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"templated_message_btn3_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"templated_message_btn3_text",storageKey:null},{alias:null,args:null,concreteType:"XFBWATemplatedMessageButtonShape",kind:"LinkedField",name:"templated_message_buttons",plural:!0,selections:wf,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"templated_message_offer_text",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"templated_message_offer_has_expiration",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"templated_message_offer_expiration_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"templated_message_offer_is_offer_code_personalized",storageKey:null},{alias:null,args:null,concreteType:"XFBWATemplatedMessageCardShape",kind:"LinkedField",name:"templated_message_cards",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"title_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"sample_handle",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"body",storageKey:null},{alias:null,args:null,concreteType:"XFBWATemplatedMessageButtonShape",kind:"LinkedField",name:"button",plural:!1,selections:wf,storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"templated_message_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"templated_message_name",storageKey:null}],type:"WECMessage",abstractKey:null};var xf={alias:null,args:null,kind:"ScalarField",name:"is_malicious",storageKey:null},yf={alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"thumbnail_image",plural:!1,selections:q,storageKey:null},zf={alias:null,args:null,kind:"ScalarField",name:"message",storageKey:null},Af={alias:null,args:null,kind:"ScalarField",name:"ad_id",storageKey:null},Bf={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"ice_breaker_title",storageKey:null},{alias:null,args:null,concreteType:"IceBreakerMessage",kind:"LinkedField",name:"ice_breaker_messages",plural:!0,selections:[zf,{alias:null,args:null,kind:"ScalarField",name:"message_key",storageKey:null}],storageKey:null},Af],type:"IceBreakerMessageAttachment",abstractKey:null},Cf={kind:"Literal",name:"height",value:280},Df={kind:"Literal",name:"width",value:280},Ef=[Cf,Df],Ff={alias:"preview",args:Ef,concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:q,storageKey:"image(height:280,width:280)"},Gf={kind:"Literal",name:"height",value:480},Hf={kind:"Literal",name:"width",value:480},If={alias:"large_preview",args:[Gf,Hf],concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:q,storageKey:"image(height:480,width:480)"},Jf={alias:null,args:null,kind:"ScalarField",name:"module_name",storageKey:null},Kf={alias:null,args:null,kind:"ScalarField",name:"program_name",storageKey:null},Lf={alias:null,args:null,kind:"ScalarField",name:"curriculum_message",storageKey:null},Mf={alias:null,args:null,kind:"ScalarField",name:"prompt",storageKey:null},Nf={alias:null,args:null,kind:"ScalarField",name:"step_count",storageKey:null},Of={alias:null,args:null,kind:"ScalarField",name:"total_steps",storageKey:null},Pf={alias:null,args:null,concreteType:"MentorshipProgram",kind:"LinkedField",name:"mentorship_program",plural:!1,selections:[a,{alias:null,args:null,concreteType:"MentorshipCurriculum",kind:"LinkedField",name:"curriculum",plural:!1,selections:d,storageKey:null}],storageKey:null},Qf={alias:null,args:null,kind:"ScalarField",name:"topics",storageKey:null},Rf=[Rb],Sf={alias:null,args:null,kind:"ScalarField",name:"xma_type",storageKey:null},Tf={alias:null,args:null,kind:"ScalarField",name:"xma_title",storageKey:null},Uf={alias:null,args:null,kind:"ScalarField",name:"xma_body",storageKey:null},Vf={alias:null,args:null,kind:"ScalarField",name:"offset",storageKey:null},Wf={alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"title",plural:!1,selections:[e,{alias:null,args:null,concreteType:"EntityAtRange",kind:"LinkedField",name:"ranges",plural:!0,selections:[z,Vf],storageKey:null}],storageKey:null},Xf={alias:null,args:null,kind:"ScalarField",name:"block_type",storageKey:null},Yf={alias:null,args:null,kind:"ScalarField",name:"data",storageKey:null},Zf={alias:null,args:null,kind:"ScalarField",name:"depth",storageKey:null},$f={alias:null,args:null,concreteType:"InlineStyleAtRange",kind:"LinkedField",name:"inline_style_ranges",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"inline_style",storageKey:null},z,Vf],storageKey:null},ag={alias:null,args:null,kind:"ScalarField",name:"comment_count_reduced",storageKey:null},bg={alias:null,args:null,concreteType:"TopLevelCommentsConnection",kind:"LinkedField",name:"top_level_comments",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"total_count",storageKey:null}],storageKey:null},cg={alias:null,args:null,kind:"ScalarField",name:"reaction_count_reduced",storageKey:null},dg={kind:"Literal",name:"first",value:3},eg=[dg,{kind:"Literal",name:"orderby",value:["COUNT_DESC","REACTION_TYPE"]}],fg={alias:null,args:null,kind:"ScalarField",name:"reaction_type",storageKey:null},gg={alias:null,args:null,kind:"ScalarField",name:"post_id",storageKey:null},hg={alias:"description",args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"message",plural:!1,selections:f,storageKey:null},ig={kind:"InlineFragment",selections:Rf,type:"User",abstractKey:null},jg=[n],kg={kind:"InlineFragment",selections:jg,type:"Entity",abstractKey:"__isEntity"},lg={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"actors",plural:!0,selections:[B,b,a,ig,kg,{alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"profile_picture",plural:!1,selections:q,storageKey:null}],storageKey:null},mg={alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:q,storageKey:null},ng={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"media",plural:!1,selections:[Za,mg],storageKey:null},og={alias:"title",args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"title_with_entities",plural:!1,selections:f,storageKey:null};dg=[dg];var pg={alias:null,args:null,kind:"ScalarField",name:"count",storageKey:null},qg=[{kind:"Literal",name:"if_style",value:"file_upload"}],rg={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"media",plural:!1,selections:Yb,storageKey:null},sg=[{kind:"Literal",name:"if_style",value:"photo"}],tg={alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"message",plural:!1,selections:f,storageKey:null},ug={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"actors",plural:!0,selections:[B,b,a,ig,kg],storageKey:null},vg={alias:null,args:null,concreteType:"Photo",kind:"LinkedField",name:"photo",plural:!1,selections:Yb,storageKey:null},wg={alias:null,args:null,concreteType:"FocusedPhoto",kind:"LinkedField",name:"cover_photo",plural:!1,selections:[vg],storageKey:null},xg={alias:null,args:null,kind:"ScalarField",name:"job_title",storageKey:null},yg={alias:null,args:null,concreteType:"WorkUserInfo",kind:"LinkedField",name:"work_info",plural:!1,selections:[xg],storageKey:null},zg={alias:null,args:null,kind:"ScalarField",name:"subscribe_status",storageKey:null},Ag={alias:null,args:null,kind:"ScalarField",name:"visibility",storageKey:null},Bg={alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"visibility_sentence",plural:!1,selections:f,storageKey:null},Cg={alias:null,args:null,kind:"ScalarField",name:"viewer_join_state",storageKey:null},Dg={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"group_general_chat",plural:!1,selections:d,storageKey:null},Eg={alias:null,args:null,kind:"ScalarField",name:"attachment_type_name",storageKey:null},Fg={alias:null,args:null,kind:"ScalarField",name:"privacy_status",storageKey:null},Gg={alias:null,args:null,kind:"ScalarField",name:"file_type_category",storageKey:null},Hg={alias:null,args:null,kind:"ScalarField",name:"app_integration_type",storageKey:null},Ig={alias:null,args:[{kind:"Literal",name:"size",value:"D32"}],concreteType:"Image",kind:"LinkedField",name:"logo",plural:!1,selections:m,storageKey:'logo(size:"D32")'},Jg={alias:null,args:null,kind:"ScalarField",name:"viewer_auth_link",storageKey:null},Kg={alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"attachment_icon",plural:!1,selections:m,storageKey:null},Lg={alias:null,args:null,kind:"ScalarField",name:"content_uri",storageKey:null},Mg={alias:null,args:null,kind:"ScalarField",name:"timestamp",storageKey:null},Ng={alias:null,args:null,kind:"ScalarField",name:"referral_offer_link",storageKey:null},Og={alias:null,args:null,kind:"ScalarField",name:"cta_title",storageKey:null},Pg={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"action_prefill",storageKey:null},Af,Og,{alias:null,args:null,kind:"ScalarField",name:"customer_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"index",storageKey:null},x,{alias:null,args:null,kind:"ScalarField",name:"reply_image_uri",storageKey:null}],type:"InThreadMultiphotoItemCTAData",abstractKey:null},Qg={alias:null,args:null,kind:"ScalarField",name:"viewer_id",storageKey:null},Rg={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"payment_confirmation_status",storageKey:null}],type:"XFBPaymentInvoiceMediaMessageDetection",abstractKey:null};ec={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"target",plural:!1,selections:[B,zb,{kind:"InlineFragment",selections:[a,Ab,s,Bb,Cb,Db,Eb],type:"WECMessageAudio",abstractKey:null},{kind:"InlineFragment",selections:[C,Fb,E,H],type:"MoneyTransfer",abstractKey:null},{kind:"InlineFragment",selections:ec,type:"PeerToPeerTransfer",abstractKey:null},{kind:"InlineFragment",selections:[K,fc,P,O,gc,hc,a,dc,Q,ic,L,R,N,H,{alias:null,args:null,concreteType:"PeerToPeerPaymentRequest",kind:"LinkedField",name:"individual_requests",plural:!0,selections:[K,fc,P,O,gc,hc,a,dc,Q,ic,L,R,N,H],storageKey:null}],type:"PeerToPeerPaymentRequest",abstractKey:null},H,{kind:"InlineFragment",selections:[jc,A,{alias:null,args:null,concreteType:"RetailPromotionItemsConnection",kind:"LinkedField",name:"promotion_items",plural:!1,selections:S,storageKey:null}],type:"MessengerRetailPromotion",abstractKey:null},{kind:"InlineFragment",selections:[jc,A,{alias:null,args:null,concreteType:"MessengerBusinessMessageItemsConnection",kind:"LinkedField",name:"business_items",plural:!1,selections:S,storageKey:null}],type:"MessengerBusinessMessage",abstractKey:null},zc,Ec,{kind:"InlineFragment",selections:[a,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"invite_sender",plural:!1,selections:d,storageKey:null},{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"invite_recipient",plural:!1,selections:d,storageKey:null}],type:"QuickInvite",abstractKey:null},{kind:"InlineFragment",selections:[Fc,Gc,Hc,Ic,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"blob_media",plural:!1,selections:[Kc,Jc],storageKey:null}],type:"MontageDirect",abstractKey:null},{kind:"InlineFragment",selections:[a,Lc,c,Mc],type:"MontageShare",abstractKey:null},{kind:"InlineFragment",selections:[a,Oc,Pc,Qc,Rc,Sc,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"native_component_flow_request",plural:!1,selections:[{kind:"InlineFragment",selections:[Tc,Uc,Vc,a,Nc,Wc,Yc,bd,{alias:null,args:null,concreteType:"NativeComponentFlowBookingRequestServicesProductItemsConnection",kind:"LinkedField",name:"services_product_items",plural:!1,selections:[{alias:null,args:null,concreteType:"ServicesProductItem",kind:"LinkedField",name:"nodes",plural:!0,selections:[a,b,M,cd,dd,{alias:null,args:ed,concreteType:"ProductImage",kind:"LinkedField",name:"images",plural:!0,selections:[fd],storageKey:"images(first:1)"},gd],storageKey:null}],storageKey:null},hd,id,jd,kd,ld,md,nd,od,pd,qd,rd,Rc,Sc,sd],type:"NativeComponentFlowBookingRequest",abstractKey:null}],storageKey:null}],type:"PagesPlatformBookingMessage",abstractKey:null},{kind:"InlineFragment",selections:[a,td,ud,vd,wd],type:"ServicesAppointmentAvailability",abstractKey:null},{kind:"InlineFragment",selections:[a,xd,yd,zd,Ad,Bd,Cd],type:"ServicesGenericAdminText",abstractKey:null},{kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"MessagingParticipant",kind:"LinkedField",name:"genie_sender",plural:!1,selections:Ed,storageKey:null},{alias:null,args:null,concreteType:"StoryAttachment",kind:"LinkedField",name:"story_attachment",plural:!1,selections:[Qa,i,t,$a,ab,bb,cb,db,eb,fb,gb,xb,yb],storageKey:null}],type:"GenieMessage",abstractKey:null},{kind:"InlineFragment",selections:[Fd,Gd,Hd,Id,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"event_place",plural:!1,selections:Jd,storageKey:null},Kd,Ld,Md,Nd,Od,b,Pd],type:"Event",abstractKey:null},Qd,Rd,{kind:"InlineFragment",selections:[a,b,Sd,Td,Ud,Vd,kc,lc,Wd,Xd,w,A],type:"MessengerRetailItem",abstractKey:null},{kind:"InlineFragment",selections:[a,Sd,Yd,Zd,nc,Td,$d,ae,be,ce,b],type:"AgentItemSuggestion",abstractKey:null},{kind:"InlineFragment",selections:[a,de,ee,fe,ge,{kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"FundraiserCoverPhoto",kind:"LinkedField",name:"focused_cover_photo",plural:!1,selections:[{alias:null,args:null,concreteType:"Photo",kind:"LinkedField",name:"photo",plural:!1,selections:[he],storageKey:null}],storageKey:null}],type:"FundraiserWithPresence",abstractKey:"__isFundraiserWithPresence"}],type:"Fundraiser",abstractKey:"__isFundraiser"},{kind:"InlineFragment",selections:[a,ie,je,ke,le,me,ne,oe,pe,qe,ve,kd,we,xe,ye,ze,{alias:null,args:null,concreteType:"RetailReceiptItemsConnection",kind:"LinkedField",name:"retail_items",plural:!1,selections:S,storageKey:null},Ae,Be,Ce,De],type:"MessengerRetailReceipt",abstractKey:null},{kind:"InlineFragment",selections:[Ee,Fe,Ge,{alias:null,args:null,concreteType:"PaymentInvoiceProduct",kind:"LinkedField",name:"item_list",plural:!0,selections:[He,b,Ie,M,Lb,Je,Ke],storageKey:null},Ta,Me,Ne,Le,Oe,Pe,F,Qe,Re,Se,Te,Ue,Ve],type:"PaymentPlatformAttachment",abstractKey:null},{kind:"InlineFragment",selections:d,type:"JobApplication",abstractKey:null},{kind:"InlineFragment",selections:[We,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"group_commerce_item_seller",plural:!1,selections:d,storageKey:null},Xe,Ye,Ze,n],type:"GroupCommerceProductItem",abstractKey:null},{kind:"InlineFragment",selections:[Xe,Ze],type:"MarketplaceListingRenderable",abstractKey:"__isMarketplaceListingRenderable"},{kind:"InlineFragment",selections:[$e,af,Wa,bf,b,Gb,a,cf],type:"Page",abstractKey:null},ff,{kind:"InlineFragment",selections:[a,{alias:null,args:null,concreteType:"MessengerRetailShipment",kind:"LinkedField",name:"shipment",plural:!1,selections:[a,gf,hf,jf,te,Cc,Bc,nf,of],storageKey:null},pf,qf,U,rf,Ae],type:"MessengerRetailShipmentTrackingEvent",abstractKey:null},{kind:"InlineFragment",selections:[a,gf,hf,jf,te,Cc,Bc,re,mf,{alias:null,args:null,concreteType:"MessengerRetailReceipt",kind:"LinkedField",name:"receipt",plural:!1,selections:[le],storageKey:null},{alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"recipient",plural:!1,selections:Jd,storageKey:null},Ae],type:"MessengerRetailShipment",abstractKey:null},{kind:"InlineFragment",selections:[a,sf,tf,b,uf],type:"LeadGenDeepLinkData",abstractKey:null},{kind:"InlineFragment",selections:[a,vf],type:"UserLeadGenInfo",abstractKey:null},wf,{kind:"InlineFragment",selections:[a,b,xf,l,Cb,Db],type:"WECMessageFile",abstractKey:null},{kind:"InlineFragment",selections:[a,s,Bb,Cb,Db,Ab,o,yf,p],type:"WECMessageVideo",abstractKey:null},Bf,{kind:"InlineFragment",selections:[a,Cb,Ff,If],type:"WECMessageImage",abstractKey:null},{kind:"InlineFragment",selections:[a,Jf,Kf,Lf,Mf,Nf,Of,Pf],type:"MentorshipMessengerCurriculumStep",abstractKey:null},{kind:"InlineFragment",selections:[a,Qf],type:"MentorshipMessengerDiscussionTopicSet",abstractKey:null},{kind:"InlineFragment",selections:[a,{alias:null,args:null,concreteType:"MentorshipProgram",kind:"LinkedField",name:"mentorship_program",plural:!1,selections:[a,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"other_member",plural:!1,selections:Rf,storageKey:null}],storageKey:null},Sf],type:"MentorshipMessengerLeavePrompt",abstractKey:null},{kind:"InlineFragment",selections:[a,Sf],type:"MentorshipMessengerReminder",abstractKey:null},{kind:"InlineFragment",selections:[a,Sf,Tf,Uf],type:"MentorshipMessengerProgressTracker",abstractKey:null},{kind:"InlineFragment",selections:[Wf,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"message_richtext",plural:!0,selections:[Xf,Yf,Zf,{alias:null,args:null,concreteType:"ComposedEntityAtRange",kind:"LinkedField",name:"entity_ranges",plural:!0,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"entity",plural:!1,selections:[B],storageKey:null},z,Vf],storageKey:null},$f,e],storageKey:null},{alias:null,args:null,concreteType:"Feedback",kind:"LinkedField",name:"feedback",plural:!1,selections:[ag,bg,cg,{alias:null,args:eg,concreteType:"TopReactionsConnection",kind:"LinkedField",name:"top_reactions",plural:!1,selections:[{alias:null,args:null,concreteType:"FeedbackReactionInfo",kind:"LinkedField",name:"nodes",plural:!0,selections:[fg],storageKey:null}],storageKey:'top_reactions(first:3,orderby:["COUNT_DESC","REACTION_TYPE"])'}],storageKey:null},gg,ic,hg,lg,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"to",plural:!1,selections:[B,b,ig,kg],storageKey:null},{alias:null,args:null,concreteType:"StoryAttachment",kind:"LinkedField",name:"attachments",plural:!0,selections:[ab,n,$a,Qa,ng,og,{alias:null,args:dg,concreteType:"SubattachmentsConnection",kind:"LinkedField",name:"all_subattachments",plural:!1,selections:[pg,{alias:"files",args:qg,concreteType:"StoryAttachment",kind:"LinkedField",name:"nodes",plural:!0,selections:[og,rg],storageKey:'nodes(if_style:"file_upload")'},{alias:"images",args:sg,concreteType:"StoryAttachment",kind:"LinkedField",name:"nodes",plural:!0,selections:[rg],storageKey:'nodes(if_style:"photo")'}],storageKey:"all_subattachments(first:3)"}],storageKey:null},{alias:null,args:null,concreteType:"Story",kind:"LinkedField",name:"attached_story",plural:!1,selections:[tg,ug,{alias:null,args:null,concreteType:"StoryAttachment",kind:"LinkedField",name:"attachments",plural:!0,selections:[ng],storageKey:null}],storageKey:null}],type:"Story",abstractKey:null},{kind:"InlineFragment",selections:[a,b,D,wg,yg,zg],type:"User",abstractKey:null},{kind:"InlineFragment",selections:[a,b,Ag,Bg,Cg,wg,Dg,{alias:null,args:null,concreteType:"GroupsSyncMetadata",kind:"LinkedField",name:"work_groups_sync_metadata",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"messenger_group",plural:!1,selections:d,storageKey:null}],storageKey:null}],type:"Group",abstractKey:null},{kind:"InlineFragment",selections:[a,Eg,Fg,Gg,{alias:null,args:null,concreteType:"AppIntegration",kind:"LinkedField",name:"app_integration",plural:!1,selections:[Hg,b,Ig,Jg],storageKey:null},Kg,Lg,{alias:null,args:null,concreteType:"AppContentAdditionalData",kind:"LinkedField",name:"link_preview_additional_data",plural:!0,selections:[h,e,Ob,ub,Mg,{alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"profiles",plural:!0,selections:[D,b],storageKey:null}],storageKey:null}],type:"AppContent",abstractKey:null},{kind:"InlineFragment",selections:d,type:"OfferItem",abstractKey:null},{kind:"InlineFragment",selections:[w],type:"CommerceProductItemShare",abstractKey:null},{kind:"InlineFragment",selections:[a,Ng],type:"ApplicationReferralXMA",abstractKey:null},Pg,{kind:"InlineFragment",selections:[a,Qg],type:"XFBP2MXMA",abstractKey:null},Rg],storageKey:null};P={alias:null,args:null,concreteType:"StoryAttachment",kind:"LinkedField",name:"story_attachment",plural:!1,selections:[Qa,i,t,$a,ab,bb,cb,db,eb,fb,gb,xb,yb,ec,{alias:null,args:null,concreteType:"StoryAttachment",kind:"LinkedField",name:"subattachments",plural:!0,selections:[Qa,i,t,$a,ab,bb,cb,db,eb,fb,gb,xb,yb,ec],storageKey:null}],storageKey:null};O={kind:"InlineFragment",selections:d,type:"Node",abstractKey:"__isNode"};Q={alias:null,args:null,concreteType:"ExtensibleMessageAttachment",kind:"LinkedField",name:"extensible_attachment",plural:!1,selections:[Pa,P,{alias:"genie_attachment",args:null,concreteType:"StoryAttachment",kind:"LinkedField",name:"story_attachment",plural:!1,selections:[{alias:"genie_message",args:null,concreteType:null,kind:"LinkedField",name:"target",plural:!1,selections:[{kind:"InlineFragment",selections:[a,{alias:null,args:null,concreteType:"MessagingParticipant",kind:"LinkedField",name:"genie_sender",plural:!1,selections:[a,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"messaging_actor",plural:!1,selections:[O,b],storageKey:null}],storageKey:null},P],type:"GenieMessage",abstractKey:null}],storageKey:null}],storageKey:null}],storageKey:null};H={alias:null,args:null,concreteType:"Sticker",kind:"LinkedField",name:"sticker",plural:!1,selections:k,storageKey:null};A={kind:"Literal",name:"sizing",value:"cover-fill"};S={alias:null,args:null,kind:"ScalarField",name:"projection_type",storageKey:null};Ze={kind:"InlineFragment",selections:[tc,uc,Ab,{alias:"preview",args:[Cf,A,Df],concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:q,storageKey:'image(height:280,sizing:"cover-fill",width:280)'},{alias:"large_preview",args:[Gf,A,Hf],concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:q,storageKey:'image(height:480,sizing:"cover-fill",width:480)'},{alias:"thumbnail",args:[{kind:"Literal",name:"height",value:38},{kind:"Literal",name:"width",value:58}],concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:m,storageKey:"image(height:38,width:58)"},{alias:null,args:null,concreteType:"PhotoEncoding",kind:"LinkedField",name:"photo_encodings",plural:!0,selections:[a,p,o,S,{alias:null,args:null,kind:"ScalarField",name:"cdn_uri",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_tile_level",storageKey:null},{alias:null,args:[{kind:"Literal",name:"thumbnail_dimensions",value:[{height:280,width:280},{height:480,width:480}]}],concreteType:"SphericalPhotoThumbnail",kind:"LinkedField",name:"thumbnails",plural:!0,selections:lf,storageKey:'thumbnails(thumbnail_dimensions:[{"height":280,"width":280},{"height":480,"width":480}])'},{alias:null,args:[{kind:"Literal",name:"tile_levels",value:[0]}],concreteType:"PhotoTile",kind:"LinkedField",name:"tiles",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"level",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"face",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"col",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"row",storageKey:null},l],storageKey:"tiles(tile_levels:[0])"},{alias:null,args:null,concreteType:"PhotosphereMetadata",kind:"LinkedField",name:"spherical_metadata",plural:!1,selections:[S,{alias:null,args:null,kind:"ScalarField",name:"full_pano_width_pixels",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"full_pano_height_pixels",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cropped_area_image_width_pixels",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cropped_area_image_height_pixels",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cropped_area_left_pixels",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cropped_area_top_pixels",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"initial_view_heading_degrees",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"initial_view_pitch_degrees",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"initial_view_vertical_fov_degrees",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"initial_view_roll_degrees",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"pose_heading_degrees",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"pose_pitch_degrees",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"pose_roll_degrees",storageKey:null}],storageKey:null}],storageKey:null},Pa,xc,{alias:null,args:null,kind:"ScalarField",name:"original_extension",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"render_as_sticker",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"blurred_image_uri",storageKey:null}],type:"MessageImage",abstractKey:null};Bc={kind:"InlineFragment",selections:[tc,uc,Ab,rc,{alias:null,args:null,kind:"ScalarField",name:"animated_image_caption",storageKey:null},Pa,qc,xc],type:"MessageAnimatedImage",abstractKey:null};Rf={alias:null,args:null,kind:"ScalarField",name:"url_skipshim",storageKey:null};rg={kind:"InlineFragment",selections:[tc,uc,Ab,s,r,{alias:null,args:null,kind:"ScalarField",name:"is_voicemail",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"audio_type",storageKey:null},Bb,Rf],type:"MessageAudio",abstractKey:null};ng={alias:null,args:null,kind:"ScalarField",name:"content_type",storageKey:null};wg={kind:"InlineFragment",selections:[tc,uc,Ab,n,{alias:null,args:null,kind:"ScalarField",name:"mimetype",storageKey:null},ng,xf,{alias:null,args:null,kind:"ScalarField",name:"message_file_fbid",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"preview_url",storageKey:null},Bb,Rf,{alias:"preview",args:null,concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:m,storageKey:null}],type:"MessageFile",abstractKey:null};w=[B,Ze,Bc,rg,vc,wg];t={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"blob_attachments",plural:!0,selections:w,storageKey:null};fb={alias:null,args:null,kind:"ScalarField",name:"extensible_message_admin_text_type",storageKey:null};xb={alias:null,args:null,concreteType:"Application",kind:"LinkedField",name:"game",plural:!1,selections:d,storageKey:null};ec={kind:"InlineFragment",selections:[xb],type:"InstantGameUpdateExtensibleMessageAdminText",abstractKey:null};P={alias:null,args:null,kind:"ScalarField",name:"platform_xmd_encoded",storageKey:null};k={alias:null,args:null,kind:"ScalarField",name:"message_unsendability_status",storageKey:null};Cf={alias:"last_message",args:Ma,concreteType:"MessagesOfThreadConnection",kind:"LinkedField",name:"messages",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"nodes",plural:!0,selections:[c,{alias:null,args:null,concreteType:"MessagingParticipant",kind:"LinkedField",name:"message_sender",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"messaging_actor",plural:!1,selections:d,storageKey:null}],storageKey:null},Na,Oa,{kind:"InlineFragment",selections:[Q,H,t],type:"UserMessage",abstractKey:null},{kind:"InlineFragment",selections:[fb,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"extensible_message_admin_text",plural:!1,selections:[ec],storageKey:null}],type:"GenericAdminTextMessage",abstractKey:null},P,k],storageKey:null}],storageKey:"messages(last:1)"};Df={alias:null,args:null,concreteType:"ThreadConnectivityData",kind:"LinkedField",name:"thread_connectivity_data",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"connectivity_status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"first_sender_id",storageKey:null}],storageKey:null};Gf={alias:null,args:null,kind:"ScalarField",name:"job_status",storageKey:null};A={alias:null,args:null,kind:"ScalarField",name:"should_show_jobs_feature",storageKey:null};Hf={alias:null,args:null,kind:"ScalarField",name:"should_show_schdule_interview_dialog",storageKey:null};q={alias:null,args:null,concreteType:"JobApplicationsFromThreadConnection",kind:"LinkedField",name:"thread_associated_job_applications",plural:!1,selections:[{alias:null,args:null,concreteType:"JobApplication",kind:"LinkedField",name:"nodes",plural:!0,selections:[a,{alias:null,args:null,concreteType:"JobOpening",kind:"LinkedField",name:"job_opening",plural:!1,selections:[Gf,{alias:null,args:null,concreteType:"Page",kind:"LinkedField",name:"employer",plural:!1,selections:[A,Hf],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null};S={alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"thread_associated_page_admin",plural:!1,selections:Xc,storageKey:null};rc={alias:null,args:null,kind:"ScalarField",name:"unread_count",storageKey:null};qc={condition:"is_work_teamwork_not_putting_muted_in_unreads",kind:"Condition",passingValue:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"unread_mentions_count",storageKey:null}]};tc={alias:null,args:null,kind:"ScalarField",name:"messages_count",storageKey:null};uc={alias:null,args:[{kind:"Literal",name:"size",value:60}],concreteType:"Image",kind:"LinkedField",name:"square_image",plural:!1,selections:m,storageKey:"square_image(size:60)"};Rf={alias:null,args:null,kind:"ScalarField",name:"updated_time_precise",storageKey:null};Xc={alias:null,args:null,kind:"ScalarField",name:"mute_until",storageKey:null};var Sg={alias:null,args:null,kind:"ScalarField",name:"is_pin_protected",storageKey:null},Tg={alias:null,args:null,kind:"ScalarField",name:"is_pinned",storageKey:null},Ug={alias:null,args:null,kind:"ScalarField",name:"is_viewer_subscribed",storageKey:null},Vg={alias:null,args:null,kind:"ScalarField",name:"is_other_recipient_page",storageKey:null},Wg={alias:null,args:null,kind:"ScalarField",name:"thread_queue_enabled",storageKey:null},Xg={alias:null,args:null,kind:"ScalarField",name:"folder",storageKey:null},Yg={alias:null,args:null,kind:"ScalarField",name:"has_viewer_archived",storageKey:null},Zg={alias:null,args:null,kind:"ScalarField",name:"is_page_follow_up",storageKey:null},$g={alias:null,args:null,kind:"ScalarField",name:"is_page_unresponded_thread",storageKey:null},ah={alias:null,args:null,kind:"ScalarField",name:"cannot_reply_reason",storageKey:null},bh={alias:null,args:null,kind:"ScalarField",name:"can_viewer_report",storageKey:null},ch={alias:null,args:null,kind:"ScalarField",name:"composer_input_disabled",storageKey:null},dh={alias:null,args:null,kind:"ScalarField",name:"ephemeral_ttl_mode",storageKey:null},eh={alias:null,args:null,kind:"ScalarField",name:"emoji",storageKey:null},fh={alias:null,args:null,kind:"ScalarField",name:"participant_id",storageKey:null},gh={alias:null,args:null,kind:"ScalarField",name:"nickname",storageKey:null},hh={alias:null,args:null,concreteType:"MessageThreadParticipantCustomization",kind:"LinkedField",name:"participant_customizations",plural:!0,selections:[fh,gh],storageKey:null},ih={alias:null,args:null,kind:"ScalarField",name:"outgoing_bubble_color",storageKey:null},jh={alias:null,args:null,concreteType:"MessageThreadCustomization",kind:"LinkedField",name:"customization_info",plural:!1,selections:[eh,hh,ih],storageKey:null},kh={alias:null,args:null,kind:"ScalarField",name:"fallback_color",storageKey:null},lh={alias:null,args:null,kind:"ScalarField",name:"accessibility_label",storageKey:null},mh={alias:null,args:null,kind:"ScalarField",name:"reverse_gradients_for_radial",storageKey:null},nh={alias:null,args:null,kind:"ScalarField",name:"gradient_colors",storageKey:null},oh={alias:null,args:null,kind:"ScalarField",name:"keyframe_asset_uri",storageKey:null},ph={alias:null,args:null,kind:"ScalarField",name:"reaction_name",storageKey:null},qh={alias:null,args:null,kind:"ScalarField",name:"reaction_emoji",storageKey:null},rh={alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"static_asset",plural:!1,selections:m,storageKey:null},sh={alias:null,args:null,concreteType:"MessengerThreadTheme",kind:"LinkedField",name:"thread_theme",plural:!1,selections:[a,kh,lh,mh,nh,{alias:null,args:null,concreteType:"MessengerReactionPack",kind:"LinkedField",name:"reaction_pack",plural:!1,selections:[{alias:null,args:null,concreteType:"MessengerReactionPackReactionAssetsConnection",kind:"LinkedField",name:"reaction_assets",plural:!1,selections:[{alias:null,args:null,concreteType:"MessengerReactionAsset",kind:"LinkedField",name:"nodes",plural:!0,selections:[oh,ph,qh,rh],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},th={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"thread_admins",plural:!0,selections:d,storageKey:null},uh={alias:"approval_mode",args:null,kind:"ScalarField",name:"group_approval_mode",storageKey:null},vh={alias:null,args:null,concreteType:"MessageThreadJoinableMode",kind:"LinkedField",name:"joinable_mode",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"mode",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"link",storageKey:null}],storageKey:null},wh={alias:null,args:null,concreteType:"GroupApprovalQueueConnection",kind:"LinkedField",name:"group_approval_queue",plural:!1,selections:[{alias:null,args:null,concreteType:"MessengerGroupRequesterInfo",kind:"LinkedField",name:"nodes",plural:!0,selections:[{alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"requester",plural:!1,selections:d,storageKey:null},{alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"inviter",plural:!1,selections:d,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"request_source",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"request_timestamp",storageKey:null}],storageKey:null}],storageKey:null},xh=[{alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"nodes",plural:!0,selections:d,storageKey:null}],yh={alias:null,args:null,concreteType:"ApprovalRequestsOfThreadConnection",kind:"LinkedField",name:"approval_requests",plural:!1,selections:xh,storageKey:null},zh={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"thread_queue_metadata",plural:!1,selections:[yh],storageKey:null},Ah={alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"lightweight_event_creator",plural:!1,selections:d,storageKey:null},Bh={alias:null,args:null,kind:"ScalarField",name:"lightweight_event_type",storageKey:null},Ch={alias:null,args:null,kind:"ScalarField",name:"location_name",storageKey:null};Dc={alias:null,args:null,concreteType:"Location",kind:"LinkedField",name:"location_coordinates",plural:!1,selections:Dc,storageKey:null};var Dh={alias:null,args:null,concreteType:"StreetAddress",kind:"LinkedField",name:"address",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"full_address",storageKey:null}],storageKey:null},Eh={alias:null,args:null,kind:"ScalarField",name:"lightweight_event_status",storageKey:null},Fh={alias:null,args:null,kind:"ScalarField",name:"note",storageKey:null},Gh={alias:null,args:null,kind:"ScalarField",name:"repeat_mode",storageKey:null},V={alias:null,args:null,kind:"ScalarField",name:"message_id",storageKey:null},Hh={alias:null,args:null,kind:"ScalarField",name:"seconds_to_notify_before",storageKey:null},Ih={alias:null,args:null,kind:"ScalarField",name:"allows_rsvp",storageKey:null},Jh={alias:null,args:null,concreteType:"Event",kind:"LinkedField",name:"related_event",plural:!1,selections:d,storageKey:null},Kh={alias:null,args:null,concreteType:"MessengerEventReminderMembersConnection",kind:"LinkedField",name:"event_reminder_members",plural:!1,selections:[{alias:null,args:null,concreteType:"MessengerEventReminderMembersEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"node",plural:!1,selections:d,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"guest_list_state",storageKey:null}],storageKey:null}],storageKey:null},Lh={alias:null,args:ed,concreteType:"MessengerEventRemindersOfThreadConnection",kind:"LinkedField",name:"event_reminders",plural:!1,selections:[{alias:null,args:null,concreteType:"MessengerEventReminder",kind:"LinkedField",name:"nodes",plural:!0,selections:[a,Ah,ef,Bh,Ch,Dc,{alias:null,args:null,concreteType:"Page",kind:"LinkedField",name:"location_page",plural:!1,selections:[Dh],storageKey:null},Eh,Fh,Gh,df,{alias:null,args:null,concreteType:"UserMessage",kind:"LinkedField",name:"trigger_message",plural:!1,selections:[V],storageKey:null},Hh,Ih,Jh,Kh],storageKey:null}],storageKey:"event_reminders(first:1)"},Mh={alias:null,args:null,concreteType:"MessageThread",kind:"LinkedField",name:"montage_thread",plural:!1,selections:d,storageKey:null},Nh=[Na],Oh={alias:"last_read_receipt",args:Ma,concreteType:"MessagingReadReceiptsOfThreadConnection",kind:"LinkedField",name:"read_receipts",plural:!1,selections:[{alias:null,args:null,concreteType:"MessagingReadReceipt",kind:"LinkedField",name:"nodes",plural:!0,selections:Nh,storageKey:null}],storageKey:"read_receipts(last:1)"},Ph={alias:"is_flagged",args:[{kind:"Literal",name:"page_message_tag",value:"FLAG"}],kind:"ScalarField",name:"has_tag",storageKey:'has_tag(page_message_tag:"FLAG")'},Qh={alias:null,args:null,kind:"ScalarField",name:"label_color",storageKey:null},W={alias:null,args:null,kind:"ScalarField",name:"data_silo",storageKey:null},Rh={alias:null,args:null,kind:"ScalarField",name:"label_source",storageKey:null},Sh={alias:null,args:null,kind:"ScalarField",name:"is_ad_response_label",storageKey:null},Th={alias:null,args:null,concreteType:"PageMessageThreadCustomThreadLabelsConnection",kind:"LinkedField",name:"custom_thread_labels",plural:!1,selections:[{alias:null,args:null,concreteType:"BusinessPresenceCustomLabel",kind:"LinkedField",name:"nodes",plural:!0,selections:[a,b,Qh,W,Rh,Sh],storageKey:null}],storageKey:null},Uh=[a,b,Ob],Vh={alias:null,args:null,concreteType:"PageMessageThreadCustomTagsConnection",kind:"LinkedField",name:"custom_thread_tags",plural:!1,selections:[{alias:null,args:null,concreteType:"PageCustomTag",kind:"LinkedField",name:"nodes",plural:!0,selections:Uh,storageKey:null}],storageKey:null},Wh={alias:null,args:null,kind:"ScalarField",name:"is_ai_label",storageKey:null},Xh={alias:null,args:null,kind:"ScalarField",name:"is_ai_handoff_label",storageKey:null},Yh={alias:null,args:null,concreteType:"PageMessageThreadCorpThreadLabelsConnection",kind:"LinkedField",name:"corp_thread_labels",plural:!1,selections:[{alias:null,args:null,concreteType:"BusinessPresenceCorporationLabel",kind:"LinkedField",name:"nodes",plural:!0,selections:[a,b,Qh,Rh,W,Wh,Xh,Sh],storageKey:null}],storageKey:null},Zh={alias:null,args:null,concreteType:"PageMessageThread",kind:"LinkedField",name:"related_page_thread",plural:!1,selections:[Ph,td,Th,Vh,Yh],storageKey:null},$h={alias:null,args:null,kind:"ScalarField",name:"call_state",storageKey:null},ai={alias:null,args:null,kind:"ScalarField",name:"server_info_data",storageKey:null},bi={alias:null,args:null,concreteType:"RtcCallData",kind:"LinkedField",name:"rtc_call_data",plural:!1,selections:[$h,ai,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"initiator",plural:!1,selections:d,storageKey:null}],storageKey:null};se={alias:null,args:null,concreteType:"Location",kind:"LinkedField",name:"location",plural:!1,selections:[{alias:null,args:null,concreteType:"ReverseGeocodeData",kind:"LinkedField",name:"reverse_geocode",plural:!1,selections:[se,ue],storageKey:null}],storageKey:null};var ci={alias:null,args:null,kind:"ScalarField",name:"inventory_count",storageKey:null},di={alias:null,args:null,kind:"ScalarField",name:"delivery_types",storageKey:null},ei={alias:null,args:null,kind:"ScalarField",name:"c2c_shipping_eligible",storageKey:null},fi={alias:null,args:null,kind:"ScalarField",name:"is_pending",storageKey:null},gi={alias:null,args:null,kind:"ScalarField",name:"is_shipping_offered",storageKey:null},hi={alias:null,args:null,kind:"ScalarField",name:"is_sold",storageKey:null},ii={alias:null,args:null,concreteType:"ProductItem",kind:"LinkedField",name:"product_item",plural:!1,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"is_commerce_post_item",storageKey:null}],storageKey:null},ji={alias:null,args:[{kind:"Literal",name:"site",value:"www"}],kind:"ScalarField",name:"url",storageKey:'url(site:"www")'},ki={alias:null,args:null,concreteType:"MarketplaceRatingState",kind:"LinkedField",name:"rating_state",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"is_eligible_to_rate",storageKey:null}],storageKey:null},li={alias:null,args:null,kind:"ScalarField",name:"is_eligible",storageKey:null},mi={kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"MarketplaceC2CShippingSeller",kind:"LinkedField",name:"marketplace_c2c_shipping_seller",plural:!1,selections:[li],storageKey:null}],type:"User",abstractKey:null},ni={alias:null,args:null,kind:"ScalarField",name:"label_type",storageKey:null},oi={alias:null,args:null,concreteType:"MarketplaceThreadLabel",kind:"LinkedField",name:"seller_added_labels",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"label_string",storageKey:null},ni],storageKey:null},pi={alias:null,args:null,concreteType:"MarketplaceThreadData",kind:"LinkedField",name:"marketplace_thread_data",plural:!1,selections:[{alias:null,args:null,concreteType:"GroupCommerceProductItem",kind:"LinkedField",name:"for_sale_item",plural:!1,selections:[a,Mc,Ye,Xe,se,ci,di,ei,fi,gi,hi,{alias:"primary_photo",args:null,concreteType:null,kind:"LinkedField",name:"primary_listing_photo",plural:!1,selections:Yb,storageKey:null},ii,ji],storageKey:null},ki,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"buyer",plural:!1,selections:d,storageKey:null},{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"seller",plural:!1,selections:[a,mi],storageKey:null},oi],storageKey:null},qi={alias:"action_link",args:null,kind:"ScalarField",name:"url",storageKey:null},ri={alias:"room_type",args:null,kind:"ScalarField",name:"time_spent_room_type",storageKey:null},si={alias:null,args:null,kind:"ScalarField",name:"privacy_mode",storageKey:null},ti={alias:null,args:null,kind:"ScalarField",name:"approval_mode_toggleable",storageKey:null},ui={alias:null,args:null,concreteType:"MentorshipProgram",kind:"LinkedField",name:"mentorship_program",plural:!1,selections:Dd,storageKey:null},vi=[pg],wi={alias:null,args:null,concreteType:"GroupSavesConnection",kind:"LinkedField",name:"group_saves",plural:!1,selections:vi,storageKey:null},xi={alias:null,args:[{kind:"Literal",name:"external_ref",value:"messenger"}],kind:"ScalarField",name:"verse_group_link",storageKey:'verse_group_link(external_ref:"messenger")'},yi={kind:"InlineFragment",selections:[b,$e],type:"Page",abstractKey:null};Dg={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"associated_object",plural:!1,selections:[{kind:"InlineFragment",selections:[qi,a,b,D,Dg,ri,si,ti,ui,wi,xi],type:"Group",abstractKey:null},{kind:"InlineFragment",selections:[qi,a,b,D,ri,si,ti,Pd,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"event_place",plural:!1,selections:[yi],storageKey:null}],type:"Event",abstractKey:null}],storageKey:null};var zi={alias:null,args:null,kind:"ScalarField",name:"reactions_mute_mode",storageKey:null},Ai={alias:null,args:null,kind:"ScalarField",name:"mentions_mute_mode",storageKey:null},Bi={alias:null,args:null,kind:"ScalarField",name:"customization_enabled",storageKey:null},Ci={alias:null,args:null,kind:"ScalarField",name:"thread_type",storageKey:null},Di={alias:null,args:null,kind:"ScalarField",name:"group_thread_subtype",storageKey:null},Ei={alias:null,args:null,kind:"ScalarField",name:"participant_add_mode_as_string",storageKey:null},Fi={alias:null,args:null,kind:"ScalarField",name:"is_canonical_neo_user",storageKey:null};fh={alias:null,args:null,concreteType:"MessageThreadParticipantEventStatusInfo",kind:"LinkedField",name:"participants_event_status",plural:!0,selections:[fh,{alias:null,args:null,kind:"ScalarField",name:"event_status",storageKey:null}],storageKey:null};var Gi={alias:null,args:null,kind:"ScalarField",name:"comm_status",storageKey:null},Hi={alias:null,args:null,kind:"ScalarField",name:"comm_source_id",storageKey:null},Ii={alias:null,args:null,kind:"ScalarField",name:"is_priority",storageKey:null},Ji={alias:null,args:null,kind:"ScalarField",name:"biz_inbox_tags",storageKey:null},Ki={alias:null,args:null,kind:"ScalarField",name:"priority_score",storageKey:null},Li={alias:null,args:null,kind:"ScalarField",name:"trigger_id",storageKey:null},Mi=[{alias:null,args:null,kind:"ScalarField",name:"suggestion_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"suggestion_content",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"triggered_timestamp",storageKey:null},Li],Ni={alias:null,args:null,concreteType:"SuggestedReplyData",kind:"LinkedField",name:"biz_inbox_suggested_reply",plural:!1,selections:Mi,storageKey:null},Oi={alias:null,args:null,kind:"ScalarField",name:"is_thread_currently_handled_by_ai_agent",storageKey:null},Pi=[a,b,{alias:null,args:[{kind:"Literal",name:"height",value:20},{kind:"Literal",name:"width",value:20}],concreteType:"Image",kind:"LinkedField",name:"profile_picture",plural:!1,selections:m,storageKey:"profile_picture(height:20,width:20)"}],Qi={alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"admin",plural:!1,selections:Pi,storageKey:null},Ri={alias:null,args:null,kind:"ScalarField",name:"comm_icon_type",storageKey:null};Yb={alias:null,args:null,concreteType:"PageCommItem",kind:"LinkedField",name:"page_comm_item",plural:!1,selections:[a,Gi,Hi,Ii,Ji,Ki,Ni,Oi,{alias:null,args:null,concreteType:"PageCommItemToPageCommItemOwnersConnection",kind:"LinkedField",name:"comm_item_owners",plural:!1,selections:[{alias:null,args:null,concreteType:"PageCommItemOwner",kind:"LinkedField",name:"nodes",plural:!0,selections:[Qi],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"subtitle",plural:!1,selections:[{alias:null,args:null,concreteType:"ImageAtRange",kind:"LinkedField",name:"image_ranges",plural:!0,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"entity_with_image",plural:!1,selections:Yb,storageKey:null},z,Vf],storageKey:null},$f,e],storageKey:null},Ri],storageKey:null};var Si={alias:null,args:null,kind:"ScalarField",name:"admin_model_status_string",storageKey:null},Ti={alias:null,args:null,kind:"ScalarField",name:"groups_sync_status_string",storageKey:null};jg={alias:null,args:null,concreteType:"GroupsSyncMetadata",kind:"LinkedField",name:"groups_sync_metadata",plural:!1,selections:[{alias:null,args:null,concreteType:"Group",kind:"LinkedField",name:"fb_group",plural:!1,selections:jg,storageKey:null}],storageKey:null};var Ui={alias:null,args:null,kind:"ScalarField",name:"pinning_time",storageKey:null},Vi={alias:null,args:null,concreteType:"OmniMActionLite",kind:"LinkedField",name:"m_suggestions",plural:!0,selections:[a,j,g,{alias:null,args:null,concreteType:"OmniMActionDataLite",kind:"LinkedField",name:"data",plural:!1,selections:[{alias:null,args:null,concreteType:"OmniMActionReminderDataLite",kind:"LinkedField",name:"reminder",plural:!1,selections:[Mg,{alias:null,args:null,kind:"ScalarField",name:"topic",storageKey:null}],storageKey:null}],storageKey:null},Ac],storageKey:null},Wi={alias:null,args:null,kind:"ScalarField",name:"offline_threading_id",storageKey:null},Xi={alias:null,args:null,kind:"ScalarField",name:"email",storageKey:null},Yi={alias:null,args:null,concreteType:"MessagingParticipant",kind:"LinkedField",name:"message_sender",plural:!1,selections:[a,Xi],storageKey:null},Zi={alias:null,args:null,kind:"ScalarField",name:"ttl",storageKey:null},$i={alias:null,args:null,kind:"ScalarField",name:"unread",storageKey:null},aj={alias:null,args:null,kind:"ScalarField",name:"is_sponsored",storageKey:null},bj={alias:null,args:null,kind:"ScalarField",name:"ad_client_token",storageKey:null},cj={alias:null,args:null,concreteType:"MessageCustomization",kind:"LinkedField",name:"customizations",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"customization_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"customization_value",storageKey:null}],storageKey:null},dj={alias:null,args:null,kind:"ScalarField",name:"tags_list",storageKey:null},ej={alias:null,args:null,concreteType:"MessageSourceData",kind:"LinkedField",name:"message_source_data",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"message_source",storageKey:null}],storageKey:null},fj={alias:null,args:null,concreteType:"MontageReplyData",kind:"LinkedField",name:"montage_reply_data",plural:!1,selections:[V,{alias:null,args:null,kind:"ScalarField",name:"reply_action",storageKey:null},c],storageKey:null},gj={alias:null,args:null,kind:"ScalarField",name:"reaction",storageKey:null},hj={alias:null,args:null,concreteType:"MessageReaction",kind:"LinkedField",name:"message_reactions",plural:!0,selections:[gj,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"user",plural:!1,selections:d,storageKey:null}],storageKey:null},ij={alias:null,args:null,kind:"ScalarField",name:"unsent_timestamp_precise",storageKey:null},jj={alias:null,args:null,concreteType:"MessagingParticipant",kind:"LinkedField",name:"unsender",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"messaging_actor",plural:!1,selections:[a,b,ig],storageKey:null}],storageKey:null},kj={alias:null,args:null,kind:"ScalarField",name:"verse_group_role_xmd",storageKey:null},lj={alias:null,args:null,kind:"ScalarField",name:"secondary_language_body",storageKey:null},mj={kind:"InlineFragment",selections:d,type:"Profile",abstractKey:"__isProfile"},nj={kind:"InlineFragment",selections:d,type:"MessengerViewerGroupThread",abstractKey:null};Ka={kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"MessageThreadKey",kind:"LinkedField",name:"thread_key",plural:!1,selections:[Ka],storageKey:null}],type:"MessageThread",abstractKey:null};var oj={alias:null,args:null,kind:"ScalarField",name:"message_profile_range_type",storageKey:null},pj={alias:null,args:null,concreteType:"MetaAtRange",kind:"LinkedField",name:"meta_ranges",plural:!0,selections:[z,Vf,g,Yf],storageKey:null};ni={alias:null,args:null,concreteType:"MessagePageAdminSender",kind:"LinkedField",name:"page_admin_sender",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"admin_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"sender_type",storageKey:null},b,ni,x,{alias:null,args:null,kind:"ScalarField",name:"profile_uri",storageKey:null}],storageKey:null};Q={kind:"InlineFragment",selections:[lj,{alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"message",plural:!1,selections:[e,{alias:null,args:null,concreteType:"EntityAtRange",kind:"LinkedField",name:"ranges",plural:!0,selections:[z,Vf,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"entity",plural:!1,selections:[B,mj,nj,Ka],storageKey:null},oj],storageKey:null}],storageKey:null},pj,Q,H,t,ni],type:"UserMessage",abstractKey:null};t={alias:null,args:null,kind:"ScalarField",name:"answered",storageKey:null};var qj={kind:"InlineFragment",selections:[t,c],type:"VoiceCallMessage",abstractKey:null};w=[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"node",plural:!1,selections:w,storageKey:null}];var rj={kind:"InlineFragment",selections:[t,c,{alias:null,args:null,concreteType:"VideoCallMessageToCaptureAttachmentsConnection",kind:"LinkedField",name:"call_capture_attachments",plural:!1,selections:[pg,{alias:null,args:null,concreteType:"VideoCallMessageToCaptureAttachmentsEdge",kind:"LinkedField",name:"edges",plural:!0,selections:w,storageKey:null}],storageKey:null}],type:"VideoCallMessage",abstractKey:null},sj={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"thread_name",storageKey:null},c],type:"ThreadNameMessage",abstractKey:null};Ef={alias:"preview",args:Ef,concreteType:"Image",kind:"LinkedField",name:"image",plural:!1,selections:m,storageKey:"image(height:280,width:280)"};var tj={kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"MessageImage",kind:"LinkedField",name:"image_with_metadata",plural:!1,selections:[Ef,Pa,xc],storageKey:null},c],type:"ThreadImageMessage",abstractKey:null},uj={kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"MessagingParticipant",kind:"LinkedField",name:"participants_added",plural:!0,selections:d,storageKey:null},c],type:"ParticipantsAddedMessage",abstractKey:null},vj={kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"MessagingParticipant",kind:"LinkedField",name:"participants_removed",plural:!0,selections:d,storageKey:null},c],type:"ParticipantLeftMessage",abstractKey:null},wj={alias:null,args:null,kind:"ScalarField",name:"viewer_has_voted",storageKey:null};wj={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"event_type",storageKey:null},{alias:"total_count",args:null,kind:"ScalarField",name:"option_count",storageKey:null},{alias:null,args:null,concreteType:"Question",kind:"LinkedField",name:"question",plural:!1,selections:[a,e,wj,{alias:null,args:[{kind:"Literal",name:"orderby",value:"creation_time"}],concreteType:"QuestionOptionsConnection",kind:"LinkedField",name:"options",plural:!1,selections:[{alias:null,args:null,concreteType:"QuestionOption",kind:"LinkedField",name:"nodes",plural:!0,selections:[a,e,wj,{alias:null,args:null,concreteType:"QuestionOptionVotersConnection",kind:"LinkedField",name:"voters",plural:!1,selections:xh,storageKey:null}],storageKey:null}],storageKey:'options(orderby:"creation_time")'}],storageKey:null}],type:"GroupPollExtensibleMessageAdminText",abstractKey:null};xh={alias:null,args:null,kind:"ScalarField",name:"display_name",storageKey:null};kf={alias:null,args:null,concreteType:"MessengerEventReminder",kind:"LinkedField",name:"event_reminder",plural:!1,selections:[a,ef,df,{alias:null,args:null,kind:"ScalarField",name:"end_time",storageKey:null},Ch,Bh,Ih,Hh,Ah,{alias:null,args:null,concreteType:"Page",kind:"LinkedField",name:"location_page",plural:!1,selections:d,storageKey:null},Dc,{alias:null,args:null,concreteType:"TimezoneInfo",kind:"LinkedField",name:"timezone_id",plural:!1,selections:[xh,kf,{alias:null,args:null,kind:"ScalarField",name:"timezone_id",storageKey:null}],storageKey:null},Kh],storageKey:null};var X=[kf],xj={kind:"InlineFragment",selections:X,type:"LightweightEventCreateExtensibleMessageAdminText",abstractKey:null},yj={kind:"InlineFragment",selections:X,type:"LightweightEventDeleteExtensibleMessageAdminText",abstractKey:null},zj={kind:"InlineFragment",selections:X,type:"LightweightEventNotifyBeforeEventExtensibleMessageAdminText",abstractKey:null},Aj={kind:"InlineFragment",selections:X,type:"LightweightEventNotifyExtensibleMessageAdminText",abstractKey:null},Bj={kind:"InlineFragment",selections:X,type:"LightweightEventUpdateExtensibleMessageAdminText",abstractKey:null},Cj={kind:"InlineFragment",selections:X,type:"LightweightEventUpdateLocationExtensibleMessageAdminText",abstractKey:null},Dj={kind:"InlineFragment",selections:X,type:"LightweightEventUpdateTimeExtensibleMessageAdminText",abstractKey:null};X={kind:"InlineFragment",selections:X,type:"LightweightEventUpdateTitleExtensibleMessageAdminText",abstractKey:null};var Ej={alias:null,args:null,kind:"ScalarField",name:"guest_id",storageKey:null};kf={kind:"InlineFragment",selections:[Ej,{alias:null,args:null,kind:"ScalarField",name:"guest_status",storageKey:null},kf],type:"LightweightEventRSVPExtensibleMessageAdminText",abstractKey:null};var Fj={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"theme_color",storageKey:null}],type:"ThemeColorExtensibleMessageAdminText",abstractKey:null},Gj={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"thread_icon",storageKey:null}],type:"ThreadIconExtensibleMessageAdminText",abstractKey:null};gh={kind:"InlineFragment",selections:[gh,{alias:"participant_id",args:null,kind:"ScalarField",name:"target_id",storageKey:null}],type:"ThreadNicknameExtensibleMessageAdminText",abstractKey:null};var Hj={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"accepter_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"requester_id",storageKey:null}],type:"AcceptPendingThreadExtensibleMessageAdminText",abstractKey:null},Ij={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"contact_added_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"contact_adder_id",storageKey:null}],type:"AddContactExtensibleMessageAdminText",abstractKey:null},Jj={alias:null,args:null,kind:"ScalarField",name:"event",storageKey:null},Kj={kind:"InlineFragment",selections:[Jj,{alias:null,args:null,kind:"ScalarField",name:"is_video_call",storageKey:null},ai],type:"RtcCallLogExtensibleMessageAdminText",abstractKey:null},Lj={alias:null,args:null,kind:"ScalarField",name:"update_type",storageKey:null},Mj={alias:null,args:null,kind:"ScalarField",name:"collapsed_text",storageKey:null},Nj={alias:null,args:null,kind:"ScalarField",name:"expanded_text",storageKey:null},Oj={alias:null,args:null,kind:"ScalarField",name:"cta_url",storageKey:null},Pj={alias:null,args:null,kind:"ScalarField",name:"template",storageKey:null},Qj={alias:null,args:null,kind:"ScalarField",name:"leaderboard_json",storageKey:null},Rj={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"game_type",storageKey:null}],type:"GameScoreExtensibleMessageAdminText",abstractKey:null},Sj={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"parties_user_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"parties_invite_type",storageKey:null}],type:"PartiesInviteExtensibleMessageAdminText",abstractKey:null},Tj={alias:null,args:null,kind:"ScalarField",name:"icebreaker_type",storageKey:null},Uj={alias:null,args:null,kind:"ScalarField",name:"icebreaker_title",storageKey:null},Vj={alias:null,args:null,kind:"ScalarField",name:"icebreaker_subtitle",storageKey:null},Wj={alias:null,args:null,kind:"ScalarField",name:"vote_buttons_with_icons",storageKey:null},Xj={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"friend_request_recipient",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"friend_request_sender",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"friend_request_subtype",storageKey:null},Tj,Uj,Vj,Wj],type:"ConfirmFriendRequestExtensibleMessageAdminText",abstractKey:null},Yj={alias:null,args:null,kind:"ScalarField",name:"sender_id",storageKey:null},Zj={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"bump_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"recipient_id",storageKey:null},Yj,h,M,{alias:null,args:null,kind:"ScalarField",name:"icon_uri",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"image_uri",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"facepile_ids",storageKey:null},Og,{alias:null,args:null,kind:"ScalarField",name:"cta_uri",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"admin_message_string",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"banner_uri",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_two_way",storageKey:null}],type:"MessengerGrowthGenericExtensibleMessageAdminText",abstractKey:null},$j={kind:"InlineFragment",selections:[Bd,{alias:null,args:null,kind:"ScalarField",name:"ios_uri",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"activity_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_redesign",storageKey:null}],type:"BizInboxDetectedOutcomesActivityAdminTextExtensibleMessageAdminText",abstractKey:null},ak={alias:null,args:null,kind:"ScalarField",name:"cta_text",storageKey:null},bk={kind:"InlineFragment",selections:[Bd,ak,Oj,{alias:null,args:null,kind:"ScalarField",name:"async_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"www_is_async_url",storageKey:null}],type:"LinkCTAExtensibleMessageAdminText",abstractKey:null},ck={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"referer_uri",storageKey:null}],type:"MessengerLiveChatPluginURLUpdateAdminText",abstractKey:null},dk={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"fb_user_name",storageKey:null}],type:"MessengerLiveChatPluginFBUserStartChatAdminText",abstractKey:null};Ac={kind:"InlineFragment",selections:[Ac],type:"MessengerLiveChatPluginGuestUserStartChatAdminText",abstractKey:null};ak={kind:"InlineFragment",selections:[ak,Oj,V,{alias:null,args:null,kind:"ScalarField",name:"recipient_is_the_sender",storageKey:null}],type:"WorkChatReminderLinkCTAExtensibleMessageAdminText",abstractKey:null};var ek={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"post_uri",storageKey:null}],type:"PostSharedFromGroupExtensibleMessageAdminText",abstractKey:null},fk={alias:null,args:null,kind:"ScalarField",name:"ad_url",storageKey:null},gk={kind:"InlineFragment",selections:[fk],type:"MessengerAdContextAdminText",abstractKey:null},hk={kind:"InlineFragment",selections:[bj,Af,{alias:null,args:null,kind:"ScalarField",name:"ad_preferences_link",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ad_properties",storageKey:null}],type:"AdExtensibleMessageAdminText",abstractKey:null},ik={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"page_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"start_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"product_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_name",storageKey:null}],type:"AppointmentReminderExtensibleMessageAdminText",abstractKey:null},jk=[x],kk={kind:"InlineFragment",selections:jk,type:"GraphQLServicesAppointmentsOptOutExtensibleMessageAdminText",abstractKey:null},lk={kind:"InlineFragment",selections:jk,type:"ServicesLeadGenSurveyExtensibleMessageAdminText",abstractKey:null};jk={kind:"InlineFragment",selections:jk,type:"ServicesLeadGenSurveyEditExtensibleMessageAdminText",abstractKey:null};var mk={alias:null,args:null,kind:"ScalarField",name:"caller_id",storageKey:null},nk={alias:null,args:null,kind:"ScalarField",name:"callee_id",storageKey:null},ok={alias:null,args:null,kind:"ScalarField",name:"conference_name",storageKey:null},pk={alias:null,args:null,kind:"ScalarField",name:"server_info",storageKey:null},qk={alias:null,args:null,kind:"ScalarField",name:"video",storageKey:null},rk={alias:null,args:null,kind:"ScalarField",name:"call_duration",storageKey:null},sk={alias:null,args:null,kind:"ScalarField",name:"rating",storageKey:null};Tj={kind:"InlineFragment",selections:[Tj,Uj,Vj,{alias:null,args:null,kind:"ScalarField",name:"votes_cast",storageKey:null},Wj],type:"MessengerIcebreakerVoteCastExtensibleMessageAdminText",abstractKey:null};Uj={alias:null,args:null,kind:"ScalarField",name:"user_id",storageKey:null};Vj={alias:null,args:null,kind:"ScalarField",name:"currency_code",storageKey:null};Wj=[x,Uj,{alias:null,args:null,kind:"ScalarField",name:"receipt_photo_id",storageKey:null},Vj,{alias:null,args:null,kind:"ScalarField",name:"detection_type",storageKey:null}];var tk={kind:"InlineFragment",selections:Wj,type:"PagesMarkAsPaidExtensibleMessageAdminText",abstractKey:null};Wj={kind:"InlineFragment",selections:Wj,type:"PagesMarkAsPaidNewExtensibleMessageAdminText",abstractKey:null};var uk={alias:null,args:null,kind:"ScalarField",name:"interaction_id",storageKey:null},vk={kind:"InlineFragment",selections:[x,Uj,{alias:null,args:null,kind:"ScalarField",name:"interaction_type",storageKey:null},uk,{alias:null,args:null,kind:"ScalarField",name:"should_show_cta",storageKey:null}],type:"PageThreadActionSystemAddDetailsXMAT",abstractKey:null},wk={kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"Page",kind:"LinkedField",name:"bot_page",plural:!1,selections:d,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"show_landing_page",storageKey:null}],type:"WorkBotInstalledExtensibleMessageAdminText",abstractKey:null};fk={kind:"InlineFragment",selections:[fk,{alias:null,args:null,kind:"ScalarField",name:"should_show_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"results_url",storageKey:null}],type:"AdReplyMessageAdminText",abstractKey:null};var xk={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"new_magic_word_count",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"magic_word",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"emoji_effect",storageKey:null}],type:"MagicWordsExtensibleMessageAdminText",abstractKey:null},yk={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"token_ent_id_string",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_action_type",storageKey:null}],type:"NotificationMessagesAdminText",abstractKey:null},zk={alias:null,args:null,kind:"ScalarField",name:"admin_assigner_name",storageKey:null},Ak={kind:"InlineFragment",selections:[zk,{alias:null,args:null,kind:"ScalarField",name:"assigned_admin_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"assign_conversation",storageKey:null}],type:"BizInboxAssignAdminAdminText",abstractKey:null};zk={kind:"InlineFragment",selections:[zk,{alias:null,args:null,kind:"ScalarField",name:"note_input",storageKey:null}],type:"BizInboxAdminAssignmentNoteAdminText",abstractKey:null};var Bk={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"email_thread_id",storageKey:null}],type:"BizInboxOmnichannelEmailSentAdminText",abstractKey:null},Ck={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"user_subscription_management_action_type",storageKey:null}],type:"InstantGameBotMessageSubscriptionManagementAdminText",abstractKey:null},Dk={kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"user_mute_management_action_type",storageKey:null}],type:"InstantGameCustomUpdateMuteManagementAdminText",abstractKey:null};vg={kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"extensible_message_admin_text",plural:!1,selections:[B,wj,xj,yj,zj,Aj,Bj,Cj,Dj,X,kf,Fj,Gj,gh,Hj,Ij,Kj,{kind:"InlineFragment",selections:[xb,Lj,Mj,Nj,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"instant_game_update_data",plural:!1,selections:[{kind:"InlineFragment",selections:[Oj,Og,vg,Pj],type:"InstantGameXMATCustomMessageClientData",abstractKey:null}],storageKey:null},Qj],type:"InstantGameUpdateExtensibleMessageAdminText",abstractKey:null},Rj,Sj,Xj,Zj,$j,bk,ck,dk,Ac,ak,ek,gk,hk,ik,kk,lk,jk,{kind:"InlineFragment",selections:[mk,nk,ok,Jj,pk,qk,rk,sk,{alias:null,args:null,concreteType:"MessengerCallLogExtensibleMessageAdminTextCallCaptureAttachmentsConnection",kind:"LinkedField",name:"call_capture_attachments",plural:!1,selections:[pg,{alias:null,args:null,concreteType:"MessengerCallLogExtensibleMessageAdminTextCallCaptureAttachmentsEdge",kind:"LinkedField",name:"edges",plural:!0,selections:w,storageKey:null}],storageKey:null}],type:"MessengerCallLogExtensibleMessageAdminText",abstractKey:null},Tj,tk,Wj,vk,wk,fk,xk,yk,Ak,zk,Bk,Ck,Dk],storageKey:null},fb,c],type:"GenericAdminTextMessage",abstractKey:null};w=[{alias:null,args:null,kind:"ScalarField",name:"transfer_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"message_type",storageKey:null},{alias:null,args:null,concreteType:"CurrencyQuantity",kind:"LinkedField",name:"amount",plural:!1,selections:$b,storageKey:null},{alias:null,args:null,concreteType:"MessagingParticipant",kind:"LinkedField",name:"p2p_sender",plural:!1,selections:d,storageKey:null},{alias:null,args:null,concreteType:"MessagingParticipant",kind:"LinkedField",name:"p2p_receiver",plural:!1,selections:d,storageKey:null},c];$b={kind:"InlineFragment",selections:w,type:"P2PPaymentRequestMessage",abstractKey:null};w={kind:"InlineFragment",selections:w,type:"P2PPaymentMessage",abstractKey:null};hj=[Vi,B,V,Wi,Yi,Zi,Na,$i,aj,Af,bj,Oa,cj,dj,P,ej,fj,hj,ij,jj,kj,k,Q,qj,rj,sj,tj,uj,vj,vg,$b,w,{alias:null,args:null,concreteType:"RepliedToMessage",kind:"LinkedField",name:"replied_to_message",plural:!1,selections:[kd,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"message",plural:!1,selections:[Vi,B,V,Wi,Yi,Zi,Na,$i,aj,Af,bj,Oa,cj,dj,P,ej,fj,hj,ij,jj,kj,k,Q,qj,rj,sj,tj,uj,vj,vg,$b,w],storageKey:null}],storageKey:null}];jj={alias:null,args:null,concreteType:"PinnedMessageData",kind:"LinkedField",name:"pinned_messages",plural:!0,selections:[V,Ui,{condition:"threadlistViewFieldsOnly",kind:"Condition",passingValue:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"message",plural:!1,selections:hj,storageKey:null}]}],storageKey:null};Q={alias:null,args:null,kind:"ScalarField",name:"is_default_child_group",storageKey:null};rj={alias:null,args:null,kind:"ScalarField",name:"emoji_codepoints",storageKey:null};tj={alias:null,args:null,concreteType:"GroupsSyncMetadata",kind:"LinkedField",name:"work_groups_sync_metadata",plural:!1,selections:[{alias:null,args:null,concreteType:"Group",kind:"LinkedField",name:"fb_group",plural:!1,selections:[n,a,b,Ag,Q,D,wi,{alias:null,args:null,concreteType:"MultiBackgroundIcon",kind:"LinkedField",name:"group_icon",plural:!1,selections:[rj],storageKey:null}],storageKey:null}],storageKey:null};vg={condition:"threadlistViewFieldsOnly",kind:"Condition",passingValue:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"saved_messages",plural:!0,selections:hj,storageKey:null}]};var Ek={alias:null,args:null,kind:"ScalarField",name:"joinable_link",storageKey:null},Fk={alias:null,args:null,kind:"ScalarField",name:"is_fuss_red_page",storageKey:null},Gk={alias:null,args:null,concreteType:"Group",kind:"LinkedField",name:"program_group",plural:!1,selections:[a,{alias:null,args:[{kind:"Literal",name:"height",value:24},{kind:"Literal",name:"width",value:24}],concreteType:"Image",kind:"LinkedField",name:"profile_picture",plural:!1,selections:m,storageKey:"profile_picture(height:24,width:24)"}],storageKey:null};Dd={alias:null,args:null,concreteType:"Group",kind:"LinkedField",name:"mentorship_group",plural:!1,selections:Dd,storageKey:null};var Hk={alias:null,args:null,kind:"ScalarField",name:"banner_title",storageKey:null},Ik={alias:null,args:null,kind:"ScalarField",name:"banner_subtitle",storageKey:null},Jk={alias:null,args:ed,concreteType:"MessengerMentorshipProgramOfThreadConnection",kind:"LinkedField",name:"linked_mentorship_programs",plural:!1,selections:[{alias:null,args:null,concreteType:"MentorshipProgram",kind:"LinkedField",name:"nodes",plural:!0,selections:[a,Gk,Dd,{alias:null,args:ed,concreteType:"MentorshipProgramToMentorshipMessengerCurriculumStepOrderByStepCountConnection",kind:"LinkedField",name:"messenger_curriculum_steps",plural:!1,selections:[{alias:null,args:null,concreteType:"MentorshipMessengerCurriculumStep",kind:"LinkedField",name:"nodes",plural:!0,selections:[Hk,Ik],storageKey:null}],storageKey:"messenger_curriculum_steps(first:1)"}],storageKey:null}],storageKey:"linked_mentorship_programs(first:1)"},Kk={alias:null,args:null,kind:"ScalarField",name:"thread_unsendability_status",storageKey:null},Lk={alias:null,args:null,kind:"ScalarField",name:"thread_pin_timestamp",storageKey:null},Mk={alias:null,args:null,kind:"ScalarField",name:"is_business_page_active",storageKey:null};li={alias:null,args:null,concreteType:"ConversionDetectionData",kind:"LinkedField",name:"conversion_detection_data",plural:!1,selections:[li,{alias:null,args:null,kind:"ScalarField",name:"conversion_type",storageKey:null},Vj,{alias:null,args:null,kind:"ScalarField",name:"currency_amount",storageKey:null},{alias:"timestamp",args:null,kind:"ScalarField",name:"timestamp_graphql_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"page_reply",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"icebreaker_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"icebreaker_message",storageKey:null},Li,{alias:null,args:null,kind:"ScalarField",name:"shipping_provider",storageKey:null},gf,{alias:null,args:null,kind:"ScalarField",name:"ctx_ad_info",storageKey:null}],storageKey:null};Vj={alias:null,args:null,concreteType:"SuggestedReplyData",kind:"LinkedField",name:"suggested_reply_data",plural:!1,selections:Mi,storageKey:null};Li={alias:null,args:null,kind:"ScalarField",name:"admin_type",storageKey:null};Mi={alias:null,args:null,kind:"ScalarField",name:"gender",storageKey:null};var Y={alias:"big_image_src",args:[{kind:"Literal",name:"height",value:60},{kind:"Literal",name:"width",value:60}],concreteType:"Image",kind:"LinkedField",name:"profile_picture",plural:!1,selections:m,storageKey:"profile_picture(height:60,width:60)"},Nk={alias:null,args:null,kind:"ScalarField",name:"username",storageKey:null},Ok={alias:null,args:null,kind:"ScalarField",name:"is_viewer_friend",storageKey:null},Pk={alias:null,args:null,kind:"ScalarField",name:"is_messenger_user",storageKey:null},Qk={alias:null,args:null,kind:"ScalarField",name:"is_message_blocked_by_viewer",storageKey:null},Rk={alias:null,args:null,kind:"ScalarField",name:"is_viewer_coworker",storageKey:null},Sk={alias:null,args:null,kind:"ScalarField",name:"is_employee",storageKey:null},Tk={alias:null,args:null,kind:"ScalarField",name:"is_aloha_proxy_confirmed",storageKey:null},Uk={alias:null,args:null,kind:"ScalarField",name:"message_capabilities2_str",storageKey:null},Vk={alias:null,args:null,kind:"ScalarField",name:"messenger_account_status_category",storageKey:null};Jd={alias:null,args:null,concreteType:"WorkUserInfo",kind:"LinkedField",name:"work_info",plural:!1,selections:[{alias:null,args:null,concreteType:"Group",kind:"LinkedField",name:"work_community",plural:!1,selections:Jd,storageKey:null},xg],storageKey:null};var Wk={kind:"InlineFragment",selections:[Mi,n,Y,Rb,Ok,Pk,Qk,{alias:null,args:null,kind:"ScalarField",name:"is_viewer_managing_parent",storageKey:null}],type:"NeoApprovedUser",abstractKey:null},Xk={kind:"InlineFragment",selections:[n,Y,Nk,{alias:null,args:null,kind:"ScalarField",name:"accepts_messenger_user_feedback",storageKey:null},Pk,{alias:null,args:null,kind:"ScalarField",name:"is_messenger_platform_bot",storageKey:null},Qk,{alias:null,args:null,kind:"ScalarField",name:"is_viewer_subscribed_to_message_updates",storageKey:null},{alias:null,args:null,concreteType:"InstantGameChannelInfo",kind:"LinkedField",name:"instant_game_channel",plural:!1,selections:[{alias:null,args:null,concreteType:"Application",kind:"LinkedField",name:"application",plural:!1,selections:d,storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"verification_status",storageKey:null}],type:"Page",abstractKey:null},Yk=[n,Y,Qk],Zk={kind:"InlineFragment",selections:Yk,type:"SmsMessagingParticipant",abstractKey:null},$k={kind:"InlineFragment",selections:[Y,Qk],type:"InstagramMessagingUser",abstractKey:null},al=[Y],bl={kind:"InlineFragment",selections:al,type:"LiveChatOnlyPerson",abstractKey:null};Yk={kind:"InlineFragment",selections:Yk,type:"UnavailableMessagingActor",abstractKey:null};var cl={kind:"InlineFragment",selections:al,type:"UnifiedMessagingInstagramUser",abstractKey:null},dl={alias:null,args:null,kind:"ScalarField",name:"is_blocked_by_viewer",storageKey:null},el=[n,Y,Nk],fl={kind:"InlineFragment",selections:el,type:"Group",abstractKey:null};el={kind:"InlineFragment",selections:el,type:"Event",abstractKey:null};j={kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"WorkForeignEntityInfo",kind:"LinkedField",name:"work_foreign_entity_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"detail",storageKey:null},j,g],storageKey:null}],type:"WorkForeignEntity",abstractKey:"__isWorkForeignEntity"};var gl=[n,Y,Rb,Qk],hl={kind:"InlineFragment",selections:gl,type:"XFBWorkroomsBaseUser",abstractKey:"__isXFBWorkroomsBaseUser"};gl={kind:"InlineFragment",selections:gl,type:"XFBWorkroomsSystemUser",abstractKey:null};var il={kind:"InlineFragment",selections:al,type:"MessengerCallGuestUser",abstractKey:null},jl={kind:"InlineFragment",selections:al,type:"WorkVCEndpointUser",abstractKey:null},kl={kind:"InlineFragment",selections:al,type:"WECMailboxAccount",abstractKey:null};al={kind:"InlineFragment",selections:al,type:"WECCustomer",abstractKey:null};var ll={alias:null,args:null,kind:"ScalarField",name:"wec_group_creation_time",storageKey:null},ml={alias:null,args:null,kind:"ScalarField",name:"wec_group_invite_link",storageKey:null};Ed={alias:null,args:null,concreteType:"MessagingParticipant",kind:"LinkedField",name:"nodes",plural:!0,selections:Ed,storageKey:null};Jd={alias:null,args:null,concreteType:"AllMessagingParticipantsOfThreadConnection",kind:"LinkedField",name:"all_participants",plural:!1,selections:[{alias:null,args:null,concreteType:"AllMessagingParticipantsOfThreadEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[Li,{alias:null,args:null,concreteType:"MessagingParticipant",kind:"LinkedField",name:"node",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"messaging_actor",plural:!1,selections:[a,B,b,{kind:"InlineFragment",selections:[Mi,n,Y,Rb,Nk,Ok,Pk,Qk,Rk,Sk,Tk,Uk,Vk,Jd],type:"User",abstractKey:null},Wk,Xk,Zk,$k,bl,Yk,cl,{kind:"InlineFragment",selections:[n,Y,Nk,dl,Qk,Jd],type:"ReducedMessagingActor",abstractKey:null},fl,el,j,hl,gl,il,jl,kl,al,{kind:"InlineFragment",selections:[Y,ll,ml,{alias:null,args:null,concreteType:"WECGroupParticipantsConnection",kind:"LinkedField",name:"wec_group_participants",plural:!1,selections:[Ed,pg],storageKey:null},{alias:null,args:null,concreteType:"WECGroupAdminsConnection",kind:"LinkedField",name:"wec_group_admins",plural:!1,selections:[Ed],storageKey:null}],type:"WECGroupRecipient",abstractKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null};Ed={alias:"watermark",args:null,kind:"ScalarField",name:"timestamp_precise",storageKey:null};var nl={alias:"action",args:null,kind:"ScalarField",name:"action_timestamp_precise",storageKey:null},ol={alias:null,args:null,concreteType:"MessagingReadReceiptsOfThreadConnection",kind:"LinkedField",name:"read_receipts",plural:!1,selections:[{alias:null,args:null,concreteType:"MessagingReadReceipt",kind:"LinkedField",name:"nodes",plural:!0,selections:[Ed,nl,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"actor",plural:!1,selections:d,storageKey:null}],storageKey:null}],storageKey:null};Nh=[{alias:null,args:null,concreteType:"MessagingDeliveryReceiptsOfThreadConnection",kind:"LinkedField",name:"delivery_receipts",plural:!1,selections:[{alias:null,args:null,concreteType:"MessagingDeliveryReceipt",kind:"LinkedField",name:"nodes",plural:!0,selections:Nh,storageKey:null}],storageKey:null}];var pl={condition:"includeDeliveryReceipts",kind:"Condition",passingValue:!0,selections:Nh},ql=[Ja,{alias:null,args:null,concreteType:"MessageThread",kind:"LinkedField",name:"nodes",plural:!0,selections:[a,La,b,Cf,Df,q,S,rc,qc,tc,uc,J,Rf,Xc,Sg,Tg,Ug,Vg,Wg,Xg,Yg,Zg,$g,ah,bh,ch,dh,jh,sh,th,uh,vh,wh,zh,Lh,Mh,Oh,Zh,bi,pi,Dg,si,zi,Ai,Bi,Ci,Di,Ei,Fi,fh,Yb,Si,Ti,jg,jj,tj,vg,M,Ek,Fk,Jk,Kk,Lk,Mk,li,Vj,Jd,ol,pl],storageKey:null}],rl={alias:null,args:null,kind:"ScalarField",name:"instagram_user_id",storageKey:null},sl=[rl,D],tl={alias:null,args:null,kind:"ScalarField",name:"unseen_count",storageKey:null},ul={alias:null,args:null,kind:"ScalarField",name:"token",storageKey:null},vl={alias:null,args:null,kind:"ScalarField",name:"thread_id",storageKey:null},wl={alias:null,args:null,kind:"ScalarField",name:"thread_v2_id",storageKey:null},xl={alias:null,args:null,kind:"ScalarField",name:"instagram_message_thread_type",storageKey:null},yl={alias:null,args:null,kind:"ScalarField",name:"thread_title",storageKey:null},zl={alias:null,args:null,kind:"ScalarField",name:"is_group",storageKey:null},Al={alias:null,args:null,kind:"ScalarField",name:"last_activity_at",storageKey:null},Bl={alias:null,args:null,concreteType:"IGThreadLastSeenUser",kind:"LinkedField",name:"last_seen_at",plural:!0,selections:[He,Mg,Uj],storageKey:null},Cl={alias:null,args:null,kind:"ScalarField",name:"media_type",storageKey:null},Dl={alias:null,args:null,concreteType:"IGThreadDirectStoryData",kind:"LinkedField",name:"direct_story",plural:!1,selections:[tl,Cl],storageKey:null},El={alias:null,args:null,concreteType:"InstagramMessageThreadThreadLabelsConnection",kind:"LinkedField",name:"thread_labels",plural:!1,selections:[{alias:null,args:null,concreteType:"BusinessPresenceCustomLabel",kind:"LinkedField",name:"nodes",plural:!0,selections:[a,b,Qh,W,Rh],storageKey:null}],storageKey:null},Fl={alias:null,args:null,concreteType:"InstagramMessageThreadThreadCorpLabelsConnection",kind:"LinkedField",name:"thread_corp_labels",plural:!1,selections:[{alias:null,args:null,concreteType:"BusinessPresenceCorporationLabel",kind:"LinkedField",name:"nodes",plural:!0,selections:[a,b,Qh,W],storageKey:null}],storageKey:null};Pi={alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"assigned_admin",plural:!1,selections:Pi,storageKey:null};var Gl={alias:null,args:null,kind:"ScalarField",name:"is_follow_up",storageKey:null},Hl={alias:null,args:null,kind:"ScalarField",name:"is_read",storageKey:null},Il={alias:null,args:null,kind:"ScalarField",name:"business_thread_folder",storageKey:null},Jl={alias:null,args:null,concreteType:"IGThreadUserNodesData",kind:"LinkedField",name:"thread_users",plural:!1,selections:[{alias:null,args:null,concreteType:"IGThreadUserData",kind:"LinkedField",name:"nodes",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"eimu_id",storageKey:null},rl,Nk,b,{alias:null,args:null,concreteType:"IGThreadUserProfilePic",kind:"LinkedField",name:"profile_picture",plural:!1,selections:m,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"blocking",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_verified",storageKey:null}],storageKey:null}],storageKey:null},Kl={alias:null,args:null,kind:"ScalarField",name:"input_mode",storageKey:null},Ll={alias:null,args:null,kind:"ScalarField",name:"is_partnership",storageKey:null},Ml={alias:null,args:null,kind:"ScalarField",name:"time_stamp",storageKey:null},Nl={alias:null,args:null,kind:"ScalarField",name:"ig_item_type",storageKey:null},Ol={alias:null,args:null,kind:"ScalarField",name:"client_context",storageKey:null},Pl={alias:null,args:null,concreteType:"IGThreadItemPlaceHolderSource",kind:"LinkedField",name:"ig_placeholder",plural:!1,selections:[h,zf],storageKey:null},Ql=[{kind:"Variable",name:"height",variableName:"height"},{kind:"Variable",name:"width",variableName:"width"}],Rl={alias:null,args:Ql,concreteType:"Image",kind:"LinkedField",name:"image_source",plural:!1,selections:m,storageKey:null},Sl={alias:null,args:Ql,concreteType:"IGThreadItemVideoSource",kind:"LinkedField",name:"video_source",plural:!1,selections:T,storageKey:null},Tl={alias:null,args:null,kind:"ScalarField",name:"expiring_at",storageKey:null},Ul=[rl,Nk,b,D],Vl={alias:null,args:null,concreteType:"InstagramUserV2",kind:"LinkedField",name:"media_owner",plural:!1,selections:Ul,storageKey:null},Wl={alias:null,args:null,concreteType:"IGMessageThreadItemRavenMedia",kind:"LinkedField",name:"raven_media",plural:!1,selections:[Cl,{alias:null,args:null,kind:"ScalarField",name:"seen_user_ids",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"view_mode",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"seen_count",storageKey:null},{alias:null,args:null,concreteType:"IGMessageThreadItemMedia",kind:"LinkedField",name:"media",plural:!0,selections:[Rl,Sl,Tl],storageKey:null}],storageKey:null};Ul={alias:null,args:null,concreteType:"InstagramUserV2",kind:"LinkedField",name:"user",plural:!1,selections:Ul,storageKey:null};var Xl={alias:null,args:Ql,concreteType:"Image",kind:"LinkedField",name:"image_source",plural:!1,selections:T,storageKey:null},Yl={kind:"InlineFragment",selections:f,type:"IGMessageThreadItemMediaShare",abstractKey:null},Zl={alias:null,args:null,kind:"ScalarField",name:"story_type",storageKey:null},$l={kind:"InlineFragment",selections:[Zl,e,g],type:"IGMessageThreadItemReelShare",abstractKey:null};Zl={kind:"InlineFragment",selections:[Zl,zf,h,e],type:"IGMessageThreadItemStoryShare",abstractKey:null};zf={kind:"InlineFragment",selections:[h,e],type:"IGMessageThreadItemFelixShare",abstractKey:null};var am={kind:"InlineFragment",selections:[h,tb,e,{alias:null,args:null,kind:"ScalarField",name:"current_price",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"full_price",storageKey:null},l],type:"IGMessageThreadItemProductShare",abstractKey:null},bm={alias:null,args:null,kind:"ScalarField",name:"likes_count",storageKey:null},cm={alias:null,args:null,kind:"ScalarField",name:"emojis",storageKey:null},dm={alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"media",plural:!0,selections:T,storageKey:null};ad={alias:null,args:null,concreteType:"IGThreadItemActionLogSource",kind:"LinkedField",name:"action_log",plural:!1,selections:[M,{alias:null,args:null,concreteType:"IGThreadItemActionLogBoldSource",kind:"LinkedField",name:"bold",plural:!0,selections:ad,storageKey:null},{alias:null,args:null,concreteType:"IGThreadItemActionLogTextAttributesSource",kind:"LinkedField",name:"text_attributes",plural:!0,selections:[Zc,$c,Ob,{alias:null,args:null,kind:"ScalarField",name:"intent",storageKey:null}],storageKey:null}],storageKey:null};Zc={alias:null,args:null,concreteType:"IGThreadItemLinkSource",kind:"LinkedField",name:"link_source",plural:!1,selections:[Ol,e,{alias:null,args:null,concreteType:"IGThreadItemLinkContextSource",kind:"LinkedField",name:"link_context",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"link_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"link_title",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"link_summary",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"link_image_url",storageKey:null}],storageKey:null}],storageKey:null};$c={alias:null,args:null,concreteType:"IGThreadItemVideoSource",kind:"LinkedField",name:"animated_media",plural:!1,selections:lf,storageKey:null};lf={alias:null,args:null,concreteType:"IGThreadItemVoiceMediaSource",kind:"LinkedField",name:"voice_media",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"audio_src",storageKey:null},Eb],storageKey:null};var Z=[Cl,Xl],em={alias:null,args:null,concreteType:"IGMessageThreadItemMedia",kind:"LinkedField",name:"media",plural:!1,selections:Z,storageKey:null},fm={alias:null,args:null,concreteType:"IGMessageThreadItemHScrollShareItem",kind:"LinkedField",name:"hscroll_share",plural:!0,selections:[h,tb,l,em],storageKey:null},gm={alias:null,args:null,kind:"ScalarField",name:"header_title",storageKey:null},hm={alias:null,args:null,kind:"ScalarField",name:"header_subtitle",storageKey:null},im={alias:null,args:null,kind:"ScalarField",name:"header_icon_url",storageKey:null},jm={alias:null,args:null,concreteType:"IGMessageThreadItemCollectionShare",kind:"LinkedField",name:"shops_collection_share",plural:!1,selections:[gm,hm,im,h,tb,nc,em],storageKey:null};tb={alias:null,args:null,concreteType:"IGMessageThreadItemAppointmentBooking",kind:"LinkedField",name:"appointment_booking",plural:!1,selections:[h,{alias:null,args:null,kind:"ScalarField",name:"max_title_num_of_lines",storageKey:null},tb,{alias:null,args:null,kind:"ScalarField",name:"max_subtitle_num_of_lines",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"header_title_text",storageKey:null},{alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"header_icon_url_info",plural:!1,selections:T,storageKey:null},em,{alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"preview_extra_urls_info",plural:!0,selections:T,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"preview_layout_type",storageKey:null},nc,{alias:null,args:null,concreteType:"IGXMAMessageCTAButton",kind:"LinkedField",name:"cta_buttons",plural:!0,selections:[Ra,h],storageKey:null}],storageKey:null};em={alias:null,args:null,concreteType:"IGMessageThreadItemShopShare",kind:"LinkedField",name:"shop_share",plural:!1,selections:[gm,hm,im,{alias:null,args:null,concreteType:"IGMessageThreadItemMedia",kind:"LinkedField",name:"medias",plural:!0,selections:Z,storageKey:null},nc],storageKey:null};T={alias:null,args:null,concreteType:"IGMessageThreadItemGenericXMA",kind:"LinkedField",name:"generic_xma",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"xma_template_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"xma_layout_type",storageKey:null},h,{alias:null,args:null,kind:"ScalarField",name:"sub_title",storageKey:null},{alias:null,args:null,concreteType:"GenericXMACTAButton",kind:"LinkedField",name:"cta_buttons",plural:!0,selections:[h,Ra],storageKey:null},{alias:null,args:null,concreteType:"IGMessageThreadItemMedia",kind:"LinkedField",name:"preview_url_info",plural:!1,selections:Z,storageKey:null}],storageKey:null};gm={alias:null,args:null,kind:"ScalarField",name:"send_attribution",storageKey:null};hm={alias:null,args:null,concreteType:"IGMessageThreadItemRepliedToMessage",kind:"LinkedField",name:"replied_to_message",plural:!1,selections:[e,V,Mg,Uj],storageKey:null};im={alias:null,args:null,kind:"ScalarField",name:"end_cursor",storageKey:null};Ra={alias:null,args:null,kind:"ScalarField",name:"has_next_page",storageKey:null};Z={alias:null,args:null,concreteType:"PageInfo",kind:"LinkedField",name:"page_info",plural:!1,selections:[im,Ra],storageKey:null};Vl=[{alias:null,args:null,concreteType:"InstagramMessageThreadItem",kind:"LinkedField",name:"nodes",plural:!0,selections:[ul,He,Yj,Ml,Nl,e,Ol,Pl,{alias:null,args:null,concreteType:"IGMessageThreadItemMedia",kind:"LinkedField",name:"ig_thread_item_media",plural:!1,selections:[Cl,Rl,Sl,Tl,Vl],storageKey:null},Wl,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"share",plural:!1,selections:[Ul,{alias:null,args:null,concreteType:"IGMessageThreadItemMedia",kind:"LinkedField",name:"media",plural:!0,selections:[Cl,Xl,Sl,Tl,Vl],storageKey:null},Yl,$l,Zl,zf,am],storageKey:null},{alias:null,args:null,concreteType:"IGThreadItemReactions",kind:"LinkedField",name:"ig_reaction",plural:!1,selections:[bm,{alias:null,args:null,concreteType:"InstagramUserV2",kind:"LinkedField",name:"likes",plural:!0,selections:sl,storageKey:null},cm],storageKey:null},{alias:null,args:Ql,concreteType:"IGThreadItemProfileShareSource",kind:"LinkedField",name:"profileshare",plural:!1,selections:[Ul,dm],storageKey:null},ad,Zc,$c,lf,fm,jm,tb,em,T,gm,hm],storageKey:null},Z];Ul={alias:null,args:null,kind:"ScalarField",name:"selected_thread_type",storageKey:null};var km=[{kind:"Variable",name:"after",variableName:"item_after"},{kind:"Variable",name:"first",variableName:"item_limit"}],lm=[{kind:"Variable",name:"before_time_precise",variableName:"before"},{kind:"Variable",name:"last",variableName:"message_limit"}],mm={alias:null,args:null,concreteType:"PageInfo",kind:"LinkedField",name:"page_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"has_previous_page",storageKey:null}],storageKey:null};Nh={condition:"load_delivery_receipts",kind:"Condition",passingValue:!0,selections:Nh};var nm={kind:"Variable",name:"page_id",variableName:"page_id"},om=[nm],pm={alias:null,args:null,kind:"ScalarField",name:"business_id",storageKey:null},qm={kind:"RootArgument",name:"page_id"},rm={kind:"Variable",name:"business_assets",variableName:"businessAssets"};nm={condition:"getShouldUnifyConfigQueries",kind:"Condition",passingValue:!0,selections:[{alias:null,args:null,concreteType:"XFBBizInboxSelectedThread",kind:"LinkedField",name:"selected_thread",plural:!1,selections:[{alias:null,args:[rm,nm],concreteType:"BizInboxFeatureConfigWrapper",kind:"LinkedField",name:"selected_thread_biz_inbox_feature_config",plural:!1,selections:[{alias:null,args:null,concreteType:"BizInboxGatingConfig",kind:"LinkedField",name:"gating_config",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"show_commerce_invoice_button_in_composer",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"show_product_picker_button_in_composer",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"show_send_availability_button_in_composer",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"show_create_appointment_button_in_composer",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"show_customer_feedback_button_on_move_to_done",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"show_form_builder_in_composer",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"show_send_inthread_forms_in_composer",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"show_marketing_messages_in_composer",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"marketing_messages_in_composer_state",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"show_gcash_id_share_and_copy_button",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"show_calling_in_composer",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"show_calling_live_in_composer",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"show_biz_ai_in_composer",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"BizInboxCommerceInvoiceButtonConfig",kind:"LinkedField",name:"commerce_invoice_button_config",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"show_confirm_payment",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"show_payment_onboarding",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"show_request_payment",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"commerce_invoice_button_icon",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}]};var sm=[tl];sm={alias:"xfb_unified_thread_list_pending",args:[{kind:"Variable",name:"msgr_params",variableName:"msgr_pending_params"},{kind:"Variable",name:"wa_params",variableName:"wa_pending_params"}],concreteType:"XFBBizInboxUnifiedThreadList",kind:"LinkedField",name:"xfb_biz_inbox_unified_thread_list",plural:!1,selections:[{condition:"isWorkUser",kind:"Condition",passingValue:!1,selections:[{alias:"wa_pending_threads",args:null,concreteType:"ViewerMessageThreadsConnection",kind:"LinkedField",name:"wa_threads",plural:!1,selections:sm,storageKey:null},{alias:"msg_pending_threads",args:null,concreteType:"ViewerMessageThreadsConnection",kind:"LinkedField",name:"msgr_threads",plural:!1,selections:sm,storageKey:null}]}],storageKey:null};var tm={alias:null,args:om,concreteType:"BizCRMContactCardConfig",kind:"LinkedField",name:"selected_biz_crm_contact_card_config",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"can_add_activities",storageKey:null}],storageKey:null};rm=[rm];var $=[B,a],um={kind:"InlineFragment",selections:d,type:"DynamicFeedAdAttachmentMedia",abstractKey:null},vm={kind:"InlineFragment",selections:d,type:"GenericAttachmentMedia",abstractKey:null},wm={kind:"InlineFragment",selections:d,type:"MontageImage",abstractKey:null},xm={kind:"InlineFragment",selections:d,type:"MontageVideo",abstractKey:null};Ua={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"media",plural:!1,selections:[B,Ua,Va,Ya,r,Za,s,O,um,vm,wm,xm],storageKey:null};Va={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"action_links",plural:!0,selections:[B,h,n],storageKey:null};Ya={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"action_objects",plural:!0,selections:[B,a,{kind:"InlineFragment",selections:[jb,kb,v,lb],type:"MessengerPlatformEntPreview",abstractKey:"__isMessengerPlatformEntPreview"}],storageKey:null};r={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"cta_data",plural:!1,selections:[B,vb,y],storageKey:null};jb={alias:null,args:null,concreteType:"MessengerCallToAction",kind:"LinkedField",name:"messenger_call_to_actions",plural:!0,selections:[hb,ib,Ya,mb,nb,a,ob,pb,qb,rb,sb,x,r,wb,Sa],storageKey:null};kb=[B,{kind:"TypeDiscriminator",abstractKey:"__isPaymentActivityAction"},u,Hb,Ib,h,Kb,{kind:"InlineFragment",selections:[{alias:"moneyTransfer",args:null,concreteType:null,kind:"LinkedField",name:"generic_money_transfer",plural:!1,selections:[B,C,Fb,E,Mb,a],storageKey:null}],type:"P2PPaymentActionButtonWithTransfer",abstractKey:null}];v={kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"P2PBubbleView",kind:"LinkedField",name:"bubble_view",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"actions",plural:!0,selections:kb,storageKey:null},{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"components",plural:!0,selections:[B,Nb,G,Pb,I],storageKey:null},{alias:null,args:null,concreteType:"P2PBubbleRobotext",kind:"LinkedField",name:"robotext",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"action",plural:!1,selections:kb,storageKey:null},Ob,Qb,e],storageKey:null},{alias:"rootAction",args:null,concreteType:null,kind:"LinkedField",name:"root_action",plural:!1,selections:kb,storageKey:null}],storageKey:null}],type:"PaymentViewData",abstractKey:"__isPaymentViewData"};vb={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"receiver_profile",plural:!1,selections:[B,a,b,D,Sb],storageKey:null};y=[J,a];wb={alias:null,args:null,concreteType:"PeerToPeerTransferContext",kind:"LinkedField",name:"transfer_context",plural:!1,selections:[{alias:null,args:null,concreteType:"MessageImage",kind:"LinkedField",name:"memo_images",plural:!0,selections:y,storageKey:null},Zb,a],storageKey:null};Sa={alias:null,args:null,concreteType:"PeerToPeerPlatformSoldItemDetail",kind:"LinkedField",name:"platform_item",plural:!1,selections:[b,M,{alias:null,args:null,concreteType:"Photo",kind:"LinkedField",name:"photos",plural:!0,selections:y,storageKey:null},n,a],storageKey:null};u=[B,b,a,D,Sb];Hb={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"requester",plural:!1,selections:u,storageKey:null};Kb={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"requestee",plural:!1,selections:u,storageKey:null};Mb={alias:null,args:null,concreteType:"PeerToPeerTransfer",kind:"LinkedField",name:"transfer",plural:!1,selections:[Fb,vb,Tb,Ub,C,Vb,Wb,Xb,wb,ac,bc,L,Sa,a,N,cc,dc,v],storageKey:null};Nb=[hb,ib,Ya,mb,nb,a,ob,pb,qb,rb,sb,x,r];G={alias:null,args:null,concreteType:"MessengerCallToAction",kind:"LinkedField",name:"call_to_actions",plural:!0,selections:Nb,storageKey:null};Pb={alias:null,args:null,concreteType:"MessengerCallToAction",kind:"LinkedField",name:"default_action",plural:!1,selections:Nb,storageKey:null};I=[{alias:null,args:null,concreteType:"MessengerRetailItem",kind:"LinkedField",name:"nodes",plural:!0,selections:[a,M,kc,lb,lc,b,mc,nc,Pb,G,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"media_blob_attachments",plural:!0,selections:[B,pc,oc,sc,vc,yc,O,um,vm,wm,xm],storageKey:null}],storageKey:null}];Qb=[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"messaging_actor",plural:!1,selections:[B,a,b],storageKey:null},a];kb={alias:"primary_photo",args:null,concreteType:null,kind:"LinkedField",name:"primary_listing_photo",plural:!1,selections:[B,Xa,a],storageKey:null};Zb={alias:null,args:null,concreteType:"RetailShipmentItemsConnection",kind:"LinkedField",name:"retail_shipment_items",plural:!1,selections:[{alias:null,args:null,concreteType:"MessengerRetailItem",kind:"LinkedField",name:"nodes",plural:!0,selections:[a,b,Sd,Td,Ud,Vd,kc,lc,Wd,Xd,G],storageKey:null}],storageKey:null};Sb=[b,a];u={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"media",plural:!1,selections:[B,Za,mg,O,um,vm,wm,xm],storageKey:null};hb={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"media",plural:!1,selections:[B,J,O,um,vm,wm,xm],storageKey:null};ib={alias:null,args:null,concreteType:"Photo",kind:"LinkedField",name:"photo",plural:!1,selections:y,storageKey:null};Ya={alias:null,args:null,concreteType:"FocusedPhoto",kind:"LinkedField",name:"cover_photo",plural:!1,selections:[ib],storageKey:null};mb={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"group_general_chat",plural:!1,selections:$,storageKey:null};nb={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"target",plural:!1,selections:[B,a,zb,{kind:"InlineFragment",selections:[Ab,s,Bb,Cb,Db,Eb],type:"WECMessageAudio",abstractKey:null},{kind:"InlineFragment",selections:[C,Fb,E,v],type:"MoneyTransfer",abstractKey:null},{kind:"InlineFragment",selections:[Fb,vb,Tb,Ub,C,Vb,Wb,Xb,wb,ac,bc,L,Sa,N,cc,dc,v],type:"PeerToPeerTransfer",abstractKey:null},{kind:"InlineFragment",selections:[K,fc,Hb,Kb,gc,hc,dc,Mb,ic,L,R,N,{alias:null,args:null,concreteType:"PeerToPeerPaymentRequest",kind:"LinkedField",name:"individual_requests",plural:!0,selections:[K,fc,Hb,Kb,gc,hc,a,dc,Mb,ic,L,R,N,v],storageKey:null},v],type:"PeerToPeerPaymentRequest",abstractKey:null},v,{kind:"InlineFragment",selections:[jc,G,{alias:null,args:null,concreteType:"RetailPromotionItemsConnection",kind:"LinkedField",name:"promotion_items",plural:!1,selections:I,storageKey:null}],type:"MessengerRetailPromotion",abstractKey:null},{kind:"InlineFragment",selections:[jc,G,{alias:null,args:null,concreteType:"MessengerBusinessMessageItemsConnection",kind:"LinkedField",name:"business_items",plural:!1,selections:I,storageKey:null}],type:"MessengerBusinessMessage",abstractKey:null},zc,Ec,{kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"invite_sender",plural:!1,selections:$,storageKey:null},{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"invite_recipient",plural:!1,selections:$,storageKey:null}],type:"QuickInvite",abstractKey:null},{kind:"InlineFragment",selections:[Fc,Gc,Hc,Ic,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"blob_media",plural:!1,selections:[B,Kc,Jc,O],storageKey:null}],type:"MontageDirect",abstractKey:null},{kind:"InlineFragment",selections:[Lc,c,Mc],type:"MontageShare",abstractKey:null},{kind:"InlineFragment",selections:[Oc,Pc,Qc,Rc,Sc,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"native_component_flow_request",plural:!1,selections:[B,a,{kind:"InlineFragment",selections:[Tc,Uc,Vc,Nc,Wc,Yc,bd,{alias:null,args:null,concreteType:"NativeComponentFlowBookingRequestServicesProductItemsConnection",kind:"LinkedField",name:"services_product_items",plural:!1,selections:[{alias:null,args:null,concreteType:"ServicesProductItem",kind:"LinkedField",name:"nodes",plural:!0,selections:[a,b,M,cd,dd,{alias:null,args:ed,concreteType:"ProductImage",kind:"LinkedField",name:"images",plural:!0,selections:[fd,a],storageKey:"images(first:1)"},gd],storageKey:null}],storageKey:null},hd,id,jd,kd,ld,md,nd,od,pd,qd,rd,Rc,Sc,sd],type:"NativeComponentFlowBookingRequest",abstractKey:null}],storageKey:null}],type:"PagesPlatformBookingMessage",abstractKey:null},{kind:"InlineFragment",selections:[td,ud,vd,wd],type:"ServicesAppointmentAvailability",abstractKey:null},{kind:"InlineFragment",selections:[xd,yd,zd,Ad,Bd,Cd],type:"ServicesGenericAdminText",abstractKey:null},{kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"MessagingParticipant",kind:"LinkedField",name:"genie_sender",plural:!1,selections:Qb,storageKey:null},{alias:null,args:null,concreteType:"StoryAttachment",kind:"LinkedField",name:"story_attachment",plural:!1,selections:[Qa,i,Ua,$a,ab,bb,cb,db,eb,Va,gb,jb,yb],storageKey:null}],type:"GenieMessage",abstractKey:null},{kind:"InlineFragment",selections:[Fd,Gd,Hd,Id,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"event_place",plural:!1,selections:[B,b,O],storageKey:null},Kd,Ld,Md,Nd,Od,b,Pd],type:"Event",abstractKey:null},Qd,Rd,{kind:"InlineFragment",selections:[b,Sd,Td,Ud,Vd,kc,lc,Wd,Xd,Pb,G],type:"MessengerRetailItem",abstractKey:null},{kind:"InlineFragment",selections:[Sd,Yd,Zd,nc,Td,$d,ae,be,ce,b],type:"AgentItemSuggestion",abstractKey:null},{kind:"InlineFragment",selections:[de,ee,fe,ge,{kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"FundraiserCoverPhoto",kind:"LinkedField",name:"focused_cover_photo",plural:!1,selections:[{alias:null,args:null,concreteType:"Photo",kind:"LinkedField",name:"photo",plural:!1,selections:[he,a],storageKey:null}],storageKey:null}],type:"FundraiserWithPresence",abstractKey:"__isFundraiserWithPresence"}],type:"Fundraiser",abstractKey:"__isFundraiser"},{kind:"InlineFragment",selections:[ie,je,ke,le,me,ne,oe,pe,qe,ve,kd,we,xe,ye,ze,{alias:null,args:null,concreteType:"RetailReceiptItemsConnection",kind:"LinkedField",name:"retail_items",plural:!1,selections:I,storageKey:null},Ae,Be,Ce,De],type:"MessengerRetailReceipt",abstractKey:null},{kind:"InlineFragment",selections:[Ee,Fe,Ge,{alias:null,args:null,concreteType:"PaymentInvoiceProduct",kind:"LinkedField",name:"item_list",plural:!0,selections:[He,b,Ie,M,Lb,Je,Ke,a],storageKey:null},Ta,Me,Ne,Le,Oe,Pe,F,Qe,Re,Se,Te,Ue,Ve],type:"PaymentPlatformAttachment",abstractKey:null},{kind:"InlineFragment",selections:[We,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"group_commerce_item_seller",plural:!1,selections:$,storageKey:null},Xe,Ye,kb,n],type:"GroupCommerceProductItem",abstractKey:null},{kind:"InlineFragment",selections:[Xe,kb],type:"MarketplaceListingRenderable",abstractKey:"__isMarketplaceListingRenderable"},{kind:"InlineFragment",selections:[$e,af,Wa,bf,b,Gb,cf],type:"Page",abstractKey:null},ff,{kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"MessengerRetailShipment",kind:"LinkedField",name:"shipment",plural:!1,selections:[a,gf,hf,jf,te,Cc,Zb,nf,of],storageKey:null},pf,qf,U,rf,Ae],type:"MessengerRetailShipmentTrackingEvent",abstractKey:null},{kind:"InlineFragment",selections:[gf,hf,jf,te,Cc,Zb,re,mf,{alias:null,args:null,concreteType:"MessengerRetailReceipt",kind:"LinkedField",name:"receipt",plural:!1,selections:[le,a],storageKey:null},{alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"recipient",plural:!1,selections:Sb,storageKey:null},Ae],type:"MessengerRetailShipment",abstractKey:null},{kind:"InlineFragment",selections:[sf,tf,b,uf],type:"LeadGenDeepLinkData",abstractKey:null},{kind:"InlineFragment",selections:[vf],type:"UserLeadGenInfo",abstractKey:null},wf,{kind:"InlineFragment",selections:[b,xf,l,Cb,Db],type:"WECMessageFile",abstractKey:null},{kind:"InlineFragment",selections:[s,Bb,Cb,Db,Ab,o,yf,p],type:"WECMessageVideo",abstractKey:null},Bf,{kind:"InlineFragment",selections:[Cb,Ff,If],type:"WECMessageImage",abstractKey:null},{kind:"InlineFragment",selections:[Jf,Kf,Lf,Mf,Nf,Of,Pf],type:"MentorshipMessengerCurriculumStep",abstractKey:null},{kind:"InlineFragment",selections:[Qf],type:"MentorshipMessengerDiscussionTopicSet",abstractKey:null},{kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"MentorshipProgram",kind:"LinkedField",name:"mentorship_program",plural:!1,selections:[a,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"other_member",plural:!1,selections:[B,Rb,a],storageKey:null}],storageKey:null},Sf],type:"MentorshipMessengerLeavePrompt",abstractKey:null},{kind:"InlineFragment",selections:[Sf],type:"MentorshipMessengerReminder",abstractKey:null},{kind:"InlineFragment",selections:[Sf,Tf,Uf],type:"MentorshipMessengerProgressTracker",abstractKey:null},{kind:"InlineFragment",selections:[Wf,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"message_richtext",plural:!0,selections:[B,Xf,Yf,Zf,{alias:null,args:null,concreteType:"ComposedEntityAtRange",kind:"LinkedField",name:"entity_ranges",plural:!0,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"entity",plural:!1,selections:[B,O],storageKey:null},z,Vf],storageKey:null},$f,e],storageKey:null},{alias:null,args:null,concreteType:"Feedback",kind:"LinkedField",name:"feedback",plural:!1,selections:[ag,bg,cg,{alias:null,args:eg,concreteType:"TopReactionsConnection",kind:"LinkedField",name:"top_reactions",plural:!1,selections:[{alias:null,args:null,concreteType:"FeedbackReactionInfo",kind:"LinkedField",name:"nodes",plural:!0,selections:[fg,a],storageKey:null}],storageKey:'top_reactions(first:3,orderby:["COUNT_DESC","REACTION_TYPE"])'},a],storageKey:null},gg,ic,hg,lg,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"to",plural:!1,selections:[B,b,ig,kg,a],storageKey:null},{alias:null,args:null,concreteType:"StoryAttachment",kind:"LinkedField",name:"attachments",plural:!0,selections:[ab,n,$a,Qa,u,og,{alias:null,args:dg,concreteType:"SubattachmentsConnection",kind:"LinkedField",name:"all_subattachments",plural:!1,selections:[pg,{alias:"files",args:qg,concreteType:"StoryAttachment",kind:"LinkedField",name:"nodes",plural:!0,selections:[og,hb],storageKey:'nodes(if_style:"file_upload")'},{alias:"images",args:sg,concreteType:"StoryAttachment",kind:"LinkedField",name:"nodes",plural:!0,selections:[hb],storageKey:'nodes(if_style:"photo")'}],storageKey:"all_subattachments(first:3)"}],storageKey:null},{alias:null,args:null,concreteType:"Story",kind:"LinkedField",name:"attached_story",plural:!1,selections:[tg,ug,{alias:null,args:null,concreteType:"StoryAttachment",kind:"LinkedField",name:"attachments",plural:!0,selections:[u],storageKey:null},a],storageKey:null}],type:"Story",abstractKey:null},{kind:"InlineFragment",selections:[b,D,Ya,yg,zg],type:"User",abstractKey:null},{kind:"InlineFragment",selections:[b,Ag,Bg,Cg,Ya,mb,{alias:null,args:null,concreteType:"GroupsSyncMetadata",kind:"LinkedField",name:"work_groups_sync_metadata",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"messenger_group",plural:!1,selections:$,storageKey:null}],storageKey:null}],type:"Group",abstractKey:null},{kind:"InlineFragment",selections:[Eg,Fg,Gg,{alias:null,args:null,concreteType:"AppIntegration",kind:"LinkedField",name:"app_integration",plural:!1,selections:[Hg,b,Ig,Jg,a],storageKey:null},Kg,Lg,{alias:null,args:null,concreteType:"AppContentAdditionalData",kind:"LinkedField",name:"link_preview_additional_data",plural:!0,selections:[h,e,Ob,ub,Mg,{alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"profiles",plural:!0,selections:[D,b,a],storageKey:null}],storageKey:null}],type:"AppContent",abstractKey:null},{kind:"InlineFragment",selections:[Pb],type:"CommerceProductItemShare",abstractKey:null},{kind:"InlineFragment",selections:[Ng],type:"ApplicationReferralXMA",abstractKey:null},Pg,{kind:"InlineFragment",selections:[Qg],type:"XFBP2MXMA",abstractKey:null},Rg],storageKey:null};ob={alias:null,args:null,concreteType:"StoryAttachment",kind:"LinkedField",name:"story_attachment",plural:!1,selections:[Qa,i,Ua,$a,ab,bb,cb,db,eb,Va,gb,jb,yb,nb,{alias:null,args:null,concreteType:"StoryAttachment",kind:"LinkedField",name:"subattachments",plural:!0,selections:[Qa,i,Ua,$a,ab,bb,cb,db,eb,Va,gb,jb,yb,nb],storageKey:null}],storageKey:null};pb={alias:null,args:null,concreteType:"ExtensibleMessageAttachment",kind:"LinkedField",name:"extensible_attachment",plural:!1,selections:[Pa,ob,{alias:"genie_attachment",args:null,concreteType:"StoryAttachment",kind:"LinkedField",name:"story_attachment",plural:!1,selections:[{alias:"genie_message",args:null,concreteType:null,kind:"LinkedField",name:"target",plural:!1,selections:[B,a,{kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"MessagingParticipant",kind:"LinkedField",name:"genie_sender",plural:!1,selections:[a,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"messaging_actor",plural:!1,selections:[B,b,a,{kind:"TypeDiscriminator",abstractKey:"__isNode"}],storageKey:null}],storageKey:null},ob],type:"GenieMessage",abstractKey:null}],storageKey:null}],storageKey:null},a],storageKey:null};qb=[B,{kind:"TypeDiscriminator",abstractKey:"__isMessageBlobAttachment"},Ze,Bc,rg,vc,wg,O];rb={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"blob_attachments",plural:!0,selections:qb,storageKey:null};sb={alias:"last_message",args:Ma,concreteType:"MessagesOfThreadConnection",kind:"LinkedField",name:"messages",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"nodes",plural:!0,selections:[B,c,{alias:null,args:null,concreteType:"MessagingParticipant",kind:"LinkedField",name:"message_sender",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"messaging_actor",plural:!1,selections:$,storageKey:null},a],storageKey:null},Na,Oa,P,k,a,{kind:"InlineFragment",selections:[pb,H,rb],type:"UserMessage",abstractKey:null},{kind:"InlineFragment",selections:[fb,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"extensible_message_admin_text",plural:!1,selections:[B,ec],storageKey:null}],type:"GenericAdminTextMessage",abstractKey:null}],storageKey:null}],storageKey:"messages(last:1)"};x={alias:null,args:null,concreteType:"JobApplicationsFromThreadConnection",kind:"LinkedField",name:"thread_associated_job_applications",plural:!1,selections:[{alias:null,args:null,concreteType:"JobApplication",kind:"LinkedField",name:"nodes",plural:!0,selections:[a,{alias:null,args:null,concreteType:"JobOpening",kind:"LinkedField",name:"job_opening",plural:!1,selections:[Gf,{alias:null,args:null,concreteType:"Page",kind:"LinkedField",name:"employer",plural:!1,selections:[A,Hf,a],storageKey:null},a],storageKey:null}],storageKey:null}],storageKey:null};r={alias:null,args:null,concreteType:"MessageThreadCustomization",kind:"LinkedField",name:"customization_info",plural:!1,selections:[eh,hh,ih,a],storageKey:null};Nb={alias:null,args:null,concreteType:"MessengerThreadTheme",kind:"LinkedField",name:"thread_theme",plural:!1,selections:[a,kh,lh,mh,nh,{alias:null,args:null,concreteType:"MessengerReactionPack",kind:"LinkedField",name:"reaction_pack",plural:!1,selections:[{alias:null,args:null,concreteType:"MessengerReactionPackReactionAssetsConnection",kind:"LinkedField",name:"reaction_assets",plural:!1,selections:[{alias:null,args:null,concreteType:"MessengerReactionAsset",kind:"LinkedField",name:"nodes",plural:!0,selections:[oh,ph,qh,rh,a],storageKey:null}],storageKey:null},a],storageKey:null}],storageKey:null};mc={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"thread_admins",plural:!0,selections:$,storageKey:null};pc={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"thread_queue_metadata",plural:!1,selections:[B,yh,a],storageKey:null};oc={alias:null,args:ed,concreteType:"MessengerEventRemindersOfThreadConnection",kind:"LinkedField",name:"event_reminders",plural:!1,selections:[{alias:null,args:null,concreteType:"MessengerEventReminder",kind:"LinkedField",name:"nodes",plural:!0,selections:[a,Ah,ef,Bh,Ch,Dc,{alias:null,args:null,concreteType:"Page",kind:"LinkedField",name:"location_page",plural:!1,selections:[Dh,a],storageKey:null},Eh,Fh,Gh,df,{alias:null,args:null,concreteType:"UserMessage",kind:"LinkedField",name:"trigger_message",plural:!1,selections:[V,a],storageKey:null},Hh,Ih,Jh,Kh],storageKey:null}],storageKey:"event_reminders(first:1)"};sc={alias:null,args:null,concreteType:"PageMessageThread",kind:"LinkedField",name:"related_page_thread",plural:!1,selections:[Ph,td,Th,Vh,Yh,a],storageKey:null};yc={alias:null,args:null,concreteType:"RtcCallData",kind:"LinkedField",name:"rtc_call_data",plural:!1,selections:[$h,ai,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"initiator",plural:!1,selections:$,storageKey:null}],storageKey:null};Xa={alias:null,args:null,concreteType:"MarketplaceThreadData",kind:"LinkedField",name:"marketplace_thread_data",plural:!1,selections:[{alias:null,args:null,concreteType:"GroupCommerceProductItem",kind:"LinkedField",name:"for_sale_item",plural:!1,selections:[a,Mc,Ye,Xe,se,ci,di,ei,fi,gi,hi,{alias:"primary_photo",args:null,concreteType:null,kind:"LinkedField",name:"primary_listing_photo",plural:!1,selections:[B,J,a],storageKey:null},ii,ji],storageKey:null},ki,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"buyer",plural:!1,selections:$,storageKey:null},{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"seller",plural:!1,selections:[B,a,mi],storageKey:null},oi],storageKey:null};Za={alias:null,args:null,concreteType:null,kind:"LinkedField",name:"associated_object",plural:!1,selections:[B,a,{kind:"InlineFragment",selections:[qi,b,D,mb,ri,si,ti,ui,wi,xi],type:"Group",abstractKey:null},{kind:"InlineFragment",selections:[qi,b,D,ri,si,ti,Pd,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"event_place",plural:!1,selections:[B,yi,O],storageKey:null}],type:"Event",abstractKey:null}],storageKey:null};mg={alias:null,args:null,concreteType:"PageCommItem",kind:"LinkedField",name:"page_comm_item",plural:!1,selections:[a,Gi,Hi,Ii,Ji,Ki,Ni,Oi,{alias:null,args:null,concreteType:"PageCommItemToPageCommItemOwnersConnection",kind:"LinkedField",name:"comm_item_owners",plural:!1,selections:[{alias:null,args:null,concreteType:"PageCommItemOwner",kind:"LinkedField",name:"nodes",plural:!0,selections:[Qi,a],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"subtitle",plural:!1,selections:[{alias:null,args:null,concreteType:"ImageAtRange",kind:"LinkedField",name:"image_ranges",plural:!0,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"entity_with_image",plural:!1,selections:[B,J,O,{kind:"InlineFragment",selections:d,type:"XFBBasicMarketplaceImage",abstractKey:null}],storageKey:null},z,Vf],storageKey:null},$f,e],storageKey:null},Ri],storageKey:null};um={alias:null,args:null,concreteType:"GroupsSyncMetadata",kind:"LinkedField",name:"groups_sync_metadata",plural:!1,selections:[{alias:null,args:null,concreteType:"Group",kind:"LinkedField",name:"fb_group",plural:!1,selections:[n,a],storageKey:null}],storageKey:null};vm={kind:"TypeDiscriminator",abstractKey:"__isMessage"};wm={alias:null,args:null,concreteType:"MessageReaction",kind:"LinkedField",name:"message_reactions",plural:!0,selections:[gj,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"user",plural:!1,selections:$,storageKey:null}],storageKey:null};xm={alias:null,args:null,concreteType:"MessagingParticipant",kind:"LinkedField",name:"unsender",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"messaging_actor",plural:!1,selections:[B,a,b,ig],storageKey:null},a],storageKey:null};y={kind:"InlineFragment",selections:[lj,{alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"message",plural:!1,selections:[e,{alias:null,args:null,concreteType:"EntityAtRange",kind:"LinkedField",name:"ranges",plural:!0,selections:[z,Vf,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"entity",plural:!1,selections:[B,mj,nj,Ka,O],storageKey:null},oj],storageKey:null}],storageKey:null},pj,pb,H,rb,ni],type:"UserMessage",abstractKey:null};zb=[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"node",plural:!1,selections:qb,storageKey:null}];Eb={kind:"InlineFragment",selections:[t,c,{alias:null,args:null,concreteType:"VideoCallMessageToCaptureAttachmentsConnection",kind:"LinkedField",name:"call_capture_attachments",plural:!1,selections:[pg,{alias:null,args:null,concreteType:"VideoCallMessageToCaptureAttachmentsEdge",kind:"LinkedField",name:"edges",plural:!0,selections:zb,storageKey:null}],storageKey:null}],type:"VideoCallMessage",abstractKey:null};E={kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"MessageImage",kind:"LinkedField",name:"image_with_metadata",plural:!1,selections:[Ef,Pa,xc,a],storageKey:null},c],type:"ThreadImageMessage",abstractKey:null};Fb={kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"extensible_message_admin_text",plural:!1,selections:[B,wj,xj,yj,zj,Aj,Bj,Cj,Dj,X,kf,Fj,Gj,gh,Hj,Ij,Kj,{kind:"InlineFragment",selections:[xb,Lj,Mj,Nj,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"instant_game_update_data",plural:!1,selections:[B,{kind:"InlineFragment",selections:[Oj,Og,ib,Pj],type:"InstantGameXMATCustomMessageClientData",abstractKey:null}],storageKey:null},Qj],type:"InstantGameUpdateExtensibleMessageAdminText",abstractKey:null},Rj,Sj,Xj,Zj,$j,bk,ck,dk,Ac,ak,ek,gk,hk,ik,kk,lk,jk,{kind:"InlineFragment",selections:[mk,nk,ok,Jj,pk,qk,rk,sk,{alias:null,args:null,concreteType:"MessengerCallLogExtensibleMessageAdminTextCallCaptureAttachmentsConnection",kind:"LinkedField",name:"call_capture_attachments",plural:!1,selections:[pg,{alias:null,args:null,concreteType:"MessengerCallLogExtensibleMessageAdminTextCallCaptureAttachmentsEdge",kind:"LinkedField",name:"edges",plural:!0,selections:zb,storageKey:null}],storageKey:null}],type:"MessengerCallLogExtensibleMessageAdminText",abstractKey:null},Tj,tk,Wj,vk,wk,fk,xk,yk,Ak,zk,Bk,Ck,Dk],storageKey:null},fb,c],type:"GenericAdminTextMessage",abstractKey:null};vb=[B,vm,Vi,V,Wi,Yi,Zi,Na,$i,aj,Af,bj,Oa,cj,dj,P,ej,fj,wm,ij,xm,kj,k,{alias:null,args:null,concreteType:"RepliedToMessage",kind:"LinkedField",name:"replied_to_message",plural:!1,selections:[kd,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"message",plural:!1,selections:[B,vm,Vi,V,Wi,Yi,Zi,Na,$i,aj,Af,bj,Oa,cj,dj,P,ej,fj,wm,ij,xm,kj,k,a,y,qj,Eb,sj,E,uj,vj,Fb,$b,w],storageKey:null}],storageKey:null},a,y,qj,Eb,sj,E,uj,vj,Fb,$b,w];Tb={alias:null,args:null,concreteType:"PinnedMessageData",kind:"LinkedField",name:"pinned_messages",plural:!0,selections:[V,Ui,{condition:"threadlistViewFieldsOnly",kind:"Condition",passingValue:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"message",plural:!1,selections:vb,storageKey:null}]}],storageKey:null};Ub={alias:null,args:null,concreteType:"GroupsSyncMetadata",kind:"LinkedField",name:"work_groups_sync_metadata",plural:!1,selections:[{alias:null,args:null,concreteType:"Group",kind:"LinkedField",name:"fb_group",plural:!1,selections:[n,a,b,Ag,Q,D,wi,{alias:null,args:null,concreteType:"MultiBackgroundIcon",kind:"LinkedField",name:"group_icon",plural:!1,selections:[rj,a],storageKey:null}],storageKey:null}],storageKey:null};C={alias:null,args:ed,concreteType:"MessengerMentorshipProgramOfThreadConnection",kind:"LinkedField",name:"linked_mentorship_programs",plural:!1,selections:[{alias:null,args:null,concreteType:"MentorshipProgram",kind:"LinkedField",name:"nodes",plural:!0,selections:[a,Gk,Dd,{alias:null,args:ed,concreteType:"MentorshipProgramToMentorshipMessengerCurriculumStepOrderByStepCountConnection",kind:"LinkedField",name:"messenger_curriculum_steps",plural:!1,selections:[{alias:null,args:null,concreteType:"MentorshipMessengerCurriculumStep",kind:"LinkedField",name:"nodes",plural:!0,selections:[Hk,Ik,a],storageKey:null}],storageKey:"messenger_curriculum_steps(first:1)"}],storageKey:null}],storageKey:"linked_mentorship_programs(first:1)"};Vb={alias:null,args:null,concreteType:"WorkUserInfo",kind:"LinkedField",name:"work_info",plural:!1,selections:[{alias:null,args:null,concreteType:"Group",kind:"LinkedField",name:"work_community",plural:!1,selections:Sb,storageKey:null},xg],storageKey:null};Wb={alias:null,args:null,concreteType:"MessagingParticipant",kind:"LinkedField",name:"nodes",plural:!0,selections:Qb,storageKey:null};Xb={alias:null,args:null,concreteType:"AllMessagingParticipantsOfThreadConnection",kind:"LinkedField",name:"all_participants",plural:!1,selections:[{alias:null,args:null,concreteType:"AllMessagingParticipantsOfThreadEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[Li,{alias:null,args:null,concreteType:"MessagingParticipant",kind:"LinkedField",name:"node",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"messaging_actor",plural:!1,selections:[B,{kind:"TypeDiscriminator",abstractKey:"__isMessagingActor"},a,b,{kind:"InlineFragment",selections:[Mi,n,Y,Rb,Nk,Ok,Pk,Qk,Rk,Sk,Tk,Uk,Vk,Vb],type:"User",abstractKey:null},Wk,Xk,Zk,$k,bl,Yk,cl,{kind:"InlineFragment",selections:[n,Y,Nk,dl,Qk,Vb],type:"ReducedMessagingActor",abstractKey:null},fl,el,j,hl,gl,il,jl,kl,al,{kind:"InlineFragment",selections:[Y,ll,ml,{alias:null,args:null,concreteType:"WECGroupParticipantsConnection",kind:"LinkedField",name:"wec_group_participants",plural:!1,selections:[Wb,pg],storageKey:null},{alias:null,args:null,concreteType:"WECGroupAdminsConnection",kind:"LinkedField",name:"wec_group_admins",plural:!1,selections:[Wb],storageKey:null}],type:"WECGroupRecipient",abstractKey:null}],storageKey:null},a],storageKey:null}],storageKey:null}],storageKey:null};wb={alias:null,args:null,concreteType:"MessagingReadReceiptsOfThreadConnection",kind:"LinkedField",name:"read_receipts",plural:!1,selections:[{alias:null,args:null,concreteType:"MessagingReadReceipt",kind:"LinkedField",name:"nodes",plural:!0,selections:[Ed,nl,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"actor",plural:!1,selections:$,storageKey:null}],storageKey:null}],storageKey:null};ac={condition:"threadlistViewFieldsOnly",kind:"Condition",passingValue:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"saved_messages",plural:!0,selections:vb,storageKey:null}]};bc=[{alias:null,args:null,concreteType:"MessageThread",kind:"LinkedField",name:"nodes",plural:!0,selections:[a,La,b,sb,Df,x,S,rc,tc,uc,J,Rf,Xc,Sg,Tg,Ug,Vg,Wg,Xg,Yg,Zg,$g,ah,bh,ch,dh,r,Nb,mc,uh,vh,wh,pc,oc,Mh,Oh,sc,yc,Xa,Za,si,zi,Ai,Bi,Ci,Di,Ei,Fi,fh,mg,Si,Ti,um,Tb,Ub,M,Ek,Fk,C,Kk,Lk,Mk,li,Vj,Xb,wb,qc,ac,pl],storageKey:null},Ja];Sa=[rl,D,a];cc=[rl,Nk,b,D,a];K={alias:null,args:null,concreteType:"InstagramUserV2",kind:"LinkedField",name:"media_owner",plural:!1,selections:cc,storageKey:null};fc={alias:null,args:null,concreteType:"InstagramUserV2",kind:"LinkedField",name:"user",plural:!1,selections:cc,storageKey:null};Hb=[{alias:null,args:null,concreteType:"InstagramMessageThreadItem",kind:"LinkedField",name:"nodes",plural:!0,selections:[ul,He,Yj,Ml,Nl,e,Ol,Pl,{alias:null,args:null,concreteType:"IGMessageThreadItemMedia",kind:"LinkedField",name:"ig_thread_item_media",plural:!1,selections:[Cl,Rl,Sl,Tl,K],storageKey:null},Wl,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"share",plural:!1,selections:[B,fc,{alias:null,args:null,concreteType:"IGMessageThreadItemMedia",kind:"LinkedField",name:"media",plural:!0,selections:[Cl,Xl,Sl,Tl,K],storageKey:null},Yl,$l,Zl,zf,am],storageKey:null},{alias:null,args:null,concreteType:"IGThreadItemReactions",kind:"LinkedField",name:"ig_reaction",plural:!1,selections:[bm,{alias:null,args:null,concreteType:"InstagramUserV2",kind:"LinkedField",name:"likes",plural:!0,selections:Sa,storageKey:null},cm],storageKey:null},{alias:null,args:Ql,concreteType:"IGThreadItemProfileShareSource",kind:"LinkedField",name:"profileshare",plural:!1,selections:[fc,dm],storageKey:null},ad,Zc,$c,lf,fm,jm,tb,em,T,gm,hm,a],storageKey:null},Z];Kb={alias:null,args:null,kind:"ScalarField",name:"page_contact_id",storageKey:null};gc={alias:null,args:null,kind:"ScalarField",name:"ig_thread_id",storageKey:null};hc={alias:null,args:null,kind:"ScalarField",name:"unit_type",storageKey:null};dc=[{kind:"Literal",name:"first",value:4},{kind:"Literal",name:"message_shared_media_type",value:"PHOTO_AND_VIDEO"}];Mb={alias:"fbid",args:null,kind:"ScalarField",name:"legacy_attachment_id",storageKey:null};L={alias:"dim",args:null,concreteType:"Vect2",kind:"LinkedField",name:"original_dimensions",plural:!1,selections:wc,storageKey:null};R={alias:null,args:null,kind:"ScalarField",name:"cursor",storageKey:null};N={alias:null,args:null,concreteType:"PageInfo",kind:"LinkedField",name:"page_info",plural:!1,selections:[Ra,im],storageKey:null};v={alias:null,args:null,kind:"ScalarField",name:"full_name",storageKey:null};jc=[{kind:"Literal",name:"height",value:52},{kind:"Literal",name:"width",value:52}];zc=[{kind:"Literal",name:"first",value:20}];Ec={alias:null,args:null,kind:"ScalarField",name:"contact_count",storageKey:null};Fc={kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"__id",storageKey:null}]};Gc=[{kind:"Literal",name:"first",value:400}];Hc={alias:null,args:null,kind:"ScalarField",name:"is_custom_event_reportable",storageKey:null};Ic={alias:null,args:null,kind:"ScalarField",name:"is_synced_with_smb",storageKey:null};Kc={alias:null,args:null,kind:"ScalarField",name:"has_wa_contact",storageKey:null};Jc=[{kind:"Literal",name:"first",value:2}];Lc=[{alias:null,args:null,kind:"ScalarField",name:"nux_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"nux_content_text",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"nux_ui_type",storageKey:null}];Oc=[{alias:null,args:null,kind:"ScalarField",name:"passes_gk",storageKey:null}];Pc={alias:null,args:[{kind:"Literal",name:"tab",value:"data_sharing"}],kind:"ScalarField",name:"settings_uri_in_business_view",storageKey:'settings_uri_in_business_view(tab:"data_sharing")'};Qc={alias:null,args:null,kind:"ScalarField",name:"__token",storageKey:null};Tc=[{kind:"Literal",name:"first",value:5},{kind:"Literal",name:"types",value:["BUSINESS_ORDER"]}];Uc={alias:null,args:null,kind:"ScalarField",name:"is_auto_detected",storageKey:null};Vc={alias:null,args:null,kind:"ScalarField",name:"should_show_automated_activity_redesigned_nux",storageKey:null};Nc={alias:null,args:null,kind:"ScalarField",name:"is_classic_page",storageKey:null};Wc={alias:null,args:null,concreteType:"BizCRMContactFBAttributes",kind:"LinkedField",name:"fb_attributes",plural:!1,selections:[Uj],storageKey:null};Yc={alias:null,args:null,kind:"ScalarField",name:"is_detected_outcomes_label",storageKey:null};bd={alias:null,args:Gc,concreteType:"CustomLabelsConnection",kind:"LinkedField",name:"custom_labels",plural:!1,selections:[{alias:null,args:null,concreteType:"CustomLabelsEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"BusinessPresenceCustomLabel",kind:"LinkedField",name:"node",plural:!1,selections:[a,b,Qh,Ec,W,Rh,Sh,Hc,Yc,Ic,Kc,{alias:null,args:null,kind:"ScalarField",name:"is_immutable",storageKey:null},B],storageKey:null},R],storageKey:null},Z],storageKey:"custom_labels(first:400)"};cd={alias:null,args:Gc,filters:null,handle:"connection",key:"BizKitContextCardLabelsSection_custom_labels",kind:"LinkedHandle",name:"custom_labels"};dd={alias:null,args:Gc,filters:null,handle:"connection",key:"BizKitContextCardLabelsSection_corp_labels",kind:"LinkedHandle",name:"corp_labels"};fd={alias:null,args:null,concreteType:"BusinessPresenceNode",kind:"LinkedField",name:"business_presence_node",plural:!1,selections:d,storageKey:null};gd=[{kind:"Literal",name:"gk_name",value:"mcom_kbank_integration_rollout"}];hd=[{alias:"passes",args:null,kind:"ScalarField",name:"passes_gk",storageKey:null}];id=[{kind:"Literal",name:"gk_name",value:"ctm_www_tas_order_integration_gk"}];jd=[{alias:"is_order_integration_enabled",args:null,kind:"ScalarField",name:"passes_gk",storageKey:null}];ld=[{kind:"Literal",name:"gk_name",value:"ctm_www_tas_timeline_actions_gk"}];md=[{alias:"showTimelineActions",args:null,kind:"ScalarField",name:"passes_gk",storageKey:null}];return{fragment:{argumentDefinitions:[aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa,Ba,Ca,Da,Ea,Fa],kind:"Fragment",metadata:null,name:"BizInboxUnifiedThreadsQuery",selections:[Ga,{alias:null,args:Ha,concreteType:"XFBBizInboxUnifiedThreadList",kind:"LinkedField",name:"xfb_biz_inbox_unified_thread_list",plural:!1,selections:[{alias:null,args:null,concreteType:"ViewerMessageThreadsConnection",kind:"LinkedField",name:"msgr_threads",plural:!1,selections:ql,storageKey:null},{alias:null,args:null,concreteType:"ViewerMessageThreadsConnection",kind:"LinkedField",name:"wa_threads",plural:!1,selections:ql,storageKey:null},{alias:null,args:null,concreteType:"InstagramMessageThreadsConnection",kind:"LinkedField",name:"ig_threads",plural:!1,selections:[{alias:null,args:null,concreteType:"InstagramUserV2",kind:"LinkedField",name:"ig_user",plural:!1,selections:sl,storageKey:null},Ia,tl,{condition:"loadThreads",kind:"Condition",passingValue:!0,selections:[{alias:null,args:null,concreteType:"InstagramMessageThread",kind:"LinkedField",name:"nodes",plural:!0,selections:[ul,vl,wl,xl,yl,zl,Al,Bl,Dl,El,Fl,Pi,Gl,Hl,Il,Jl,Kl,Ll,Ji,Ki,{condition:"loadThreadItems",kind:"Condition",passingValue:!0,selections:[{alias:null,args:ed,concreteType:"InstagramMessageThreadItemsConnection",kind:"LinkedField",name:"thread_items",plural:!1,selections:Vl,storageKey:"thread_items(first:1)"}]}],storageKey:null},Z]}],storageKey:null},{alias:null,args:null,concreteType:"XFBBizInboxSelectedThread",kind:"LinkedField",name:"selected_thread",plural:!1,selections:[Ul,{alias:null,args:null,concreteType:"InstagramMessageThread",kind:"LinkedField",name:"selected_ig_thread",plural:!1,selections:[ul,vl,wl,xl,yl,zl,Al,Bl,Dl,El,Fl,Pi,Gl,Hl,Il,Jl,Kl,Ll,Ji,Ki,{condition:"load_items",kind:"Condition",passingValue:!0,selections:[{alias:null,args:km,concreteType:"InstagramMessageThreadItemsConnection",kind:"LinkedField",name:"thread_items",plural:!1,selections:Vl,storageKey:null}]}],storageKey:null},{alias:null,args:null,concreteType:"MessageThread",kind:"LinkedField",name:"selected_message_thread",plural:!1,selections:[a,La,b,Cf,Df,q,S,rc,qc,tc,uc,J,Rf,Xc,Sg,Tg,Ug,Vg,Wg,Xg,Yg,Zg,$g,ah,bh,ch,dh,jh,sh,th,uh,vh,wh,zh,Lh,Mh,Oh,Zh,bi,pi,Dg,si,zi,Ai,Bi,Ci,Di,Ei,Fi,fh,Yb,Si,Ti,jg,jj,tj,vg,M,Ek,Fk,Jk,Kk,Lk,Mk,li,Vj,Jd,{condition:"load_messages",kind:"Condition",passingValue:!0,selections:[{alias:null,args:lm,concreteType:"MessagesOfThreadConnection",kind:"LinkedField",name:"messages",plural:!1,selections:[mm,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"nodes",plural:!0,selections:hj,storageKey:null}],storageKey:null}]},{condition:"load_read_receipts",kind:"Condition",passingValue:!0,selections:[ol]},Nh],storageKey:null},{condition:"shouldUnifyContextCardQueries",kind:"Condition",passingValue:!0,selections:[{kind:"InlineDataFragmentSpread",name:"BizKitContextCardContainerDetailsFrag_selectedContact",selections:[{alias:null,args:om,concreteType:"BizCRMContact",kind:"LinkedField",name:"selected_biz_crm_contact",plural:!1,selections:[{alias:null,args:null,concreteType:"BizCRMContactIdentity",kind:"LinkedField",name:"identity",plural:!1,selections:[pm],storageKey:null},{args:null,kind:"FragmentSpread",name:"BizKitContextCardContainer_contact"}],storageKey:null},{alias:null,args:om,concreteType:"BizCRMContactCardConfig",kind:"LinkedField",name:"selected_biz_crm_contact_card_config",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"BizKitContextCard_config"}],storageKey:null}],args:null,argumentDefinitions:[qm]}]}],storageKey:null},nm],storageKey:null},sm,{condition:"shouldUnifyContextCardQueries",kind:"Condition",passingValue:!0,selections:[{kind:"InlineDataFragmentSpread",name:"BizKitContextCardActivitySectionFrag_activitiesquery",selections:[{alias:null,args:Ha,concreteType:"XFBBizInboxUnifiedThreadList",kind:"LinkedField",name:"xfb_biz_inbox_unified_thread_list",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBBizInboxSelectedThread",kind:"LinkedField",name:"selected_thread",plural:!1,selections:[{alias:null,args:om,concreteType:"BizCRMContact",kind:"LinkedField",name:"selected_biz_crm_contact",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"BizKitContextCardActivitySection_contact"},{args:null,kind:"FragmentSpread",name:"BizKitContextCardActivityDropDown_contact"},{args:null,kind:"FragmentSpread",name:"BizKitContextCardActivityNuxForAutoDetected_contact"}],storageKey:null},tm],storageKey:null},{condition:"isDependencyOfRemovePageDependencyEnabledTool",kind:"Condition",passingValue:!1,selections:[{alias:null,args:om,concreteType:"Page",kind:"LinkedField",name:"selected_page",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"BizKitContextCardActivityDropDown_page"},{args:null,kind:"FragmentSpread",name:"BizKitContextCardActivityListItem_page"}],storageKey:null}]}],storageKey:null},{condition:"isDependencyOfRemovePageDependencyEnabledTool",kind:"Condition",passingValue:!0,selections:[{alias:null,args:rm,concreteType:"XFBMBSBusinessAssets",kind:"LinkedField",name:"xfb_mbs_business_assets",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"BizKitContextCardActivityDropDown_mbsBusinessAssets"},{args:null,kind:"FragmentSpread",name:"BizKitContextCardActivityListItem_mbsBusinessAssets"}],storageKey:null}]}],args:null,argumentDefinitions:[{kind:"RootArgument",name:"businessAssets"},{kind:"RootArgument",name:"ig_params"},{kind:"RootArgument",name:"isDependencyOfRemovePageDependencyEnabledTool"},{kind:"RootArgument",name:"msgr_params"},qm,{kind:"RootArgument",name:"selected_item_id"},{kind:"RootArgument",name:"wa_params"}]}]}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[ia,fa,ga,ja,Ca,Ba,Fa,da,na,ma,wa,ea,ta,Da,ua,Ea,sa,aa,qa,ra,oa,la,ka,pa,va,ca,za,ya,xa,Aa,ha,ba],kind:"Operation",name:"BizInboxUnifiedThreadsQuery",selections:[Ga,{alias:null,args:Ha,concreteType:"XFBBizInboxUnifiedThreadList",kind:"LinkedField",name:"xfb_biz_inbox_unified_thread_list",plural:!1,selections:[{alias:null,args:null,concreteType:"ViewerMessageThreadsConnection",kind:"LinkedField",name:"msgr_threads",plural:!1,selections:bc,storageKey:null},{alias:null,args:null,concreteType:"ViewerMessageThreadsConnection",kind:"LinkedField",name:"wa_threads",plural:!1,selections:bc,storageKey:null},{alias:null,args:null,concreteType:"InstagramMessageThreadsConnection",kind:"LinkedField",name:"ig_threads",plural:!1,selections:[{alias:null,args:null,concreteType:"InstagramUserV2",kind:"LinkedField",name:"ig_user",plural:!1,selections:Sa,storageKey:null},Ia,tl,{condition:"loadThreads",kind:"Condition",passingValue:!0,selections:[{alias:null,args:null,concreteType:"InstagramMessageThread",kind:"LinkedField",name:"nodes",plural:!0,selections:[ul,vl,wl,xl,yl,zl,Al,Bl,Dl,El,Fl,Pi,Gl,Hl,Il,Jl,Kl,Ll,Ji,Ki,{condition:"loadThreadItems",kind:"Condition",passingValue:!0,selections:[{alias:null,args:ed,concreteType:"InstagramMessageThreadItemsConnection",kind:"LinkedField",name:"thread_items",plural:!1,selections:Hb,storageKey:"thread_items(first:1)"}]},a],storageKey:null},Z]}],storageKey:null},{alias:null,args:null,concreteType:"XFBBizInboxSelectedThread",kind:"LinkedField",name:"selected_thread",plural:!1,selections:[Ul,{alias:null,args:null,concreteType:"InstagramMessageThread",kind:"LinkedField",name:"selected_ig_thread",plural:!1,selections:[ul,vl,wl,xl,yl,zl,Al,Bl,Dl,El,Fl,Pi,Gl,Hl,Il,Jl,Kl,Ll,Ji,Ki,{condition:"load_items",kind:"Condition",passingValue:!0,selections:[{alias:null,args:km,concreteType:"InstagramMessageThreadItemsConnection",kind:"LinkedField",name:"thread_items",plural:!1,selections:Hb,storageKey:null}]},a],storageKey:null},{alias:null,args:null,concreteType:"MessageThread",kind:"LinkedField",name:"selected_message_thread",plural:!1,selections:[a,La,b,sb,Df,x,S,rc,tc,uc,J,Rf,Xc,Sg,Tg,Ug,Vg,Wg,Xg,Yg,Zg,$g,ah,bh,ch,dh,r,Nb,mc,uh,vh,wh,pc,oc,Mh,Oh,sc,yc,Xa,Za,si,zi,Ai,Bi,Ci,Di,Ei,Fi,fh,mg,Si,Ti,um,Tb,Ub,M,Ek,Fk,C,Kk,Lk,Mk,li,Vj,Xb,qc,ac,{condition:"load_messages",kind:"Condition",passingValue:!0,selections:[{alias:null,args:lm,concreteType:"MessagesOfThreadConnection",kind:"LinkedField",name:"messages",plural:!1,selections:[mm,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"nodes",plural:!0,selections:vb,storageKey:null}],storageKey:null}]},{condition:"load_read_receipts",kind:"Condition",passingValue:!0,selections:[wb]},Nh],storageKey:null},{condition:"shouldUnifyContextCardQueries",kind:"Condition",passingValue:!0,selections:[{alias:null,args:om,concreteType:"BizCRMContact",kind:"LinkedField",name:"selected_biz_crm_contact",plural:!1,selections:[{alias:null,args:null,concreteType:"BizCRMContactIdentity",kind:"LinkedField",name:"identity",plural:!1,selections:[pm,g,{alias:null,args:null,kind:"ScalarField",name:"contact_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"sub_business_id",storageKey:null}],storageKey:null},a,{alias:null,args:null,concreteType:"BizCRMContactSharedAttributes",kind:"LinkedField",name:"shared_attributes",plural:!1,selections:[Kb,{alias:null,args:null,kind:"ScalarField",name:"is_guest_chat",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"has_consented_to_contact_card_tos",storageKey:null},{condition:"should3DContextCardSections",kind:"Condition",passingValue:!1,selections:[{alias:null,args:null,concreteType:"XFBBizCRMContactIGIDs",kind:"LinkedField",name:"ig_ids",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ig_id_v2",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ig_eimu_id",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"BizCRMContactIGAttributes",kind:"LinkedField",name:"ig_attributes",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ig_user_id",storageKey:null},gc,{alias:null,args:null,concreteType:"BizCRMContactIGUserProfileUnit",kind:"LinkedField",name:"profile_units",plural:!0,selections:[hc,e],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"BizCRMContactFBAttributes",kind:"LinkedField",name:"fb_attributes",plural:!1,selections:[Uj,{alias:null,args:null,concreteType:"BizCRMContactFBUserProfileUnit",kind:"LinkedField",name:"profile_units",plural:!0,selections:[{alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"text",plural:!1,selections:[{alias:null,args:null,concreteType:"EntityAtRange",kind:"LinkedField",name:"ranges",plural:!0,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"entity",plural:!1,selections:[B,n,O],storageKey:null},z,Vf],storageKey:null},e],storageKey:null},hc],storageKey:null},{alias:null,args:null,concreteType:"BizCRMContactMessengerThreadAttribute",kind:"LinkedField",name:"messenger_thread",plural:!1,selections:[{alias:null,args:null,concreteType:"MessageThread",kind:"LinkedField",name:"one_to_one_thread",plural:!1,selections:[{alias:"sharedMedia",args:dc,concreteType:"MessageSharedMediaConnection",kind:"LinkedField",name:"message_shared_media",plural:!1,selections:[{alias:null,args:null,concreteType:"MessageSharedMediaEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"node",plural:!1,selections:[B,{kind:"TypeDiscriminator",abstractKey:"__isMessageSharedMedia"},O,{kind:"InlineFragment",selections:[Mb,J,L],type:"MessageImage",abstractKey:null},{kind:"InlineFragment",selections:[Mb,J,L,s],type:"MessageVideo",abstractKey:null}],storageKey:null},R],storageKey:null},N],storageKey:'message_shared_media(first:4,message_shared_media_type:"PHOTO_AND_VIDEO")'},{alias:"sharedMedia",args:dc,filters:["message_shared_media_type"],handle:"connection",key:"BizKitContextCardSharedPhotos_sharedMedia",kind:"LinkedHandle",name:"message_shared_media"},a],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"BizCRMContactSharedAttributes",kind:"LinkedField",name:"shared_attributes",plural:!1,selections:[{alias:null,args:null,concreteType:"BizCRMContactProfile",kind:"LinkedField",name:"profile",plural:!1,selections:[Ej,{alias:null,args:null,kind:"ScalarField",name:"first_name",storageKey:null},v,{alias:null,args:null,concreteType:"PageContactProfileURI",kind:"LinkedField",name:"profile_uris",plural:!0,selections:m,storageKey:null},{alias:null,args:jc,concreteType:"PageContactProfilePhotoURI",kind:"LinkedField",name:"profile_photo_uris_prefetch",plural:!0,selections:m,storageKey:"profile_photo_uris_prefetch(height:52,width:52)"},{alias:null,args:null,kind:"ScalarField",name:"last_name",storageKey:null},{alias:"profile_photo_uri_about_section",args:[{kind:"Literal",name:"height",value:100},{kind:"Literal",name:"width",value:100}],concreteType:"PageContactProfilePhotoURI",kind:"LinkedField",name:"profile_photo_uris",plural:!0,selections:m,storageKey:"profile_photo_uris(height:100,width:100)"},{alias:null,args:null,kind:"ScalarField",name:"address",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"city_name",storageKey:null},Xi,{alias:"phone",args:null,concreteType:"PhoneNumber",kind:"LinkedField",name:"phone_number",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"region_code",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"national_number",storageKey:null},{alias:"phoneNumber",args:null,kind:"ScalarField",name:"display_number",storageKey:null}],storageKey:null},ue,{alias:null,args:null,kind:"ScalarField",name:"zip_code",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"country_code",storageKey:null},{alias:null,args:null,concreteType:"PageContactBirthday",kind:"LinkedField",name:"birthday",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"day",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"month",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"formatted_birthday",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"suggested_email_address",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"fallback_phone_number",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"city_state",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ban_action_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_banned",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_blocked",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_wec_blocked",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_onsite_user",storageKey:null},Ii,{alias:null,args:zc,concreteType:"BizCRMContactSharedAttributesCorpLabelListConnection",kind:"LinkedField",name:"corp_label_list",plural:!1,selections:[{alias:null,args:null,concreteType:"BizCRMContactSharedAttributesCorpLabelListEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"BusinessPresenceCorporationLabel",kind:"LinkedField",name:"node",plural:!1,selections:[a,b,Qh,Rh,Ec,W,Wh,Xh,Sh,B],storageKey:null},R],storageKey:null},Z,Fc],storageKey:"corp_label_list(first:20)"},{alias:null,args:zc,filters:null,handle:"connection",key:"BizKitContextCard_corp_label_list",kind:"LinkedHandle",name:"corp_label_list"},{alias:null,args:zc,concreteType:"BizCRMContactSharedAttributesSuggestedLabelsConnection",kind:"LinkedField",name:"suggested_labels",plural:!1,selections:[{alias:null,args:null,concreteType:"BizCRMContactSharedAttributesSuggestedLabelsEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"node",plural:!1,selections:[B,a,b,Qh,{kind:"InlineFragment",selections:[xh,ng,{alias:null,args:null,kind:"ScalarField",name:"upsell",storageKey:null}],type:"BusinessPresenceDerivedLabel",abstractKey:null}],storageKey:null},R],storageKey:null},Z,Fc],storageKey:"suggested_labels(first:20)"},{alias:null,args:zc,filters:null,handle:"connection",key:"BizKitContextCard_suggested_labels",kind:"LinkedHandle",name:"suggested_labels"}],storageKey:null},{alias:null,args:null,concreteType:"BizCRMContactBusinessAttributes",kind:"LinkedField",name:"business_attributes",plural:!1,selections:[{alias:null,args:null,concreteType:"BizCRMContactCommunicationPreference",kind:"LinkedField",name:"communication_preference",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"email_subscription_status",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"BizCRMContactMessageLabelAttribute",kind:"LinkedField",name:"customer_labels",plural:!1,selections:[{alias:null,args:Gc,concreteType:"BizCRMContactMessageLabelAttributeLabelListConnection",kind:"LinkedField",name:"label_list",plural:!1,selections:[{alias:null,args:null,concreteType:"BizCRMContactMessageLabelAttributeLabelListEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"BusinessPresenceCustomLabel",kind:"LinkedField",name:"node",plural:!1,selections:[a,b,Qh,Ec,W,Rh,Sh,Hc,Ic,Kc,B],storageKey:null},R],storageKey:null},Z,Fc],storageKey:"label_list(first:400)"},{alias:null,args:Gc,filters:null,handle:"connection",key:"Contact_customer_label_list",kind:"LinkedHandle",name:"label_list"},{alias:null,args:null,concreteType:"BizCRMContactMessageLabelAttributeCustomerCustomTagsConnection",kind:"LinkedField",name:"customer_custom_tags",plural:!1,selections:[{alias:null,args:null,concreteType:"BizCRMContactMessageLabelAttributeCustomerCustomTagsEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"PageCustomTag",kind:"LinkedField",name:"node",plural:!1,selections:Uh,storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"BizCRMContactAdminNotesAttribute",kind:"LinkedField",name:"admin_notes",plural:!1,selections:[{alias:null,args:Jc,concreteType:"BizCRMContactAdminNotesAttributeNotesListConnection",kind:"LinkedField",name:"notes_list",plural:!1,selections:[{alias:null,args:null,concreteType:"BizCRMContactAdminNotesAttributeNotesListEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"PageAdminNote",kind:"LinkedField",name:"node",plural:!1,selections:[a,{alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"body",plural:!1,selections:f,storageKey:null},Mg,{alias:null,args:null,kind:"ScalarField",name:"note_label",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"action_source_type",storageKey:null},{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"underlying_admin_creator",plural:!1,selections:[B,b,a],storageKey:null},B],storageKey:null},R],storageKey:null},N,Fc],storageKey:"notes_list(first:2)"},{alias:null,args:Jc,filters:null,handle:"connection",key:"BizKitContextCard_notes_list",kind:"LinkedHandle",name:"notes_list"}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"BizCRMContactWAAttributes",kind:"LinkedField",name:"wa_attributes",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"wa_customer_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"opt_in_status",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"should_enable_ads_consent_in_ctwa",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"should_show_wa_automated_label_nux",storageKey:null},{alias:"adsDataSharingLabelsNUX",args:[{kind:"Literal",name:"mbs_ads_event_sharing_event_type",value:"LABEL_CREATION_WA"}],concreteType:"XFBMBSAdsEventSharingNux",kind:"LinkedField",name:"mbs_ads_event_sharing_eligible_nux_types",plural:!0,selections:Lc,storageKey:'mbs_ads_event_sharing_eligible_nux_types(mbs_ads_event_sharing_event_type:"LABEL_CREATION_WA")'},{alias:null,args:null,concreteType:"Page",kind:"LinkedField",name:"page",plural:!1,selections:[{alias:null,args:[{kind:"Literal",name:"gk_name",value:"ctm_custom_label_reporting_pages"}],concreteType:"EntGKCheck",kind:"LinkedField",name:"gk_check",plural:!1,selections:Oc,storageKey:'gk_check(gk_name:"ctm_custom_label_reporting_pages")'},Pc,a,{alias:null,args:null,kind:"ScalarField",name:"is_p2m_lite_payment_onboarded",storageKey:null},{alias:null,args:[{kind:"Literal",name:"tab",value:"DATA_SHARING"}],kind:"ScalarField",name:"wa_settings_uri_in_business_view",storageKey:'wa_settings_uri_in_business_view(tab:"DATA_SHARING")'}],storageKey:null},Qc,{alias:null,args:null,concreteType:"BizCRMContactBusinessActions",kind:"LinkedField",name:"business_actions",plural:!1,selections:[{alias:null,args:Tc,concreteType:"BizCRMContactBusinessActionsActionsConnection",kind:"LinkedField",name:"actions",plural:!1,selections:[{alias:null,args:null,concreteType:"BizCRMContactBusinessActionsActionsEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"node",plural:!1,selections:[B,{alias:null,args:null,concreteType:"BizCRMContactAction3DWrapper",kind:"LinkedField",name:"wrapper",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"contact_action",plural:!1,selections:[B,Mg,Jb,g,Ie,{alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"descriptions",plural:!0,selections:f,storageKey:null},lb,{alias:null,args:null,kind:"ScalarField",name:"click_url",storageKey:null},Ib,{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"invoice_id",storageKey:null},uk,Uc],type:"BizCRMContactAdAction",abstractKey:null},{kind:"InlineFragment",selections:[{alias:null,args:null,concreteType:"Story",kind:"LinkedField",name:"story",plural:!1,selections:d,storageKey:null}],type:"BizCRMContactFacebookActionWithStory",abstractKey:null},{kind:"InlineFragment",selections:[uk,W,Uc,{alias:null,args:null,kind:"ScalarField",name:"show_ad_icon",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"data_silo_auto_detected_activity",storageKey:null}],type:"BizCRMContactCustomAction",abstractKey:null},{kind:"InlineFragment",selections:[W],type:"BizCRMContactBusinessOrderAction",abstractKey:null}],storageKey:null}],storageKey:null}],storageKey:null},R],storageKey:null},N],storageKey:'actions(first:5,types:["BUSINESS_ORDER"])'},{alias:null,args:Tc,filters:["types"],handle:"connection",key:"BizKitContextCardOrders__actions",kind:"LinkedHandle",name:"actions"}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"should_show_mbs_ads_consent_upsell_in_inbox_at_thread_entry",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"should_show_mbs_ads_event_sharing_consent_at_thread_entry",storageKey:null},{alias:null,args:null,concreteType:"XFBMBSAdsEventSharingSettings",kind:"LinkedField",name:"mbs_ads_event_sharing_settings",plural:!1,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"ads_event_sharing_business_opt_in_status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ads_event_sharing_consumer_opt_in_status",storageKey:null}],storageKey:null},{alias:null,args:[{kind:"Literal",name:"mbs_ads_event_sharing_event_type",value:"DETECTED_ACTIVITY_ON_THREAD_ENTRY"}],concreteType:"XFBMBSAdsEventSharingNux",kind:"LinkedField",name:"mbs_ads_event_sharing_eligible_nux_types",plural:!0,selections:Lc,storageKey:'mbs_ads_event_sharing_eligible_nux_types(mbs_ads_event_sharing_event_type:"DETECTED_ACTIVITY_ON_THREAD_ENTRY")'},Vc,{condition:"isDependencyOfRemovePageDependencyEnabledTool",kind:"Condition",passingValue:!1,selections:[{alias:null,args:null,concreteType:"Page",kind:"LinkedField",name:"page",plural:!1,selections:[Nc],storageKey:null}]},{condition:"isDependencyOfRemovePageDependencyEnabledTool",kind:"Condition",passingValue:!0,selections:[{alias:null,args:null,concreteType:"XFBMBSBusinessAssets",kind:"LinkedField",name:"mbs_business_assets",plural:!1,selections:[Nc,a],storageKey:null}]}]},{condition:"shouldSkipMessage",kind:"Condition",passingValue:!1,selections:[{alias:null,args:null,concreteType:"BizCRMContactSharedAttributes",kind:"LinkedField",name:"shared_attributes",plural:!1,selections:[{alias:null,args:null,concreteType:"BizCRMContactProfile",kind:"LinkedField",name:"profile",plural:!1,selections:[v,{alias:null,args:jc,concreteType:"PageContactProfilePhotoURI",kind:"LinkedField",name:"profile_photo_uris",plural:!0,selections:m,storageKey:"profile_photo_uris(height:52,width:52)"}],storageKey:null},{alias:null,args:null,concreteType:"PageContactCTAType",kind:"LinkedField",name:"contact_ctas",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"cta_type",storageKey:null}],storageKey:null}],storageKey:null},Wc,{alias:null,args:null,concreteType:"BizCRMContactIGAttributes",kind:"LinkedField",name:"ig_attributes",plural:!1,selections:[gc,{alias:null,args:null,concreteType:"BizCRMContactIGUserProfileUnit",kind:"LinkedField",name:"profile_units",plural:!0,selections:[e,hc],storageKey:null}],storageKey:null}]},{condition:"shouldSkipPageQuery",kind:"Condition",passingValue:!1,selections:[{alias:null,args:null,concreteType:"Page",kind:"LinkedField",name:"page",plural:!1,selections:[a,bd,cd,{alias:null,args:Gc,concreteType:"PageCorpLabelsConnection",kind:"LinkedField",name:"corp_labels",plural:!1,selections:[{alias:null,args:null,concreteType:"PageCorpLabelsEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"BusinessPresenceCorporationLabel",kind:"LinkedField",name:"node",plural:!1,selections:[a,b,Qh,Rh,Ec,W,Wh,Xh,Sh,Yc,B],storageKey:null},R],storageKey:null},Z],storageKey:"corp_labels(first:400)"},dd,{alias:null,args:null,concreteType:"Page",kind:"LinkedField",name:"if_viewer_can_manage_permissions",plural:!1,selections:$,storageKey:null},fd,{alias:"is_in_kbank_rollout",args:gd,concreteType:"EntGKCheck",kind:"LinkedField",name:"gk_check",plural:!1,selections:hd,storageKey:'gk_check(gk_name:"mcom_kbank_integration_rollout")'},{alias:"show_payment_onboarding_context_card",args:[{kind:"Literal",name:"gk_name",value:"messenger_p2m_lite_merchant_onboarding"}],concreteType:"EntGKCheck",kind:"LinkedField",name:"gk_check",plural:!1,selections:Oc,storageKey:'gk_check(gk_name:"messenger_p2m_lite_merchant_onboarding")'}],storageKey:null},{condition:"isDependencyOfRemovePageDependencyEnabledTool",kind:"Condition",passingValue:!0,selections:[{alias:null,args:null,concreteType:"XFBMBSBusinessAssets",kind:"LinkedField",name:"mbs_business_assets",plural:!1,selections:[a,bd,cd,{alias:null,args:Gc,concreteType:"XFBMBSBusinessAssetsCorpLabelsConnection",kind:"LinkedField",name:"corp_labels",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBMBSBusinessAssetsCorpLabelsEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"BusinessPresenceCorporationLabel",kind:"LinkedField",name:"node",plural:!1,selections:[a,b,Qh,Ec,W,Rh,Wh,Xh,Sh,Yc,B],storageKey:null},R],storageKey:null},Z],storageKey:"corp_labels(first:400)"},dd,{alias:null,args:null,concreteType:"Page",kind:"LinkedField",name:"page_if_viewer_can_manage_permissions",plural:!1,selections:$,storageKey:null},fd,{alias:"is_in_kbank_rollout",args:gd,concreteType:"EntGKCheck",kind:"LinkedField",name:"gk_check_page",plural:!1,selections:hd,storageKey:'gk_check_page(gk_name:"mcom_kbank_integration_rollout")'}],storageKey:null}]}]}],storageKey:null},{alias:null,args:om,concreteType:"BizCRMContactCardConfig",kind:"LinkedField",name:"selected_biz_crm_contact_card_config",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},{condition:"should3DContextCardSections",kind:"Condition",passingValue:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"sections",storageKey:null}]},{condition:"should3DContextCardSections",kind:"Condition",passingValue:!0,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"sections_renderers",plural:!0,selections:[B,{kind:"TypeDiscriminator",abstractKey:"__isXFBBizCRMContactSectionRenderer"},{alias:null,args:null,kind:"ScalarField",name:"section_enum",storageKey:null},a,{kind:"InlineFragment",selections:[{args:null,documentName:"BizKitContextCardSection3DWrapper_sections",fragmentName:"BizKitContextCardProfileSection3DWrapper_profile",fragmentPropName:"profile",kind:"ModuleImport"}],type:"XFBBizKitContextCardProfileSectionRenderer",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"BizKitContextCardSection3DWrapper_sections",fragmentName:"BizKitContextCardAboutDetailSection3DWrapper_about",fragmentPropName:"about",kind:"ModuleImport"}],type:"XFBBizKitContextCardAboutDetailSectionRenderer",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"BizKitContextCardSection3DWrapper_sections",fragmentName:"BizKitContextCardAboutSectionFacebook3DWrapper_details",fragmentPropName:"details",kind:"ModuleImport"}],type:"XFBBizKitContextCardAboutSectionFacebookRenderer",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"BizKitContextCardSection3DWrapper_sections",fragmentName:"BizKitContextCardAboutSectionInstagram3DWrapper_details",fragmentPropName:"details",kind:"ModuleImport"}],type:"XFBBizKitContextCardAboutSectionInstagramRenderer",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"BizKitContextCardSection3DWrapper_sections",fragmentName:"BizKitContextCardNotesSection3DWrapper_notes",fragmentPropName:"notes",kind:"ModuleImport"}],type:"XFBBizKitContextCardNotesSectionRenderer",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"BizKitContextCardSection3DWrapper_sections",fragmentName:"BizKitContextCardMediaSection3DWrapper_media",fragmentPropName:"media",kind:"ModuleImport"}],type:"XFBBizKitContextCardMediaSectionRenderer",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"BizKitContextCardSection3DWrapper_sections",fragmentName:"BizKitContextCardOrdersSection3DWrapper_orders",fragmentPropName:"orders",kind:"ModuleImport"}],type:"XFBBizKitContextCardOrdersSectionRenderer",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"BizKitContextCardSection3DWrapper_sections",fragmentName:"BizKitContextCardMessageSection3DWrapper_details",fragmentPropName:"details",kind:"ModuleImport"}],type:"XFBBizKitContextCardMessageSectionRenderer",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"BizKitContextCardSection3DWrapper_sections",fragmentName:"BizKitContextLabels3DWrapper_contactLabels",fragmentPropName:"contactLabels",kind:"ModuleImport"}],type:"XFBBizKitContextCardLabelsSectionRenderer",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"BizKitContextCardSection3DWrapper_sections",fragmentName:"BizKitContextCardActivitySection3DWrapper_activities",fragmentPropName:"activities",kind:"ModuleImport"}],type:"XFBBizKitContextCardActivitySectionRenderer",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"BizKitContextCardSection3DWrapper_sections",fragmentName:"BizKitContextCardPaymentSection3DWrapper_payment",fragmentPropName:"payment",kind:"ModuleImport"}],type:"XFBBizKitMessengerOrdersContextCardSectionRenderer",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"BizKitContextCardSection3DWrapper_sections",fragmentName:"BizKitContextCardReminderSection3DWrapper_reminder",fragmentPropName:"reminder",kind:"ModuleImport"}],type:"XFBBizKitContextCardReminderRenderer",abstractKey:null}],storageKey:null}]}],storageKey:null}]}],storageKey:null},nm],storageKey:null},sm,{condition:"shouldUnifyContextCardQueries",kind:"Condition",passingValue:!0,selections:[{alias:null,args:Ha,concreteType:"XFBBizInboxUnifiedThreadList",kind:"LinkedField",name:"xfb_biz_inbox_unified_thread_list",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBBizInboxSelectedThread",kind:"LinkedField",name:"selected_thread",plural:!1,selections:[{alias:null,args:om,concreteType:"BizCRMContact",kind:"LinkedField",name:"selected_biz_crm_contact",plural:!1,selections:[{alias:null,args:null,concreteType:"BizCRMContactAllActions",kind:"LinkedField",name:"all_actions",plural:!1,selections:[{alias:null,args:Jc,concreteType:"BizCRMContactAllActionsActionsConnection",kind:"LinkedField",name:"actions",plural:!1,selections:[{alias:null,args:null,concreteType:"BizCRMContactAllActionsActionsEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"node",plural:!1,selections:[B,{alias:"codeSplitWrapper",args:null,concreteType:"BizCRMContactAction3DWrapper",kind:"LinkedField",name:"wrapper",plural:!1,selections:[{args:null,documentName:"BizKitContextCardActivityListItem3DWrapper_BizCRMContactAction3DWrapper",fragmentName:"BizKitContextCardActivityListItem_node",fragmentPropName:"node",kind:"ModuleImport"}],storageKey:null}],storageKey:null},R],storageKey:null},N,Fc],storageKey:"actions(first:2)"},{alias:null,args:Jc,filters:null,handle:"connection",key:"BizKitContextCardActivityList_actions",kind:"LinkedHandle",name:"actions"},{alias:"interaction_count",args:null,concreteType:"BizCRMContactAllActionsActionsConnection",kind:"LinkedField",name:"actions",plural:!1,selections:vi,storageKey:null}],storageKey:null},a,Qc,Wc,{alias:null,args:null,concreteType:"BizCRMContactSharedAttributes",kind:"LinkedField",name:"shared_attributes",plural:!1,selections:[Kb],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"should_show_automated_activity_nux",storageKey:null},Vc,{alias:"adsDataSharingActivityNUX",args:[{kind:"Literal",name:"mbs_ads_event_sharing_event_type",value:"ACTIVITY"}],concreteType:"XFBMBSAdsEventSharingNux",kind:"LinkedField",name:"mbs_ads_event_sharing_eligible_nux_types",plural:!0,selections:Lc,storageKey:'mbs_ads_event_sharing_eligible_nux_types(mbs_ads_event_sharing_event_type:"ACTIVITY")'},{alias:null,args:null,concreteType:"Page",kind:"LinkedField",name:"page",plural:!1,selections:[Pc,a,{alias:"two_step_do_nux_tour_gk",args:[{kind:"Literal",name:"gk_name",value:"two_step_do_nux_tour"}],concreteType:"EntGKCheck",kind:"LinkedField",name:"gk_check",plural:!1,selections:Oc,storageKey:'gk_check(gk_name:"two_step_do_nux_tour")'}],storageKey:null},{alias:"adsDataSharingDetectedActivityNUX",args:[{kind:"Literal",name:"mbs_ads_event_sharing_event_type",value:"DETECTED_ACTIVITY"}],concreteType:"XFBMBSAdsEventSharingNux",kind:"LinkedField",name:"mbs_ads_event_sharing_eligible_nux_types",plural:!0,selections:Lc,storageKey:'mbs_ads_event_sharing_eligible_nux_types(mbs_ads_event_sharing_event_type:"DETECTED_ACTIVITY")'}],storageKey:null},tm],storageKey:null},{condition:"isDependencyOfRemovePageDependencyEnabledTool",kind:"Condition",passingValue:!1,selections:[{alias:null,args:om,concreteType:"Page",kind:"LinkedField",name:"selected_page",plural:!1,selections:[{alias:"ctm_www_tas_order_integration_gk",args:id,concreteType:"EntGKCheck",kind:"LinkedField",name:"gk_check",plural:!1,selections:jd,storageKey:'gk_check(gk_name:"ctm_www_tas_order_integration_gk")'},{alias:"translationFix",args:[{kind:"Literal",name:"qe_universe",value:"tas_bizweb_translation_fix_universe"}],concreteType:"QECheck",kind:"LinkedField",name:"qe_check",plural:!1,selections:[{alias:"is_enabled",args:[{kind:"Literal",name:"bool_default",value:!1},{kind:"Literal",name:"param_name",value:"has_string_translation"}],kind:"ScalarField",name:"bool",storageKey:'bool(bool_default:false,param_name:"has_string_translation")'}],storageKey:'qe_check(qe_universe:"tas_bizweb_translation_fix_universe")'},{alias:"timelineActionsCheck",args:ld,concreteType:"EntGKCheck",kind:"LinkedField",name:"gk_check",plural:!1,selections:md,storageKey:'gk_check(gk_name:"ctm_www_tas_timeline_actions_gk")'},a],storageKey:null}]}],storageKey:null},{condition:"isDependencyOfRemovePageDependencyEnabledTool",kind:"Condition",passingValue:!0,selections:[{alias:null,args:rm,concreteType:"XFBMBSBusinessAssets",kind:"LinkedField",name:"xfb_mbs_business_assets",plural:!1,selections:[{alias:"ctm_www_tas_order_integration_gk",args:id,concreteType:"EntGKCheck",kind:"LinkedField",name:"gk_check_page",plural:!1,selections:jd,storageKey:'gk_check_page(gk_name:"ctm_www_tas_order_integration_gk")'},{alias:"timelineActionsCheck",args:ld,concreteType:"EntGKCheck",kind:"LinkedField",name:"gk_check_page",plural:!1,selections:md,storageKey:'gk_check_page(gk_name:"ctm_www_tas_timeline_actions_gk")'},a],storageKey:null}]}]}]},params:{id:"24650762084528964",metadata:{},name:"BizInboxUnifiedThreadsQuery",operationKind:"query",text:null}}}();ba("relay-runtime").PreloadableQueryRegistry.set(aa.params.id,aa);ea.exports=aa}),null);/*FB_PKG_DELIM*/
__d("ArmadilloCutoverClientFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("699");b=d("FalcoLoggerInternal").create("armadillo_cutover_client",a);e=b;g["default"]=e}),98);
__d("CometFriendNotificationsStateChangeSubscription_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="9754477301332178"}),null);
__d("CometFriendNotificationsStateChangeSubscription.graphql",["CometFriendNotificationsStateChangeSubscription_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={defaultValue:null,kind:"LocalArgument",name:"environment"},c={defaultValue:null,kind:"LocalArgument",name:"input"},d=[{alias:null,args:[{kind:"Variable",name:"data",variableName:"input"}],concreteType:"NotificationStateChangeSubscribeResponsePayload",kind:"LinkedField",name:"notification_state_change_subscribe",plural:!1,selections:[{alias:null,args:null,concreteType:"Notification",kind:"LinkedField",name:"notification",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"seen_state",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"notif_id",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:[{kind:"Variable",name:"environment",variableName:"environment"}],kind:"ScalarField",name:"notifications_unseen_count",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_update_timestamp",storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[a,c],kind:"Fragment",metadata:null,name:"CometFriendNotificationsStateChangeSubscription",selections:d,type:"Subscription",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[c,a],kind:"Operation",name:"CometFriendNotificationsStateChangeSubscription",selections:d},params:{id:b("CometFriendNotificationsStateChangeSubscription_facebookRelayOperation"),metadata:{subscriptionName:"notification_state_change_subscribe"},name:"CometFriendNotificationsStateChangeSubscription",operationKind:"subscription",text:null}}}();e.exports=a}),null);
__d("FriendingCometSubscriptionToastHelper",["react","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react"),j=c("requireDeferred")("FriendingCometConfirmedFriendRequestToast.react").__setRef("FriendingCometSubscriptionToastHelper"),k=c("requireDeferred")("FriendingCometFriendRequestToast.react").__setRef("FriendingCometSubscriptionToastHelper"),l=new Set(),m={};function a(a,b){var c,d,e=a==null?void 0:a.friend_request_receive_subscribe,f=e==null||(c=e.notif)==null?void 0:c.seen_state,g=e==null||(d=e.notif)==null?void 0:d.notif_id;f==="UNSEEN_AND_UNREAD"&&g!=null&&(l.add(g),k.onReadyImmediately(function(c){if(!l.has(g))return;l["delete"](g);var d=b.push(i.jsx(c,{onCloseClick:function(){return b.expire(d)},response:a}),5e3);m[g]=d}))}function b(a,b){var c,d,e=a==null?void 0:a.friend_request_confirm_subscribe,f=e==null||(c=e.notif)==null?void 0:c.seen_state,g=e==null||(d=e.notif)==null?void 0:d.notif_id;f==="UNSEEN_AND_UNREAD"&&g!=null&&(l.add(g),j.onReadyImmediately(function(c){if(!l.has(g))return;l["delete"](g);var d=b.push(i.jsx(c,{onCloseClick:function(){return b.expire(d)},response:a}),5e3);m[g]=d}))}function e(a,b,c){var d=c.getState();a!=="UNSEEN_AND_UNREAD"&&b in m&&((a=d[m[b]])==null?void 0:a.shown)!==!0&&(c["delete"](m[b]),delete m[b],l["delete"](b))}g.pushFriendingCometToast=a;g.pushFriendingConfirmedCometToast=b;g.deleteToastIfSeen=e}),98);
__d("CometFriendNotificationsStateChangeSubscription",["CometFriendNotificationsStateChangeSubscription.graphql","CometRelay","FriendingCometSubscriptionToastHelper"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h!==void 0?h:h=b("CometFriendNotificationsStateChangeSubscription.graphql");function a(a,b){var c=function(a){var c;a=a==null||(c=a.notification_state_change_subscribe)==null?void 0:c.notification;var e=a==null?void 0:a.seen_state;a=a==null?void 0:a.notif_id;e!=null&&a!=null&&d("FriendingCometSubscriptionToastHelper").deleteToastIfSeen(e,a,b)};return d("CometRelay").requestSubscription(a,{onNext:c,subscription:i,variables:{environment:"FRIENDS_TAB",input:{environment:"FRIENDS_TAB"}}})}g.subscription=i;g.subscribeToFriendNotifs=a}),98);
__d("DedupMiThreadCreationCache",["justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h=new Set();a=function(a){var b=c("justknobx")._("4749");b&&h.add(a)};g.DedupMiThreadCreationCache=h;g.addToDedupMiThreadCreationCache=a}),98);
__d("EBSMMainthreadAPI",["EBDeps","EBGating","EBSMWorkerThreadAPI","MAWBridgeSendAndReceive","MWEncryptedBackupsFirstRestoreUpsellTime","Promise","QPLFlow","WebSession","gkx","justknobx","qpl","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("EBAddDeviceWithRecoveryCode").__setRef("EBSMMainthreadAPI"),j=c("requireDeferred")("EBFetchBackupIds").__setRef("EBSMMainthreadAPI"),k=c("requireDeferred")("EBOtcAddDevice").__setRef("EBSMMainthreadAPI");a=babelHelpers["extends"]({},c("EBSMWorkerThreadAPI"),{addDeviceWithRecoveryCode:function(){for(var a=arguments.length,e=new Array(a),g=0;g<a;g++)e[g]=arguments[g];if(e.length===0||e[0]==null)return(h||(h=b("Promise"))).reject("Missing args");var j=d("QPLFlow").startQPLFlow(c("qpl")._(521473756,"2768"),{annotations:{bool:{isBackendSetupOnStart:d("EBDeps").getDeps().isBackendSetupSuccessful(),isEBAddDeviceWithKeys:!1}},timeoutInMs:c("justknobx")._("2444")});if(c("gkx")("17731")&&e.length>0&&e[0]!=null)return d("MAWBridgeSendAndReceive").sendAndReceive("ebsmapi","addDeviceWithRecoveryCodeInWorker",{qplInstanceKeyMainthread:j.getQPLAttrs().instanceKey,recoveryCode:e[0].recoveryCode,userId:e[0].userId});else return i.load().then(function(a){return a.addDeviceWithRecoveryCode(babelHelpers["extends"]({},e[0],{qplFlow:j}))})},fetchBackupIds:function(a,b){var e=d("QPLFlow").startQPLFlow(c("qpl")._(521471024,"2275"),{annotations:{string:{ebSessionIdentifier:d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime(),fetchBackupIdsVersion:"msys",sessionTabId:d("WebSession").getId(),source:a}}});e.addPoint("eb_fetch_backup_ids_start");if(d("EBGating").isFetchBackupIdsFromWorker()){e.addPoint("eb_fetch_backup_ids_bridge_call_start");return d("MAWBridgeSendAndReceive").sendAndReceive("ebsmapi","fetchBackupIdsInWorker",{qplInstanceKeyMainthread:e.getQPLAttrs().instanceKey,source:a})}else return j.load().then(function(b){return b.fetchBackupIds(a,e)})},otcAddDevice:function(){for(var a=arguments.length,b=new Array(a),e=0;e<a;e++)b[e]=arguments[e];var g=d("QPLFlow").startQPLFlow(c("qpl")._(521473756,"2768"),{annotations:{bool:{isBackendSetupOnStart:d("EBDeps").getDeps().isBackendSetupSuccessful(),isEBAddDeviceWithKeys:!1,isInWorker:!1,isOtc:!0}},timeoutInMs:c("justknobx")._("2444")});if(c("gkx")("17731")&&b.length>0&&b[0]!=null)return d("MAWBridgeSendAndReceive").sendAndReceive("ebsmapi","addDeviceWithOtcInWorker",{initiatorId:b[0].initiatorId,qplInstanceKeyMainthread:g.getQPLAttrs().instanceKey,secrets:b[0].secrets});else return k.load().then(function(a){return a.otcAddDevice(babelHelpers["extends"]({},b[0],{qplFlow:g}))})}});e=a;g["default"]=e}),98);
__d("EncryptedBackupdDYIFileSaver",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("file-saver").__setRef("EncryptedBackupdDYIFileSaver");function a(a,b){h.onReadyImmediately(function(c){c=c.saveAs;c(b,a)})}g.saveFile=a}),98);
__d("FDSMinusCircleOutline20Icon",["cr:15284"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=b("cr:15284")}),98);
__d("FriendingCometConfirmedFriendRequestToast.react",["fbt","CometNotificationsListItem.react","CometNotificationsMutationLogger","CometNotificationsUpdateSeenStateMutation","CometRelay","CometToastCard.react","FBLogger","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react"));b=i;b.useCallback;var k=b.useRef,l="MARK_SEEN",m="comet_toast",n="beeper";function a(a){var b,e,f=d("react-compiler-runtime").c(18),g=a.onCloseClick;a=a.response;a=a==null?void 0:a.friend_request_confirm_subscribe;var i=a==null?void 0:a.notif,p=i==null?void 0:i.id,q=i==null?void 0:i.seen_state,r=a==null?void 0:a.new_friend;a=a==null||(b=a.viewer)==null?void 0:b.actor;var s=i==null||(e=i.body)==null?void 0:e.text,t=k(!1),u=d("CometRelay").useRelayEnvironment(),v;f[0]!==u||f[1]!==p||f[2]!==q?(v=function(){if(p==null||q!=="UNSEEN_AND_UNREAD"||t.current===!0)return;d("CometNotificationsUpdateSeenStateMutation").CometNotificationsUpdateSeenStateMutation(u,{environment:"FRIENDS_TAB",input:{environment:"FRIENDS_TAB",is_comet:!0,last_notif_sync_time:0,notif_ids:[p],source:m,update_type:l}},{mutationLogger:d("CometNotificationsMutationLogger").notificationMarkAsSeenStart,onError:o,onSuccess:function(){t.current=!0},updater:function(a){d("CometNotificationsUpdateSeenStateMutation").updateSingleNotifReadState(a,p)}})},f[0]=u,f[1]=p,f[2]=q,f[3]=v):v=f[3];v=v;if(r==null||i==null)return null;f[4]!==p||f[5]!==s?(r=p==null||s==null?null:{id:p,text:s},f[4]=p,f[5]=s,f[6]=r):r=f[6];s=r;f[7]!==a||f[8]!==i||f[9]!==g?(r=j.jsx("div",{role:"grid",children:j.jsx(c("CometNotificationsListItem.react"),{actor:a,loggerContext:n,notification:i,onClick:g})}),f[7]=a,f[8]=i,f[9]=g,f[10]=r):r=f[10];f[11]===Symbol["for"]("react.memo_cache_sentinel")?(a=h._(/*BTDS*/"New notification"),f[11]=a):a=f[11];f[12]!==s||f[13]!==v||f[14]!==g||f[15]!==r||f[16]!==a?(i=j.jsx(c("CometToastCard.react"),{accessibilityAnnouncement:s,content:r,headline:a,onCloseClick:g,onMouseEnter:v}),f[12]=s,f[13]=v,f[14]=g,f[15]=r,f[16]=a,f[17]=i):i=f[17];return i}function o(a){c("FBLogger")("growth_friending").catching(a).mustfix("Failed to mark friend confirmed notification as seen in the toast")}g["default"]=a}),226);
__d("FriendingCometFriendRequestToast.react",["fbt","CometNotificationsListItem.react","CometNotificationsMutationLogger","CometNotificationsUpdateSeenStateMutation","CometRelay","CometToastCard.react","react","react-compiler-runtime","recoverableViolation"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react"));b=i;b.useCallback;var k=b.useRef,l="MARK_SEEN",m="comet_toast",n="beeper";function a(a){var b,e,f=d("react-compiler-runtime").c(18),g=a.onCloseClick;a=a.response;a=a==null?void 0:a.friend_request_receive_subscribe;var i=a==null?void 0:a.notif,p=i==null?void 0:i.id,q=i==null?void 0:i.seen_state;a=a==null||(b=a.viewer)==null?void 0:b.actor;var r=i==null||(e=i.body)==null?void 0:e.text,s=k(!1),t=d("CometRelay").useRelayEnvironment(),u;f[0]!==t||f[1]!==p||f[2]!==q?(u=function(){if(p==null||q!=="UNSEEN_AND_UNREAD"||s.current===!0)return;d("CometNotificationsUpdateSeenStateMutation").CometNotificationsUpdateSeenStateMutation(t,{environment:"FRIENDS_TAB",input:{environment:"FRIENDS_TAB",is_comet:!0,last_notif_sync_time:0,notif_ids:[p],source:m,update_type:l}},{mutationLogger:d("CometNotificationsMutationLogger").notificationMarkAsSeenStart,onError:o,onSuccess:function(){s.current=!0},updater:function(a){d("CometNotificationsUpdateSeenStateMutation").updateSingleNotifSeenState(a,p),d("CometNotificationsUpdateSeenStateMutation").lowerBadgeCountByOne(a)}})},f[0]=t,f[1]=p,f[2]=q,f[3]=u):u=f[3];u=u;if(i==null)return null;var v;f[4]!==p||f[5]!==r?(v=p==null||r==null?null:{id:p,text:r},f[4]=p,f[5]=r,f[6]=v):v=f[6];r=v;f[7]!==a||f[8]!==i||f[9]!==g?(v=j.jsx("div",{role:"grid",children:j.jsx(c("CometNotificationsListItem.react"),{actor:a,loggerContext:n,notification:i,onClick:g})}),f[7]=a,f[8]=i,f[9]=g,f[10]=v):v=f[10];f[11]===Symbol["for"]("react.memo_cache_sentinel")?(a=h._(/*BTDS*/"New notification"),f[11]=a):a=f[11];f[12]!==r||f[13]!==u||f[14]!==g||f[15]!==v||f[16]!==a?(i=j.jsx(c("CometToastCard.react"),{accessibilityAnnouncement:r,content:v,headline:a,onCloseClick:g,onMouseEnter:u}),f[12]=r,f[13]=u,f[14]=g,f[15]=v,f[16]=a,f[17]=i):i=f[17];return i}function o(a){c("recoverableViolation")("Failed to mark friend notification as seen in the toast: ","growth_friending",{error:a})}g["default"]=a}),226);
__d("LSBumpE2EEMetadataThread",["LSCancelTaskByQueueName","LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=new c.Map(),d[0].set("bump_timestamp_ms",a[1]),d[0].set("thread_key",a[0]),d[0].set("bumped_by_local_device_send",a[2]),d[0].set("tam_thread_subtype",c.i64.cast([0,0])),d[0].set("wa_jid",void 0),d[0].set("message_ephemeral_duration_in_sec",c.i64.cast([0,0])),d[0].set("message_product_type",void 0),d[0].set("is_message_deletion",!1),d[0].set("is_unbump",a[3]),d[1]=d[0].get("thread_key"),c.storedProcedure(b("LSCancelTaskByQueueName"),c.i64.to_string(d[1]),c.i64.cast([0,389]))},function(e){return d[2]=new c.Map(),d[2].set("bump_timestamp_ms",a[1]),d[2].set("thread_key",a[0]),d[2].set("bumped_by_local_device_send",a[2]),d[2].set("tam_thread_subtype",c.i64.cast([0,0])),d[2].set("wa_jid",void 0),d[2].set("message_ephemeral_duration_in_sec",c.i64.cast([0,0])),d[2].set("message_product_type",void 0),d[2].set("is_message_deletion",!1),d[2].set("is_unbump",a[3]),d[3]=d[2].get("thread_key"),d[4]=c.toJSON(d[2]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[3]),c.i64.cast([0,389]),d[4],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxBumpE2EEMetadataThreadStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSBumpE2EEMetadataThreadStoredProcedure",["LSBumpE2EEMetadataThread","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSBumpE2EEMetadataThread"),e.threadKey,e.serverAuthoritativeTimestampMs,e.bumpedByLocalDeviceSend,e.isUnbump);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSCreateE2EEMetadataThread",["LSArrayGetObjectAt","LSBase64Encode.nop","LSIsEncryptionVersionSecure","LSIssueNewTask","LSLogMebClientEvent.nop","LSQplAnnotateString.nop","LSQplMarkPoint.nop","LSQplStartTrace.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][createE2EEMetadataThread] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[19]=new c.Map(),d[19].set("error_msg","Expected a nonempty query result"),d[19].set("code",c.i64.cast([0,3])),d[19].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[20]=c.createArray(),d[21]=(d[20].push(d[19]),d[20]),e=[void 0,d[20]],d[2]=e[0],d[3]=e[1]):(b=a.item,d[19]=new c.Map(),d[19].set("backup_id",b.backupId),d[19].set("device_public_key_blob",b.devicePublicKeyBlob),d[19].set("device_private_key_blob",b.devicePrivateKeyBlob),d[19].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[19].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[19].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[19].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[19].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[19].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[19].set("orf_client_state_v2_blob",void 0),d[19].set("orf_v2_authority_level",void 0),d[19].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[19].set("device_id",b.deviceId),d[19].set("backup_tenancy",b.backupTenancy),d[19].set("encryption_version",b.encryptionVersion),d[19].set("revision_version",b.revisionVersion),d[19].set("initialize_restore_result",void 0),d[19].set("device_creation_timestamp_sec",void 0),d[19].set("authority_level",b.authorityLevel),e=[d[19],void 0],d[2]=e[0],d[3]=e[1])})},function(a){return d[5]=new c.Map(),d[5].set("value",d[2]),d[5].set("errors",d[3]),d[6]=d[5].get("value"),d[6]!==void 0?c.sequence([function(a){return d[19]=d[6].get("backup_id"),d[20]=d[6].get("device_public_key_blob"),d[21]=d[6].get("device_private_key_blob"),d[22]=d[6].get("epoch_storage_public_key_blob"),d[23]=d[6].get("epoch_storage_private_key_blob"),d[24]=d[6].get("epoch_auth_public_key_blob"),d[25]=d[6].get("epoch_auth_private_key_blob"),d[26]=d[6].get("mailbox_root_key_blob"),d[27]=d[6].get("ocmf_client_state_blob"),d[28]=d[6].get("orf_client_state_v2_blob"),d[29]=d[6].get("orf_v2_authority_level"),d[30]=d[6].get("oblivious_validation_token_blob"),d[31]=d[6].get("device_id"),d[32]=d[6].get("backup_tenancy"),d[33]=d[6].get("encryption_version"),d[34]=d[6].get("revision_version"),d[35]=d[6].get("initialize_restore_result"),d[36]=d[6].get("device_creation_timestamp_sec"),d[37]=d[6].get("authority_level"),c.i64.neq(d[31],void 0)?c.sequence([function(a){return d[39]=void 0,c.i64.neq(d[39],void 0)?c.resolve(d[40]=d[39]):c.sequence([function(a){return d[52]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[53]=a[0],a})},function(a){return d[53]?d[62]=(d[52].push(c.i64.cast([0,0])),d[52]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[54]=a[0],a})},function(a){return d[54]?d[62]=(d[52].push(c.i64.cast([0,2])),d[52]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[55]=a[0],a})},function(a){return d[55]?d[62]=(d[52].push(c.i64.cast([0,3])),d[52]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[56]=a[0],a})},function(a){return d[56]?d[62]=(d[52].push(c.i64.cast([0,4])),d[52]):0,d[57]=c.createArray(),d[58]=c.i64.of_int32(d[52].length),c.i64.gt(d[58],c.i64.cast([0,0]))?c.loopAsync(d[58],function(a){return d[62]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[52],d[62]).then(function(a){return a=a,d[63]=a[0],d[64]=a[1],a})},function(a){return d[65]=(d[57].push(d[63]),d[57])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[62]=c.createArray(),d[63]=c.i64.of_int32(d[57].length),c.i64.gt(d[63],c.i64.cast([0,0]))?c.loopAsync(d[63],function(a){return d[65]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[57],d[65]).then(function(a){return a=a,d[66]=a[0],d[67]=a[1],a})},function(a){return d[68]=(d[62].push(c.i64.to_string(d[66])),d[62])}])}):c.resolve()},function(a){return d[64]=d[62].join(","),d[59]=d[64]}])},function(a){return d[57].some(function(a){return c.i64.eq(d[33],a)})?d[60]=d[33]:d[60]=void 0,c.i64.neq(d[60],void 0)?d[61]=d[60]:d[61]=void 0,d[40]=d[61]}])},function(a){return c.i64.neq(d[40],void 0)?d[41]=d[40]:d[41]=c.i64.cast([0,0]),c.i64.neq(d[32],void 0)?d[42]=d[32]:d[42]=c.i64.cast([0,1]),c.nativeOperation(b("LSBase64Encode.nop"),d[27]).then(function(a){return a=a,d[43]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[26]).then(function(a){return a=a,d[44]=a[0],a})},function(a){return d[45]=new c.Map(),d[45].set("ocmf_client_state_blob",d[43]==null?"":d[43]),d[45].set("mailbox_root_key",d[44]==null?"":d[44]),d[46]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[52]=(d[46].push(a.epochId),d[46])})},function(a){return d[50]="Queried locally available epochs. Count: ",d[47]=c.i64.of_int32(d[46].length),d[51]=c.i64.to_string(d[47]),d[48]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[48],d[50],d[48],d[51]].join("")),c.resolve()},function(a){return d[49]=new c.Map(),d[49].set("device_id",d[31]),d[49].set("raw_tokens",d[45]),d[49].set("locally_available_epochs",d[46]),d[38]=d[49]}]):c.resolve(d[38]=void 0)},function(a){return d[7]=d[38]}]):c.resolve((d[19]=d[5].get("errors"),d[20]=d[5].get("errors"),d[7]=void 0))},function(a){return d[8]=c.i64.random(),d[9]=void 0==null?c.i64.to_string(d[8]):void 0,d[9]!==void 0?c.nativeOperation(b("LSQplStartTrace.nop"),c.i64.cast([0,679677570]),d[9],!0,void 0):c.resolve()},function(a){return d[9]!==void 0?c.nativeOperation(b("LSQplMarkPoint.nop"),c.i64.cast([0,679677570]),d[9],"issue_task"):c.resolve()},function(a){return d[9]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,679677570]),d[9],"request_type","THREAD_POINT_QUERY"):c.resolve()},function(e){return d[10]=new c.Map(),d[10].set("wa_jid",a[0]),d[10].set("offline_thread_key",a[1]),d[10].set("thread_type",a[2]),d[10].set("folder_type",a[3]),d[10].set("bump_timestamp_ms",a[4]),d[10].set("tam_thread_subtype",c.i64.cast([0,0])),d[10].set("created_by_local_device",a[5]),d[10].set("device_context",d[7]),d[10].set("qpl_instance_key",d[9]),d[10].set("should_run_privacy_and_folder_checks",!1),d[10].set("should_only_create_server_thread",!1),d[11]=d[10].get("offline_thread_key"),d[12]=c.toJSON(d[10]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[11]),c.i64.cast([0,388]),d[12],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return d[13]=c.i64.of_float(Date.now()),d[14]=c.i64.random(),d[16]="Finishing execution. Execution time: ",d[17]=c.i64.to_string(c.i64.sub(d[13],d[0])),d[18]=" ms",d[15]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][createE2EEMetadataThread] ",d[15],d[16],d[15],d[17],d[15],d[18]].join("")),c.i64.eq(c.i64.mod_(d[14],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[19]=",",d[20]=c.createArray(),void 0!==void 0?d[21]=(d[20].push(void 0),d[20]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"createE2EEMetadataThread",[d[16],d[19],d[17],d[19],d[18]].join(""),d[20],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxCreateE2EEMetadataThreadStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSCreateE2EEMetadataThreadStoredProcedure",["LSCreateE2EEMetadataThread","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSCreateE2EEMetadataThread"),e.waJid,e.offlineThreadKey,e.threadType,e.folderType,e.bumpTimestampMs,e.createdByLocalDevice);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSCreateOfflineThreadingIDStoredProcedure",["LSCreateOfflineThreadingID","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSCreateOfflineThreadingID"),e.timestampMs);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSEncryptedBackupsOnboardingDecision",[],(function(a,b,c,d,e,f){a=Object.freeze({FAILURE:-1,NO_DECISION_MADE:0,BACKUP_CREATED:1,STORE_ON_DEVICE_ONLY:2});f["default"]=a}),66);
__d("LSEncryptedBackupsVirtualDeviceType",[],(function(a,b,c,d,e,f){a=Object.freeze({OFFLINE:1,HSM:2,BLOCK_STORE:3,KEYCHAIN:5,ICLOUD_KVS:6,GOOGLE_DRIVE:7,CLOUDKIT:8,ICLOUD_DRIVE:9,PASSKEY:10,ICLOUD_KEYCHAIN:11,GOOGLE_ONE_AUTO_BACKUP:12,SECURITY_QUESTION_HSM:13,TRUSTED_CONTACT:14,META_OWNED:15,AUTOMATIC_EB:16});f["default"]=a}),66);
__d("LSIssueAttachmentBackupTask",["LSArrayGetObjectAt","LSBase64Encode.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSIssueNewTask","LSLogMebClientEvent.nop","LSOcmfClientMap.nop","LSQplAnnotateString.nop","LSQplMarkEnd.nop","LSQplMarkPoint.nop","LSQplStartTrace.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure] Beginning execution."),a[5]!==void 0?c.resolve(d[1]=a[5]):c.sequence([function(a){return d[27]=c.i64.random(),d[28]=c.i64.to_string(d[27]),d[28]!==void 0?c.nativeOperation(b("LSQplStartTrace.nop"),c.i64.cast([0,637738637]),d[28],!0,void 0):c.resolve()},function(a){return d[1]=d[28]}])},function(a){return d[1]!==void 0?c.nativeOperation(b("LSQplMarkPoint.nop"),c.i64.cast([0,637738637]),d[1],"LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure_start"):c.resolve()},function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,e){var f=a.done;a=a.value;return f?(f=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,20]),void 0,void 0],d[2]=f[0],d[3]=f[1],d[4]=f[2],d[5]=f[3],d[6]=f[4],d[7]=f[5],d[8]=f[6],d[9]=f[7],d[10]=f[8],d[11]=f[9],d[12]=f[10],d[13]=f[11],d[14]=f[12],d[15]=f[13],d[16]=f[14],d[17]=f[15],d[18]=f[16],d[19]=f[17],f):(e=a.item,c.sequence([function(a){return d[32]=e.backupTenancy,d[31]=e.encryptionVersion,d[27]=void 0,c.i64.neq(d[27],void 0)?c.resolve(d[28]=d[27]):c.sequence([function(a){return d[33]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[34]=a[0],a})},function(a){return d[34]?d[43]=(d[33].push(c.i64.cast([0,0])),d[33]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[35]=a[0],a})},function(a){return d[35]?d[43]=(d[33].push(c.i64.cast([0,2])),d[33]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[36]=a[0],a})},function(a){return d[36]?d[43]=(d[33].push(c.i64.cast([0,3])),d[33]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[37]=a[0],a})},function(a){return d[37]?d[43]=(d[33].push(c.i64.cast([0,4])),d[33]):0,d[38]=c.createArray(),d[39]=c.i64.of_int32(d[33].length),c.i64.gt(d[39],c.i64.cast([0,0]))?c.loopAsync(d[39],function(a){return d[43]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[33],d[43]).then(function(a){return a=a,d[44]=a[0],d[45]=a[1],a})},function(a){return d[46]=(d[38].push(d[44]),d[38])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[43]=c.createArray(),d[44]=c.i64.of_int32(d[38].length),c.i64.gt(d[44],c.i64.cast([0,0]))?c.loopAsync(d[44],function(a){return d[46]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[38],d[46]).then(function(a){return a=a,d[47]=a[0],d[48]=a[1],a})},function(a){return d[49]=(d[43].push(c.i64.to_string(d[47])),d[43])}])}):c.resolve()},function(a){return d[45]=d[43].join(","),d[40]=d[45]}])},function(a){return d[38].some(function(a){return c.i64.eq(d[31],a)})?d[41]=d[31]:d[41]=void 0,c.i64.neq(d[41],void 0)?d[42]=d[41]:d[42]=void 0,d[28]=d[42]}])},function(a){return c.i64.neq(d[28],void 0)?d[29]=d[28]:d[29]=c.i64.cast([0,0]),c.i64.neq(d[32],void 0)?d[30]=d[32]:d[30]=c.i64.cast([0,1]),a=[e.backupId,e.deviceId,e.mailboxRootKeyBlob,e.ocmfClientStateBlob,void 0,void 0,d[29],d[30],e.epochAuthPublicKeyBlob,e.epochAuthPrivateKeyBlob,e.devicePublicKeyBlob,e.devicePrivateKeyBlob,e.epochStoragePublicKeyBlob,e.epochStoragePrivateKeyBlob,e.obliviousValidationTokenBlob,e.authorityLevel,void 0,void 0],d[2]=a[0],d[3]=a[1],d[4]=a[2],d[5]=a[3],d[6]=a[4],d[7]=a[5],d[8]=a[6],d[9]=a[7],d[10]=a[8],d[11]=a[9],d[12]=a[10],d[13]=a[11],d[14]=a[12],d[15]=a[13],d[16]=a[14],d[17]=a[15],d[18]=a[16],d[19]=a[17]}]))})},function(e){return c.blobs.neq(d[5],void 0)?c.i64.neq(d[3],void 0)?(d[27]=c.i64.to_string(d[2]),d[27]!==void 0?c.sequence([function(e){return d[28]=c.createArray(),d[63]=(d[28].push(d[27]),d[28]),d[63]=(d[28].push(a[0]),d[28]),d[29]=c.toJSON(d[28]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[29]).then(function(a){return a=a,d[30]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF9rZXlfc2NvcGU="),d[30]).then(function(a){return a=a,d[31]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[31]).then(function(a){return a=a,d[32]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[32]).then(function(a){return a=a,d[33]=a[0],a})},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),d[27]).then(function(a){return a=a,d[34]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWFpbGJveF9pZF9zY29wZQ=="),d[34]).then(function(a){return a=a,d[35]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[35]).then(function(a){return a=a,d[36]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[36]).then(function(a){return a=a,d[37]=a[0],a})},function(e){return d[38]=new c.Map(),d[38].set("attachment_index_key",d[33]==null?"":d[33]),d[38].set("delivery_object_id",a[0]),d[38].set("device_id",d[3]),d[38].set("mailbox_partial_id",d[37]==null?"":d[37]),d[38].set("media_type",a[2]),d[38].set("product_type",a[1]),d[38].set("trace_id",d[1]),d[39]=new c.Map(),d[39].set("otid",a[3]),d[39].set("server_thread_key",a[6]),d[39].set("timestamp",void 0),c.nativeOperation(b("LSGetBlobFromString.nop"),a[3]).then(function(a){return a=a,d[40]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),d[40]).then(function(a){return a=a,d[41]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[41]).then(function(a){return a=a,d[42]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[42]).then(function(a){return a=a,d[43]=a[0],a})},function(e){return d[38].set("salt_partial_id",d[43]==null?"":d[43]),c.nativeOperation(b("LSGetBlobFromString.nop"),a[4]).then(function(a){return a=a,d[44]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("dGhyZWFkX2lkX3Njb3Bl"),d[44]).then(function(a){return a=a,d[45]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[45]).then(function(a){return a=a,d[46]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[46]).then(function(a){return a=a,d[47]=a[0],a})},function(e){return d[38].set("thread_partial_id",d[47]==null?"":d[47]),c.nativeOperation(b("LSGetBlobFromString.nop"),a[3]).then(function(a){return a=a,d[48]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWVzc2FnZV9pZF9zY29wZQ=="),d[48]).then(function(a){return a=a,d[49]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[49]).then(function(a){return a=a,d[50]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[50]).then(function(a){return a=a,d[51]=a[0],a})},function(e){return d[38].set("message_partial_id",d[51]==null?"":d[51]),d[52]=c.createArray(),d[63]=(d[52].push(a[3]),d[52]),d[63]=(d[52].push(a[0]),d[52]),d[53]=c.toJSON(d[52]),d[38].set("raw_identifiers",d[39]),d[38].set("backup_id",d[27]),d[38].set("thread_id",a[4]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[53]).then(function(a){return a=a,d[54]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),d[54]).then(function(a){return a=a,d[55]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[55]).then(function(a){return a=a,d[56]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[56]).then(function(a){return a=a,d[57]=a[0],a})},function(a){return d[38].set("salt_partial_access_token",d[57]==null?"":d[57]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[29]).then(function(a){return a=a,d[58]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF9rZXlfc2FsdF9zY29wZQ=="),d[58]).then(function(a){return a=a,d[59]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[59]).then(function(a){return a=a,d[60]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[60]).then(function(a){return a=a,d[61]=a[0],a})},function(a){return d[38].set("salt_partial_attachment_index_key",d[61]==null?"":d[61]),d[1]!==void 0?c.nativeOperation(b("LSQplMarkEnd.nop"),c.i64.cast([0,637738637]),d[1],!0):c.resolve()},function(a){return d[62]=c.toJSON(d[38]),c.storedProcedure(b("LSIssueNewTask"),"encrypted_backups_attachment_upload",c.i64.cast([0,50012]),d[62],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}]):c.sequence([function(a){return d[29]="Missing backup_id for IssueAttachmentBackupTask",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure] ","",d[29]].join("")),d[28]=c.createArray(),void 0!==void 0?d[31]=(d[28].push(void 0),d[28]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure",d[29],d[28],c.i64.cast([0,3]))},function(a){return d[30]=["LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure",".","missing_backup_id"].join(""),d[1]!==void 0?d[30]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,637738637]),d[1],"error",d[30]):c.resolve():c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSQplMarkEnd.nop"),c.i64.cast([0,637738637]),d[1],!1):c.resolve()}])):c.sequence([function(a){return d[28]="Missing device_id for IssueAttachmentBackupTask",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure] ","",d[28]].join("")),d[27]=c.createArray(),void 0!==void 0?d[30]=(d[27].push(void 0),d[27]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure",d[28],d[27],c.i64.cast([0,3]))},function(a){return d[29]=["LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure",".","missing_device_id"].join(""),d[1]!==void 0?d[29]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,637738637]),d[1],"error",d[29]):c.resolve():c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSQplMarkEnd.nop"),c.i64.cast([0,637738637]),d[1],!1):c.resolve()}]):c.sequence([function(a){return d[28]="Missing ocmf_client_state_blob for IssueAttachmentBackupTask",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure] ","",d[28]].join("")),d[27]=c.createArray(),void 0!==void 0?d[30]=(d[27].push(void 0),d[27]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure",d[28],d[27],c.i64.cast([0,3]))},function(a){return d[29]=["LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure",".","missing_ocmf_client_state_blob"].join(""),d[1]!==void 0?d[29]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,637738637]),d[1],"error",d[29]):c.resolve():c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSQplMarkEnd.nop"),c.i64.cast([0,637738637]),d[1],!1):c.resolve()}])},function(a){return d[21]=c.i64.of_float(Date.now()),d[22]=c.i64.random(),d[24]="Finishing execution. Execution time: ",d[25]=c.i64.to_string(c.i64.sub(d[21],d[0])),d[26]=" ms",d[23]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure] ",d[23],d[24],d[23],d[25],d[23],d[26]].join("")),c.i64.eq(c.i64.mod_(d[22],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[27]=",",d[28]=c.createArray(),void 0!==void 0?d[29]=(d[28].push(void 0),d[28]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure",[d[24],d[27],d[25],d[27],d[26]].join(""),d[28],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state"];e.exports=a}),null);
__d("LSIssueAttachmentBackupTaskStoredProcedure",["LSIssueAttachmentBackupTask","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSIssueAttachmentBackupTask"),e.deliveryObjectId,e.productType,e.mediaType,e.messageId,e.threadId,e.traceId,e.serverThreadKey);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSIssueAttachmentRestoreTask",["LSArrayGetObjectAt","LSBase64Encode.nop","LSBinaryToHex.nop","LSCreateDerivedKeys.nop","LSFindBackup","LSGetBlobFromInt64BE.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSIssueNewTask","LSLogMebClientEvent.nop","LSOcmfClientMap.nop","LSOpeEncrypt.nop","LSQplAnnotateString.nop","LSQplMarkEnd.nop","LSQplMarkPoint.nop","LSQplStartTrace.nop","LSTruncateSortKey.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] Beginning execution."),a[7]!==void 0?c.resolve(d[1]=a[7]):c.sequence([function(a){return d[28]=c.i64.random(),d[29]=c.i64.to_string(d[28]),d[29]!==void 0?c.nativeOperation(b("LSQplStartTrace.nop"),c.i64.cast([0,679684335]),d[29],!0,void 0):c.resolve()},function(a){return d[1]=d[29]}])},function(a){return d[1]!==void 0?c.nativeOperation(b("LSQplMarkPoint.nop"),c.i64.cast([0,679684335]),d[1],"LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure_start"):c.resolve()},function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,e){var f=a.done;a=a.value;return f?(f=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,20]),void 0,void 0],d[2]=f[0],d[3]=f[1],d[4]=f[2],d[5]=f[3],d[6]=f[4],d[7]=f[5],d[8]=f[6],d[9]=f[7],d[10]=f[8],d[11]=f[9],d[12]=f[10],d[13]=f[11],d[14]=f[12],d[15]=f[13],d[16]=f[14],d[17]=f[15],d[18]=f[16],d[19]=f[17],f):(e=a.item,c.sequence([function(a){return d[33]=e.backupTenancy,d[32]=e.encryptionVersion,d[28]=void 0,c.i64.neq(d[28],void 0)?c.resolve(d[29]=d[28]):c.sequence([function(a){return d[34]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[35]=a[0],a})},function(a){return d[35]?d[44]=(d[34].push(c.i64.cast([0,0])),d[34]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[36]=a[0],a})},function(a){return d[36]?d[44]=(d[34].push(c.i64.cast([0,2])),d[34]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[37]=a[0],a})},function(a){return d[37]?d[44]=(d[34].push(c.i64.cast([0,3])),d[34]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[38]=a[0],a})},function(a){return d[38]?d[44]=(d[34].push(c.i64.cast([0,4])),d[34]):0,d[39]=c.createArray(),d[40]=c.i64.of_int32(d[34].length),c.i64.gt(d[40],c.i64.cast([0,0]))?c.loopAsync(d[40],function(a){return d[44]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[34],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return d[47]=(d[39].push(d[45]),d[39])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[44]=c.createArray(),d[45]=c.i64.of_int32(d[39].length),c.i64.gt(d[45],c.i64.cast([0,0]))?c.loopAsync(d[45],function(a){return d[47]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[39],d[47]).then(function(a){return a=a,d[48]=a[0],d[49]=a[1],a})},function(a){return d[50]=(d[44].push(c.i64.to_string(d[48])),d[44])}])}):c.resolve()},function(a){return d[46]=d[44].join(","),d[41]=d[46]}])},function(a){return d[39].some(function(a){return c.i64.eq(d[32],a)})?d[42]=d[32]:d[42]=void 0,c.i64.neq(d[42],void 0)?d[43]=d[42]:d[43]=void 0,d[29]=d[43]}])},function(a){return c.i64.neq(d[29],void 0)?d[30]=d[29]:d[30]=c.i64.cast([0,0]),c.i64.neq(d[33],void 0)?d[31]=d[33]:d[31]=c.i64.cast([0,1]),a=[e.backupId,e.deviceId,e.mailboxRootKeyBlob,e.ocmfClientStateBlob,void 0,void 0,d[30],d[31],e.epochAuthPublicKeyBlob,e.epochAuthPrivateKeyBlob,e.devicePublicKeyBlob,e.devicePrivateKeyBlob,e.epochStoragePublicKeyBlob,e.epochStoragePrivateKeyBlob,e.obliviousValidationTokenBlob,e.authorityLevel,void 0,void 0],d[2]=a[0],d[3]=a[1],d[4]=a[2],d[5]=a[3],d[6]=a[4],d[7]=a[5],d[8]=a[6],d[9]=a[7],d[10]=a[8],d[11]=a[9],d[12]=a[10],d[13]=a[11],d[14]=a[12],d[15]=a[13],d[16]=a[14],d[17]=a[15],d[18]=a[16],d[19]=a[17]}]))})},function(a){return c.storedProcedure(b("LSFindBackup")).then(function(a){return a=a,d[21]=a[0],a})},function(e){return c.blobs.neq(d[5],void 0)?c.i64.neq(d[3],void 0)?d[21]!==void 0?c.blobs.neq(d[4],void 0)?c.sequence([function(e){return d[28]=c.createArray(),d[35]=(d[28].push(d[21]),d[28]),d[35]=(d[28].push(a[1]),d[28]),d[29]=c.toJSON(d[28]),d[30]=c.createArray(),d[35]=(d[30].push(c.i64.cast([0,32])),d[30]),c.nativeOperation(b("LSGetBlobFromString.nop"),["thread_ope_key","_",a[5]].join("")).then(function(a){return a=a,d[31]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[31],void 0,d[4],d[30]).then(function(a){return a=a,d[32]=a[0],a})},function(a){return d[32]?d[33]=!1:d[33]=!0,d[33]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),d[36]="Got null keys while deriving message list OPE key. Returning null blobish",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",d[36]].join("")),d[35]=c.createArray(),void 0!==void 0?d[37]=(d[35].push(void 0),d[35]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",d[36],d[35],c.i64.cast([0,3]))},function(a){return d[34]=void 0}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[32],c.i64.cast([0,0])).then(function(a){return a=a,d[35]=a[0],d[36]=a[1],a})},function(a){return d[34]=d[35]}])},function(e){return c.blobs.neq(d[34],void 0)?c.sequence([function(e){return c.i64.neq(a[9],void 0)?d[35]=a[9]:d[35]=c.i64.cast([-1,4294967295]),c.nativeOperation(b("LSGetBlobFromInt64BE.nop"),a[6]).then(function(a){return a=a,d[36]=a[0],a})},function(a){return c.nativeOperation(b("LSTruncateSortKey.nop"),d[36]).then(function(a){return a=a,d[37]=a[0],a})},function(a){return c.nativeOperation(b("LSOpeEncrypt.nop"),d[34],d[37],c.i64.cast([0,16])).then(function(a){return a=a,d[38]=a[0],a})},function(a){return c.nativeOperation(b("LSBinaryToHex.nop"),d[38]).then(function(a){return a=a,d[39]=a[0],a})},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),d[29]).then(function(a){return a=a,d[40]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF9rZXlfc2NvcGU="),d[40]).then(function(a){return a=a,d[41]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[41]).then(function(a){return a=a,d[42]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[42]).then(function(a){return a=a,d[43]=a[0],a})},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),d[21]).then(function(a){return a=a,d[44]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWFpbGJveF9pZF9zY29wZQ=="),d[44]).then(function(a){return a=a,d[45]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[45]).then(function(a){return a=a,d[46]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[46]).then(function(a){return a=a,d[47]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[4]).then(function(a){return a=a,d[48]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWVzc2FnZV9pZF9zY29wZQ=="),d[48]).then(function(a){return a=a,d[49]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[49]).then(function(a){return a=a,d[50]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[50]).then(function(a){return a=a,d[51]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[4]).then(function(a){return a=a,d[52]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),d[52]).then(function(a){return a=a,d[53]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[53]).then(function(a){return a=a,d[54]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[54]).then(function(a){return a=a,d[55]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[5]).then(function(a){return a=a,d[56]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("dGhyZWFkX2lkX3Njb3Bl"),d[56]).then(function(a){return a=a,d[57]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[57]).then(function(a){return a=a,d[58]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[58]).then(function(a){return a=a,d[59]=a[0],a})},function(e){return d[60]=new c.Map(),d[60].set("attachment_index_key",d[43]==null?"":d[43]),d[60].set("backup_ent_fbid",a[0]),d[60].set("delivery_object_id",a[1]),d[60].set("device_id",d[3]),d[60].set("mailbox_partial_id",d[47]==null?"":d[47]),d[60].set("media_type",a[3]),d[60].set("message_partial_id",d[51]==null?"":d[51]),d[60].set("product_type",a[2]),d[60].set("salt_partial_id",d[55]==null?"":d[55]),d[60].set("sort_key",d[39]==null?"":d[39]),d[60].set("thread_partial_id",d[59]==null?"":d[59]),d[60].set("trace_id",d[1]),d[60].set("source",d[35]),d[61]=new c.Map(),d[61].set("otid",a[4]),d[61].set("server_thread_key",a[8]),d[61].set("timestamp",c.i64.to_string(a[6])),c.nativeOperation(b("LSBase64Encode.nop"),d[5]).then(function(a){return a=a,d[62]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[4]).then(function(a){return a=a,d[63]=a[0],a})},function(e){return d[64]=new c.Map(),d[64].set("ocmf_client_state_blob",d[62]==null?"":d[62]),d[64].set("mailbox_root_key",d[63]==null?"":d[63]),d[65]=c.createArray(),d[76]=(d[65].push(a[4]),d[65]),d[76]=(d[65].push(a[1]),d[65]),d[66]=c.toJSON(d[65]),d[60].set("raw_identifiers",d[61]),d[60].set("backup_id",d[21]),d[60].set("thread_id",a[5]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[66]).then(function(a){return a=a,d[67]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),d[67]).then(function(a){return a=a,d[68]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[68]).then(function(a){return a=a,d[69]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[69]).then(function(a){return a=a,d[70]=a[0],a})},function(a){return d[60].set("salt_partial_access_token",d[70]==null?"":d[70]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[29]).then(function(a){return a=a,d[71]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF9rZXlfc2FsdF9zY29wZQ=="),d[71]).then(function(a){return a=a,d[72]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[72]).then(function(a){return a=a,d[73]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[73]).then(function(a){return a=a,d[74]=a[0],a})},function(a){return d[60].set("salt_partial_attachment_index_key",d[74]==null?"":d[74]),d[60].set("raw_tokens",d[64]),void 0!==void 0?d[60].set("access_token_secret",void 0):0,void 0!==void 0?d[60].set("primary_key_secret",void 0):0,d[75]=c.toJSON(d[60]),c.storedProcedure(b("LSIssueNewTask"),"encrypted_backups_attachment_restore",c.i64.cast([0,50020]),d[75],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}]):c.sequence([function(a){return d[37]=["LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",".","OPE_key_is_null"].join(""),d[1]!==void 0?d[37]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,679684335]),d[1],"error",d[37]):c.resolve():c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSQplMarkEnd.nop"),c.i64.cast([0,679684335]),d[1],!1):c.resolve()},function(a){return d[36]="OPE key is null for IssueAttachmentRestoreTask",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",d[36]].join("")),d[35]=c.createArray(),void 0!==void 0?d[38]=(d[35].push(void 0),d[35]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",d[36],d[35],c.i64.cast([0,3]))}])}]):c.sequence([function(a){return d[30]=["LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",".","missing_mailbox_root_key"].join(""),d[1]!==void 0?d[30]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,679684335]),d[1],"error",d[30]):c.resolve():c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSQplMarkEnd.nop"),c.i64.cast([0,679684335]),d[1],!1):c.resolve()},function(a){return d[29]="Missing mailbox_root_key for IssueAttachmentRestoreTask",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",d[29]].join("")),d[28]=c.createArray(),void 0!==void 0?d[31]=(d[28].push(void 0),d[28]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",d[29],d[28],c.i64.cast([0,3]))}]):c.sequence([function(a){return d[30]=["LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",".","missing_backup_id"].join(""),d[1]!==void 0?d[30]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,679684335]),d[1],"error",d[30]):c.resolve():c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSQplMarkEnd.nop"),c.i64.cast([0,679684335]),d[1],!1):c.resolve()},function(a){return d[29]="Missing backup_id for IssueAttachmentRestoreTask",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",d[29]].join("")),d[28]=c.createArray(),void 0!==void 0?d[31]=(d[28].push(void 0),d[28]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",d[29],d[28],c.i64.cast([0,3]))}]):c.sequence([function(a){return d[30]=["LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",".","missing_device_id"].join(""),d[1]!==void 0?d[30]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,679684335]),d[1],"error",d[30]):c.resolve():c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSQplMarkEnd.nop"),c.i64.cast([0,679684335]),d[1],!1):c.resolve()},function(a){return d[29]="Missing device_id for IssueAttachmentRestoreTask",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",d[29]].join("")),d[28]=c.createArray(),void 0!==void 0?d[31]=(d[28].push(void 0),d[28]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",d[29],d[28],c.i64.cast([0,3]))}]):c.sequence([function(a){return d[30]=["LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",".","missing_ocmf_client_state_blob"].join(""),d[1]!==void 0?d[30]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,679684335]),d[1],"error",d[30]):c.resolve():c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSQplMarkEnd.nop"),c.i64.cast([0,679684335]),d[1],!1):c.resolve()},function(a){return d[29]="Missing ocmf_client_state_blob for IssueAttachmentRestoreTask",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ","",d[29]].join("")),d[28]=c.createArray(),void 0!==void 0?d[31]=(d[28].push(void 0),d[28]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",d[29],d[28],c.i64.cast([0,3]))}])},function(a){return d[22]=c.i64.of_float(Date.now()),d[23]=c.i64.random(),d[25]="Finishing execution. Execution time: ",d[26]=c.i64.to_string(c.i64.sub(d[22],d[0])),d[27]=" ms",d[24]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure] ",d[24],d[25],d[24],d[26],d[24],d[27]].join("")),c.i64.eq(c.i64.mod_(d[23],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[28]=",",d[29]=c.createArray(),void 0!==void 0?d[30]=(d[29].push(void 0),d[29]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure",[d[25],d[28],d[26],d[28],d[27]].join(""),d[29],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsIssueAttachmentRestoreTaskStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state"];e.exports=a}),null);
__d("LSIssueAttachmentRestoreTaskStoredProcedure",["LSIssueAttachmentRestoreTask","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSIssueAttachmentRestoreTask"),e.backupEntFbid,e.deliveryObjectId,e.productType,e.mediaType,e.messageId,e.threadId,e.sortOrder,e.traceId,e.serverThreadKey,e.source);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSIssueThreadRemove",["LSArrayGetObjectAt","LSIsEncryptionVersionSecure","LSIssueNewTaskAndGetTaskID","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][issueThreadRemove] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[15]=new c.Map(),d[15].set("error_msg","Expected a nonempty query result"),d[15].set("code",c.i64.cast([0,3])),d[15].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[16]=c.createArray(),d[17]=(d[16].push(d[15]),d[16]),e=[void 0,d[16]],d[2]=e[0],d[3]=e[1]):(b=a.item,d[15]=new c.Map(),d[15].set("backup_id",b.backupId),d[15].set("device_public_key_blob",b.devicePublicKeyBlob),d[15].set("device_private_key_blob",b.devicePrivateKeyBlob),d[15].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[15].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[15].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[15].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[15].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[15].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[15].set("orf_client_state_v2_blob",void 0),d[15].set("orf_v2_authority_level",void 0),d[15].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[15].set("device_id",b.deviceId),d[15].set("backup_tenancy",b.backupTenancy),d[15].set("encryption_version",b.encryptionVersion),d[15].set("revision_version",b.revisionVersion),d[15].set("initialize_restore_result",void 0),d[15].set("device_creation_timestamp_sec",void 0),d[15].set("authority_level",b.authorityLevel),e=[d[15],void 0],d[2]=e[0],d[3]=e[1])})},function(e){return d[5]=new c.Map(),d[5].set("value",d[2]),d[5].set("errors",d[3]),d[6]=d[5].get("value"),d[6]!==void 0?c.sequence([function(e){return d[15]=d[6].get("backup_id"),d[16]=d[6].get("device_public_key_blob"),d[17]=d[6].get("device_private_key_blob"),d[18]=d[6].get("epoch_storage_public_key_blob"),d[19]=d[6].get("epoch_storage_private_key_blob"),d[20]=d[6].get("epoch_auth_public_key_blob"),d[21]=d[6].get("epoch_auth_private_key_blob"),d[22]=d[6].get("mailbox_root_key_blob"),d[23]=d[6].get("ocmf_client_state_blob"),d[24]=d[6].get("orf_client_state_v2_blob"),d[25]=d[6].get("orf_v2_authority_level"),d[26]=d[6].get("oblivious_validation_token_blob"),d[27]=d[6].get("device_id"),d[28]=d[6].get("backup_tenancy"),d[29]=d[6].get("encryption_version"),d[30]=d[6].get("revision_version"),d[31]=d[6].get("initialize_restore_result"),d[32]=d[6].get("device_creation_timestamp_sec"),d[33]=d[6].get("authority_level"),c.i64.neq(d[27],void 0)?c.sequence([function(a){return d[36]=void 0,c.i64.neq(d[36],void 0)?c.resolve(d[37]=d[36]):c.sequence([function(a){return d[43]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[44]=a[0],a})},function(a){return d[44]?d[53]=(d[43].push(c.i64.cast([0,0])),d[43]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[45]=a[0],a})},function(a){return d[45]?d[53]=(d[43].push(c.i64.cast([0,2])),d[43]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[46]=a[0],a})},function(a){return d[46]?d[53]=(d[43].push(c.i64.cast([0,3])),d[43]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[47]?d[53]=(d[43].push(c.i64.cast([0,4])),d[43]):0,d[48]=c.createArray(),d[49]=c.i64.of_int32(d[43].length),c.i64.gt(d[49],c.i64.cast([0,0]))?c.loopAsync(d[49],function(a){return d[53]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[43],d[53]).then(function(a){return a=a,d[54]=a[0],d[55]=a[1],a})},function(a){return d[56]=(d[48].push(d[54]),d[48])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[53]=c.createArray(),d[54]=c.i64.of_int32(d[48].length),c.i64.gt(d[54],c.i64.cast([0,0]))?c.loopAsync(d[54],function(a){return d[56]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[48],d[56]).then(function(a){return a=a,d[57]=a[0],d[58]=a[1],a})},function(a){return d[59]=(d[53].push(c.i64.to_string(d[57])),d[53])}])}):c.resolve()},function(a){return d[55]=d[53].join(","),d[50]=d[55]}])},function(a){return d[48].some(function(a){return c.i64.eq(d[29],a)})?d[51]=d[29]:d[51]=void 0,c.i64.neq(d[51],void 0)?d[52]=d[51]:d[52]=void 0,d[37]=d[52]}])},function(e){return c.i64.neq(d[37],void 0)?d[38]=d[37]:d[38]=c.i64.cast([0,0]),c.i64.neq(d[28],void 0)?d[39]=d[28]:d[39]=c.i64.cast([0,1]),d[40]=c.i64.of_float(Date.now()),c.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),["eb_upload",":",a[0]].join(""),c.i64.cast([0,50026]),"",void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),c.i64.cast([0,93]),void 0,c.i64.le(c.i64.cast([0,0]),c.i64.cast([0,0]))?c.i64.cast([0,0]):c.i64.add(d[40],c.i64.sub(c.i64.cast([0,0]),c.i64.mod_(d[40],c.i64.cast([0,0])))),c.i64.cast([0,0])).then(function(a){return a=a,d[41]=a[0],a})},function(b){return c.db.table(177).add({pk:void 0,pendingBackupTaskId:d[41],actionType:c.i64.cast([0,2]),contentType:c.i64.cast([0,2]),backupStatus:c.i64.cast([0,1]),listKey:a[0],uniqueKey:a[0],sortKey:a[1],persistentId:"",isInstamadillo:!1,lsTraceId:a[3],error:a[4]})},function(b){return c.i64.eq(c.i64.cast([0,2]),c.i64.cast([0,1]))?c.i64.eq(c.i64.cast([0,2]),c.i64.cast([0,1]))?(d[43]=c.createArray(),d[45]=(d[43].push("Successfully issued message backup task. act thread id = "),d[43]),d[45]=(d[43].push(a[0]),d[43]),d[45]=(d[43].push(", otid = "),d[43]),d[45]=(d[43].push(a[0]),d[43]),d[44]=d[43].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ","",d[44]].join("")),c.resolve()):(d[43]=c.createArray(),d[45]=(d[43].push("Successfully issued message remove task. act thread id = "),d[43]),d[45]=(d[43].push(a[0]),d[43]),d[45]=(d[43].push(", otid = "),d[43]),d[45]=(d[43].push(a[0]),d[43]),d[44]=d[43].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ","",d[44]].join("")),c.resolve()):(d[43]=c.createArray(),d[45]=(d[43].push("Successfully issued thread remove task. act thread id = "),d[43]),d[45]=(d[43].push(a[0]),d[43]),d[44]=d[43].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ","",d[44]].join("")),c.resolve())},function(a){return d[42]=new c.Map(),d[42].set("task_id",d[41]),a=[d[42],void 0],d[34]=a[0],d[35]=a[1]}]):c.sequence([function(b){return d[36]=c.createArray(),d[39]=(d[36].push("Skipping thread remove since EB is disabled. act thread id = "),d[36]),d[39]=(d[36].push(a[0]),d[36]),d[37]=d[36].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ","",d[37]].join("")),c.resolve()},function(a){return d[38]=new c.Map(),d[38].set("error_code",c.i64.cast([0,24])),d[38].set("stored_procedure","LSEncryptedBackupsIssueThreadRemoveStoredProcedure"),d[38].set("error_message",""),a=[void 0,d[38]],d[34]=a[0],d[35]=a[1]}])},function(a){return a=[d[34],d[35]],d[7]=a[0],d[8]=a[1],a}]):c.sequence([function(b){return d[15]=d[5].get("errors"),d[16]=d[5].get("errors"),d[17]=c.createArray(),d[20]=(d[17].push("Skipping thread remove since EB is disabled. act thread id = "),d[17]),d[20]=(d[17].push(a[0]),d[17]),d[18]=d[17].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ","",d[18]].join("")),c.resolve()},function(a){return d[19]=new c.Map(),d[19].set("error_code",c.i64.cast([0,1])),d[19].set("stored_procedure","LSEncryptedBackupsIssueThreadRemoveStoredProcedure"),d[19].set("error_message",""),a=[void 0,d[19]],d[7]=a[0],d[8]=a[1]}])},function(a){return d[9]=c.i64.of_float(Date.now()),d[10]=c.i64.random(),d[12]="Finishing execution. Execution time: ",d[13]=c.i64.to_string(c.i64.sub(d[9],d[0])),d[14]=" ms",d[11]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ",d[11],d[12],d[11],d[13],d[11],d[14]].join("")),c.i64.eq(c.i64.mod_(d[10],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[15]=",",d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"issueThreadRemove",[d[12],d[15],d[13],d[15],d[14]].join(""),d[16],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[7],d[8]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsIssueThreadRemoveStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","pending_backups_context_v2"];e.exports=a}),null);
__d("LSIssueThreadRemoveStoredProcedure",["LSIssueThreadRemove","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSIssueThreadRemove"),e.actThreadId,e.sortKey,e.source,e.traceId,e.error);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSRefetchContactRowIfExists",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.filter(c.db.table(7).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.id,a[0])&&c.i64.eq(c.i64.cast([0,1]),c.i64.cast([0,1]))}).next().then(function(e,f){var g=e.done;e=e.value;return g?0:(f=e.item,c.i64.le(f.authorityLevel,c.i64.cast([0,80]))?(d[0]=new c.Map(),d[0].set("contact_id",a[0]),d[1]=c.toJSON(d[0]),c.storedProcedure(b("LSIssueNewTask"),"cpq_v2",c.i64.cast([0,207]),d[1],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))):c.resolve())})},function(a){return c.resolve(e)}])}a.__sproc_name__="LSContactRefetchContactRowIfExistsStoredProcedure";a.__tables__=["contacts"];e.exports=a}),null);
__d("LSRefetchContactRowIfExistsStoredProcedure",["LSRefetchContactRowIfExists","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSRefetchContactRowIfExists"),e.id);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSUpdateBackupsTableStoredProcedure",["LSSynchronousPromise","LSUpdateBackupsTable","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSUpdateBackupsTable"),e.isSuccess,e.backupIds,e.virtualDevices,e.deviceIds,e.backupMetadata,e.traceId,e.isUserOptedOut,e.hasOtcEligibleDevices,e.encryptionManagementDelegatorId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSUpdateE2EEMetadataParticipants",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return d[0]=new c.Map(),d[0].set("thread_key",a[0]),d[0].set("user_self_remove",!1),d[1]=d[0].get("thread_key"),d[2]=c.toJSON(d[0]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[1]),c.i64.cast([0,394]),d[2],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxUpdateE2EEMetadataParticipantsStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSUpdateE2EEMetadataParticipantsStoredProcedure",["LSSynchronousPromise","LSUpdateE2EEMetadataParticipants","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSUpdateE2EEMetadataParticipants"),e.threadKey);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSUpsertAttachmentRange",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.sequence([function(c){return b.forEach(b.db.table(17).fetch([[[a[0],a[1]]]]),function(a){return a["delete"]()})},function(c){return b.db.table(17).add({threadKey:a[0],mediaGroup:a[1],minTimestampMs:a[2],maxTimestampMs:b.i64.cast([2328,1316134911]),hasMoreBefore:a[3],hasMoreAfter:!1,isLoadingBefore:!1,isLoadingAfter:!1,lastLoadedMessageId:a[4]})}])},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxUpsertAttachmentRangeStoredProcedure";a.__tables__=["attachments_ranges_v2__generated"];e.exports=a}),null);
__d("LSUpsertAttachmentRangeStoredProcedure",["LSSynchronousPromise","LSUpsertAttachmentRange","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSUpsertAttachmentRange"),e.threadKey,e.mediaGroup,e.newMinTs,e.hasMoreBefore,e.newLastLoadedMessageId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MAWFTSRawStringMatcher",["JSResourceForInteraction","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h=c("JSResourceForInteraction")("WAFtsMultiLangTokenizer").__setRef("MAWFTSRawStringMatcher"),i=null;async function a(){i=await h.load();return k}function j(a){return new(c("nullthrows")(i))().tokenize(a)}function k(a,b){a=Array.from(j(a)).filter(function(a){return a.length>1});if(a.length===0)return!1;var c=Array.from(j(b));return a.every(function(a){return c.some(function(b){return b.startsWith(a)})})}g.load=a}),98);
__d("addMAWBridgeSearchMessagesToUniversalSearch",["I64","LSIntEnum","LSMessageSearchType","MAWCurrentUser","MAWUniversalMessageSearch","MWContentSearchUtils","MWSearchThreadUtils","ReQL","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(h||d("LSIntEnum")).ofNumber(c("LSMessageSearchType").THREAD);async function a(a,b,e,g,h){var k;d("MAWUniversalMessageSearch").updateSecureMsgMatchCountForThread(b,g.length);var l=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.message_search_results).getKeyRange(j,e,b)),m=l==null;k=(i||(i=d("I64"))).to_int32((k=l==null?void 0:l.matchCount)!=null?k:(i||(i=d("I64"))).zero);var n=k+g.length;k=await d("MWSearchThreadUtils").getThreadDataByThreadKey(a,b,i.of_string(d("MAWCurrentUser").getID()),j);if(k==null)return;var o=k.profilePicUrl,p=k.secondaryProfilePicUrl,q=k.threadDisplayName,r=k.threadType,s=l==null?void 0:l.globalIndex,t=d("MWContentSearchUtils").getGlobalIndex(g[0].sortOrderMs,l==null?void 0:l.globalIndex),u=async function(a){var c;await a.message_search_results.upsert([j,e,b,s!=null?s:t],babelHelpers.extends({},d("MWContentSearchUtils").getContextLineAndMatches(e,n,(c=g[0].msg)==null?void 0:c.content,j),{displayName:q,globalIndex:t,matchCount:(i||(i=d("I64"))).of_int32(n),messageTimestampMs:d("MWContentSearchUtils").getMessageTimestamp(g[0].sortOrderMs),profilePicUrl:o,query:e,secondaryProfilePicUrl:p,threadKey:b,threadType:r,type_:j}));m&&await a.message_search_queries.put(babelHelpers.extends({},h,{resultCount:(i||(i=d("I64"))).add(h.resultCount,i.one)}))};c("promiseDone")(a.runInTransaction(async function(a){await u(a)},"readwrite",void 0,void 0,f.id+":113"))}g.default=a}),98);
__d("MAWBridgeAddMessageSearchResultHandler",["I64","LSIntEnum","LSMessageSearchType","MAWCurrentUser","MAWFTSRawStringMatcher","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MWInboxSecureContentSearch","ReQL","addMAWBridgeSearchMessagesToUniversalSearch","emptyFunction","isMAWUniversalSearchWithEBEnabled","promiseDone","waitForMiActMappingForUniversalSearch"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessageSearchType").MESSAGE),k=h.ofNumber(c("LSMessageSearchType").THREAD);function a(a,b,d){return d.length===0?Promise.resolve():Promise.all([m(a,b,d),n(a,b,d)]).then(c("emptyFunction"))}async function l(a,b){var c=await d("MAWFTSRawStringMatcher").load();return b.filter(function(b){b=(b=b.msg)==null?void 0:b.content;return b==null?!1:c(a,b)})}async function m(a,b,e){var f=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(b.message_search_queries).getKeyRange(j));if(f.length===0)return;return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(b,e[0].chatJid,"MAWBridgeAddMessageSearchResultHandler",function(b,g){return async function(){var c=f.filter(function(a){return(i||(i=d("I64"))).equal(a.threadKeyV2,g)})[0];if(c==null)return;var h=c.query;if(h==null||h.length<2)return;var j=(i||(i=d("I64"))).to_int32(c.resultCount);h=await l(h,e);if(h.length===0)return;await d("MWInboxSecureContentSearch").addBridgeSearchMsgsToSearchResult(a,b,c.query,h,j+h.length,i.of_string(d("MAWCurrentUser").getID()))}().then(c("emptyFunction"))})}async function n(a,b,e){if(!c("isMAWUniversalSearchWithEBEnabled")())return;var f=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.message_search_queries).getKeyRange(k).filter(function(a){return(i||(i=d("I64"))).equal(a.threadKeyV2,i.one)}));if(f==null)return;var g=f.query;if(g==null||g.length<2)return;var h=await l(g,e);if(h.length===0)return;c("promiseDone")(c("waitForMiActMappingForUniversalSearch")(a,e[0].chatJid),function(b){if(b!=null)return c("addMAWBridgeSearchMessagesToUniversalSearch")(a,b.serverThreadKey,g,h,f)})}g.call=a}),98);
__d("MAWBridgeCallRestoreNativeOpHandler",["I64","MAWMpsGating","Promise","WAJids","WALogger","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=c("requireDeferred")("LSProtobufRestoreHandler").__setRef("MAWBridgeCallRestoreNativeOpHandler"),l=c("requireDeferred")("LSRestoreEchoBlobs.nop").__setRef("MAWBridgeCallRestoreNativeOpHandler");function a(a,c){var e=c.chatJid,f=c.decryptedMessagesProtobufs,g=c.echoMessages,m=c.hasMoreAfter,n=c.hasMoreBefore,o=c.isPointQuery,p=c.nextMessageTimestampMsAfter,q=c.nextMessageTimestampMsBefore,r=c.referenceTimestamp,s=c.requestId,t=c.taskSource;if(d("MAWMpsGating").isFullMpsEnabled())return(j||(j=b("Promise"))).resolve();if(f!=null)return k.load().then(function(a){return a.handleProtobufRestoreHelper(d("WAJids").threadIdForChatJid(e),{convertedProtobufs:f,type:"convertedProtobufs"},n,q,m,p,o,s,r,void 0,void 0,t,e)});else if(g!=null)return l.load().then(function(c){return c(a,0,(i||(i=d("I64"))).zero,g,n,q,m,p,o,d("WAJids").threadIdForChatJid(e),s,r,t,e).then(function(){return(j||(j=b("Promise"))).resolve()})});else d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Unable to call restore native op - echo and protobuf messages are both null"])));return(j||(j=b("Promise"))).resolve()}g.call=a}),98);
__d("MAWBridgeDeleteGroupInviteHandler",["LSThreadBitOffset","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","ReQL","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeDeleteGroupInviteHandler",async function(b,e){var f=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(b.group_invites).getKeyRange(e));return Promise.all(f.map(function(a){return b.group_invites.delete(a.threadKey,a.inviterId,a.inviteeId)})).then(function(){c("promiseDone")(d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(e)),function(b){if(b==null)return;var c=d("LSThreadBitOffset").clear([105],b.capabilities,b.capabilities2,b.capabilities3,b.capabilities4,b.capabilities5),e=c[0],f=c[1],g=c[2],h=c[3];c=c[4];return a.threads.put(babelHelpers.extends({},b,{capabilities:e,capabilities2:f,capabilities3:g,capabilities4:h,capabilities5:c,snippet:void 0}))})})})}g.call=a}),98);
__d("MAWBridgeDeleteMessagesOfThreadHandler",["EBIsEbEnabled","LSFactory","LSIntEnum","LSIssueThreadRemoveStoredProcedure","LSMEBTaskCreationSource"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(a,b){if(b.actionType===2){if(!await d("EBIsEbEnabled").isEbEnabledLS(a))return;await c("LSIssueThreadRemoveStoredProcedure")(c("LSFactory")(a),{actThreadId:b.threadId,sortKey:b.ts.toString(),source:(h||(h=d("LSIntEnum"))).ofNumber(c("LSMEBTaskCreationSource").TAM_WEB)})}}g.call=a}),98);
__d("MAWBridgeEphemeralSettingsUpdatedForUIHandler",["MAWChatJid","MAWEphemeralSettingsUpdate","cr:17100"],(function(a,b,c,d,e,f,g){"use strict";async function a(a,c){var e=await d("MAWChatJid").toThreadKeyMaybe(a,c.chatJid);return e!=null?d("MAWEphemeralSettingsUpdate").updateEphemeralSettingsWithTxn(a,c.ephemeralSettingArgs.ephemeralExpirationInSec,await b("cr:17100").castUnixTimeToMillisTime(c.ephemeralSettingArgs.ephemeralLastUpdatedOrSetTimestamp),c.isEphemeralSettingReset,e,!1,c.author):Promise.resolve()}g.call=a}),98);
__d("MAWBridgeFulfillRestorePromisePayloadHandler",["MAWAsyncEBPendingQueryPromise","MAWEBRestoreTrackingUtils","Promise","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){a.success?(d("MAWAsyncEBPendingQueryPromise").resolvePendingQueryUponReStore(a.value.traceId),d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(a.value.traceId)):(d("MAWAsyncEBPendingQueryPromise").rejectPendingQueryIfPresent(a.error.traceId,c("err")(a.error.message)),d("MAWEBRestoreTrackingUtils").markEBRestoreFail(a.error.traceId));return(h||(h=b("Promise"))).resolve()}g.call=a}),98);
__d("MAWBridgeGQLUploadUtils",["JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";async function a(b,d){var a=await c("JSResourceForInteraction")("MAWEncryptedBackupsMessageUploadMutation").__setRef("MAWBridgeGQLUploadUtils").load();return a.uploadMessageOverGQL(b,d)}g.uploadMessageOverGQL=a}),98);
__d("MAWBridgeGroupInfoUpdatedHandler",["I64","MAWMiActMappingTableAPI","MWFBLogger","ODS","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m=d("MWFBLogger").MWLogger().tags(["bridgeUIEvent","Occam","Middleware"]);async function a(a,b){var c,e=await d("MAWMiActMappingTableAPI").getMappingRowForChatJid(a,b.chatJid);if(e==null){m.WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Missing thread key for chatJid: ",""])),b.chatJid);return}c=(c=b.threadName)!=null?c:void 0;e=e.serverThreadKey;a=a.threads;var f=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a).getKeyRange(e));if(f==null){(k||(k=d("ODS"))).bumpEntityKey(3185,"armadillo_group_info_update","missing_thread");m.WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Missing thread for updating group with threadKey: ",""])),(l||(l=d("I64"))).to_string(e));return}else c==null&&(c=f.threadName,m.WARN(j||(j=babelHelpers.taggedTemplateLiteralLoose(['MAWDB groupInfo is missing "name" field for threadKey: ',""])),(l||(l=d("I64"))).to_string(e)));e=b.memberAddMode!=="all_member_add";await a.put(babelHelpers.extends({},f,{needsAdminApprovalForNewParticipant:e,threadName:c}))}g.call=a}),98);
__d("MAWBridgeGroupInviteUpdateHandler",["I64","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MAWUpdateLSThreadCapabilities","Promise","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,e){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,e.threadJid,"MAWBridgeGroupInviteUpdateHandler",function(a,f){var g=(i||(i=d("I64"))).of_string(e.inviterId);return(h||(h=b("Promise"))).all([d("MAWUpdateLSThreadCapabilities").setGroupInviteTxn(a,f,g)]).then(c("emptyFunction"))})}g.call=a}),98);
__d("MAWBridgeHandleCOPDigest",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;function a(a,c){return(g||(g=b("Promise"))).resolve()}f.call=a}),66);
__d("MAWBridgeMediaExpiredHandler",["MAWMiActOnMiThreadExistsForJid__DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeMediaExpiredHandler.bs",function(a,c){return a.attachments["delete"](c,b.msgId,String(b.plaintextHash))})}g.call=a}),98);
__d("MAWBridgeMsgUpdatedHandler",["FBLogger","MAWAdminMsgCTA","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MAWMsgFetchLSReplyMsgAndAttachment","MAWUpdateMsg","MsgrWebGating","ReQL"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.chatJid,"MAWBridgeMsgUpdatedHandler",async function(e,f){var g,i=await (g=d("ReQL")).firstAsync(g.fromTableAscending(e.messages.index("messageId")).getKeyRange(b.msgId));g=await g.firstAsync(g.fromTableAscending(e.attachments).getKeyRange(f,b.msgId));if(i==null){c("FBLogger")("messenger_web").info("existing message is null for type %s, and attachment is null: %s",b.type_,g==null);return}g=await d("MAWAdminMsgCTA").getAdminMsgCtaStep(e,f,b);f=await h(a,b);return d("MAWUpdateMsg").call(e,f,i,g)})}async function h(a,b){if(d("MsgrWebGating").isQuotedMessagesInLsEnabled()){a=await d("MAWMsgFetchLSReplyMsgAndAttachment").fetchReplyLocalViaLS(a,b);return a!=null?a:b}return Promise.resolve(b)}g.call=a}),98);
__d("MAWBridgeNewMediaRangeHandler",["I64","LSFactory","LSIntEnum","LSUpsertAttachmentRangeStoredProcedure","MAWMediaGalleryEBTaggingUtils","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","cr:20238","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,e){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,e.threadJid,"MAWBridgeNewMediaRangeHandler",function(a,f){var g=(h||(h=d("I64"))).of_float(e.earliestLoadedMediaTs),j=e.mediaGalleryGroup,k=b("cr:20238")!=null?b("cr:20238").getMediaRestoreEBRange().getRange(f):null;k=Boolean(k==null?void 0:k.hasMoreBefore)&&d("MAWMediaGalleryEBTaggingUtils").isMediaGalleryGroupSupportedForTaggedRestore(j);k=e.hasMoreBefore||k;return c("LSUpsertAttachmentRangeStoredProcedure")(c("LSFactory")(a),{hasMoreBefore:k,mediaGroup:(i||(i=d("LSIntEnum"))).ofNumber(j),newLastLoadedMessageId:e.lastLoadedMessageId,newMinTs:g,threadKey:f})})}function a(a,b){return j(a,b).then(c("emptyFunction"))}g.call=a}),98);
__d("MAWCreateOptimisticThread",["I64","LSAuthorityLevel","LSCreateOfflineThreadingIDStoredProcedure","LSFactory","LSIntEnum","LSMailboxType","LSRtcCallState"],(function(a,b,c,d,e,f,g){"use strict";var h,i;async function j(a){a=await c("LSCreateOfflineThreadingIDStoredProcedure")(c("LSFactory")(a),{timestampMs:(h||(h=d("I64"))).of_float(Date.now())});a=a[0];return a}async function k(a,b){var e={authorityLevel:(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC),folderName:"inbox",lastReadWatermarkTimestampMs:(h||(h=d("I64"))).of_float(0),mailboxType:i.ofNumber(c("LSMailboxType").MESSENGER),ongoingCallState:i.ofNumber(c("LSRtcCallState").NO_ONGOING_CALL),parentThreadKey:h.zero,threadKey:b,threadType:i.ofNumber(15)};await a.threads.put(e);return b}async function a(a){var b=await j(a);await k(a,b);return b}g.createOfflineThreadingId=j;g.createOptimisticThreadWithThreadKey=k;g.createOptimisticThread=a}),98);
__d("MAWBridgeOccamadilloCreateE2EEMetadataThreadHandlerV2",["DedupMiThreadCreationCache","FBLogger","I64","LSAuthorityLevel","LSCreateE2EEMetadataThreadStoredProcedure","LSFactory","LSIntEnum","MAWCreateOptimisticThread","MAWFolderUtils","MAWJids","MAWThreadLoadingState","MAWThreadUtils"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j="[Occamadillo][CreateE2EEMetadataThreadHandlerV2]";async function a(a,b){var e=b.bumpTimestampMs,f=b.creationSource,g=b.folderId,i=b.jid;b=b.optimisticThreadKey;m(f,i);b=b!=null?await a.threads.get((h||(h=d("I64"))).of_string(b)):null;if(b!=null&&d("DedupMiThreadCreationCache").DedupMiThreadCreationCache.has(i)){q(i);return}if(b!=null&&k(b)){n(i,(h||(h=d("I64"))).to_string(b.threadKey));return}e={bumpTimestampMs:e,createdByLocalDevice:f==="outgoing_message",folderType:d("MAWFolderUtils").systemFolderToLSCoreClientFolder(g),offlineThreadKey:await l(b,i,a),threadType:d("MAWThreadUtils").getLSThreadTypeFromJid(i),waJid:d("MAWJids").convertChatJidToIntJid(i)};p(e);return c("LSCreateE2EEMetadataThreadStoredProcedure")(c("LSFactory")(a),e).then(function(){d("DedupMiThreadCreationCache").addToDedupMiThreadCreationCache(i)})}function k(a){a=(i||(i=d("LSIntEnum"))).unwrapIntEnum(a.authorityLevel);switch(a){case c("LSAuthorityLevel").CLIENT_PARTIAL:case c("LSAuthorityLevel").OPTIMISTIC:case c("LSAuthorityLevel").SERVER_PARTIAL:return!1;case c("LSAuthorityLevel").AUTHORITATIVE:case c("LSAuthorityLevel").AUTHORITATIVE_PENDING_REPLACEMENT:case c("LSAuthorityLevel").CLIENT_AUTHORITATIVE_DELETE:return!0;default:a;throw c("FBLogger")("messenger_web").mustfixThrow("Unknown authority level")}}async function l(a,b,c){if(a!=null)return Promise.resolve(a.threadKey);a=await d("MAWCreateOptimisticThread").createOfflineThreadingId(c);o(b,a);await Promise.all([d("MAWCreateOptimisticThread").createOptimisticThreadWithThreadKey(c,a),d("MAWThreadLoadingState").markActThreadLoadingAsCompleted(c,{intJid:d("MAWJids").convertChatJidToIntJid(b),threadKey:a})]);return a}function m(a,b){c("FBLogger")("messenger_web").info(j+" handler called from %s for jid %s",a,b)}function n(a,b){c("FBLogger")("messenger_web").info(j+" handler returned early for jid %s because thread %s was already authoritative",a,b)}function o(a,b){c("FBLogger")("messenger_web").info(j+" no thread exists for jid %s, creating optimistic thread with key %s",a,(h||(h=d("I64"))).to_string(b))}function p(a){c("FBLogger")("messenger_web").info(j+" Calling LSCreateE2EEMetadataThreadStoredProcedure with params: bumpTimestampMs: %s, createdByLocalDevice: %s, folderType: %s, offlineThreadKey: %s, offlineThreadKeySource: %s, threadType: %s, waJid: %s",(h||(h=d("I64"))).to_string(a.bumpTimestampMs),a.createdByLocalDevice,h.to_string(a.folderType),h.to_string(a.offlineThreadKey),h.to_string(a.threadType),h.to_string(a.waJid))}function q(a){c("FBLogger")("messenger_web").info(j+" LSCreateE2EEMetadataThreadStoredProcedure has already been called for jid %s, early returning",a)}g.call=a}),98);
__d("MAWBridgeParticipantRemovedHandler",["I64","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeParticipantRemovedHandler",function(a,c){return a.participants["delete"](c,(h||(h=d("I64"))).of_string(b.userId))})}g.call=a}),98);
__d("MAWBridgeRavenActionMsgForUIHandler",["I64","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MAWMsg","MAWRavenUtils","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h=["ephemeralMediaState"],i;function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeRavenActionMsgForUIHandler",async function(a,c){a=a.attachments;c=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a).getKeyRange(c,b.ravenMsgId));if(c==null)return Promise.resolve();if(c.ephemeralMediaState==null)return Promise.resolve();var e=(i||(i=d("I64"))).to_int32(c.ephemeralMediaState);if(c.ephemeralMediaViewMode==null)return Promise.resolve();var f=i.to_int32(c.ephemeralMediaViewMode);e=d("MAWMsg").MAWRavenMsgEphemeralMediaState.cast(e);f=d("MAWMsg").MAWRavenMsgEphemeralType.cast(f);if(e==null||f==null)return Promise.resolve();e=d("MAWRavenUtils").getNextRavenMessageEphemeralState(e,f);if(e==null)return Promise.resolve();c.ephemeralMediaState;f=babelHelpers.objectWithoutPropertiesLoose(c,h);c=babelHelpers.extends({ephemeralMediaState:i.of_int32(e)},f,{transportKey:"WhatsApp"});e=[f.threadKey,f.messageId,f.attachmentFbid];return a.upsert(e,c)})}g.call=a}),98);
__d("MAWBridgeReceivedReceiptHandler",["I64","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MAWTimeUtils","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h;async function i(a,b,c){var e=(h||(h=d("I64"))).of_string(b.fbid);b=d("MAWTimeUtils").toTimestamp(b.deliveredWatermarkTs);c=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.participants).getKeyRange(c,e));c!=null&&await a.participants.put({authorityLevel:c.authorityLevel,contactId:c.contactId,deliveredWatermarkTimestampMs:(h||(h=d("I64"))).equal(b,(h||(h=d("I64"))).zero)?c.deliveredWatermarkTimestampMs:b,groupParticipantJoinState:c.groupParticipantJoinState,isAdmin:c.isAdmin,isModerator:c.isModerator,isSuperAdmin:c.isSuperAdmin,nickname:c.nickname,normalizedSearchTerms:c.normalizedSearchTerms,participantCapabilities:c.participantCapabilities,readActionTimestampMs:c.readActionTimestampMs,readWatermarkTimestampMs:c.readWatermarkTimestampMs,subscribeSource:c.subscribeSource,threadKey:c.threadKey,threadRoles:(h||(h=d("I64"))).zero})}function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.chatJid,"MAWBridgeReceivedReceiptHandler",function(a,c){return i(a,b,c)})}g.callWithoutWaitingForAnything=i;g.call=a}),98);
__d("MAWBridgeRefreshContactHandler",["LSFactory","LSRefetchContactRowIfExistsStoredProcedure"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return c("LSRefetchContactRowIfExistsStoredProcedure")(c("LSFactory")(a),{id:b})}g.call=a}),98);
__d("MAWBridgeRemoveMessageSearchResultHandler",["ReQL","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return async function(){var c=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.message_search_results).filter(function(a){return b.includes(a.messageOtid)}));await Promise.all(c.map(function(b){return a.message_search_results.delete(b.type_,b.query,b.threadKey,b.globalIndex)}))}().then(c("emptyFunction"))}g.call=a}),98);
__d("MAWBridgeResignAttachmentCDNUrlHandler",["I64","LSFactory","LSIssueAttachmentRestoreTaskStoredProcedure","MAWAsyncEBMediaDownloadPromise","MAWBridgeFireAndForget","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";var h,i="-8";function a(a,b){var e,f=b.traceId,g=(e=b.skipLegacyMediaDownloadFlow)!=null?e:!1;function j(a,b,c){!g&&f!=null&&d("MAWBridgeFireAndForget").fireAndForget("backend","addMediaDownloadQpl",{annotations:c!=null?c:void 0,pointName:b,qplInstanceKey:f,qplType:a})}j("point","resign_cdn_url_bridge_handler_start");return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeResignAttachmentCDNUrlHandler",function(a,e){e={backupEntFbid:(h||(h=d("I64"))).of_string(i),deliveryObjectId:b.deliveryObjectId,mediaType:b.mediaType,messageId:b.messageId,productType:b.productType,serverThreadKey:h.to_string(e),sortOrder:h.of_float(b.sortOrder),threadId:b.threadId,traceId:f.toString()};b.skipLegacyMediaDownloadFlow!==!0&&d("MAWAsyncEBMediaDownloadPromise").setMediaDownloadPayload({messageId:b.msgId,objectId:b.deliveryObjectId,plaintextHash:b.plaintextHash,threadId:b.threadId});j("point","resign_cdn_url_issue_attachment_task",{string:{taskTraceId:e.traceId}});return c("LSIssueAttachmentRestoreTaskStoredProcedure")(c("LSFactory")(a),e).then(function(){j("point","resign_cdn_url_issue_attachment_task_end")})["catch"](function(a){j("fail","resign_cdn_url_issue_attachment_task_fail",{string:{error:a.toString()}})})})}g.call=a}),98);
__d("MAWBridgeSyncContacts",["CurrentMessengerUser","I64","LSAuthorityLevel","LSContactBlockedByViewerStatus","LSContactGender","LSContactIdType","LSContactType","LSContactViewerRelationship","LSContactWorkForeignEntityType","LSFactory","LSIntEnum","LSVerifyContactRowExistsStoredProcedure","Promise","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=d("CurrentMessengerUser").getID();function a(a,e){return e.reduce(function(b,e){var f=(i||(i=d("I64"))).of_string(e);return b.then(function(){return c("LSVerifyContactRowExistsStoredProcedure")(c("LSFactory")(a),{authorityLevel:(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC),blockedByViewerStatus:j.ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED),contactIdType:j.ofNumber(c("LSContactIdType").FBID),contactType:j.ofNumber(c("LSContactType").USER),contactViewerRelationship:j.ofNumber(c("LSContactViewerRelationship").UNKNOWN),gender:j.ofNumber(c("LSContactGender").UNKNOWN),id:f,isBlocked:!1,isMemorialized:!1,isSelf:k===e,workForeignEntityType:j.ofNumber(c("LSContactWorkForeignEntityType").UNKNOWN)})}).then(c("emptyFunction"))},(h||(h=b("Promise"))).resolve())}g.call=a}),98);
__d("MAWBridgeThreadHiddenV2Handler",["LSFactory","LSIntEnum","LSOptimisticRemoveThreadStoredProcedure","LSThreadRemoveType","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b,"MAWBridgeThreadHiddenV2Handler",function(a,b){a=c("LSFactory")(a);return c("LSOptimisticRemoveThreadStoredProcedure")(a,{removeType:(h||(h=d("LSIntEnum"))).ofNumber(c("LSThreadRemoveType").DELETE_THREAD),threadKey:b})})}g.call=a}),98);
__d("MAWBridgeThreadUpdatedHandler",["MAWBridgeBuildThreadSnippet","MAWBridgeUIEventDataValidation","MAWFolderUtils","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","ReQL","getMAWLastMessageCtaType"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){var c=b.folder!=null?d("MAWFolderUtils").getMessagingFolderTag(b.folder):a.folderName;return(b=b.cannotReplyReason)!=null?b:c==="inbox"?void 0:a.cannotReplyReason}async function i(a,b,e){e=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(e));if(e==null)return;var f=d("MAWBridgeBuildThreadSnippet").buildBridgeThreadSnippet(b,e.snippet),g=h(e,b),i=c("getMAWLastMessageCtaType")(b.snippetType);g=babelHelpers.extends({},e,{cannotReplyReason:g,folderName:e.folderName,lastMessageCtaType:i,parentThreadKey:e.parentThreadKey,snippet:f,snippetSenderContactId:b.snippetSenderContactId==null?e.snippetSenderContactId:d("MAWBridgeUIEventDataValidation").stringToI64Opt(b.snippetSenderContactId)});await a.threads.put(g)}function a(a,b){var c=b.threadJid;return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,c,"MAWBridgeThreadUpdatedHandler",function(a,c){return i(a,b,c)})}g.callWithoutWaitingForAnything=i;g.call=a}),98);
__d("MAWBridgeUIEventQueueQPLLogger",["QPLUserFlow","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){c("QPLUserFlow").start(c("qpl")._(1056849266,"1765"),{annotations:{string_array:{events:b}},instanceKey:a})}function b(a,b){c("QPLUserFlow").addAnnotations(c("qpl")._(1056849266,"1765"),b,{instanceKey:a})}function d(a){c("QPLUserFlow").endSuccess(c("qpl")._(1056849266,"1765"),{instanceKey:a})}function e(a,b){c("QPLUserFlow").endFailure(c("qpl")._(1056849266,"1765"),"MAWBridgeUIEventHandlerFailure",{annotations:{string:{failedEventTag:b}},instanceKey:a})}g.start=a;g.addAnnotations=b;g.endSuccess=d;g.endFailure=e}),98);
__d("MAWBridgeUnArchivedSelfDeviceChangeAlertsHandler",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;function a(a,c){return(g||(g=b("Promise"))).resolve()}f.call=a}),66);
__d("MAWBridgeUpdateContactAsConnectedHandler",["FBLogger","I64","LSAddMessengerContactStoredProcedure","LSContactViewerRelationship","LSFactory","LSIntEnum","LSOptimisticAcceptMessageRequestStoredProcedure","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MAWUpdateLSThreadCapabilities","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h,i;async function a(a,b){var e=b.contactUserId;b=b.threadJid;var f=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.contacts).getKeyRange((h||(h=d("I64"))).of_string(e)));if(f==null){c("FBLogger")("messenger_web").warn("Missing contact in MAWBridgeUpdateContactAsConnectedHandler");return}var g=babelHelpers.extends({},f,{contactViewerRelationship:(i||(i=d("LSIntEnum"))).ofNumber(c("LSContactViewerRelationship").CONTACT_OF_VIEWER)});return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b,"MAWBridgeUpdateContactAsConnectedHandler",async function(a,b){await Promise.allSettled([a.contacts.upsert([f.id],g),c("LSAddMessengerContactStoredProcedure")(c("LSFactory")(a),{contactId:f.id}),d("MAWUpdateLSThreadCapabilities").updateNonMessageRequestThreadTxn(a,b),c("LSOptimisticAcceptMessageRequestStoredProcedure")(c("LSFactory")(a),{threadKey:b})])})}g.call=a}),98);
__d("MAWBridgeUpdateE2EEMetadataParticipantsHandler",["LSFactory","LSUpdateE2EEMetadataParticipantsStoredProcedure","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeThreadsLoadedHandler",function(a,b){return c("LSUpdateE2EEMetadataParticipantsStoredProcedure")(c("LSFactory")(a),{threadKey:b})})}g.call=a}),98);
__d("MAWBridgeUpdateThreadActivityHandler",["I64","LSBumpE2EEMetadataThreadStoredProcedure","LSFactory","MAWChatJid","MAWJids","MAWMiActGetThreadLifecycleState__DO_NOT_USE","MWFBLogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i=d("MWFBLogger").MWLogger().tags(["bridgeUIEvent","Occam","ActivityUpdate"]);async function a(a,b){var c=await d("MAWChatJid").toThreadMaybe(a,b.chatJid);if(c==null){await n(a,b.chatJid);return}switch(b.source){case"outgoing_msg":case"incoming_msg":return j(a,c,b);case"deleted_msg":return k(a,c,b);case"inserted_admin_msg":return m(c,b,"No bump for admin message");case"eb_restore":return i.warn("Attempted bump from EB restore");default:b.source;throw i.mustfixThrow("Unknown source")}}async function j(a,b,d){if(l(b,d)){m(b,d,"Stale incoming bump");return}await c("LSBumpE2EEMetadataThreadStoredProcedure")(c("LSFactory")(a),{bumpedByLocalDeviceSend:d.source==="outgoing_msg",isUnbump:!1,serverAuthoritativeTimestampMs:d.bumpTimestampMs,threadKey:b.threadKey});m(b,d,"Thread bumped")}async function k(a,b,c){await a.threads.put(babelHelpers.extends({},b,{lastActivityTimestampMs:(h||(h=d("I64"))).min(b.lastActivityTimestampMs,c.bumpTimestampMs),lastReadWatermarkTimestampMs:h.min(b.lastReadWatermarkTimestampMs,c.bumpTimestampMs)})),m(b,c,"Thread unbumped")}function l(a,b){return b.source==="incoming_msg"&&(h||(h=d("I64"))).le(b.bumpTimestampMs,a.lastActivityTimestampMs)}function m(a,b,c){b=[(h||(h=d("I64"))).to_string(a.threadKey),b.source,h.to_string(b.bumpTimestampMs),h.to_string(a.lastActivityTimestampMs),h.to_string(a.lastReadWatermarkTimestampMs)];i.debug.apply(i,[c+". threadKey: %s, source: %s, bumpTimestampMs: %s, originalLastActivityTimestampMs: %s, originalLastReadWatermarkTimestampMs: %s"].concat(b))}async function n(a,b){a=await d("MAWMiActGetThreadLifecycleState__DO_NOT_USE").getThreadLifecycleStateByJid(a,d("MAWJids").convertChatJidToIntJid(b),"MAWBridgeUpdateThreadActivityHandler");i.mustfix("Missing LSDBThread when updating thread activity. jid: %s, thread state: %s",b,a.type)}g.call=a}),98);
__d("MAWBridgeUpdateTraceHandler",["ArmadilloDataTraceCheckPoint","I64","LSAppendDataTraceAddonStoredProcedure","LSDataTraceCheckPoint","LSFactory","LSIntEnum","MAWBridgeTraceEvent","Promise","ReQL","emptyFunction","updateAndFlushLSDataTrace"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a,e,f){return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.data_trace_meta).filter(function(a){var b=a.contextThree;if(b!=null&&e.externalIds.includes(b)&&(j||(j=d("I64"))).equal(a.traceType,e.traceType))return a.shouldFlush===!1;else return!1})).then(function(g){var i=[];return g.reduce(function(b,g){return b.then(function(){i.push(g.traceId);var b=e.errorMessage;if(b!=null)return c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:f,dataTraceId:g.traceId,errorMessage:b,syncChannel:(j||(j=d("I64"))).neg_one});else return c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:f,dataTraceId:g.traceId,syncChannel:(j||(j=d("I64"))).neg_one})})},(h||(h=b("Promise"))).resolve()).then(function(){return i})})}function l(a,d){return d.reduce(function(b,d){return b.then(function(){return c("updateAndFlushLSDataTrace")(a,d)})},(h||(h=b("Promise"))).resolve())}function a(a,e){var f=e.event;if(f===c("MAWBridgeTraceEvent").ReceivedReceipt)return k(a,e,d("ArmadilloDataTraceCheckPoint").deliveryReceiptReceived).then(function(b){return l(a,b)});else if(f===c("MAWBridgeTraceEvent").ReceivedSent)return k(a,e,d("ArmadilloDataTraceCheckPoint").advancedCryptoMEMSendTaskComplete).then(c("emptyFunction"));else if(f===c("MAWBridgeTraceEvent").FlowEndForFailure)return k(a,e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_FOR_FAILURE)).then(function(b){return l(a,b)});else if(f===c("MAWBridgeTraceEvent").FlowEndForSuccess)return k(a,e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_AND_FLUSH)).then(function(b){return l(a,b)});else return(h||(h=b("Promise"))).resolve()}g.call=a}),98);
__d("MAWBridgeUploadAttachmentHandler",["I64","LSFactory","LSIssueAttachmentBackupTaskStoredProcedure","LSRequestId","MAWEBFrontendQPLLogger","MAWEncryptedBackupUtils","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MAWTimeUtils","Promise","isInstamadilloEB"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,e){var f;if(c("isInstamadilloEB")())return(i||(i=b("Promise"))).resolve();var g=(f=e.traceId)!=null?f:c("LSRequestId").generate();f=e.mediaType;return f==="document"?(i||(i=b("Promise"))).resolve():d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,e.threadJid,"MAWBridgeUploadAttachmentHandler",function(a,f){var j=(h||(h=d("I64"))).to_string(f),k=d("MAWTimeUtils").isTimestampNewerThanXDays(e.ts,30);return d("MAWEncryptedBackupUtils").getBackupTenancy(a).then(function(f){var h=e.productType;if(f!=null&&k)if(g!=null){d("MAWEBFrontendQPLLogger").startFlowUploadAttachmentBackup({deliveryObjectId:e.deliveryObjectId,flow:"old",mediaType:e.mediaType,messageId:e.messageId,threadId:e.threadId,traceId:g});return c("LSIssueAttachmentBackupTaskStoredProcedure")(c("LSFactory")(a),{deliveryObjectId:e.deliveryObjectId,mediaType:e.mediaType,messageId:e.messageId,productType:h,serverThreadKey:j,threadId:e.threadId,traceId:g})}else return c("LSIssueAttachmentBackupTaskStoredProcedure")(c("LSFactory")(a),{deliveryObjectId:e.deliveryObjectId,mediaType:e.mediaType,messageId:e.messageId,productType:h,serverThreadKey:j,threadId:e.threadId});else{d("MAWEBFrontendQPLLogger").endFlowUploadAttachmentBackup(g,!1,"old");return(i||(i=b("Promise"))).resolve()}})})}g.call=a}),98);
__d("MAWBridgeUploadMessageByBatchHandler",["MAWBridgeTraceRecordCheckpointHandler","MAWBridgeUploadMessageHandler","MAWEBFrontendQPLLogger","QPLUserFlow","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){a.forEach(function(a){a.uploadTrackingInstanceKey!=null&&d("MAWEBFrontendQPLLogger").addPointEBUploadTracking(a.uploadTrackingInstanceKey,b)})}async function a(a,b){h(b.messages,"upload_tracking_bridge_batch_handler");b.qpl.forEach(function(a){return c("QPLUserFlow").addPoint(a.event,a.action.name,{instanceKey:a.instanceKey,timestamp:a.timestamp})});b.checkPoint.forEach(function(b){return c("promiseDone")(d("MAWBridgeTraceRecordCheckpointHandler").call(a,b))});for(b of b.messages)await d("MAWBridgeUploadMessageHandler").call(a,b);return Promise.resolve()}g.call=a}),98);
__d("MAWBridgeXMAShareExpiredHandler",["MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,c,d){var e=String(d.xmaId);return a.attachments.get(c,d.msgId,e).then(function(f){if(f==null)return(h||(h=b("Promise"))).resolve();f=[f.defaultCtaId,f.attachmentCta1Id,f.attachmentCta2Id,f.attachmentCta3Id].filter(Boolean);f=f.map(function(b){return a.attachment_ctas["delete"](b)});return(h||(h=b("Promise"))).all(f).then(function(){return a.attachments["delete"](c,d.msgId,e)})})}function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeXMAShareExpiredHandler",function(a,c){return i(a,c,b)})}g.callWithoutWaitingForAnything=i;g.call=a}),98);
__d("MAWBridgeXMAShareTombstonedHandler",["FBLogger","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","ReQL"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e=String(b.xmaId);return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeXMAShareTombstonedHandler",function(a,f){return a.attachments.get(f,b.msgId,e).then(function(g){if(g==null)return Promise.resolve();g=[g.defaultCtaId,g.attachmentCta1Id,g.attachmentCta2Id,g.attachmentCta3Id].filter(Boolean);g=g.map(function(b){return a.attachment_ctas.delete(b)});return Promise.all(g).then(function(){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.attachments).getKeyRange(f,b.msgId,e)).then(async function(b){if(b!=null){b=babelHelpers.extends({},b,{attachmentCta1Id:void 0,attachmentCta2Id:void 0,attachmentCta3Id:void 0,cta1Title:void 0,cta1Type:void 0,cta2Title:void 0,cta2Type:void 0,cta3Title:void 0,cta3Type:void 0,defaultCtaId:void 0,defaultCtaTitle:void 0,maxSubtitleNumOfLines:void 0,maxTitleNumOfLines:void 0,previewHeight:void 0,previewHeightLarge:void 0,previewWidth:void 0,previewWidthLarge:void 0,subtitleText:void 0,titleText:void 0});await a.attachments.put(b)}c("FBLogger")("messenger_web_sharing").blameToPreviousFrame().mustfix("Trying to tombstone a secure xma attachment but no existing attachment");return Promise.resolve()})})})})}g.call=a}),98);
__d("isInstamadilloDYI",["qex"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("qex")._("665")===!0}g["default"]=a}),98);
__d("MAWBridgeUIEventHandler",["EBLogger","MAWAbPropsClient","MAWBridgeAddMessageSearchResultHandler","MAWBridgeCallRestoreNativeOpHandler","MAWBridgeDeleteGroupInviteHandler","MAWBridgeDeleteMessagesHandler","MAWBridgeDeleteMessagesOfThreadHandler","MAWBridgeDeleteReactionHandler","MAWBridgeDropAllSecureThreadsHandler","MAWBridgeEditMsgHistoryAddedHandler","MAWBridgeEphemeralSettingsUpdatedForUIHandler","MAWBridgeFulfillRestorePromisePayloadHandler","MAWBridgeGroupInfoUpdatedHandler","MAWBridgeGroupInviteLoadedHandler","MAWBridgeGroupInviteUpdateHandler","MAWBridgeHandleCOPDigest","MAWBridgeMediaExpiredHandler","MAWBridgeMsgUpdatedHandler","MAWBridgeMsgsStartCountdownHandler","MAWBridgeNewMediaHandler","MAWBridgeNewMediaRangeHandler","MAWBridgeNewMsgHandler","MAWBridgeNewPollHandler","MAWBridgeNewReceiverFetchInfoHandler","MAWBridgeNewXMAHandler","MAWBridgeOccamadilloCreateE2EEMetadataThreadHandlerV2","MAWBridgeOccamadilloVerifyThreadExistsHandler","MAWBridgeOneToOneMessageRequestLoadedHandler","MAWBridgeParticipantRemovedHandler","MAWBridgeParticipantsUpdatedHandler","MAWBridgeRavenActionMsgForUIHandler","MAWBridgeReactionUpsertHandler","MAWBridgeReceivedChatStateHandler","MAWBridgeReceivedReceiptHandler","MAWBridgeRefreshContactHandler","MAWBridgeRemoveMessageSearchResultHandler","MAWBridgeResignAttachmentCDNUrlHandler","MAWBridgeStartTraceHandler","MAWBridgeSyncContacts","MAWBridgeThreadHiddenV2Handler","MAWBridgeThreadUpdatedHandler","MAWBridgeTraceRecordCheckpointHandler","MAWBridgeUIEventQueueQPLLogger","MAWBridgeUnArchivedSelfDeviceChangeAlertsHandler","MAWBridgeUpdateClientRestoreStatus","MAWBridgeUpdateContactAsConnectedHandler","MAWBridgeUpdateE2EEMetadataParticipantsHandler","MAWBridgeUpdateThreadActivityHandler","MAWBridgeUpdateTraceHandler","MAWBridgeUploadAttachmentHandler","MAWBridgeUploadMessageByBatchHandler","MAWBridgeUploadMessageHandler","MAWBridgeXMAShareExpiredHandler","MAWBridgeXMAShareTombstonedHandler","MAWEphemeralMessageExpirationStorage","MAWLoggerUtils","MWFBLogger","WAResultOrError","WATimeUtils","emptyFunction","getErrorSafe","isArmadillo","isInstamadilloDYI","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=d("MWFBLogger").MWLogger().tags(["MAWBridgeUIEvent"]);function l(a,b,c){switch(c.tag){case"NewMsg":return d("MAWBridgeNewMsgHandler").call(b,c.value);case"MsgsStartCountdown":return d("MAWBridgeMsgsStartCountdownHandler").call(b,c.value);case"MsgClearCountdown":return Promise.resolve(d("MAWEphemeralMessageExpirationStorage").clearMessageFromExpiration(c.value));case"DropAllSecureThreads":return d("MAWBridgeDropAllSecureThreadsHandler").call(b);case"VerifyThreadExists":var e=c.value;return d("MAWBridgeOccamadilloVerifyThreadExistsHandler").call(b,e);case"CreateE2EEMetadataThreadV2":return d("MAWBridgeOccamadilloCreateE2EEMetadataThreadHandlerV2").call(b,c.value);case"EditMsgHistoryAdded":return d("MAWBridgeEditMsgHistoryAddedHandler").call(a,b,c.value);case"MsgUpdated":return d("MAWBridgeMsgUpdatedHandler").call(b,c.value);case"NewMedia":return d("MAWBridgeNewMediaHandler").call(b,c.value);case"NewMediaRange":return d("MAWBridgeNewMediaRangeHandler").call(b,c.value);case"MediaExpired":return d("MAWBridgeMediaExpiredHandler").call(b,c.value);case"XMAShareExpired":return d("MAWBridgeXMAShareExpiredHandler").call(b,c.value);case"NewXMA":return d("MAWBridgeNewXMAHandler").call(b,c.value);case"XMAShareTombstoned":return d("MAWBridgeXMAShareTombstonedHandler").call(b,c.value);case"ParticipantRemoved":return d("MAWBridgeParticipantRemovedHandler").call(b,c.value);case"UpdateE2EEMetadataParticipants":return d("MAWBridgeUpdateE2EEMetadataParticipantsHandler").call(b,c.value);case"ReceivedReceipt":return d("MAWBridgeReceivedReceiptHandler").call(b,c.value);case"ThreadUpdated":return d("MAWBridgeThreadUpdatedHandler").call(b,c.value);case"GroupInfoUpdated":return d("MAWBridgeGroupInfoUpdatedHandler").call(b,c.value);case"UpdateThreadActivity":return d("MAWBridgeUpdateThreadActivityHandler").call(b,c.value);case"StartTrace":return d("MAWBridgeStartTraceHandler").call(b,c.value);case"UpdateTrace":return d("MAWBridgeUpdateTraceHandler").call(b,c.value);case"ThreadHiddenV2":return d("MAWBridgeThreadHiddenV2Handler").call(b,c.value);case"SyncContacts":return d("MAWBridgeSyncContacts").call(b,c.value);case"ReceivedChatState":return d("MAWBridgeReceivedChatStateHandler").call(b,c.value);case"ClockSkewUpdated":return Promise.resolve(d("WATimeUtils").setClockSkew(c.value));case"ABPropsUpdated":k.warn("ABPropsUpdated has been deprecated. Please use the bridge with ABPropsUpdated");return Promise.resolve(d("MAWAbPropsClient").rewrite(c.value));case"COPDigestReceived":return d("MAWBridgeHandleCOPDigest").call(b,c.value);case"UpsertReaction":return d("MAWBridgeReactionUpsertHandler").call(b,c.value);case"DeleteReaction":return d("MAWBridgeDeleteReactionHandler").call(b,c.value);case"UploadMessage":return d("MAWBridgeUploadMessageHandler").call(b,c.value);case"UploadMessageByBatch":return d("MAWBridgeUploadMessageByBatchHandler").call(b,c.value);case"DeleteMessagesOfThread":return d("MAWBridgeDeleteMessagesOfThreadHandler").call(b,c.value);case"UploadAttachment":return d("MAWBridgeUploadAttachmentHandler").call(b,c.value);case"ResignAttachmentCDNUrl":return d("MAWBridgeResignAttachmentCDNUrlHandler").call(b,c.value);case"DeleteMessages":return d("MAWBridgeDeleteMessagesHandler").call(b,c.value);case"RestoreMessageBatch":d("EBLogger").EBLogger().tags(["labyrinth_dyi"]).WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Attempted to call the old DYI V1 flow"])));return Promise.resolve();case"OneToOneMessageRequestLoaded":return d("MAWBridgeOneToOneMessageRequestLoadedHandler").call(b,c.value);case"GroupInviteUpdate":return d("MAWBridgeGroupInviteUpdateHandler").call(b,c.value);case"UpdateDyiStatus":d("EBLogger").EBLogger().tags(["labyrinth_dyi"]).WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Attempted to call the old DYI V1 flow"])));return Promise.resolve();case"DeleteGroupInvite":return d("MAWBridgeDeleteGroupInviteHandler").call(b,c.value);case"TraceRecordCheckpoint":return d("MAWBridgeTraceRecordCheckpointHandler").call(b,c.value);case"ParticipantsUpdated":return d("MAWBridgeParticipantsUpdatedHandler").call(b,c.value);case"StartTraceWithTraceId":return Promise.resolve();case"UpdateClientRestoreStatus":return d("MAWBridgeUpdateClientRestoreStatus").call(b,c.value);case"NewMsgs":return d("MAWBridgeNewMsgHandler").bulkCall(b,c.value.msgs);case"UnArchivedSelfDeviceChangeAlerts":return d("MAWBridgeUnArchivedSelfDeviceChangeAlertsHandler").call(b,c.value);case"EphemeralSettingsUpdatedForUI":return d("MAWBridgeEphemeralSettingsUpdatedForUIHandler").call(b,c.value);case"RavenActionUpdate":return d("MAWBridgeRavenActionMsgForUIHandler").call(b,c.value);case"GroupInviteLoaded":return d("MAWBridgeGroupInviteLoadedHandler").call(b,c.value);case"RemoveMessageSearchResult":return d("MAWBridgeRemoveMessageSearchResultHandler").call(b,c.value);case"AddMessageSearchResult":return d("MAWBridgeAddMessageSearchResultHandler").call(a,b,c.value);case"FulfillRestorePromise":return d("MAWBridgeFulfillRestorePromisePayloadHandler").call(c.value);case"UpdateContactAsConnected":return d("MAWBridgeUpdateContactAsConnectedHandler").call(b,c.value);case"RefreshContact":return d("MAWBridgeRefreshContactHandler").call(b,c.value);case"NewReceiverFetchInfo":return d("MAWBridgeNewReceiverFetchInfoHandler").call(b,c.value);case"RestoreNativeOp":return d("MAWBridgeCallRestoreNativeOpHandler").call(b,c.value);case"NewPoll":return d("MAWBridgeNewPollHandler").call(b,c.value);default:return Promise.resolve()}}function a(a,b){if(!c("isArmadillo")()&&!c("isInstamadilloDYI")()){k.mustfix("User is neither part of armadillo QE and dual send QE but somehow loaded this handler");return}if(!(b.length===1&&b[0].tag==="TraceRecordCheckpoint")){var d={};d=b.reduce(function(a,b){a[b.tag]=((b=a[b.tag])!=null?b:0)+1;return a},d);k.DEBUG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Handle UI Events: ",""])),JSON.stringify(d))}c("promiseDone")(m(a,b),c("emptyFunction"),function(a){k.catching(a).mustfix("[MAWBridgeUIEventHandler] Failed to handle UI events: %s",b.map(function(a){return a.tag}).join(", "))})}async function m(a,b){var e=await a;a=d("MAWLoggerUtils").getInstanceKey();var g=b.map(function(a){return a.tag}),h="";d("MAWBridgeUIEventQueueQPLLogger").start(a,g);d("MAWBridgeUIEventQueueQPLLogger").addAnnotations(a,{int:{queue_size:b.length}});var i;try{i=await e.runInTransaction(async function(a){for(var f=0;f<b.length;f++){var g=b[f];try{await l(e,a,g)}catch(a){h=g.tag;return d("WAResultOrError").makeError(c("getErrorSafe")(a))}}return d("WAResultOrError").makeResult(!0)},"readwrite","background",{events:b,type:"maw_ui_bridge"},f.id+":284")}catch(a){i=d("WAResultOrError").makeError(c("getErrorSafe")(a))}!i.success?(d("MAWBridgeUIEventQueueQPLLogger").endFailure(a,h),k.catching(i.error).mustfix("MAWBridgeUIEventHandler] Did not commit UI events to DB, failed at %s, all events: %s",h,g.toString())):d("MAWBridgeUIEventQueueQPLLogger").endSuccess(a)}async function b(a,b,d){try{await l(a,b,d)}catch(b){a=c("getErrorSafe")(b);k.catching(a).mustfix("[handleShimEvent] Failed to handle UI event: %s",d.tag);throw b}}g.handleEvents=a;g.handleShimEvent=b}),98);
__d("MAWBridgeUpdateDYIStatusV2",["EBLogger","EncryptedBackupdDYIFileSaver","EncryptedBackupsDYIFileUtils","EncryptedBackupsDYITypes","QPLUserFlow","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";async function h(a,b,e){d("EncryptedBackupdDYIFileSaver").saveFile(a,b),window.setTimeout(function(){c("promiseDone")(e())},1e3)}async function a(a){var b=a.qplEvent,e=a.qplInstanceKeyE2E;a=a.status;var f=d("EBLogger").EBLogger().tags(["dyi"]);if(a===d("EncryptedBackupsDYITypes").EncryptedBackupsDYIState.Completed)try{if(navigator.storage==null)throw f.mustfixThrow("Storage management API is not supported. Please try one of the supported browsers.");var g=d("EncryptedBackupsDYIFileUtils").DyiArchiveFilename,i=await d("EncryptedBackupsDYIFileUtils").getRootFolderHandle(),j=await d("EncryptedBackupsDYIFileUtils").readFile(i,g);await h(g,j,async function(){await i.removeEntry(g)});f.info("Saving file with filename ",g);b!=null&&e!=null&&c("QPLUserFlow").endSuccess(b,{instanceKey:e});f.info("DYI Complete")}catch(a){f.mustfix("Failed to download the DYI archive: %s",a);b!=null&&e!=null&&c("QPLUserFlow").endFailure(b,a.message,{instanceKey:e});return d("EncryptedBackupsDYITypes").EncryptedBackupsDYIState.Failed}a===d("EncryptedBackupsDYITypes").EncryptedBackupsDYIState.Failed&&(b!=null&&e!=null&&c("QPLUserFlow").endFailure(b,"Unknown error",{instanceKey:e}));return a}g.call=a}),98);
__d("MAWBridgeUploadMessageGQLHandlerSingleTxn",["EBBucketUtils","EBIsEbEnabled","EncryptedBackupsWriteToMPSTables","MAWBridgeGQLUploadUtils","MAWEBFalcoLoggerUtils","MAWEBFrontendQPLLogger","MWEBODSCategory","MWEBODSEntityName.enum","MWEBUseLocalStorage","MWEncryptedBackupsLocalStorageEntryEnum","ODS","WAErrorMessage","WAResultOrError","isInstamadilloEB"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(a,b){try{if(c("isInstamadilloEB")()){d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(b,"upload_tracking_gql_cancelled_instamadillo");b.forEach(function(a){var b=a.echoDocument!=null?"dual_upload":"protobuf_only";d("MAWEBFalcoLoggerUtils").logEBFalcoTaskFailure(a,b,"gql_cancelled_instamadillo")});return d("WAResultOrError").makeError("gql_cancelled_instamadillo")}d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(b,"upload_tracking_gql_handler_single_txn_start");var e="mps_write_failure",g=await a.runInTransaction(async function(f){if(!await d("EBIsEbEnabled").isEbEnabledLS(a.tables)){b.forEach(function(a){if(a.uploadTrackingInstanceKey!=null){var b,e=a.uploadTrackingInstanceKey;d("MAWEBFrontendQPLLogger").addPointEBUploadTracking(e,"user_device_not_enrolled_invalid_gql_request");var f=d("MWEBUseLocalStorage").mwEBGetIsLocalStorageEntryValuePresent(c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_RESTORED_IN_CURRENT_SESSION);b=(b=d("MWEBUseLocalStorage").mwEBGetLocalStorageEntryValue(c("MWEncryptedBackupsLocalStorageEntryEnum").EBSM_CORRUPTION_WIPE))!=null?b:"no";f={bool:{wasEBEnabledPreviously:f},string:{wasEBSMWiped:b}};b=a.echoDocument!=null?"dual_upload":"protobuf_only";d("MAWEBFalcoLoggerUtils").logEBFalcoTaskSkipped(a,b,"user_device_not_enrolled");d("MAWEBFrontendQPLLogger").endEBUploadTracking(e,f)}});var g=[];e="user_device_not_enrolled";return g}else{d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(b,"upload_tracking_gql_handler_mps_write_start");g=await i(f,b);d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(b,"upload_tracking_gql_handler_mps_write_end");return g}},"readwrite",void 0,void 0,f.id+":87");g=g.filter(Boolean);if(g.length===0)return d("WAResultOrError").makeError(e);(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,"graphql.batch.size."+g.length);h.bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,"graphql.batch.bucket"+d("EBBucketUtils").getBucketName(g.length));d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(b,"upload_tracking_gql_handler_upload_start");g.forEach(function(a){var b=a.echoDocument!=null?"dual_upload":"protobuf_only";d("MAWEBFalcoLoggerUtils").logEBFalcoTaskIssued(a,b)});var j=await d("MAWBridgeGQLUploadUtils").uploadMessageOverGQL(a,g);d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(b,"upload_tracking_gql_handler_single_txn_end");!j.success?g.forEach(function(a){var b=a.echoDocument!=null?"dual_upload":"protobuf_only";d("MAWEBFalcoLoggerUtils").logEBFalcoTaskFailure(a,b,j.error)}):g.forEach(function(a){d("MAWEBFalcoLoggerUtils").logEBFalcoEncryptedBackupUploadSuccess(a)});return j}catch(a){b.forEach(function(b){var c=b.echoDocument!=null?"dual_upload":"protobuf_only";d("MAWEBFalcoLoggerUtils").logEBFalcoTaskFailure(b,c,d("WAErrorMessage").maybeGetMessageFromError(a));b.uploadTrackingInstanceKey!=null&&d("MAWEBFrontendQPLLogger").failEBUploadTracking(b.uploadTrackingInstanceKey,"gql_upload_runtime_error",a instanceof Error?{string:{runtime_error:a.message}}:void 0)});return d("WAResultOrError").makeError("gql_upload_runtime_error")}}async function i(a,b){b=b.map(async function(b){var c=b.protoMsg,e=b.uploadTrackingInstanceKey!=null?d("MAWEBFrontendQPLLogger").makeEBFrontendQplFlowFromInstanceKey(b.uploadTrackingInstanceKey):null;if(c!=null){c=c.backupActionType===1?Promise.all([d("EncryptedBackupsWriteToMPSTables").writeToMPSTables(a,c,b.threadId,!1,e),d("EncryptedBackupsWriteToMPSTables").writeTagsToMPSTables(a,c,b.threadId)]).then(function(a){var b=a[0];a[1];return b}):d("EncryptedBackupsWriteToMPSTables").writeToMPSTables(a,c,b.threadId,!1,e);e=await c.then(function(a){if(!a.success&&b.uploadTrackingInstanceKey!=null){d("MAWEBFrontendQPLLogger").failEBUploadTracking(b.uploadTrackingInstanceKey,"mps_write_failed",{string:{error:a.error.errorMsg,errorMsgType:b.messageType}});return null}return b},function(a){b.uploadTrackingInstanceKey!=null&&d("MAWEBFrontendQPLLogger").failEBUploadTracking(b.uploadTrackingInstanceKey,"upload_tracking_gql_handler_failed_mps_write",{string:{error:d("WAErrorMessage").maybeGetMessageFromError(a),errorMsgType:b.messageType}});return null});return e}return b});b=await Promise.all(b);return b.filter(Boolean)}g.call=a}),98);
__d("MAWBridgeUploadMessageByBatchGQLHandler",["FBLogger","MAWBridgeSafeActionsWorkerAndUI","MAWBridgeUploadMessageGQLHandlerSingleTxn","MAWEBFrontendQPLLogger","MWEBODSEntityName.enum","ODS","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(a,b){(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"main_thread");d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(b.messages,"upload_tracking_bridge_batch_handler_gql");var e=await d("MAWBridgeUploadMessageGQLHandlerSingleTxn").call(a,b.messages);if(e.success){a=b.messages.map(function(a){if(a.uploadTrackingInstanceKey!=null)return{instanceKey:a.traceId,success:!0};else return null}).filter(Boolean);d("MAWBridgeSafeActionsWorkerAndUI").fireAndForgetBackendWorkerAndUIShared("ackWithInstanceKeyBatched",{instancesWithOutcomes:a});c("FBLogger")("wmi_eb").info("Successfully completed GQL upload batch of size %s",b.messages.length);return d("WAResultOrError").makeResult()}b.messages.forEach(function(a){a.uploadTrackingInstanceKey!=null&&d("MAWEBFrontendQPLLogger").failEBUploadTracking(a.uploadTrackingInstanceKey,"gql_upload_failed",{string:{error:e.error}})});return d("WAResultOrError").makeError(e.error)}g.call=a}),98);
__d("MWChatEncryptedBackupsAddDeviceWithEBKeys",["EBMainThreadEBDBApiDeferred","EBSMAPI","EBWorkerODSEntityName.enum","MAWBridgeFireAndForget"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.backupId,e=a.db,f=a.newDeviceRegistrationId,g=a.previousDeviceId;return c("EBSMAPI").addDeviceWithEBKeys({backupId:b,db:e,newDeviceRegistrationId:f,previousDeviceId:g,source:c("EBWorkerODSEntityName.enum").MW_EB_AUTO_RESTORE_MAIN_THREAD,trackAddingDevice:function(a){void d("EBMainThreadEBDBApiDeferred").addNewDevice(a)}}).then(function(){return d("MAWBridgeFireAndForget").fireAndForget("backend","addDeviceWithKeysInWorker",{backupId:b,deviceRegistrationId:f,isAutoRestore:!0,previousDeviceId:g,source:c("EBWorkerODSEntityName.enum").MW_EB_AUTO_RESTORE_WORKER})})}g.addDeviceWithEBKeys=a}),98);
__d("MWChatEncryptedBackupsHandleRestoreWrapper.react",["cr:6736","cr:8598","cr:8599","cr:8601"],(function(a,b,c,d,e,f,g){"use strict";function a(){b("cr:8598")==null||b("cr:8598")();b("cr:8599")==null||b("cr:8599")();b("cr:8601")==null||b("cr:8601")();b("cr:6736")==null||b("cr:6736")();return null}g["default"]=a}),98);
__d("useMWV2ChatCloseTabs",["MWChatStateActions","MWChatStateContext","MWChatStateV2.react","MessengerWebEventsFalcoEvent","react","react-compiler-runtime","useCometFeedNoRoutingNavigationEventLogger"],(function(a,b,c,d,e,f,g){"use strict";var h;(h||d("react")).useCallback;function a(){var a=d("react-compiler-runtime").c(4),b=c("useCometFeedNoRoutingNavigationEventLogger")(),e=d("MWChatStateContext").useChatState(j),f=d("MWChatStateV2.react").useDispatch(),g;a[0]!==f||a[1]!==b||a[2]!==e?(g=function(){b(Date.now(),"","messenger");c("MessengerWebEventsFalcoEvent").log(i);var a=Date.now();return f(Array.from(e.values()).flatMap(function(b){return d("MWChatStateActions").closeTab(a,b.tabId)}))},a[0]=f,a[1]=b,a[2]=e,a[3]=g):g=a[3];return g}function i(){return{event_name:"close_all_chat_tabs"}}function j(a){return a.tabs}g["default"]=a}),98);
__d("useMWV2ChatMinimizeTabs",["MWChatStateActions","MWChatStateContext","MWChatStateV2.react","MWChatStateV2IsOpen","MessengerWebEventsFalcoEvent","react","react-compiler-runtime","useCometFeedNoRoutingNavigationEventLogger"],(function(a,b,c,d,e,f,g){"use strict";var h;(h||d("react")).useCallback;function a(){var a=d("react-compiler-runtime").c(4),b=c("useCometFeedNoRoutingNavigationEventLogger")(),e=d("MWChatStateContext").useChatState(k),f=d("MWChatStateV2.react").useDispatch(),g;a[0]!==f||a[1]!==b||a[2]!==e?(g=function(){b(Date.now(),"","messenger");c("MessengerWebEventsFalcoEvent").log(j);var a=Date.now();return f(Array.from(e.values()).filter(i).flatMap(function(b){return d("MWChatStateActions").minimizeTab(a,b.tabId)}))},a[0]=f,a[1]=b,a[2]=e,a[3]=g):g=a[3];return g}function i(a){return d("MWChatStateV2IsOpen").isOpen(void 0,a)}function j(){return{event_name:"minimize_all_chat_tabs"}}function k(a){return a.tabs}g["default"]=a}),98);
__d("MWV2ChatOptionsHeadPopover.react",["fbt","FDSCrossCircleOutline20Icon","FDSMinusCircleOutline20Icon","MWXMenu.react","MWXMenuItem.react","react","react-compiler-runtime","useMWV2ChatCloseTabs","useMWV2ChatMinimizeTabs"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react");function a(a){var b=d("react-compiler-runtime").c(12);a=a.hasOpenTabs;var e=c("useMWV2ChatCloseTabs")(),f=c("useMWV2ChatMinimizeTabs")(),g;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(g=h._(/*BTDS*/"Chat options menu"),b[0]=g):g=b[0];var i;b[1]!==e?(i=function(a){return e()},b[1]=e,b[2]=i):i=b[2];var k;b[3]===Symbol["for"]("react.memo_cache_sentinel")?(k=h._(/*BTDS*/"Close all chats"),b[3]=k):k=b[3];b[4]!==i?(k=j.jsx(c("MWXMenuItem.react"),{icon:c("FDSCrossCircleOutline20Icon"),onClick:i,primaryText:k,testid:void 0}),b[4]=i,b[5]=k):k=b[5];b[6]!==a||b[7]!==f?(i=a?j.jsx(c("MWXMenuItem.react"),{icon:c("FDSMinusCircleOutline20Icon"),onClick:function(a){return f()},primaryText:h._(/*BTDS*/"Minimize open chats"),testid:void 0}):null,b[6]=a,b[7]=f,b[8]=i):i=b[8];b[9]!==k||b[10]!==i?(a=j.jsxs(c("MWXMenu.react"),{"aria-label":g,withArrow:!0,children:[k,i]}),b[9]=k,b[10]=i,b[11]=a):a=b[11];return a}g["default"]=a}),226);
__d("MWV2ChatTabRootLoader.react",["FBLogger","MWV2ChatTabRoot.entrypoint","RelayHooks","react","react-compiler-runtime","useCometRelayEntrypointContextualEnvironmentProvider"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=d("react-compiler-runtime").c(9),e=a.isMinimized,f=a.tab;a=a.threadKeyDescriptor;e=e===void 0?!1:e;var g=c("useCometRelayEntrypointContextualEnvironmentProvider")(),h=f.tabRootEntryPointRef;if(h==null){c("FBLogger")("messenger_web").warn("Missing chat tab entrypoint ref. Loading dynamically.");var j;b[0]!==g?(j=d("RelayHooks").loadEntryPoint(g,c("MWV2ChatTabRoot.entrypoint"),{}),b[0]=g,b[1]=j):j=b[1];h=j}b[2]!==e||b[3]!==f||b[4]!==a?(g={isMinimized:e,tab:f,threadKeyDescriptor:a},b[2]=e,b[3]=f,b[4]=a,b[5]=g):g=b[5];b[6]!==g||b[7]!==h?(j=i.jsx(d("RelayHooks").EntryPointContainer,{entryPointReference:h,props:g}),b[6]=g,b[7]=h,b[8]=j):j=b[8];return j}g["default"]=a}),98);
__d("WebStorageManagerEstimatesFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("2144");b=d("FalcoLoggerInternal").create("web_storage_manager_estimates",a);e=b;g["default"]=e}),98);
__d("mwEBSetBackupState",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=a.setBackupState;a=a.state;switch(a){case 1:break;case 2:b(2);break;case 3:b(3);break;case 4:b(4);break;case-1:b(-1);break;case 0:break}}f["default"]=a}),66);
__d("mwEBUpdateBackupsTable",["LSFactory","LSUpdateBackupsTableStoredProcedure","LSVec"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.backupIds,d=a.deviceIds,e=a.encryptionManagementDelegatorId,g=a.hasOtcEligibleDevices,h=a.isSuccess,i=a.isUserOptedOut,j=a.storage,k=a.virtualDevices;return j.runInTransaction(function(a){return c("LSUpdateBackupsTableStoredProcedure")(c("LSFactory")(a),{backupIds:b,backupMetadata:c("LSVec").ofArray([]),deviceIds:d,encryptionManagementDelegatorId:e,hasOtcEligibleDevices:g,isSuccess:h,isUserOptedOut:i,virtualDevices:k})},"readwrite",void 0,void 0,f.id+":48")}g["default"]=a}),98);
__d("mwProcessBackupIds",["I64","LSAuthorityLevel","LSIntEnum","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEncryptedBackupsFirstRestoreUpsellTime","QPLEvent","QPLUserFlow","WebSession"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k="-1";function l(a){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent,"EB_STATE_"+a+"."),d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent})}function m(a){var b=a.clientStateData;a=a.encryptedBackupData;a=a==null?void 0:a.backupId;if(a==null){l("NO_BACKUPS_PRESENT");return 2}if((h||(h=d("I64"))).to_string(a)===k){d("MWChatEncryptedBackupsLogging").endFailure({errorName:"FETCH_ERROR",event:d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent});return-1}if(b==null||!(h||(h=d("I64"))).equal(b.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))){l("DEVICE_NOT_ONBOARDED");return 4}if(!(h||(h=d("I64"))).equal(b.backupId,a)){l("DEVICE_NOT_ONBOARDED_BACKUP_ID_MISMATCH");return 4}l("DEVICE_ONBOARDED");return 3}function a(a){var b=a.clientStateData;a=a.encryptedBackupData;if(a==null)return 0;var e=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();c("QPLUserFlow").getActiveFlowIDs().includes((j||(j=d("QPLEvent"))).getMarkerId(d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent))||c("QPLUserFlow").start(d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent,{annotations:{string:{ebSessionIdentifier:e,processBackupIdsVersion:"JS",sessionTabId:d("WebSession").getId()}}});if((h||(h=d("I64"))).equal(a.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC))){l("FETCH_IN_PROGRESS");return 1}else if((h||(h=d("I64"))).equal(a.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE)))return m({clientStateData:b,encryptedBackupData:a});else{d("MWChatEncryptedBackupsLogging").endFailure({errorName:"FETCH_ERROR_WRONG_AUTHORITY_LEVEL",event:d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent});return-1}}g["default"]=a}),98);
__d("useMWChatDisplayEncryptedBackupsRestoreToast",["I64","LSEncryptedBackupsClientRestoreState","LSIntEnum","ReQL","ReQLSuspense","react","react-compiler-runtime","useMAWEncryptedBackupsRestoreToast","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;b=k||d("react");var l=b.useEffect,m=b.useState;function a(){var a=d("react-compiler-runtime").c(10),b=(h||(h=c("useReStore")))(),e;a[0]!==b.tables.encrypted_backups_client_restore_status?(e=function(){return d("ReQL").fromTableAscending(b.tables.encrypted_backups_client_restore_status)},a[0]=b.tables.encrypted_backups_client_restore_status,a[1]=e):e=a[1];var g;a[2]!==b?(g=[b],a[2]=b,a[3]=g):g=a[3];var i=d("ReQLSuspense").useArray(e,g,f.id+":27");e=c("useMAWEncryptedBackupsRestoreToast")();var j=e.showInProgressToast,k=e.showSuccessToast;g=m(!1);var o=g[0],p=g[1];a[4]!==o||a[5]!==i||a[6]!==j||a[7]!==k?(e=function(){var a=i.some(n);o&&!a?(p(!1),k()):!o&&a&&(p(!0),j())},g=[o,i,j,k],a[4]=o,a[5]=i,a[6]=j,a[7]=k,a[8]=e,a[9]=g):(e=a[8],g=a[9]);l(e,g)}function n(a){a=a.restoreStatus;return a!=null&&(i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsClientRestoreState").RESTORE_IN_PROGRESS))}g["default"]=a}),98);
__d("useMWChatEncryptedBackupsAutoRestore",["EBSMGatingUI","I64","LSAuthorityLevel","LSIntEnum","MWChatEncryptedBackupsAddDeviceWithEBKeys","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsQPLSource.enum","MWEBEntrypointsKillswitch.enum","MWEBODSEntityName.enum","MWEBUseLocalStorage","MWEncryptedBackupsDeviceRegistrationId","MWEncryptedBackupsFirstRestoreUpsellTime","MWEncryptedBackupsInitializeRestoreDeferred","MWEncryptedBackupsLocalStorageEntryEnum","MWEncryptedBackupsSharedState","ReQL","ReQLSuspense","WALogger","promiseDone","qex","react","react-compiler-runtime","useLabyrinthLogging","useMWEBBackupState","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m;b=m||d("react");var n=b.useEffect,o=b.useRef,p=b.useState;function a(){var a=d("react-compiler-runtime").c(21),b=c("MWChatEncryptedBackupsQPLSource.enum").AUTO_RESTORE,e=p(!0),g=e[0],i=e[1],k=(j||(j=c("useReStore")))();e=d("useLabyrinthLogging").useLabyrinthLoggingFlow();var l=e.startFlow,m;a[0]!==g||a[1]!==k?(e=function(){return g?d("ReQL").fromTableAscending(k.tables.secure_encrypted_backups_epochs):d("ReQL").empty()},m=[g,k],a[0]=g,a[1]=k,a[2]=e,a[3]=m):(e=a[2],m=a[3]);var s=d("ReQLSuspense").useFirst(e,m,f.id+":51");a[4]!==g||a[5]!==k?(e=function(){return g?d("ReQL").fromTableAscending(k.tables.secure_encrypted_backups_client_state).filter(r):d("ReQL").empty()},m=[g,k],a[4]=g,a[5]=k,a[6]=e,a[7]=m):(e=a[6],m=a[7]);var t=d("ReQLSuspense").useFirst(e,m,f.id+":58");a[8]===Symbol["for"]("react.memo_cache_sentinel")?(e={entrypoint:c("MWEBEntrypointsKillswitch.enum").AUTO_RESTORE},a[8]=e):e=a[8];var u=c("useMWEBBackupState")(e);a[9]!==g||a[10]!==k?(m=function(){return g?d("ReQL").fromTableAscending(k.tables.experiences_shared_state):d("ReQL").empty()},e=[g,k],a[9]=g,a[10]=k,a[11]=m,a[12]=e):(m=a[11],e=a[12]);var v=d("ReQLSuspense").useArray(m,e,f.id+":75"),w=o(!1);a[13]!==u||a[14]!==t||a[15]!==s||a[16]!==v||a[17]!==l||a[18]!==k?(m=function(){if(w.current||u===1||u===0)return;if(u===3){var a=t==null?void 0:t.deviceId,e=d("MWEncryptedBackupsSharedState").getIsEntryPresentInSharedState({db:k,sharedStateTable:v,stateKey:"auto_restored"}),f=d("MWEncryptedBackupsSharedState").getIsEntryPresentInSharedState({db:k,sharedStateTable:v,stateKey:c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_RESTORED_SUCCESSFULLY}),g=d("MWEncryptedBackupsSharedState").getIsEntryPresentInSharedState({db:k,sharedStateTable:v,stateKey:c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_ONBOARDED_SUCCESSFULLY});e=e||f||g;f=d("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId();if(!e&&f!==""&&t!=null&&s!=null&&a!=null){d("MWEBUseLocalStorage").mwEBCreateLocalStorageEntry(c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_REMEMBER_BROWSER_CONSENT);l({additionalAnnotations:{device_type:"auto_restore"},event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH,source:b});g=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();l({additionalAnnotations:{eb_session_identifier:g,restore_upsell_first_impression_time:g},event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,source:b});if(c("qex")._("2481"))d("MWEncryptedBackupsInitializeRestoreDeferred").encryptedBackupsInitializeRestoreDeferred({db:k,onFailure:q,onSuccess:function(){c("promiseDone")(d("MWEncryptedBackupsSharedState").upsertEBSharedStateEntry({db:k,stateKey:c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_RESTORED_SUCCESSFULLY})),d("MWChatEncryptedBackupsLogging").endSuccess({annotations:{bool:{is_backend_setup:d("EBSMGatingUI").isBackendSetupSuccessfulForEBSM(),without_add_device:!0},string:{restore_type:"auto_restore"}},event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH}),d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[wmi][eb] initialize auto-restore success"])))}});else{e={backupId:t.backupId,db:k,newDeviceRegistrationId:f,previousDeviceId:a};d("MWChatEncryptedBackupsAddDeviceWithEBKeys").addDeviceWithEBKeys(e)}}}w.current=!0;i(!1)},e=[u,t,s,v,b,l,k],a[13]=u,a[14]=t,a[15]=s,a[16]=v,a[17]=l,a[18]=k,a[19]=m,a[20]=e):(m=a[19],e=a[20]);n(m,e)}function q(){d("MWChatEncryptedBackupsLogging").endFailure({annotations:{bool:{is_backend_setup:d("EBSMGatingUI").isBackendSetupSuccessfulForEBSM(),without_add_device:!0}},errorName:"FAILED_TO_RESTORE_ENCRYPTED_BACKUP",event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),d("MWChatEncryptedBackupsLogging").endFailure({annotations:{bool:{is_backend_setup:d("EBSMGatingUI").isBackendSetupSuccessfulForEBSM()}},errorName:"FAILED_TO_RESTORE_ENCRYPTED_BACKUP",event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH}),d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[wmi][eb] initialize auto-restore failed"])))}function r(a){a=a.authorityLevel;return(k||(k=d("I64"))).equal(a,(l||(l=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))}g["default"]=a}),98);
__d("useMWEBListenForChangesToBackupStateXDevice",["I64","ReQL","ReQLSuspense","react","react-compiler-runtime","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;b=j||d("react");var k=b.useEffect,l=b.useRef;function a(a){var b=d("react-compiler-runtime").c(8),e=(h||(h=c("useReStore")))(),g;b[0]!==e.tables.encrypted_backups_status_trigger?(g=function(){return d("ReQL").fromTableAscending(e.tables.encrypted_backups_status_trigger)},b[0]=e.tables.encrypted_backups_status_trigger,b[1]=g):g=b[1];var j;b[2]!==e?(j=[e],b[2]=e,b[3]=j):j=b[3];var m=d("ReQLSuspense").useFirst(g,j,f.id+":27"),n=l(null);b[4]!==m||b[5]!==a?(g=function(){m!=null&&n.current!==m.pk&&!(i||(i=d("I64"))).equal(m.pk,(i||(i=d("I64"))).of_float(0))&&(n.current=m.pk,a())},j=[m,a],b[4]=m,b[5]=a,b[6]=g,b[7]=j):(g=b[6],j=b[7]);k(g,j)}g["default"]=a}),98);
__d("useMWEBPropagateEbStateChangesThroughRelay",["CometRelay","EBLogger","ReQL","ReQLSuspense","promiseDone","react","requireDeferred","useMAWHasUserVisibleErrors","useMAWUnsupportedBrowserNUX","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;b=k||d("react");var l=b.useCallback,m=b.useEffect,n=b.useRef,o=c("requireDeferred")("mwEBSetBackupState").__setRef("useMWEBPropagateEbStateChangesThroughRelay"),p=c("requireDeferred")("mwProcessBackupIds").__setRef("useMWEBPropagateEbStateChangesThroughRelay");function a(a){var b=a.listenForChangesToBackupState,e=a.onStateChange,g=(j||(j=c("useReStore")))(),k=d("CometRelay").useRelayEnvironment(),q=d("ReQLSuspense").useFirst(function(){return b?d("ReQL").fromTableAscending(g.tables.encrypted_backups):d("ReQL").empty()},[g,b],f.id+":43"),r=d("ReQLSuspense").useFirst(function(){return b?d("ReQL").fromTableAscending(g.tables.secure_encrypted_backups_client_state):d("ReQL").empty()},[g,b],f.id+":50"),s=n(null),t=l(function(a){d("EBLogger").EBLogger().DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[useMWEBPropagateEbStateChangesThroughRelay] update: ",""])),a);var b=s.current;b!==null&&b!==a&&e&&(d("EBLogger").EBLogger().DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["mwEB Backup state changed from "," to "," - triggering onStateChange"])),b,a),e());s.current=a;d("CometRelay").commitLocalUpdate(k,function(b){b=b.getRoot().getLinkedRecord("viewer");if(b==null){d("EBLogger").EBLogger().mustfix("[backup_state] A viewer record does not exist when propagating EB state.");return}b.setValue(a,"backup_state")})},[k,e]);a=d("useMAWUnsupportedBrowserNUX").useMAWUnsupportedBrowserNUX();a=a.shouldHideEBFlow;var u=c("useMAWHasUserVisibleErrors")(),v=a||u;m(function(){async function a(){var a=null;(q!=null||r!=null)&&(a=v?0:(await p.load())({clientStateData:r,encryptedBackupData:q}));a!=null&&(await o.load())({setBackupState:t,state:a})}c("promiseDone")(a())},[r,g,q,k,v,t])}g.default=a}),98);
__d("useMWEncryptedBackupsFetchBackupIdsV2ImplQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="23961239003493663"}),null);
__d("useMWEncryptedBackupsFetchBackupIdsV2ImplQuery.graphql",["useMWEncryptedBackupsFetchBackupIdsV2ImplQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"useMWEncryptedBackupsFetchBackupIdsV2ImplQuery",selections:[{args:null,kind:"FragmentSpread",name:"useMWEncryptedBackupsFetchBackupIdsV2Impl_query"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"useMWEncryptedBackupsFetchBackupIdsV2ImplQuery",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"backup_tenancy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_user_opted_out",storageKey:null},{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'},{alias:null,args:null,kind:"ScalarField",name:"encryption_management_delegator_id",storageKey:null},{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"client_generated_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_created_on",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creation_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"migration_status",storageKey:null},a],storageKey:null},{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesConnection",kind:"LinkedField",name:"devices",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEBDevice",kind:"LinkedField",name:"node",plural:!1,selections:[a],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEBUserPreferences",kind:"LinkedField",name:"xfb_eb_user_preferences",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"onboarding_decision",storageKey:null},a],storageKey:null}]},params:{id:b("useMWEncryptedBackupsFetchBackupIdsV2ImplQuery_facebookRelayOperation"),metadata:{},name:"useMWEncryptedBackupsFetchBackupIdsV2ImplQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("useMWEncryptedBackupsFetchBackupIdsV2Impl_query.graphql",["useMWEncryptedBackupsFetchBackupIdsV2ImplQuery.graphql"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{argumentDefinitions:[],kind:"Fragment",metadata:{refetch:{connection:null,fragmentPathInResult:[],operation:b("useMWEncryptedBackupsFetchBackupIdsV2ImplQuery.graphql")}},name:"useMWEncryptedBackupsFetchBackupIdsV2Impl_query",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"backup_tenancy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_user_opted_out",storageKey:null},{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'},{alias:null,args:null,kind:"ScalarField",name:"encryption_management_delegator_id",storageKey:null},{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"client_generated_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_created_on",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creation_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"migration_status",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesConnection",kind:"LinkedField",name:"devices",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEBDevice",kind:"LinkedField",name:"node",plural:!1,selections:[a],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEBUserPreferences",kind:"LinkedField",name:"xfb_eb_user_preferences",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"onboarding_decision",storageKey:null}],storageKey:null}],type:"Query",abstractKey:null}}();e.exports=a}),null);
__d("useMWEncryptedBackupsFetchBackupIdsV2Query_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="29473760965600491"}),null);
__d("useMWEncryptedBackupsFetchBackupIdsV2Query.graphql",["useMWEncryptedBackupsFetchBackupIdsV2Query_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"useMWEncryptedBackupsFetchBackupIdsV2Query",selections:[{args:null,kind:"FragmentSpread",name:"useMWEncryptedBackupsFetchBackupIdsV2Impl_query"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"useMWEncryptedBackupsFetchBackupIdsV2Query",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"backup_tenancy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_user_opted_out",storageKey:null},{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'},{alias:null,args:null,kind:"ScalarField",name:"encryption_management_delegator_id",storageKey:null},{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"client_generated_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_created_on",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creation_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"migration_status",storageKey:null},a],storageKey:null},{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesConnection",kind:"LinkedField",name:"devices",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEBDevice",kind:"LinkedField",name:"node",plural:!1,selections:[a],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEBUserPreferences",kind:"LinkedField",name:"xfb_eb_user_preferences",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"onboarding_decision",storageKey:null},a],storageKey:null}]},params:{id:b("useMWEncryptedBackupsFetchBackupIdsV2Query_facebookRelayOperation"),metadata:{},name:"useMWEncryptedBackupsFetchBackupIdsV2Query",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("useMWEncryptedBackupsFetchBackupIdsV2",["Base64Utils","CometRelay","EBGating","EBSMAPI","FBLogger","I64","LSEncryptedBackupsBackupTenancy","LSEncryptedBackupsOnboardingDecision","LSEncryptedBackupsVirtualDeviceType","LSIntEnum","LSShape","LSVec","MAWWaitForBackendSetup","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEncryptedBackupsFirstRestoreUpsellTime","MWEncryptedBackupsListenForChangesToBackupStateInitPath","Promise","QPLEvent","QPLUserFlow","WebSession","promiseDone","react","react-compiler-runtime","requireDeferred","useAsyncReStore","useMWEBListenForChangesToBackupStateXDevice","useMWEBPropagateEbStateChangesThroughRelay","useMWEncryptedBackupsFetchBackupIdsV2Impl_query.graphql","useMWEncryptedBackupsFetchBackupIdsV2Query.graphql"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n;e=k||d("react");var o=e.useEffect,p=e.useRef,q=e.useState,r=c("requireDeferred")("mwEBUpdateBackupsTable").__setRef("useMWEncryptedBackupsFetchBackupIdsV2");function s(a){if(a!=null){a=a;a=c("LSEncryptedBackupsOnboardingDecision")[a];return a}return void 0}function t(a){if(a!=null){a=a;a=c("LSEncryptedBackupsBackupTenancy")[a];return(l||(l=d("LSIntEnum"))).ofNumber(a)}return void 0}function u(a){var e=a.data,f=a.dbPromise,g=a.isInitalLoad,h=a.setListenForChangesToBackupState,i=e.xfb_backup,k=i==null?void 0:i.id;if(i!=null&&k!=null){var m=!1;(i==null?void 0:i.has_otc_eligible_devices)!=null?m=i==null?void 0:i.has_otc_eligible_devices:c("FBLogger")("wmi_eb").mustfix("failed to retrieve has_otc_eligible_devices. defaulting to false");var o=c("LSVec").ofArray([d("LSShape").ofRecord({backup_id:(n||(n=d("I64"))).of_string(k),backup_tenancy:t(i.backup_tenancy)})]),p=[];i.virtual_devices.forEach(function(a){var b,e=a.client_generated_id;if(k==null||e==null||a.device_type==null){c("FBLogger")("wmi_eb").warn("Invalid virtual device fetched in fetchBackupsIdsV2.");return}var f="REQUIRES_MIGRATION";f=a.migration_status===f;var g=a.device_type;g=c("LSEncryptedBackupsVirtualDeviceType")[g];p.push(d("LSShape").ofRecord({backup_id:(n||(n=d("I64"))).of_string(k),virtual_device_ids:c("LSVec").ofArray([d("LSShape").ofRecord({virtual_device_id:d("Base64Utils").toArrayBuffer(e)})]),virtual_devices:c("LSVec").ofArray([d("LSShape").ofRecord({creation_time:(b=a.creation_time)!=null?b:void 0,device_created_on:(b=a.device_created_on)!=null?b:void 0,requires_hsm_migration:f,virtual_device_id:d("Base64Utils").toArrayBuffer(e),virtual_device_type:(l||(l=d("LSIntEnum"))).ofNumber(g)})])}))});var q=[];(a=i.devices)==null||a.edges.forEach(function(a){var b;if(((b=a.node)==null?void 0:b.id)==null)return;q.push(d("LSShape").ofRecord({device_id:(n||(n=d("I64"))).of_string((b=a.node)==null?void 0:b.id)}))});var u=i.encryption_management_delegator_id!=null?(n||(n=d("I64"))).of_string(i.encryption_management_delegator_id):void 0;c("promiseDone")((j||(j=b("Promise"))).all([r.load(),f]),function(a){var b=a[0],d=a[1];c("promiseDone")(b({backupIds:o,deviceIds:c("LSVec").ofArray(q),encryptionManagementDelegatorId:u,hasOtcEligibleDevices:m,isSuccess:!0,isUserOptedOut:(a=i.is_user_opted_out)!=null?a:void 0,storage:d,virtualDevices:c("LSVec").ofArray(p)}),function(){h(!0),g.current===!0&&(g.current=!1,c("MWEncryptedBackupsListenForChangesToBackupStateInitPath").preloadEBData(d))})})}else{var v=s((a=e.xfb_eb_user_preferences)==null?void 0:a.onboarding_decision)===c("LSEncryptedBackupsOnboardingDecision").STORE_ON_DEVICE_ONLY;c("promiseDone")((j||(j=b("Promise"))).all([r.load(),f]),function(a){var b=a[0];a=a[1];c("promiseDone")(b({backupIds:c("LSVec").ofArray([]),deviceIds:c("LSVec").ofArray([]),hasOtcEligibleDevices:!1,isSuccess:!0,isUserOptedOut:v,storage:a,virtualDevices:c("LSVec").ofArray([])}),function(){h(!0)})})}}function v(a){var e=d("react-compiler-runtime").c(10),f=c("useAsyncReStore")(),g=p(!0),i=p(!1),j=q(!1),k=j[0],l=j[1];j=d("CometRelay").useRefetchableFragment(h!==void 0?h:h=b("useMWEncryptedBackupsFetchBackupIdsV2Impl_query.graphql"),a);var n=j[0],r=j[1];e[0]!==n||e[1]!==r?(a=function(){var a=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();c("QPLUserFlow").getActiveFlowIDs().includes((m||(m=d("QPLEvent"))).getMarkerId(d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent))||c("QPLUserFlow").start(d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent,{annotations:{string:{ebSessionIdentifier:a,fetchBackupIdsVersion:"GQL",sessionTabId:d("WebSession").getId()}}});r({},{fetchPolicy:"network-only",onComplete:function(a){i.current=!1;if(c("QPLUserFlow").getActiveFlowIDs().includes((m||(m=d("QPLEvent"))).getMarkerId(d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent)))if(a!=null)d("MWChatEncryptedBackupsLogging").endFailure({annotations:{string:{error:a.message,error_stack:a.stack}},errorName:"fetch_backup_ids_error",event:d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent});else{d("MWChatEncryptedBackupsLogging").endSuccess({annotations:{bool:{isUserOptedOut:(a=n.xfb_backup)==null?void 0:a.is_user_opted_out},string:{backup_id:(a=(a=n.xfb_backup)==null?void 0:a.id)!=null?a:"null"}},event:d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent})}}})},e[0]=n,e[1]=r,e[2]=a):a=e[2];j=a;c("useMWEBListenForChangesToBackupStateXDevice")(j);e[3]!==k||e[4]!==j?(a={listenForChangesToBackupState:k,onStateChange:j},e[3]=k,e[4]=j,e[5]=a):a=e[5];c("useMWEBPropagateEbStateChangesThroughRelay")(a);e[6]!==n||e[7]!==f?(k=function(){if(i.current===!0)return;i.current=!0;d("MAWWaitForBackendSetup").isBackendSetupSuccessful()&&d("EBGating").isFetchBackupIdsFromWorker()?c("promiseDone")(c("EBSMAPI").fetchBackupIds("useMWEncryptedBackupsFetchBackupIdsV2").then(function(){l(!0),n.xfb_backup!=null&&n.xfb_backup.id!=null&&g.current===!0&&(g.current=!1)})):u({data:n,dbPromise:f,isInitalLoad:g,setListenForChangesToBackupState:l})},j=[n,f],e[6]=n,e[7]=f,e[8]=k,e[9]=j):(k=e[8],j=e[9]);o(k,j)}function a(){var a=d("CometRelay").useLazyLoadQuery(i!==void 0?i:i=b("useMWEncryptedBackupsFetchBackupIdsV2Query.graphql"),{},{fetchPolicy:"network-only"});v(a)}g["default"]=a}),98);